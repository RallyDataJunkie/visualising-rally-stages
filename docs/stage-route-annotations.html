<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Stage Route Annotations | Visualising WRC Rally Stages With rayshader and R</title>
  <meta name="description" content="Rally stage maps often appear on rally websites displayed via interactive web maps. The data used to generate the routes is often available as a digital data file of some sort. This book takes one such file and embarks on an adventure into the wilds of geocomputing using the R programming language to see just where such a file may take us. From web maps and elevation maps to interactive 3D displays, let the exploration commence…" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Stage Route Annotations | Visualising WRC Rally Stages With rayshader and R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Rally stage maps often appear on rally websites displayed via interactive web maps. The data used to generate the routes is often available as a digital data file of some sort. This book takes one such file and embarks on an adventure into the wilds of geocomputing using the R programming language to see just where such a file may take us. From web maps and elevation maps to interactive 3D displays, let the exploration commence…" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Stage Route Annotations | Visualising WRC Rally Stages With rayshader and R" />
  
  <meta name="twitter:description" content="Rally stage maps often appear on rally websites displayed via interactive web maps. The data used to generate the routes is often available as a digital data file of some sort. This book takes one such file and embarks on an adventure into the wilds of geocomputing using the R programming language to see just where such a file may take us. From web maps and elevation maps to interactive 3D displays, let the exploration commence…" />
  

<meta name="author" content="Tony Hirst" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="introducing-map-projections.html"/>
<link rel="next" href="accessing-and-working-with-elevation-data-raster-files.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3.9000/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.3.9000/leaflet-providers-plugin.js"></script>
<link href="libs/leaflet-awesomemarkers-2.0.3/leaflet.awesome-markers.css" rel="stylesheet" />
<script src="libs/leaflet-awesomemarkers-2.0.3/leaflet.awesome-markers.min.js"></script>
<link href="libs/fontawesome-4.7.0/font-awesome.min.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="in-the-beginning.html"><a href="in-the-beginning.html"><i class="fa fa-check"></i>In the beginning…</a></li>
<li class="chapter" data-level="" data-path="acknowledgements.html"><a href="acknowledgements.html"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#who-this-book-is-for"><i class="fa fa-check"></i><b>1.1</b> Who This Book Is For</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#what-this-book-isnt"><i class="fa fa-check"></i><b>1.2</b> What This Book Isn’t</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#structure-of-the-book"><i class="fa fa-check"></i><b>1.3</b> Structure of the Book</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#further-reading"><i class="fa fa-check"></i><b>1.4</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="getting-started.html"><a href="getting-started.html"><i class="fa fa-check"></i><b>2</b> Getting Started</a>
<ul>
<li class="chapter" data-level="2.1" data-path="getting-started.html"><a href="getting-started.html#setting-up-a-working-code-execution-environment"><i class="fa fa-check"></i><b>2.1</b> Setting Up a Working Code Execution Environment</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="getting-started.html"><a href="getting-started.html#installing-the-docker-environment"><i class="fa fa-check"></i><b>2.1.1</b> Installing the Docker Environment</a></li>
<li class="chapter" data-level="2.1.2" data-path="getting-started.html"><a href="getting-started.html#installing-the-required-r-packages-manually"><i class="fa fa-check"></i><b>2.1.2</b> Installing the Required R Packages Manually</a></li>
<li class="chapter" data-level="2.1.3" data-path="getting-started.html"><a href="getting-started.html#other-installation-dependencies"><i class="fa fa-check"></i><b>2.1.3</b> Other Installation Dependencies</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="getting-started.html"><a href="getting-started.html#using-the-rstudio-environment"><i class="fa fa-check"></i><b>2.2</b> Using the RStudio Environment</a></li>
<li class="chapter" data-level="2.3" data-path="getting-started.html"><a href="getting-started.html#using-a-jupyter-notebook-environment"><i class="fa fa-check"></i><b>2.3</b> Using a Jupyter Notebook Environment</a></li>
<li class="chapter" data-level="2.4" data-path="getting-started.html"><a href="getting-started.html#exploring-the-book-as-an-online-interactive-textbook-not-yet"><i class="fa fa-check"></i><b>2.4</b> Exploring the Book as an Online Interactive Textbook (Not Yet!)</a></li>
<li class="chapter" data-level="2.5" data-path="getting-started.html"><a href="getting-started.html#serving-your-own-map-tiles-and-elevation-raster-images"><i class="fa fa-check"></i><b>2.5</b> Serving Your Own Map Tiles and Elevation Raster Images</a></li>
<li class="chapter" data-level="2.6" data-path="getting-started.html"><a href="getting-started.html#donate"><i class="fa fa-check"></i><b>2.6</b> Donate</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html"><i class="fa fa-check"></i><b>3</b> Importing the Stage Route Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#downloading-the-stage-data-file"><i class="fa fa-check"></i><b>3.1</b> Downloading the Stage Data File</a></li>
<li class="chapter" data-level="3.2" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#opening-kml-geodata-files"><i class="fa fa-check"></i><b>3.2</b> Opening KML Geodata Files</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#using-rgdal-and-sp-to-open-geodata-files"><i class="fa fa-check"></i><b>3.2.1</b> Using <code>rgdal</code> and <code>sp</code> to Open Geodata Files</a></li>
<li class="chapter" data-level="3.2.2" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#using-sf-to-open-geodata-files"><i class="fa fa-check"></i><b>3.2.2</b> Using <code>sf</code> to Open Geodata Files</a></li>
<li class="chapter" data-level="3.2.3" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#accessing-route-data-as-a-geojson-string"><i class="fa fa-check"></i><b>3.2.3</b> Accessing Route Data as a geojson String</a></li>
<li class="chapter" data-level="3.2.4" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#saving-simple-features-data-to-various-geodata-file-formats"><i class="fa fa-check"></i><b>3.2.4</b> Saving Simple Features Data to Various Geodata File Formats</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#important-geodata-file-formats"><i class="fa fa-check"></i><b>3.3</b> Important Geodata File Formats</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#loading-geojson-data"><i class="fa fa-check"></i><b>3.3.1</b> Loading geojson Data</a></li>
<li class="chapter" data-level="3.3.2" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#loading-gpx-data"><i class="fa fa-check"></i><b>3.3.2</b> Loading GPX Data</a></li>
<li class="chapter" data-level="3.3.3" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#loading-flight-data-using-igc-format-gps-files"><i class="fa fa-check"></i><b>3.3.3</b> Loading Flight Data Using IGC format GPS Files</a></li>
<li class="chapter" data-level="3.3.4" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#reading-data-from-gps-devices"><i class="fa fa-check"></i><b>3.3.4</b> Reading Data from GPS Devices</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="working-with-route-data.html"><a href="working-with-route-data.html"><i class="fa fa-check"></i><b>4</b> Working with Route Data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="working-with-route-data.html"><a href="working-with-route-data.html#loading-in-the-route-data"><i class="fa fa-check"></i><b>4.1</b> Loading in the Route Data</a></li>
<li class="chapter" data-level="4.2" data-path="working-with-route-data.html"><a href="working-with-route-data.html#access-a-specific-stage"><i class="fa fa-check"></i><b>4.2</b> Access a specific stage</a></li>
<li class="chapter" data-level="4.3" data-path="working-with-route-data.html"><a href="working-with-route-data.html#visual-preview-of-route-geodata"><i class="fa fa-check"></i><b>4.3</b> Visual Preview of Route Geodata</a></li>
<li class="chapter" data-level="4.4" data-path="working-with-route-data.html"><a href="working-with-route-data.html#previews-using-ggplot2"><i class="fa fa-check"></i><b>4.4</b> Previews using <code>ggplot2</code></a></li>
<li class="chapter" data-level="4.5" data-path="working-with-route-data.html"><a href="working-with-route-data.html#identifying-the-start-and-end-of-the-stage"><i class="fa fa-check"></i><b>4.5</b> Identifying the Start and End of the Stage</a></li>
<li class="chapter" data-level="4.6" data-path="working-with-route-data.html"><a href="working-with-route-data.html#extracting-route-fragments"><i class="fa fa-check"></i><b>4.6</b> Extracting Route Fragments</a></li>
<li class="chapter" data-level="4.7" data-path="working-with-route-data.html"><a href="working-with-route-data.html#previews-using-leaflet-interactive-maps"><i class="fa fa-check"></i><b>4.7</b> Previews Using <code>leaflet</code> Interactive Maps</a></li>
<li class="chapter" data-level="4.8" data-path="working-with-route-data.html"><a href="working-with-route-data.html#creating-buffer-regions-around-features"><i class="fa fa-check"></i><b>4.8</b> Creating Buffer regions around features</a></li>
<li class="chapter" data-level="4.9" data-path="working-with-route-data.html"><a href="working-with-route-data.html#adding-additional-features-to-leaflet-maps"><i class="fa fa-check"></i><b>4.9</b> Adding Additional Features to <code>leaflet</code> maps</a>
<ul>
<li class="chapter" data-level="4.9.1" data-path="working-with-route-data.html"><a href="working-with-route-data.html#add-minimap-navigation"><i class="fa fa-check"></i><b>4.9.1</b> Add “minimap” navigation</a></li>
<li class="chapter" data-level="4.9.2" data-path="working-with-route-data.html"><a href="working-with-route-data.html#add-custom-symbol-legends"><i class="fa fa-check"></i><b>4.9.2</b> Add Custom Symbol Legends</a></li>
<li class="chapter" data-level="4.9.3" data-path="working-with-route-data.html"><a href="working-with-route-data.html#adding-mini-charts-to-maps"><i class="fa fa-check"></i><b>4.9.3</b> Adding Mini-Charts to Maps</a></li>
<li class="chapter" data-level="4.9.4" data-path="working-with-route-data.html"><a href="working-with-route-data.html#adding-html-content-to-popups"><i class="fa fa-check"></i><b>4.9.4</b> Adding HTML content to popups</a></li>
</ul></li>
<li class="chapter" data-level="4.10" data-path="working-with-route-data.html"><a href="working-with-route-data.html#using-mapview-to-create-leaflet-maps"><i class="fa fa-check"></i><b>4.10</b> Using <code>mapview</code> To Create <em>leaflet</em> Maps</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html"><i class="fa fa-check"></i><b>5</b> Introducing Map Projections</a>
<ul>
<li class="chapter" data-level="5.1" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#load-in-the-route-data"><i class="fa fa-check"></i><b>5.1</b> Load in the Route Data</a></li>
<li class="chapter" data-level="5.2" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#previewing-a-map-route"><i class="fa fa-check"></i><b>5.2</b> Previewing a Map Route</a></li>
<li class="chapter" data-level="5.3" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#plotting-latlong-naively"><i class="fa fa-check"></i><b>5.3</b> Plotting LatLong Naively</a></li>
<li class="chapter" data-level="5.4" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#using-the-utm-co-ordinate-reference-system"><i class="fa fa-check"></i><b>5.4</b> Using the UTM Co-ordinate Reference System</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#using-st_transform-for-projection-transformations"><i class="fa fa-check"></i><b>5.4.1</b> Using <code>st_transform</code> for Projection Transformations</a></li>
<li class="chapter" data-level="5.4.2" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#using-ggplot2coord_sf-to-render-projections"><i class="fa fa-check"></i><b>5.4.2</b> Using <code>ggplot2::coord_sf</code> to Render Projections</a></li>
<li class="chapter" data-level="5.4.3" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#exporting-the-route-data-as-a-dataframe"><i class="fa fa-check"></i><b>5.4.3</b> Exporting the Route Data As a Dataframe</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#alternative-crs-projections"><i class="fa fa-check"></i><b>5.5</b> Alternative CRS Projections</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="stage-route-annotations.html"><a href="stage-route-annotations.html"><i class="fa fa-check"></i><b>6</b> Stage Route Annotations</a>
<ul>
<li class="chapter" data-level="6.1" data-path="stage-route-annotations.html"><a href="stage-route-annotations.html#load-in-the-route-data-1"><i class="fa fa-check"></i><b>6.1</b> Load in the Route Data</a></li>
<li class="chapter" data-level="6.2" data-path="stage-route-annotations.html"><a href="stage-route-annotations.html#adding-split-point-locations"><i class="fa fa-check"></i><b>6.2</b> Adding Split Point Locations</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="stage-route-annotations.html"><a href="stage-route-annotations.html#using-geojson-to-find-the-distance-along-a-route"><i class="fa fa-check"></i><b>6.2.1</b> Using geojson to Find the Distance Along a Route</a></li>
<li class="chapter" data-level="6.2.2" data-path="stage-route-annotations.html"><a href="stage-route-annotations.html#using-rgeosginterpolate-to-find-the-distance-along-a-route"><i class="fa fa-check"></i><b>6.2.2</b> Using <code>rgeos::gInterpolate</code> to Find the Distance Along a Route</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="stage-route-annotations.html"><a href="stage-route-annotations.html#parallel-routes"><i class="fa fa-check"></i><b>6.3</b> Parallel Routes</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html"><i class="fa fa-check"></i><b>7</b> Accessing and Working With Elevation Data Raster Files</a>
<ul>
<li class="chapter" data-level="7.1" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#introducing-digital-elevation-model-dem-raster-images"><i class="fa fa-check"></i><b>7.1</b> Introducing Digital Elevation Model (DEM) Raster Images</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#what-is-raster-data"><i class="fa fa-check"></i><b>7.1.1</b> What Is Raster Data?</a></li>
<li class="chapter" data-level="7.1.2" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#what-are-digital-elevation-models-dems"><i class="fa fa-check"></i><b>7.1.2</b> What Are Digital Elevation Models (DEMs)?</a></li>
<li class="chapter" data-level="7.1.3" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#the-r-raster-package"><i class="fa fa-check"></i><b>7.1.3</b> The R <code>raster</code> Package</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#downloading-elevation-data"><i class="fa fa-check"></i><b>7.2</b> Downloading Elevation Data</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#loading-in-some-stage-data"><i class="fa fa-check"></i><b>7.2.1</b> Loading in some stage data</a></li>
<li class="chapter" data-level="7.2.2" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#obtaining-relief-elevation-raster-data-using-elevatr"><i class="fa fa-check"></i><b>7.2.2</b> Obtaining relief / elevation raster data using <code>elevatr</code></a></li>
<li class="chapter" data-level="7.2.3" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#plotting-rasters-as-ggplot-objects"><i class="fa fa-check"></i><b>7.2.3</b> Plotting Rasters As <code>ggplot</code> Objects</a></li>
<li class="chapter" data-level="7.2.4" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#interactive-raster-previews-with-plainview"><i class="fa fa-check"></i><b>7.2.4</b> Interactive Raster Previews with <code>plainview</code></a></li>
<li class="chapter" data-level="7.2.5" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#saving-the-image-raster-data-to-a-local-file"><i class="fa fa-check"></i><b>7.2.5</b> Saving the Image Raster Data to a Local File</a></li>
<li class="chapter" data-level="7.2.6" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#from-raster-to-terra"><i class="fa fa-check"></i><b>7.2.6</b> From <code>raster</code> to <code>terra</code></a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#overlaying-raster-images-on-leaflet-maps"><i class="fa fa-check"></i><b>7.3</b> Overlaying Raster Images on Leaflet Maps</a></li>
<li class="chapter" data-level="7.4" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#retrieving-descriptive-information-about-the-raster"><i class="fa fa-check"></i><b>7.4</b> Retrieving Descriptive Information About the Raster</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#using-mapzen-to-retrieve-dem-raster-data"><i class="fa fa-check"></i><b>7.4.1</b> Using Mapzen to Retrieve DEM raster data</a></li>
<li class="chapter" data-level="7.4.2" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#additional-elevation-data-downloading-tools"><i class="fa fa-check"></i><b>7.4.2</b> Additional Elevation Data Downloading Tools</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#manipulating-raster-images"><i class="fa fa-check"></i><b>7.5</b> Manipulating Raster Images</a></li>
<li class="chapter" data-level="7.6" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#ridge-maps"><i class="fa fa-check"></i><b>7.6</b> Ridge maps</a></li>
<li class="chapter" data-level="7.7" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#further-information"><i class="fa fa-check"></i><b>7.7</b> Further Information</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="determining-terrain-features-from-raster-data.html"><a href="determining-terrain-features-from-raster-data.html"><i class="fa fa-check"></i><b>8</b> Determining Terrain Features from Raster Data</a>
<ul>
<li class="chapter" data-level="8.1" data-path="determining-terrain-features-from-raster-data.html"><a href="determining-terrain-features-from-raster-data.html#load-in-base-data"><i class="fa fa-check"></i><b>8.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="8.2" data-path="determining-terrain-features-from-raster-data.html"><a href="determining-terrain-features-from-raster-data.html#rendering-terrain-over-raster-images"><i class="fa fa-check"></i><b>8.2</b> Rendering Terrain Over Raster Images</a></li>
<li class="chapter" data-level="8.3" data-path="determining-terrain-features-from-raster-data.html"><a href="determining-terrain-features-from-raster-data.html#adding-contours-to-raster-images"><i class="fa fa-check"></i><b>8.3</b> Adding Contours to <code>raster</code> Images</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="using-rayshader-to-render-2d-elevation-and-shade-views.html"><a href="using-rayshader-to-render-2d-elevation-and-shade-views.html"><i class="fa fa-check"></i><b>9</b> Using <code>rayshader</code> to Render 2D Elevation and Shade Views</a>
<ul>
<li class="chapter" data-level="9.1" data-path="using-rayshader-to-render-2d-elevation-and-shade-views.html"><a href="using-rayshader-to-render-2d-elevation-and-shade-views.html#load-in-base-data-1"><i class="fa fa-check"></i><b>9.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="9.2" data-path="using-rayshader-to-render-2d-elevation-and-shade-views.html"><a href="using-rayshader-to-render-2d-elevation-and-shade-views.html#rendering-imagery-from-the-dem-raster"><i class="fa fa-check"></i><b>9.2</b> Rendering imagery from the DEM raster</a></li>
<li class="chapter" data-level="9.3" data-path="using-rayshader-to-render-2d-elevation-and-shade-views.html"><a href="using-rayshader-to-render-2d-elevation-and-shade-views.html#roundtripping-rayshader-rasters-and-matrices"><i class="fa fa-check"></i><b>9.3</b> Roundtripping <code>rayshader</code> Rasters and Matrices</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html"><i class="fa fa-check"></i><b>10</b> Overlaying 2D <code>rayshader</code> Maps</a>
<ul>
<li class="chapter" data-level="10.1" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#load-in-base-data-2"><i class="fa fa-check"></i><b>10.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="10.2" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#adding-overlays"><i class="fa fa-check"></i><b>10.2</b> Adding overlays</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#adding-shadows-to-rayshader-maps"><i class="fa fa-check"></i><b>10.2.1</b> Adding Shadows to <code>rayshader</code> Maps</a></li>
<li class="chapter" data-level="10.2.2" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#adding-water-features"><i class="fa fa-check"></i><b>10.2.2</b> Adding Water Features</a></li>
<li class="chapter" data-level="10.2.3" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#overlaying-map-tiles"><i class="fa fa-check"></i><b>10.2.3</b> Overlaying Map Tiles</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#adding-a-stage-route-layer"><i class="fa fa-check"></i><b>10.3</b> Adding a Stage Route Layer</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#buffering-the-stage-route-view"><i class="fa fa-check"></i><b>10.3.1</b> Buffering the Stage Route View</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#modeling-increased-water-levels"><i class="fa fa-check"></i><b>10.4</b> Modeling Increased Water Levels</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="annotating-rayshader-maps.html"><a href="annotating-rayshader-maps.html"><i class="fa fa-check"></i><b>11</b> Annotating <code>rayshader</code> maps</a>
<ul>
<li class="chapter" data-level="11.1" data-path="annotating-rayshader-maps.html"><a href="annotating-rayshader-maps.html#load-in-base-data-3"><i class="fa fa-check"></i><b>11.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="11.2" data-path="annotating-rayshader-maps.html"><a href="annotating-rayshader-maps.html#adding-a-title-to-a-map"><i class="fa fa-check"></i><b>11.2</b> Adding a Title to a Map</a></li>
<li class="chapter" data-level="11.3" data-path="annotating-rayshader-maps.html"><a href="annotating-rayshader-maps.html#adding-contours-to-rayshader-stage-maps"><i class="fa fa-check"></i><b>11.3</b> Adding Contours to <code>rayshader</code> Stage Maps</a></li>
<li class="chapter" data-level="11.4" data-path="annotating-rayshader-maps.html"><a href="annotating-rayshader-maps.html#overlaying-image-tiles"><i class="fa fa-check"></i><b>11.4</b> Overlaying Image Tiles</a></li>
<li class="chapter" data-level="11.5" data-path="annotating-rayshader-maps.html"><a href="annotating-rayshader-maps.html#plotting-route-layers-on-rayshader-maps"><i class="fa fa-check"></i><b>11.5</b> Plotting Route Layers on <code>rayshader</code> Maps</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="an-aside-the-penny-red.html"><a href="an-aside-the-penny-red.html"><i class="fa fa-check"></i>An Aside - The Penny Red</a>
<ul>
<li><a href="an-aside-the-penny-red.html#d-rendering-of-colour-images-using-rayshader">3D Rendering of Colour Images Using <code>rayshader</code></a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="an-aside-the-penny-red.html"><a href="an-aside-the-penny-red.html#rendering-the-image-directly-from-ggplot2"><i class="fa fa-check"></i><b>11.5.1</b> Rendering the image directly from <code>ggplot2</code></a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="an-aside-the-penny-red.html"><a href="an-aside-the-penny-red.html#rendering-a-movie"><i class="fa fa-check"></i><b>11.6</b> Rendering a Movie</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html"><i class="fa fa-check"></i><b>12</b> Introducing 3D <code>rayshader</code> Models</a>
<ul>
<li class="chapter" data-level="12.1" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#rendering-the-3d-maps-in-rstudio-and-knitrable-rmd-documents"><i class="fa fa-check"></i><b>12.1</b> Rendering the 3D Maps in <em>RStudio&amp; and <code>knitr</code>able </em>Rmd* Documents</a></li>
<li class="chapter" data-level="12.2" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#rendering-a-3d-view"><i class="fa fa-check"></i><b>12.2</b> Rendering a 3D View</a></li>
<li class="chapter" data-level="12.3" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#the-rayshader-3d-model-plinth"><i class="fa fa-check"></i><b>12.3</b> The <code>rayshader</code> 3D Model Plinth</a></li>
<li class="chapter" data-level="12.4" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#saving-the-widget-as-an-html-file"><i class="fa fa-check"></i><b>12.4</b> Saving the Widget as an HTML File</a></li>
<li class="chapter" data-level="12.5" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#rendering-the-model-to-an-image-file"><i class="fa fa-check"></i><b>12.5</b> Rendering the Model to an Image File</a></li>
<li class="chapter" data-level="12.6" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#rendering-high-quality-models"><i class="fa fa-check"></i><b>12.6</b> Rendering High Quality Models</a></li>
<li class="chapter" data-level="12.7" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#making-a-3d-print-file"><i class="fa fa-check"></i><b>12.7</b> Making a 3D Print File</a></li>
<li class="chapter" data-level="12.8" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#saving-a-movie-of-a-3d-model"><i class="fa fa-check"></i><b>12.8</b> Saving a Movie of a 3D Model</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="rendering-3d-rayshader-stage-route-maps.html"><a href="rendering-3d-rayshader-stage-route-maps.html"><i class="fa fa-check"></i><b>13</b> Rendering 3D <code>rayshader</code> Stage Route Maps</a>
<ul>
<li class="chapter" data-level="13.1" data-path="rendering-3d-rayshader-stage-route-maps.html"><a href="rendering-3d-rayshader-stage-route-maps.html#load-in-base-data-4"><i class="fa fa-check"></i><b>13.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="13.2" data-path="rendering-3d-rayshader-stage-route-maps.html"><a href="rendering-3d-rayshader-stage-route-maps.html#setting-up-3d-embedded-plots"><i class="fa fa-check"></i><b>13.2</b> Setting Up 3D Embedded Plots</a></li>
<li class="chapter" data-level="13.3" data-path="rendering-3d-rayshader-stage-route-maps.html"><a href="rendering-3d-rayshader-stage-route-maps.html#rendering-a-simple-stage-route-model"><i class="fa fa-check"></i><b>13.3</b> Rendering a Simple Stage Route Model</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="rendering-3d-rayshader-stage-route-maps.html"><a href="rendering-3d-rayshader-stage-route-maps.html#decorating-3d-views-with-map-tile-overlays"><i class="fa fa-check"></i><b>13.3.1</b> Decorating 3D Views With Map Tile Overlays</a></li>
<li class="chapter" data-level="13.3.2" data-path="rendering-3d-rayshader-stage-route-maps.html"><a href="rendering-3d-rayshader-stage-route-maps.html#adding-labels-to-3d-rayshader-maps"><i class="fa fa-check"></i><b>13.3.2</b> Adding Labels to 3D <code>rayshader</code> Maps</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="creating-cropped-3d-rayshader-models.html"><a href="creating-cropped-3d-rayshader-models.html"><i class="fa fa-check"></i><b>14</b> Creating Cropped 3d <code>rayshader</code> Models</a>
<ul>
<li class="chapter" data-level="14.1" data-path="creating-cropped-3d-rayshader-models.html"><a href="creating-cropped-3d-rayshader-models.html#load-in-base-data-5"><i class="fa fa-check"></i><b>14.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="14.2" data-path="creating-cropped-3d-rayshader-models.html"><a href="creating-cropped-3d-rayshader-models.html#cropping-the-rendered-3d-view"><i class="fa fa-check"></i><b>14.2</b> Cropping the Rendered 3D View</a></li>
<li class="chapter" data-level="14.3" data-path="creating-cropped-3d-rayshader-models.html"><a href="creating-cropped-3d-rayshader-models.html#cropping-3d-models-to-a-buffered-region"><i class="fa fa-check"></i><b>14.3</b> Cropping 3D Models to a Buffered Region</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="obtaining-shadows-for-a-particular-date-and-time.html"><a href="obtaining-shadows-for-a-particular-date-and-time.html"><i class="fa fa-check"></i><b>15</b> Obtaining Shadows for a Particular Date and Time</a>
<ul>
<li class="chapter" data-level="15.1" data-path="obtaining-shadows-for-a-particular-date-and-time.html"><a href="obtaining-shadows-for-a-particular-date-and-time.html#load-in-base-data-6"><i class="fa fa-check"></i><b>15.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="15.2" data-path="obtaining-shadows-for-a-particular-date-and-time.html"><a href="obtaining-shadows-for-a-particular-date-and-time.html#sunlight-times-vocabulary"><i class="fa fa-check"></i><b>15.2</b> Sunlight Times Vocabulary</a></li>
<li class="chapter" data-level="15.3" data-path="obtaining-shadows-for-a-particular-date-and-time.html"><a href="obtaining-shadows-for-a-particular-date-and-time.html#finding-sunrise-and-sunset-times"><i class="fa fa-check"></i><b>15.3</b> Finding Sunrise and Sunset Times</a></li>
<li class="chapter" data-level="15.4" data-path="obtaining-shadows-for-a-particular-date-and-time.html"><a href="obtaining-shadows-for-a-particular-date-and-time.html#animating-shade"><i class="fa fa-check"></i><b>15.4</b> Animating Shade</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html"><i class="fa fa-check"></i><b>16</b> Composing <code>rayshader</code> Stills and Movies</a>
<ul>
<li class="chapter" data-level="16.1" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html#load-in-base-data-7"><i class="fa fa-check"></i><b>16.1</b> Load in Base Data</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html#adding-complications"><i class="fa fa-check"></i><b>16.1.1</b> Adding Complications…</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html#setting-up-the-camera-shots-in-rayshader"><i class="fa fa-check"></i><b>16.2</b> Setting Up the Camera Shots in <code>rayshader</code></a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html#depth-of-field"><i class="fa fa-check"></i><b>16.2.1</b> Depth of Field</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html#camera-positioning"><i class="fa fa-check"></i><b>16.3</b> Camera Positioning</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html#lighting-effects"><i class="fa fa-check"></i><b>16.3.1</b> Lighting Effects</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html#making-3d-video-tracking-shots"><i class="fa fa-check"></i><b>16.4</b> Making 3D Video Tracking Shots</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html"><i class="fa fa-check"></i><b>17</b> Stage Route Analysis</a>
<ul>
<li class="chapter" data-level="17.1" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#load-in-base-data-8"><i class="fa fa-check"></i><b>17.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="17.2" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#generating-stage-route-profiles"><i class="fa fa-check"></i><b>17.2</b> Generating Stage Route Profiles</a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#an-aside---twists-and-turns-of-rally-stages"><i class="fa fa-check"></i><b>17.2.1</b> An Aside - Twists and Turns of Rally Stages</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#finding-stage-route-lengths"><i class="fa fa-check"></i><b>17.3</b> Finding Stage Route Lengths</a></li>
<li class="chapter" data-level="17.4" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#using-ecological-movement-analysis-tools-to-analyse-stage-routes"><i class="fa fa-check"></i><b>17.4</b> Using Ecological Movement Analysis Tools to Analyse Stage Routes</a></li>
<li class="chapter" data-level="17.5" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#using-trajr-for-stage-route-profiling"><i class="fa fa-check"></i><b>17.5</b> Using <code>trajr</code> for Stage Route Profiling</a>
<ul>
<li class="chapter" data-level="17.5.1" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#smoothing-a-trajectory"><i class="fa fa-check"></i><b>17.5.1</b> Smoothing a Trajectory</a></li>
<li class="chapter" data-level="17.5.2" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#resampling-locations"><i class="fa fa-check"></i><b>17.5.2</b> Resampling Locations</a></li>
<li class="chapter" data-level="17.5.3" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#resampling-against-distance"><i class="fa fa-check"></i><b>17.5.3</b> Resampling Against Distance</a></li>
<li class="chapter" data-level="17.5.4" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#splitting-a-trajectory"><i class="fa fa-check"></i><b>17.5.4</b> Splitting a Trajectory</a></li>
<li class="chapter" data-level="17.5.5" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#rotating-the-stage-trajectory"><i class="fa fa-check"></i><b>17.5.5</b> Rotating the Stage Trajectory</a></li>
<li class="chapter" data-level="17.5.6" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#straightness-and-sinuosity"><i class="fa fa-check"></i><b>17.5.6</b> Straightness and Sinuosity</a></li>
<li class="chapter" data-level="17.5.7" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#directional-change"><i class="fa fa-check"></i><b>17.5.7</b> Directional Change</a></li>
<li class="chapter" data-level="17.5.8" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#tracking-turning-angles"><i class="fa fa-check"></i><b>17.5.8</b> Tracking Turning Angles</a></li>
<li class="chapter" data-level="17.5.9" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#visualising-trajectory-direction-changes"><i class="fa fa-check"></i><b>17.5.9</b> Visualising Trajectory Direction Changes</a></li>
<li class="chapter" data-level="17.5.10" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#using-amt-for-stage-route-profiling"><i class="fa fa-check"></i><b>17.5.10</b> Using <code>amt</code> for Stage Route Profiling</a></li>
<li class="chapter" data-level="17.5.11" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#creating-tracks"><i class="fa fa-check"></i><b>17.5.11</b> Creating Tracks</a></li>
<li class="chapter" data-level="17.5.12" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#converting-to-other-track-formats"><i class="fa fa-check"></i><b>17.5.12</b> Converting to Other Track Formats</a></li>
<li class="chapter" data-level="17.5.13" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#using-amt-for-stage-route-analysis"><i class="fa fa-check"></i><b>17.5.13</b> Using <code>amt</code> for Stage Route Analysis</a></li>
<li class="chapter" data-level="17.5.14" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#using-rlft-for-profiling-along-a-stage-route"><i class="fa fa-check"></i><b>17.5.14</b> Using `rLFT`` for Profiling Along a Stage Route</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="revisiting-elevation-data.html"><a href="revisiting-elevation-data.html"><i class="fa fa-check"></i><b>18</b> Revisiting Elevation Data</a>
<ul>
<li class="chapter" data-level="18.1" data-path="revisiting-elevation-data.html"><a href="revisiting-elevation-data.html#load-in-base-data-9"><i class="fa fa-check"></i><b>18.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="18.2" data-path="revisiting-elevation-data.html"><a href="revisiting-elevation-data.html#generating-elevation-maps"><i class="fa fa-check"></i><b>18.2</b> Generating Elevation Maps</a>
<ul>
<li class="chapter" data-level="18.2.1" data-path="revisiting-elevation-data.html"><a href="revisiting-elevation-data.html#accessing-elevation-values-along-a-route-from-an-elevation-raster"><i class="fa fa-check"></i><b>18.2.1</b> Accessing Elevation Values Along a Route from an Elevation Raster</a></li>
<li class="chapter" data-level="18.2.2" data-path="revisiting-elevation-data.html"><a href="revisiting-elevation-data.html#using-geospheredistgeo-to-find-distance-along-a-route"><i class="fa fa-check"></i><b>18.2.2</b> Using <code>geosphere::distGeo</code> to Find Distance Along a Route</a></li>
<li class="chapter" data-level="18.2.3" data-path="revisiting-elevation-data.html"><a href="revisiting-elevation-data.html#using-spspdists-to-find-distance-along-a-route"><i class="fa fa-check"></i><b>18.2.3</b> Using <code>sp::spDists</code> to Find Distance Along a Route</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="revisiting-elevation-data.html"><a href="revisiting-elevation-data.html#generating-a-3d-ribbon-plot-of-the-stage-route"><i class="fa fa-check"></i><b>18.3</b> Generating a 3D Ribbon Plot of the Stage Route</a></li>
<li class="chapter" data-level="18.4" data-path="revisiting-elevation-data.html"><a href="revisiting-elevation-data.html#identifying-road-type"><i class="fa fa-check"></i><b>18.4</b> Identifying Road Type</a></li>
<li class="chapter" data-level="18.5" data-path="revisiting-elevation-data.html"><a href="revisiting-elevation-data.html#displaying-route-twistiness-and-elevation"><i class="fa fa-check"></i><b>18.5</b> Displaying Route Twistiness and Elevation</a>
<ul>
<li class="chapter" data-level="18.5.1" data-path="revisiting-elevation-data.html"><a href="revisiting-elevation-data.html#making-a-3d-print-file-of-the-model"><i class="fa fa-check"></i><b>18.5.1</b> Making a 3D Print File of the Model</a></li>
<li class="chapter" data-level="18.5.2" data-path="revisiting-elevation-data.html"><a href="revisiting-elevation-data.html#rendering-a-3d-movie-of-the-model"><i class="fa fa-check"></i><b>18.5.2</b> Rendering a 3D movie of the Model</a></li>
</ul></li>
<li class="chapter" data-level="18.6" data-path="revisiting-elevation-data.html"><a href="revisiting-elevation-data.html#using-the-slopes-package-to-analyse-stage-elevation-data"><i class="fa fa-check"></i><b>18.6</b> Using the <code>slopes</code> Package to Analyse Stage Elevation Data</a></li>
<li class="chapter" data-level="18.7" data-path="revisiting-elevation-data.html"><a href="revisiting-elevation-data.html#analysing-route-elevation-from-first-principles"><i class="fa fa-check"></i><b>18.7</b> Analysing Route Elevation from First Principles</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html"><i class="fa fa-check"></i><b>19</b> Adding <em>OpenStreetMap</em> Data</a>
<ul>
<li class="chapter" data-level="19.1" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#load-in-base-data-10"><i class="fa fa-check"></i><b>19.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="19.2" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#adding-detail-and-features-from-openstreetmap"><i class="fa fa-check"></i><b>19.2</b> Adding Detail and Features from OpenStreetMap</a>
<ul>
<li class="chapter" data-level="19.2.1" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#plotting-osm-highways"><i class="fa fa-check"></i><b>19.2.1</b> Plotting OSM Highways</a></li>
</ul></li>
<li class="chapter" data-level="19.3" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#viewing-roads-in-the-vicinity-of-a-route"><i class="fa fa-check"></i><b>19.3</b> Viewing Roads in the Vicinity of a Route</a>
<ul>
<li class="chapter" data-level="19.3.1" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#using-sfst_buffer-to-create-buffered-areas"><i class="fa fa-check"></i><b>19.3.1</b> Using <code>sf::st_buffer</code> to Create Buffered Areas</a></li>
<li class="chapter" data-level="19.3.2" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#using-rgeosgbuffer-to-create-buffered-areas"><i class="fa fa-check"></i><b>19.3.2</b> Using <code>rgeos::gBuffer</code> to Create Buffered Areas</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#adding-additional-data-from-osm"><i class="fa fa-check"></i><b>19.4</b> Adding Additional Data From OSM</a>
<ul>
<li class="chapter" data-level="19.4.1" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#adding-building-layers-from-openstreetmap"><i class="fa fa-check"></i><b>19.4.1</b> Adding Building Layers from <em>OpenStreetMap</em></a></li>
<li class="chapter" data-level="19.4.2" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#the-wide-variety-of-osm-features"><i class="fa fa-check"></i><b>19.4.2</b> The Wide Variety of OSM Features</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="20" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html"><i class="fa fa-check"></i><b>20</b> Creating A Road Book</a>
<ul>
<li class="chapter" data-level="20.1" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#load-in-base-data-11"><i class="fa fa-check"></i><b>20.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="20.2" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#using-sfnetworks-to-represent-routes-and-road-networks"><i class="fa fa-check"></i><b>20.2</b> Using <code>sfnetworks</code> to Represent Routes and Road Networks</a></li>
<li class="chapter" data-level="20.3" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#analysing-road-networks-with-sfnetworks"><i class="fa fa-check"></i><b>20.3</b> Analysing Road Networks with <code>sfnetworks</code></a>
<ul>
<li class="chapter" data-level="20.3.1" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#creating-an-sfnetworks-graph"><i class="fa fa-check"></i><b>20.3.1</b> Creating an <code>sfnetworks</code> Graph</a></li>
<li class="chapter" data-level="20.3.2" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#filtering-an-sfnetworks-graph"><i class="fa fa-check"></i><b>20.3.2</b> Filtering an <code>sfnetworks</code> Graph</a></li>
<li class="chapter" data-level="20.3.3" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#viewing-a-buffered-area-around-a-junction-node"><i class="fa fa-check"></i><b>20.3.3</b> Viewing a Buffered Area Around a Junction Node</a></li>
<li class="chapter" data-level="20.3.4" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#snapping-a-route-to-a-road-network"><i class="fa fa-check"></i><b>20.3.4</b> Snapping a Route to a Road Network</a></li>
<li class="chapter" data-level="20.3.5" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#snapping-a-full-stage-route-to-the-road-network"><i class="fa fa-check"></i><b>20.3.5</b> Snapping a Full Stage Route to the Road Network</a></li>
</ul></li>
<li class="chapter" data-level="20.4" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#using-dodgr-to-represent-routes-and-road-networks"><i class="fa fa-check"></i><b>20.4</b> Using <code>dodgr</code> to Represent Routes and Road Networks</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="where-next.html"><a href="where-next.html"><i class="fa fa-check"></i><b>21</b> Where Next?</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Visualising WRC Rally Stages With <code>rayshader</code> and R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="stage-route-annotations" class="section level1" number="6">
<h1><span class="header-section-number">6</span> Stage Route Annotations</h1>
<p>As well as reviewing the stage route, we may also want to annotate the route with additional information such as markers showing the location of split points or other points of interest.</p>
<p>We have already seen how we can add stage start and end markers at specific locations using custom markers, but how might we add markers to other locations?</p>
<div id="load-in-the-route-data-1" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Load in the Route Data</h2>
<p>Let’s load in our route data to give us something to work with:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="stage-route-annotations.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-2"><a href="stage-route-annotations.html#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="stage-route-annotations.html#cb1-3" aria-hidden="true" tabindex="-1"></a>geojson_filename <span class="ot">=</span> <span class="st">&#39;montecarlo_2021.geojson&#39;</span></span>
<span id="cb1-4"><a href="stage-route-annotations.html#cb1-4" aria-hidden="true" tabindex="-1"></a>geojson_sf <span class="ot">=</span> <span class="fu">st_read</span>(geojson_filename)</span></code></pre></div>
<pre><code>## Reading layer `montecarlo_2021&#39; from data source `/Users/tonyhirst/Documents/GitHub/visualising-rally-stages/montecarlo_2021.geojson&#39; using driver `GeoJSON&#39;
## Simple feature collection with 9 features and 2 fields
## geometry type:  LINESTRING
## dimension:      XY
## bbox:           xmin: 5.243488 ymin: 43.87633 xmax: 6.951953 ymax: 44.81973
## geographic CRS: WGS 84</code></pre>
<p>and quickly preview a map with start and end markers:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="stage-route-annotations.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb3-2"><a href="stage-route-annotations.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># https://fontawesome.com/v4.7.0/icons/ </span></span>
<span id="cb3-3"><a href="stage-route-annotations.html#cb3-3" aria-hidden="true" tabindex="-1"></a>start_stop_markers <span class="ot">&lt;-</span> <span class="fu">awesomeIconList</span>(</span>
<span id="cb3-4"><a href="stage-route-annotations.html#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;start&quot;</span> <span class="ot">=</span> <span class="fu">makeAwesomeIcon</span>(</span>
<span id="cb3-5"><a href="stage-route-annotations.html#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">icon =</span> <span class="st">&quot;play-circle&quot;</span>,</span>
<span id="cb3-6"><a href="stage-route-annotations.html#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">markerColor =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb3-7"><a href="stage-route-annotations.html#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">library =</span> <span class="st">&quot;fa&quot;</span></span>
<span id="cb3-8"><a href="stage-route-annotations.html#cb3-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb3-9"><a href="stage-route-annotations.html#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;stop&quot;</span> <span class="ot">=</span> <span class="fu">makeAwesomeIcon</span>(</span>
<span id="cb3-10"><a href="stage-route-annotations.html#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">icon =</span> <span class="st">&quot;stop-circle&quot;</span>,</span>
<span id="cb3-11"><a href="stage-route-annotations.html#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">markerColor =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb3-12"><a href="stage-route-annotations.html#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">library =</span> <span class="st">&quot;fa&quot;</span></span>
<span id="cb3-13"><a href="stage-route-annotations.html#cb3-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-14"><a href="stage-route-annotations.html#cb3-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-15"><a href="stage-route-annotations.html#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="stage-route-annotations.html#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co"># TO DO - we need a better way (dplyr?) to extract this data</span></span>
<span id="cb3-17"><a href="stage-route-annotations.html#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co"># for each stage</span></span>
<span id="cb3-18"><a href="stage-route-annotations.html#cb3-18" aria-hidden="true" tabindex="-1"></a>stage_coords <span class="ot">=</span> <span class="fu">as.data.frame</span>(<span class="fu">st_coordinates</span>(geojson_sf[<span class="dv">1</span>, ]<span class="sc">$</span>geometry))</span>
<span id="cb3-19"><a href="stage-route-annotations.html#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="stage-route-annotations.html#cb3-20" aria-hidden="true" tabindex="-1"></a>stage_start_coords <span class="ot">=</span> stage_coords[<span class="dv">1</span>, ]</span>
<span id="cb3-21"><a href="stage-route-annotations.html#cb3-21" aria-hidden="true" tabindex="-1"></a>stage_end_coords <span class="ot">=</span> stage_coords[<span class="fu">nrow</span>(stage_coords), ]</span>
<span id="cb3-22"><a href="stage-route-annotations.html#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="stage-route-annotations.html#cb3-23" aria-hidden="true" tabindex="-1"></a>first_and_last <span class="ot">=</span> stage_coords[<span class="fu">c</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(stage_coords)),]</span>
<span id="cb3-24"><a href="stage-route-annotations.html#cb3-24" aria-hidden="true" tabindex="-1"></a>first_and_last<span class="sc">$</span>label<span class="ot">=</span><span class="fu">c</span>(<span class="st">&#39;SS1 stage start&#39;</span>, <span class="st">&#39;SS1 stage end&#39;</span>)</span>
<span id="cb3-25"><a href="stage-route-annotations.html#cb3-25" aria-hidden="true" tabindex="-1"></a>first_and_last<span class="sc">$</span>typ<span class="ot">=</span><span class="fu">c</span>(<span class="st">&#39;start&#39;</span>, <span class="st">&#39;stop&#39;</span>)</span>
<span id="cb3-26"><a href="stage-route-annotations.html#cb3-26" aria-hidden="true" tabindex="-1"></a>first_and_last<span class="sc">$</span>color<span class="ot">=</span><span class="fu">c</span>(<span class="st">&#39;green&#39;</span>, <span class="st">&#39;red&#39;</span>)</span>
<span id="cb3-27"><a href="stage-route-annotations.html#cb3-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-28"><a href="stage-route-annotations.html#cb3-28" aria-hidden="true" tabindex="-1"></a>m <span class="ot">=</span> <span class="fu">leaflet</span>(geojson_sf[<span class="dv">1</span>,]) <span class="sc">%&gt;%</span> </span>
<span id="cb3-29"><a href="stage-route-annotations.html#cb3-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addProviderTiles</span>(<span class="st">&quot;OpenTopoMap&quot;</span>, <span class="at">group =</span> <span class="st">&quot;OSM&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-30"><a href="stage-route-annotations.html#cb3-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addPolylines</span>(<span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">weight =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-31"><a href="stage-route-annotations.html#cb3-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addAwesomeMarkers</span>(<span class="sc">~</span>X, <span class="sc">~</span>Y,</span>
<span id="cb3-32"><a href="stage-route-annotations.html#cb3-32" aria-hidden="true" tabindex="-1"></a>                    <span class="at">icon =</span> <span class="sc">~</span> start_stop_markers[typ],</span>
<span id="cb3-33"><a href="stage-route-annotations.html#cb3-33" aria-hidden="true" tabindex="-1"></a>                    <span class="at">label =</span> <span class="sc">~</span> label,</span>
<span id="cb3-34"><a href="stage-route-annotations.html#cb3-34" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data=</span>first_and_last)</span>
<span id="cb3-35"><a href="stage-route-annotations.html#cb3-35" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div>
<div id="htmlwidget-21fbfb8606b2f93d0e4f" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-21fbfb8606b2f93d0e4f">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["OpenTopoMap",null,"OSM",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addPolylines","args":[[[[{"lng":[5.894486,5.894618,5.894778,5.894805,5.894672,5.894407,5.893912,5.893578,5.89172,5.891433,5.891298,5.891362,5.891597,5.891862,5.892002,5.892008,5.891335,5.891103,5.890532,5.890608,5.890752,5.890765,5.890347,5.890073,5.889517,5.888297,5.888073,5.887965,5.887875,5.887657,5.88689,5.88652,5.886002,5.885592,5.885238,5.885072,5.88518,5.885023,5.884815,5.884872,5.885,5.884995,5.884855,5.884797,5.884568,5.883923,5.883837,5.883753,5.883783,5.88435,5.884825,5.885332,5.8858,5.886523,5.886617,5.886647,5.886798,5.887068,5.88712,5.887133,5.88729,5.887937,5.888073,5.888083,5.888248,5.888592,5.88934,5.889938,5.890837,5.891675,5.892485,5.893257,5.89399,5.89436,5.894845,5.895225,5.895593,5.896387,5.897093,5.897828,5.898207,5.898468,5.898717,5.900633,5.901327,5.901892,5.902313,5.90256,5.903095,5.903202,5.903262,5.90323,5.90317,5.903258,5.90362,5.903788,5.904052,5.904285,5.904627,5.905452,5.906387,5.907607,5.907985,5.908453,5.908712,5.909033,5.909068,5.908958,5.909072,5.909323,5.90987,5.910563,5.911877,5.912927,5.913292,5.91384,5.914295,5.9149,5.915582,5.915852,5.916025,5.916333,5.916562,5.91679,5.917125,5.9179,5.9184,5.918885,5.919097,5.919548,5.919783,5.920475,5.920688,5.92087,5.920875,5.920827,5.920995,5.921395,5.921412,5.920982,5.921027,5.921287,5.92148,5.921745,5.922175,5.922148,5.921965,5.9214,5.92114,5.92095,5.920675,5.9202,5.919993,5.919103,5.918942,5.918908,5.91899,5.919562,5.919752,5.92002,5.921048,5.92208,5.922703,5.922657,5.922437,5.92197,5.921622,5.920627,5.920498,5.920517,5.920718,5.920915,5.920888,5.920757,5.920453,5.920268,5.920187,5.92016,5.920012,5.918987,5.91837,5.918117,5.917647,5.91742,5.917013,5.916813,5.916697,5.91671,5.916878,5.917182,5.917687,5.918422,5.91845,5.918353,5.918148,5.917752,5.917443,5.91733,5.91714,5.916813,5.91629,5.915897,5.914883,5.914543,5.914068,5.913522,5.913033,5.912768,5.912445,5.912283,5.912147,5.912072,5.912133,5.912568,5.912832,5.912825,5.912773,5.91281,5.912988,5.913285,5.913622,5.913927,5.914192,5.914358,5.91436,5.914188,5.913967,5.913828,5.913823,5.913948,5.91417,5.914197,5.914305,5.91427,5.914095,5.91375,5.913197,5.913027,5.913002,5.913017,5.912968,5.912898,5.912798,5.912717,5.912788,5.913113,5.912883,5.912682,5.912222,5.911108,5.910588,5.910152,5.90938,5.90938,5.909433,5.909318,5.908048,5.908023,5.908007,5.908057,5.909883,5.909967,5.91064,5.910868,5.911248,5.91177,5.911905,5.912322,5.912872,5.912878,5.912767,5.912632,5.912555,5.912577,5.912693,5.91328,5.913268,5.913135,5.912285,5.91167,5.910647,5.910585,5.910753,5.91095,5.910808,5.908725,5.908577,5.908197,5.90758,5.907173,5.90739,5.907838,5.907972,5.90799,5.907885,5.905927,5.905868,5.905638,5.905362,5.900993,5.901082,5.903422,5.9037,5.90425,5.904528,5.904733,5.90656,5.90689,5.908113,5.90843,5.908685,5.908988,5.909205,5.909415,5.909985,5.910178,5.910315,5.910322,5.910107,5.909825,5.90947,5.909243,5.90924,5.909368,5.909533,5.909942,5.9103,5.91113,5.911322,5.91144,5.911567,5.911702,5.911883,5.912622,5.912777,5.912923,5.912922,5.912788,5.912355,5.911995,5.911683,5.911475,5.911032,5.910925,5.910842,5.910702,5.910555,5.910327,5.910068,5.909375,5.907205,5.907203,5.907607,5.907998,5.90805,5.907942,5.907455,5.907487,5.907668,5.908275,5.908487,5.910033,5.911102,5.91225,5.91285,5.913228,5.91413,5.914372,5.914657,5.915142,5.915562,5.915683,5.915785,5.915827,5.91597,5.916547,5.917078,5.917288,5.917522,5.917802,5.918248,5.918513,5.919397,5.920775,5.921145,5.922952,5.924433,5.926068,5.926332,5.926693,5.927,5.927723,5.928357,5.929227,5.930022,5.93052,5.931418,5.931788,5.932423,5.933035,5.933205,5.933252,5.93317,5.93295,5.932512,5.932275,5.932185,5.932282,5.93308,5.934547,5.935048,5.935415,5.935765,5.935815,5.936858,5.937347,5.938643,5.93957,5.940715],"lat":[44.735616,44.735796,44.73602,44.736208,44.736365,44.736417,44.73641,44.736497,44.737378,44.737608,44.737893,44.738188,44.738433,44.738658,44.738918,44.739387,44.741625,44.741962,44.742657,44.74279,44.742898,44.743062,44.74377,44.743987,44.744232,44.74453,44.744737,44.745003,44.745667,44.745898,44.746435,44.746815,44.747272,44.74733,44.747517,44.748068,44.748778,44.749218,44.749597,44.749812,44.750048,44.750315,44.750867,44.750932,44.750988,44.751062,44.751127,44.751353,44.751575,44.753332,44.753957,44.754798,44.75512,44.755598,44.755822,44.756077,44.756328,44.756687,44.756955,44.75802,44.758138,44.758372,44.75855,44.759195,44.75932,44.759498,44.760225,44.76047,44.760835,44.76128,44.76183,44.762027,44.762045,44.762152,44.76235,44.76246,44.762647,44.763272,44.763717,44.764305,44.764535,44.764783,44.764887,44.765207,44.765412,44.765695,44.76592,44.765963,44.765932,44.765985,44.766065,44.766243,44.766387,44.766508,44.766705,44.766948,44.767515,44.76774,44.767895,44.768142,44.768365,44.768782,44.768843,44.768835,44.768937,44.769163,44.769257,44.76962,44.769793,44.769933,44.770123,44.770462,44.770788,44.771277,44.77134,44.771315,44.771228,44.771043,44.770973,44.771028,44.771188,44.771963,44.772965,44.77316,44.77328,44.773465,44.773702,44.773825,44.773983,44.774365,44.774362,44.774198,44.774252,44.774432,44.774467,44.774512,44.774672,44.775088,44.775253,44.776207,44.777338,44.777908,44.77814,44.778312,44.778505,44.778628,44.77868,44.77858,44.778478,44.7783,44.777967,44.777552,44.777358,44.776912,44.776952,44.777008,44.777157,44.777622,44.778018,44.778758,44.77972,44.781063,44.781725,44.781883,44.781998,44.782127,44.78215,44.782042,44.782128,44.782252,44.782398,44.782522,44.782598,44.782627,44.782563,44.782457,44.7823,44.781642,44.781512,44.781063,44.78094,44.780973,44.781227,44.781407,44.781885,44.781898,44.781787,44.781712,44.781588,44.78139,44.780877,44.780423,44.780263,44.780123,44.780053,44.780027,44.779868,44.779863,44.779973,44.780237,44.78046,44.780543,44.780592,44.780512,44.780267,44.780218,44.779988,44.779862,44.77955,44.779287,44.779275,44.77937,44.779522,44.779962,44.780192,44.780358,44.780543,44.780757,44.780927,44.781007,44.780978,44.780932,44.780993,44.781143,44.781225,44.78133,44.781453,44.781653,44.781892,44.78233,44.782543,44.782932,44.78315,44.783198,44.78321,44.78316,44.783293,44.783433,44.783637,44.783867,44.783905,44.783902,44.783795,44.783398,44.783165,44.782805,44.782575,44.782473,44.782417,44.782327,44.78216,44.781902,44.7811,44.780938,44.780742,44.780678,44.780717,44.780727,44.780783,44.781145,44.79076,44.790812,44.790758,44.790833,44.791168,44.791373,44.791545,44.792348,44.793062,44.793258,44.793328,44.793388,44.793523,44.793947,44.79429,44.795408,44.795598,44.795728,44.796073,44.796227,44.796453,44.796518,44.79795,44.79971,44.799782,44.80001,44.799948,44.799553,44.799285,44.799187,44.799322,44.799532,44.799738,44.799898,44.80007,44.802173,44.804155,44.809063,44.80906,44.809308,44.80942,44.811205,44.811485,44.812413,44.812887,44.81303,44.813443,44.813468,44.813323,44.813375,44.81352,44.813737,44.813768,44.813678,44.813305,44.81325,44.813323,44.813395,44.813653,44.813977,44.814555,44.814698,44.814817,44.81489,44.814838,44.814518,44.814175,44.81372,44.813743,44.813867,44.814092,44.81409,44.813998,44.813553,44.813527,44.813592,44.813657,44.813743,44.813948,44.814327,44.814623,44.814665,44.814595,44.814623,44.814687,44.815028,44.815663,44.815937,44.816035,44.81612,44.816173,44.816267,44.816475,44.816692,44.816845,44.817043,44.817663,44.817827,44.817975,44.818295,44.818302,44.818165,44.818338,44.818103,44.818068,44.818143,44.818452,44.818645,44.819067,44.819351,44.819288,44.819158,44.818613,44.81839,44.818192,44.817657,44.817015,44.816947,44.817012,44.817302,44.81782,44.817922,44.818122,44.818235,44.818285,44.81815,44.818208,44.818157,44.818283,44.818502,44.818532,44.818432,44.818453,44.818528,44.818495,44.818455,44.818573,44.818555,44.818448,44.818557,44.818683,44.818867,44.819062,44.819217,44.819327,44.81937,44.819463,44.819537,44.819582,44.819732,44.819687,44.819545,44.819312,44.819283,44.818918,44.818875,44.81897,44.818925,44.819117]}]]],null,null,{"interactive":true,"className":"","stroke":true,"color":"red","weight":5,"opacity":0.5,"fill":false,"fillColor":"red","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addAwesomeMarkers","args":[[44.735616,44.819117],[5.894486,5.940715],{"icon":["play-circle","stop-circle"],"markerColor":["blue","red"],"iconColor":"white","spin":false,"squareMarker":false,"iconRotate":0,"prefix":"fa"},null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},null,null,null,null,["SS1 stage start","SS1 stage end"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[44.735616,44.819732],"lng":[5.883753,5.940715]}},"evals":[],"jsHooks":[]}</script>
<p>With a base map in place, what other information might we add?</p>
</div>
<div id="adding-split-point-locations" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Adding Split Point Locations</h2>
<p>One of the useful locations to mark on the stage are the split points. Split times are reported by WRC live timing, so it can be useful to see just where are on the stage they are recorded.</p>
<p>A live timing data feed from the WRC live timing service includes the distance into the stage of each split point, as the following JSON fragment taken from the feed demonstrates:</p>
<pre><code># https://api.wrc.com/results-api/rally-event/1695/split-times/stage-external/1701
{
  &quot;stageId&quot;: 1701,
  &quot;splitPoints&quot;: [
    {
      &quot;splitPointId&quot;: 3506,
      &quot;stageId&quot;: 1701,
      &quot;number&quot;: 2,
      &quot;distance&quot;: 10.99
    },
    {
      &quot;splitPointId&quot;: 3509,
      &quot;stageId&quot;: 1701,
      &quot;number&quot;: 3,
      &quot;distance&quot;: 17.5
    },
    {
      &quot;splitPointId&quot;: 3527,
      &quot;stageId&quot;: 1701,
      &quot;number&quot;: 1,
      &quot;distance&quot;: 6.46
    },
    {
      &quot;splitPointId&quot;: 3543,
      &quot;stageId&quot;: 1701,
      &quot;number&quot;: 4,
      &quot;distance&quot;: 19.1
    }
  ]
}</code></pre>
<p>We can grab this JSON from the original URL and parse the data out:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="stage-route-annotations.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb5-2"><a href="stage-route-annotations.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb5-3"><a href="stage-route-annotations.html#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="stage-route-annotations.html#cb5-4" aria-hidden="true" tabindex="-1"></a>stage_splits_url <span class="ot">=</span> <span class="st">&#39;https://api.wrc.com/results-api/rally-event/1695/split-times/stage-external/1701&#39;</span></span>
<span id="cb5-5"><a href="stage-route-annotations.html#cb5-5" aria-hidden="true" tabindex="-1"></a>splits_json <span class="ot">=</span> <span class="fu">fromJSON</span>( stage_splits_url ) </span>
<span id="cb5-6"><a href="stage-route-annotations.html#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="stage-route-annotations.html#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Lets also save a local copy of that JSON data</span></span>
<span id="cb5-8"><a href="stage-route-annotations.html#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="fu">write</span>(<span class="fu">toJSON</span>(splits_json), <span class="st">&quot;split_times_example.json&quot;</span>)</span>
<span id="cb5-9"><a href="stage-route-annotations.html#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="stage-route-annotations.html#cb5-10" aria-hidden="true" tabindex="-1"></a>splitPoints <span class="ot">=</span> <span class="fu">arrange</span>(splits_json<span class="sc">$</span>splitPoints, number)</span>
<span id="cb5-11"><a href="stage-route-annotations.html#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="stage-route-annotations.html#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># We also have access to splits_json$entrySplitPointTimes and splits_json$stageId</span></span>
<span id="cb5-13"><a href="stage-route-annotations.html#cb5-13" aria-hidden="true" tabindex="-1"></a>splitPoints</span></code></pre></div>
<pre><code>##   splitPointId stageId number distance
## 1         3527    1701      1     6.46
## 2         3506    1701      2    10.99
## 3         3509    1701      3    17.50
## 4         3543    1701      4    19.10</code></pre>
<div id="using-geojson-to-find-the-distance-along-a-route" class="section level3" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> Using geojson to Find the Distance Along a Route</h3>
<p>The <em>turf.js</em> is a widely used Javascript package for working with and processing geojson data. The package has been ported to other languages, including R and Python, using similar APIs.</p>
<p>The <a href="https://github.com/sckott/geoops"><code>geoops</code> R package</a> provides an R port of many of the functions in the <code>turf.js</code> Javascript package, so let’s see how it works.</p>
<p>We can get the distance into stage (in km) for one of the split points from the split time JSON data:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="stage-route-annotations.html#cb7-1" aria-hidden="true" tabindex="-1"></a>splits_json<span class="sc">$</span>splitPoints[<span class="dv">2</span>, <span class="st">&#39;distance&#39;</span>]</span></code></pre></div>
<pre><code>## [1] 17.5</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="stage-route-annotations.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A distance of 17.5km</span></span></code></pre></div>
<p>We can use this distance to index along the geojson object using the <code>geoops:geo_along()</code> function. Specifically, <code>geo_along()</code> take a GeoJSON string (rather than a spatial object) and then returns the location of a point a specific distance along it, again in a GeoJSON string format:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="stage-route-annotations.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geojsonio)</span>
<span id="cb10-2"><a href="stage-route-annotations.html#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="stage-route-annotations.html#cb10-3" aria-hidden="true" tabindex="-1"></a>route_as_geojson <span class="ot">=</span> geojsonio<span class="sc">::</span><span class="fu">geojson_json</span>(geojson_sf[<span class="dv">1</span>,]<span class="sc">$</span>geometry)</span>
<span id="cb10-4"><a href="stage-route-annotations.html#cb10-4" aria-hidden="true" tabindex="-1"></a>             </span>
<span id="cb10-5"><a href="stage-route-annotations.html#cb10-5" aria-hidden="true" tabindex="-1"></a>gj_point_along <span class="ot">=</span> geoops<span class="sc">::</span><span class="fu">geo_along</span>(route_as_geojson,</span>
<span id="cb10-6"><a href="stage-route-annotations.html#cb10-6" aria-hidden="true" tabindex="-1"></a>                                   <span class="fl">17.5</span>, <span class="at">units=</span><span class="st">&#39;kilometres&#39;</span>)</span>
<span id="cb10-7"><a href="stage-route-annotations.html#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="stage-route-annotations.html#cb10-8" aria-hidden="true" tabindex="-1"></a>gj_point_along</span></code></pre></div>
<pre><code>## [1] &quot;{\&quot;geometry\&quot;:{\&quot;coordinates\&quot;:[5.908658,44.816138],\&quot;type\&quot;:\&quot;Point\&quot;},\&quot;properties\&quot;:{},\&quot;type\&quot;:\&quot;Feature\&quot;}&quot;</code></pre>
<p>We can parse the geojson point as a simple feature using the <code>geojsonio::geojson_sf()</code> function and then plot the split time waypoint directly from that object:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="stage-route-annotations.html#cb12-1" aria-hidden="true" tabindex="-1"></a>m <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="stage-route-annotations.html#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addCircleMarkers</span>(<span class="at">data=</span><span class="fu">geojson_sf</span>(gj_point_along),</span>
<span id="cb12-3"><a href="stage-route-annotations.html#cb12-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">radius =</span><span class="dv">10</span>,</span>
<span id="cb12-4"><a href="stage-route-annotations.html#cb12-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">stroke =</span> <span class="cn">FALSE</span>, <span class="at">fillOpacity =</span> <span class="fl">0.8</span>)</span></code></pre></div>
<div id="htmlwidget-49e87e7836f425cfdbab" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-49e87e7836f425cfdbab">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["OpenTopoMap",null,"OSM",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addPolylines","args":[[[[{"lng":[5.894486,5.894618,5.894778,5.894805,5.894672,5.894407,5.893912,5.893578,5.89172,5.891433,5.891298,5.891362,5.891597,5.891862,5.892002,5.892008,5.891335,5.891103,5.890532,5.890608,5.890752,5.890765,5.890347,5.890073,5.889517,5.888297,5.888073,5.887965,5.887875,5.887657,5.88689,5.88652,5.886002,5.885592,5.885238,5.885072,5.88518,5.885023,5.884815,5.884872,5.885,5.884995,5.884855,5.884797,5.884568,5.883923,5.883837,5.883753,5.883783,5.88435,5.884825,5.885332,5.8858,5.886523,5.886617,5.886647,5.886798,5.887068,5.88712,5.887133,5.88729,5.887937,5.888073,5.888083,5.888248,5.888592,5.88934,5.889938,5.890837,5.891675,5.892485,5.893257,5.89399,5.89436,5.894845,5.895225,5.895593,5.896387,5.897093,5.897828,5.898207,5.898468,5.898717,5.900633,5.901327,5.901892,5.902313,5.90256,5.903095,5.903202,5.903262,5.90323,5.90317,5.903258,5.90362,5.903788,5.904052,5.904285,5.904627,5.905452,5.906387,5.907607,5.907985,5.908453,5.908712,5.909033,5.909068,5.908958,5.909072,5.909323,5.90987,5.910563,5.911877,5.912927,5.913292,5.91384,5.914295,5.9149,5.915582,5.915852,5.916025,5.916333,5.916562,5.91679,5.917125,5.9179,5.9184,5.918885,5.919097,5.919548,5.919783,5.920475,5.920688,5.92087,5.920875,5.920827,5.920995,5.921395,5.921412,5.920982,5.921027,5.921287,5.92148,5.921745,5.922175,5.922148,5.921965,5.9214,5.92114,5.92095,5.920675,5.9202,5.919993,5.919103,5.918942,5.918908,5.91899,5.919562,5.919752,5.92002,5.921048,5.92208,5.922703,5.922657,5.922437,5.92197,5.921622,5.920627,5.920498,5.920517,5.920718,5.920915,5.920888,5.920757,5.920453,5.920268,5.920187,5.92016,5.920012,5.918987,5.91837,5.918117,5.917647,5.91742,5.917013,5.916813,5.916697,5.91671,5.916878,5.917182,5.917687,5.918422,5.91845,5.918353,5.918148,5.917752,5.917443,5.91733,5.91714,5.916813,5.91629,5.915897,5.914883,5.914543,5.914068,5.913522,5.913033,5.912768,5.912445,5.912283,5.912147,5.912072,5.912133,5.912568,5.912832,5.912825,5.912773,5.91281,5.912988,5.913285,5.913622,5.913927,5.914192,5.914358,5.91436,5.914188,5.913967,5.913828,5.913823,5.913948,5.91417,5.914197,5.914305,5.91427,5.914095,5.91375,5.913197,5.913027,5.913002,5.913017,5.912968,5.912898,5.912798,5.912717,5.912788,5.913113,5.912883,5.912682,5.912222,5.911108,5.910588,5.910152,5.90938,5.90938,5.909433,5.909318,5.908048,5.908023,5.908007,5.908057,5.909883,5.909967,5.91064,5.910868,5.911248,5.91177,5.911905,5.912322,5.912872,5.912878,5.912767,5.912632,5.912555,5.912577,5.912693,5.91328,5.913268,5.913135,5.912285,5.91167,5.910647,5.910585,5.910753,5.91095,5.910808,5.908725,5.908577,5.908197,5.90758,5.907173,5.90739,5.907838,5.907972,5.90799,5.907885,5.905927,5.905868,5.905638,5.905362,5.900993,5.901082,5.903422,5.9037,5.90425,5.904528,5.904733,5.90656,5.90689,5.908113,5.90843,5.908685,5.908988,5.909205,5.909415,5.909985,5.910178,5.910315,5.910322,5.910107,5.909825,5.90947,5.909243,5.90924,5.909368,5.909533,5.909942,5.9103,5.91113,5.911322,5.91144,5.911567,5.911702,5.911883,5.912622,5.912777,5.912923,5.912922,5.912788,5.912355,5.911995,5.911683,5.911475,5.911032,5.910925,5.910842,5.910702,5.910555,5.910327,5.910068,5.909375,5.907205,5.907203,5.907607,5.907998,5.90805,5.907942,5.907455,5.907487,5.907668,5.908275,5.908487,5.910033,5.911102,5.91225,5.91285,5.913228,5.91413,5.914372,5.914657,5.915142,5.915562,5.915683,5.915785,5.915827,5.91597,5.916547,5.917078,5.917288,5.917522,5.917802,5.918248,5.918513,5.919397,5.920775,5.921145,5.922952,5.924433,5.926068,5.926332,5.926693,5.927,5.927723,5.928357,5.929227,5.930022,5.93052,5.931418,5.931788,5.932423,5.933035,5.933205,5.933252,5.93317,5.93295,5.932512,5.932275,5.932185,5.932282,5.93308,5.934547,5.935048,5.935415,5.935765,5.935815,5.936858,5.937347,5.938643,5.93957,5.940715],"lat":[44.735616,44.735796,44.73602,44.736208,44.736365,44.736417,44.73641,44.736497,44.737378,44.737608,44.737893,44.738188,44.738433,44.738658,44.738918,44.739387,44.741625,44.741962,44.742657,44.74279,44.742898,44.743062,44.74377,44.743987,44.744232,44.74453,44.744737,44.745003,44.745667,44.745898,44.746435,44.746815,44.747272,44.74733,44.747517,44.748068,44.748778,44.749218,44.749597,44.749812,44.750048,44.750315,44.750867,44.750932,44.750988,44.751062,44.751127,44.751353,44.751575,44.753332,44.753957,44.754798,44.75512,44.755598,44.755822,44.756077,44.756328,44.756687,44.756955,44.75802,44.758138,44.758372,44.75855,44.759195,44.75932,44.759498,44.760225,44.76047,44.760835,44.76128,44.76183,44.762027,44.762045,44.762152,44.76235,44.76246,44.762647,44.763272,44.763717,44.764305,44.764535,44.764783,44.764887,44.765207,44.765412,44.765695,44.76592,44.765963,44.765932,44.765985,44.766065,44.766243,44.766387,44.766508,44.766705,44.766948,44.767515,44.76774,44.767895,44.768142,44.768365,44.768782,44.768843,44.768835,44.768937,44.769163,44.769257,44.76962,44.769793,44.769933,44.770123,44.770462,44.770788,44.771277,44.77134,44.771315,44.771228,44.771043,44.770973,44.771028,44.771188,44.771963,44.772965,44.77316,44.77328,44.773465,44.773702,44.773825,44.773983,44.774365,44.774362,44.774198,44.774252,44.774432,44.774467,44.774512,44.774672,44.775088,44.775253,44.776207,44.777338,44.777908,44.77814,44.778312,44.778505,44.778628,44.77868,44.77858,44.778478,44.7783,44.777967,44.777552,44.777358,44.776912,44.776952,44.777008,44.777157,44.777622,44.778018,44.778758,44.77972,44.781063,44.781725,44.781883,44.781998,44.782127,44.78215,44.782042,44.782128,44.782252,44.782398,44.782522,44.782598,44.782627,44.782563,44.782457,44.7823,44.781642,44.781512,44.781063,44.78094,44.780973,44.781227,44.781407,44.781885,44.781898,44.781787,44.781712,44.781588,44.78139,44.780877,44.780423,44.780263,44.780123,44.780053,44.780027,44.779868,44.779863,44.779973,44.780237,44.78046,44.780543,44.780592,44.780512,44.780267,44.780218,44.779988,44.779862,44.77955,44.779287,44.779275,44.77937,44.779522,44.779962,44.780192,44.780358,44.780543,44.780757,44.780927,44.781007,44.780978,44.780932,44.780993,44.781143,44.781225,44.78133,44.781453,44.781653,44.781892,44.78233,44.782543,44.782932,44.78315,44.783198,44.78321,44.78316,44.783293,44.783433,44.783637,44.783867,44.783905,44.783902,44.783795,44.783398,44.783165,44.782805,44.782575,44.782473,44.782417,44.782327,44.78216,44.781902,44.7811,44.780938,44.780742,44.780678,44.780717,44.780727,44.780783,44.781145,44.79076,44.790812,44.790758,44.790833,44.791168,44.791373,44.791545,44.792348,44.793062,44.793258,44.793328,44.793388,44.793523,44.793947,44.79429,44.795408,44.795598,44.795728,44.796073,44.796227,44.796453,44.796518,44.79795,44.79971,44.799782,44.80001,44.799948,44.799553,44.799285,44.799187,44.799322,44.799532,44.799738,44.799898,44.80007,44.802173,44.804155,44.809063,44.80906,44.809308,44.80942,44.811205,44.811485,44.812413,44.812887,44.81303,44.813443,44.813468,44.813323,44.813375,44.81352,44.813737,44.813768,44.813678,44.813305,44.81325,44.813323,44.813395,44.813653,44.813977,44.814555,44.814698,44.814817,44.81489,44.814838,44.814518,44.814175,44.81372,44.813743,44.813867,44.814092,44.81409,44.813998,44.813553,44.813527,44.813592,44.813657,44.813743,44.813948,44.814327,44.814623,44.814665,44.814595,44.814623,44.814687,44.815028,44.815663,44.815937,44.816035,44.81612,44.816173,44.816267,44.816475,44.816692,44.816845,44.817043,44.817663,44.817827,44.817975,44.818295,44.818302,44.818165,44.818338,44.818103,44.818068,44.818143,44.818452,44.818645,44.819067,44.819351,44.819288,44.819158,44.818613,44.81839,44.818192,44.817657,44.817015,44.816947,44.817012,44.817302,44.81782,44.817922,44.818122,44.818235,44.818285,44.81815,44.818208,44.818157,44.818283,44.818502,44.818532,44.818432,44.818453,44.818528,44.818495,44.818455,44.818573,44.818555,44.818448,44.818557,44.818683,44.818867,44.819062,44.819217,44.819327,44.81937,44.819463,44.819537,44.819582,44.819732,44.819687,44.819545,44.819312,44.819283,44.818918,44.818875,44.81897,44.818925,44.819117]}]]],null,null,{"interactive":true,"className":"","stroke":true,"color":"red","weight":5,"opacity":0.5,"fill":false,"fillColor":"red","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addAwesomeMarkers","args":[[44.735616,44.819117],[5.894486,5.940715],{"icon":["play-circle","stop-circle"],"markerColor":["blue","red"],"iconColor":"white","spin":false,"squareMarker":false,"iconRotate":0,"prefix":"fa"},null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},null,null,null,null,["SS1 stage start","SS1 stage end"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addCircleMarkers","args":[44.816138,5.908658,10,null,null,{"interactive":true,"className":"","stroke":false,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.8},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[44.735616,44.819732],"lng":[5.883753,5.940715]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="using-rgeosginterpolate-to-find-the-distance-along-a-route" class="section level3" number="6.2.2">
<h3><span class="header-section-number">6.2.2</span> Using <code>rgeos::gInterpolate</code> to Find the Distance Along a Route</h3>
<p>The following provides a rather clunky workaround to finding the distance along the line from a <em>Spatial</em> object (a more streamlined approach can be found in the next chapter).</p>
<p>I present the recipe here as a useful (useless?!) exercise in how to come up with a recipe from basic principles when you don’t really know what you’re doing!</p>
<p>To begin with, let’s reuse some of the code we used in the chapter on projections that allow us to project from the degree based latlong CRS to the meters based UTM coordinate systems:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="stage-route-annotations.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Detect the UTM zone as an EPSG code</span></span>
<span id="cb13-2"><a href="stage-route-annotations.html#cb13-2" aria-hidden="true" tabindex="-1"></a>lonlat2UTMzone <span class="ot">=</span> <span class="cf">function</span>(lonlat) {</span>
<span id="cb13-3"><a href="stage-route-annotations.html#cb13-3" aria-hidden="true" tabindex="-1"></a>  utm <span class="ot">=</span> (<span class="fu">floor</span>((lonlat[<span class="dv">1</span>] <span class="sc">+</span> <span class="dv">180</span>) <span class="sc">/</span> <span class="dv">6</span>) <span class="sc">%%</span> <span class="dv">60</span>) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb13-4"><a href="stage-route-annotations.html#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(lonlat[<span class="dv">2</span>] <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb13-5"><a href="stage-route-annotations.html#cb13-5" aria-hidden="true" tabindex="-1"></a>    utm <span class="sc">+</span> <span class="dv">32600</span></span>
<span id="cb13-6"><a href="stage-route-annotations.html#cb13-6" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb13-7"><a href="stage-route-annotations.html#cb13-7" aria-hidden="true" tabindex="-1"></a>    utm <span class="sc">+</span> <span class="dv">32700</span></span>
<span id="cb13-8"><a href="stage-route-annotations.html#cb13-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-9"><a href="stage-route-annotations.html#cb13-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-10"><a href="stage-route-annotations.html#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="stage-route-annotations.html#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep track of the original proj4 string</span></span>
<span id="cb13-12"><a href="stage-route-annotations.html#cb13-12" aria-hidden="true" tabindex="-1"></a>old_crs <span class="ot">=</span> <span class="fu">st_crs</span>(geojson_sf[<span class="dv">1</span>,])<span class="sc">$</span>proj4string</span>
<span id="cb13-13"><a href="stage-route-annotations.html#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="stage-route-annotations.html#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate a new projection in the appropriate UTM zone</span></span>
<span id="cb13-15"><a href="stage-route-annotations.html#cb13-15" aria-hidden="true" tabindex="-1"></a>crs_zone <span class="ot">=</span> <span class="fu">lonlat2UTMzone</span>(<span class="fu">c</span>(<span class="fu">st_coordinates</span>(geojson_sf[<span class="dv">1</span>,])[<span class="dv">1</span>,<span class="dv">1</span>],</span>
<span id="cb13-16"><a href="stage-route-annotations.html#cb13-16" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">st_coordinates</span>(geojson_sf[<span class="dv">1</span>,])[<span class="dv">1</span>,<span class="dv">2</span>]))</span>
<span id="cb13-17"><a href="stage-route-annotations.html#cb13-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-18"><a href="stage-route-annotations.html#cb13-18" aria-hidden="true" tabindex="-1"></a>new_proj4_string <span class="ot">=</span> <span class="fu">st_crs</span>(crs_zone)<span class="sc">$</span>proj4string</span>
<span id="cb13-19"><a href="stage-route-annotations.html#cb13-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-20"><a href="stage-route-annotations.html#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform the route to the UTM projection</span></span>
<span id="cb13-21"><a href="stage-route-annotations.html#cb13-21" aria-hidden="true" tabindex="-1"></a>utm_routes <span class="ot">=</span> <span class="fu">st_transform</span>(geojson_sf, <span class="at">crs=</span>new_proj4_string)</span>
<span id="cb13-22"><a href="stage-route-annotations.html#cb13-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-23"><a href="stage-route-annotations.html#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(utm_routes)<span class="sc">$</span>proj4string</span></code></pre></div>
<pre><code>## [1] &quot;+proj=utm +zone=31 +datum=WGS84 +units=m +no_defs&quot;</code></pre>
<p>Now that we are in a projection system based on meters, we can use the <code>rgeos::gInterpolate()</code> function to find a point a certain number of meters along the route. Note that the coordinates that are returned are UTM based coordinates:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="stage-route-annotations.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the distance along the route in meters</span></span>
<span id="cb15-2"><a href="stage-route-annotations.html#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># rgeos seems to want a Spatial object?</span></span>
<span id="cb15-3"><a href="stage-route-annotations.html#cb15-3" aria-hidden="true" tabindex="-1"></a>utm_point_along <span class="ot">=</span> rgeos<span class="sc">::</span><span class="fu">gInterpolate</span>(<span class="fu">as</span>(utm_routes[<span class="dv">1</span>,],<span class="st">&#39;Spatial&#39;</span>),</span>
<span id="cb15-4"><a href="stage-route-annotations.html#cb15-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="dv">12500</span>, <span class="at">normalized =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-5"><a href="stage-route-annotations.html#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="stage-route-annotations.html#cb15-6" aria-hidden="true" tabindex="-1"></a>utm_point_along</span></code></pre></div>
<pre><code>## class       : SpatialPoints 
## features    : 1 
## extent      : 730351.2, 730351.2, 4963971, 4963971  (xmin, xmax, ymin, ymax)
## crs         : +proj=utm +zone=31 +datum=WGS84 +units=m +no_defs</code></pre>
<p>We now need to transform this point <em>back</em> to the latlong CRS:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="stage-route-annotations.html#cb17-1" aria-hidden="true" tabindex="-1"></a>latlon_point <span class="ot">=</span> <span class="fu">st_transform</span>(<span class="fu">st_as_sf</span>(utm_point_along),</span>
<span id="cb17-2"><a href="stage-route-annotations.html#cb17-2" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">st_crs</span>(geojson_sf)<span class="sc">$</span>proj4string)</span>
<span id="cb17-3"><a href="stage-route-annotations.html#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="stage-route-annotations.html#cb17-4" aria-hidden="true" tabindex="-1"></a>latlon_point</span></code></pre></div>
<pre><code>## Simple feature collection with 1 feature and 0 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: 5.912144 ymin: 44.792 xmax: 5.912144 ymax: 44.792
## CRS:            +proj=longlat +datum=WGS84 +no_defs
##                  geometry
## 1 POINT (5.912144 44.792)</code></pre>
<p>We can add a marker to the map showing the location of the point the required distance along the line by casting the transformed point location(s) into a dataframe and extracting the desired coordinate columns:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="stage-route-annotations.html#cb19-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">=</span> <span class="fu">leaflet</span>(geojson_sf[<span class="dv">1</span>,]) <span class="sc">%&gt;%</span> </span>
<span id="cb19-2"><a href="stage-route-annotations.html#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addProviderTiles</span>(<span class="st">&quot;OpenTopoMap&quot;</span>, <span class="at">group =</span> <span class="st">&quot;OSM&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-3"><a href="stage-route-annotations.html#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addPolylines</span>(<span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">weight =</span> <span class="dv">5</span>)<span class="sc">%&gt;%</span> </span>
<span id="cb19-4"><a href="stage-route-annotations.html#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="stage-route-annotations.html#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addCircleMarkers</span>(<span class="sc">~</span>X, <span class="sc">~</span>Y,  <span class="at">radius =</span><span class="dv">10</span>,</span>
<span id="cb19-6"><a href="stage-route-annotations.html#cb19-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">stroke =</span> <span class="cn">FALSE</span>, <span class="at">fillOpacity =</span> <span class="fl">0.9</span>,</span>
<span id="cb19-7"><a href="stage-route-annotations.html#cb19-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data=</span> <span class="fu">as.data.frame</span>(<span class="fu">st_coordinates</span>(latlon_point)))</span>
<span id="cb19-8"><a href="stage-route-annotations.html#cb19-8" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div>
<div id="htmlwidget-1d032840cb7062e1f3d4" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-1d032840cb7062e1f3d4">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["OpenTopoMap",null,"OSM",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addPolylines","args":[[[[{"lng":[5.894486,5.894618,5.894778,5.894805,5.894672,5.894407,5.893912,5.893578,5.89172,5.891433,5.891298,5.891362,5.891597,5.891862,5.892002,5.892008,5.891335,5.891103,5.890532,5.890608,5.890752,5.890765,5.890347,5.890073,5.889517,5.888297,5.888073,5.887965,5.887875,5.887657,5.88689,5.88652,5.886002,5.885592,5.885238,5.885072,5.88518,5.885023,5.884815,5.884872,5.885,5.884995,5.884855,5.884797,5.884568,5.883923,5.883837,5.883753,5.883783,5.88435,5.884825,5.885332,5.8858,5.886523,5.886617,5.886647,5.886798,5.887068,5.88712,5.887133,5.88729,5.887937,5.888073,5.888083,5.888248,5.888592,5.88934,5.889938,5.890837,5.891675,5.892485,5.893257,5.89399,5.89436,5.894845,5.895225,5.895593,5.896387,5.897093,5.897828,5.898207,5.898468,5.898717,5.900633,5.901327,5.901892,5.902313,5.90256,5.903095,5.903202,5.903262,5.90323,5.90317,5.903258,5.90362,5.903788,5.904052,5.904285,5.904627,5.905452,5.906387,5.907607,5.907985,5.908453,5.908712,5.909033,5.909068,5.908958,5.909072,5.909323,5.90987,5.910563,5.911877,5.912927,5.913292,5.91384,5.914295,5.9149,5.915582,5.915852,5.916025,5.916333,5.916562,5.91679,5.917125,5.9179,5.9184,5.918885,5.919097,5.919548,5.919783,5.920475,5.920688,5.92087,5.920875,5.920827,5.920995,5.921395,5.921412,5.920982,5.921027,5.921287,5.92148,5.921745,5.922175,5.922148,5.921965,5.9214,5.92114,5.92095,5.920675,5.9202,5.919993,5.919103,5.918942,5.918908,5.91899,5.919562,5.919752,5.92002,5.921048,5.92208,5.922703,5.922657,5.922437,5.92197,5.921622,5.920627,5.920498,5.920517,5.920718,5.920915,5.920888,5.920757,5.920453,5.920268,5.920187,5.92016,5.920012,5.918987,5.91837,5.918117,5.917647,5.91742,5.917013,5.916813,5.916697,5.91671,5.916878,5.917182,5.917687,5.918422,5.91845,5.918353,5.918148,5.917752,5.917443,5.91733,5.91714,5.916813,5.91629,5.915897,5.914883,5.914543,5.914068,5.913522,5.913033,5.912768,5.912445,5.912283,5.912147,5.912072,5.912133,5.912568,5.912832,5.912825,5.912773,5.91281,5.912988,5.913285,5.913622,5.913927,5.914192,5.914358,5.91436,5.914188,5.913967,5.913828,5.913823,5.913948,5.91417,5.914197,5.914305,5.91427,5.914095,5.91375,5.913197,5.913027,5.913002,5.913017,5.912968,5.912898,5.912798,5.912717,5.912788,5.913113,5.912883,5.912682,5.912222,5.911108,5.910588,5.910152,5.90938,5.90938,5.909433,5.909318,5.908048,5.908023,5.908007,5.908057,5.909883,5.909967,5.91064,5.910868,5.911248,5.91177,5.911905,5.912322,5.912872,5.912878,5.912767,5.912632,5.912555,5.912577,5.912693,5.91328,5.913268,5.913135,5.912285,5.91167,5.910647,5.910585,5.910753,5.91095,5.910808,5.908725,5.908577,5.908197,5.90758,5.907173,5.90739,5.907838,5.907972,5.90799,5.907885,5.905927,5.905868,5.905638,5.905362,5.900993,5.901082,5.903422,5.9037,5.90425,5.904528,5.904733,5.90656,5.90689,5.908113,5.90843,5.908685,5.908988,5.909205,5.909415,5.909985,5.910178,5.910315,5.910322,5.910107,5.909825,5.90947,5.909243,5.90924,5.909368,5.909533,5.909942,5.9103,5.91113,5.911322,5.91144,5.911567,5.911702,5.911883,5.912622,5.912777,5.912923,5.912922,5.912788,5.912355,5.911995,5.911683,5.911475,5.911032,5.910925,5.910842,5.910702,5.910555,5.910327,5.910068,5.909375,5.907205,5.907203,5.907607,5.907998,5.90805,5.907942,5.907455,5.907487,5.907668,5.908275,5.908487,5.910033,5.911102,5.91225,5.91285,5.913228,5.91413,5.914372,5.914657,5.915142,5.915562,5.915683,5.915785,5.915827,5.91597,5.916547,5.917078,5.917288,5.917522,5.917802,5.918248,5.918513,5.919397,5.920775,5.921145,5.922952,5.924433,5.926068,5.926332,5.926693,5.927,5.927723,5.928357,5.929227,5.930022,5.93052,5.931418,5.931788,5.932423,5.933035,5.933205,5.933252,5.93317,5.93295,5.932512,5.932275,5.932185,5.932282,5.93308,5.934547,5.935048,5.935415,5.935765,5.935815,5.936858,5.937347,5.938643,5.93957,5.940715],"lat":[44.735616,44.735796,44.73602,44.736208,44.736365,44.736417,44.73641,44.736497,44.737378,44.737608,44.737893,44.738188,44.738433,44.738658,44.738918,44.739387,44.741625,44.741962,44.742657,44.74279,44.742898,44.743062,44.74377,44.743987,44.744232,44.74453,44.744737,44.745003,44.745667,44.745898,44.746435,44.746815,44.747272,44.74733,44.747517,44.748068,44.748778,44.749218,44.749597,44.749812,44.750048,44.750315,44.750867,44.750932,44.750988,44.751062,44.751127,44.751353,44.751575,44.753332,44.753957,44.754798,44.75512,44.755598,44.755822,44.756077,44.756328,44.756687,44.756955,44.75802,44.758138,44.758372,44.75855,44.759195,44.75932,44.759498,44.760225,44.76047,44.760835,44.76128,44.76183,44.762027,44.762045,44.762152,44.76235,44.76246,44.762647,44.763272,44.763717,44.764305,44.764535,44.764783,44.764887,44.765207,44.765412,44.765695,44.76592,44.765963,44.765932,44.765985,44.766065,44.766243,44.766387,44.766508,44.766705,44.766948,44.767515,44.76774,44.767895,44.768142,44.768365,44.768782,44.768843,44.768835,44.768937,44.769163,44.769257,44.76962,44.769793,44.769933,44.770123,44.770462,44.770788,44.771277,44.77134,44.771315,44.771228,44.771043,44.770973,44.771028,44.771188,44.771963,44.772965,44.77316,44.77328,44.773465,44.773702,44.773825,44.773983,44.774365,44.774362,44.774198,44.774252,44.774432,44.774467,44.774512,44.774672,44.775088,44.775253,44.776207,44.777338,44.777908,44.77814,44.778312,44.778505,44.778628,44.77868,44.77858,44.778478,44.7783,44.777967,44.777552,44.777358,44.776912,44.776952,44.777008,44.777157,44.777622,44.778018,44.778758,44.77972,44.781063,44.781725,44.781883,44.781998,44.782127,44.78215,44.782042,44.782128,44.782252,44.782398,44.782522,44.782598,44.782627,44.782563,44.782457,44.7823,44.781642,44.781512,44.781063,44.78094,44.780973,44.781227,44.781407,44.781885,44.781898,44.781787,44.781712,44.781588,44.78139,44.780877,44.780423,44.780263,44.780123,44.780053,44.780027,44.779868,44.779863,44.779973,44.780237,44.78046,44.780543,44.780592,44.780512,44.780267,44.780218,44.779988,44.779862,44.77955,44.779287,44.779275,44.77937,44.779522,44.779962,44.780192,44.780358,44.780543,44.780757,44.780927,44.781007,44.780978,44.780932,44.780993,44.781143,44.781225,44.78133,44.781453,44.781653,44.781892,44.78233,44.782543,44.782932,44.78315,44.783198,44.78321,44.78316,44.783293,44.783433,44.783637,44.783867,44.783905,44.783902,44.783795,44.783398,44.783165,44.782805,44.782575,44.782473,44.782417,44.782327,44.78216,44.781902,44.7811,44.780938,44.780742,44.780678,44.780717,44.780727,44.780783,44.781145,44.79076,44.790812,44.790758,44.790833,44.791168,44.791373,44.791545,44.792348,44.793062,44.793258,44.793328,44.793388,44.793523,44.793947,44.79429,44.795408,44.795598,44.795728,44.796073,44.796227,44.796453,44.796518,44.79795,44.79971,44.799782,44.80001,44.799948,44.799553,44.799285,44.799187,44.799322,44.799532,44.799738,44.799898,44.80007,44.802173,44.804155,44.809063,44.80906,44.809308,44.80942,44.811205,44.811485,44.812413,44.812887,44.81303,44.813443,44.813468,44.813323,44.813375,44.81352,44.813737,44.813768,44.813678,44.813305,44.81325,44.813323,44.813395,44.813653,44.813977,44.814555,44.814698,44.814817,44.81489,44.814838,44.814518,44.814175,44.81372,44.813743,44.813867,44.814092,44.81409,44.813998,44.813553,44.813527,44.813592,44.813657,44.813743,44.813948,44.814327,44.814623,44.814665,44.814595,44.814623,44.814687,44.815028,44.815663,44.815937,44.816035,44.81612,44.816173,44.816267,44.816475,44.816692,44.816845,44.817043,44.817663,44.817827,44.817975,44.818295,44.818302,44.818165,44.818338,44.818103,44.818068,44.818143,44.818452,44.818645,44.819067,44.819351,44.819288,44.819158,44.818613,44.81839,44.818192,44.817657,44.817015,44.816947,44.817012,44.817302,44.81782,44.817922,44.818122,44.818235,44.818285,44.81815,44.818208,44.818157,44.818283,44.818502,44.818532,44.818432,44.818453,44.818528,44.818495,44.818455,44.818573,44.818555,44.818448,44.818557,44.818683,44.818867,44.819062,44.819217,44.819327,44.81937,44.819463,44.819537,44.819582,44.819732,44.819687,44.819545,44.819312,44.819283,44.818918,44.818875,44.81897,44.818925,44.819117]}]]],null,null,{"interactive":true,"className":"","stroke":true,"color":"red","weight":5,"opacity":0.5,"fill":false,"fillColor":"red","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addCircleMarkers","args":[44.7920044874637,5.91214361144185,10,null,null,{"interactive":true,"className":"","stroke":false,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.9},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[44.735616,44.819732],"lng":[5.883753,5.940715]}},"evals":[],"jsHooks":[]}</script>
<p>For convenience, we can cast all the split point distances into stage as actual location points and create a simple feature containing the points:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="stage-route-annotations.html#cb20-1" aria-hidden="true" tabindex="-1"></a>splitPoints</span></code></pre></div>
<pre><code>##   splitPointId stageId number distance
## 1         3527    1701      1     6.46
## 2         3506    1701      2    10.99
## 3         3509    1701      3    17.50
## 4         3543    1701      4    19.10</code></pre>
<p>Create a simple function to handle the creation of a point:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="stage-route-annotations.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgeos)</span>
<span id="cb22-2"><a href="stage-route-annotations.html#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="stage-route-annotations.html#cb22-3" aria-hidden="true" tabindex="-1"></a>point_from_dist_along <span class="ot">=</span> <span class="cf">function</span>(route, dist){</span>
<span id="cb22-4"><a href="stage-route-annotations.html#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="fu">gInterpolate</span>(<span class="fu">as</span>(route,<span class="st">&#39;Spatial&#39;</span>),</span>
<span id="cb22-5"><a href="stage-route-annotations.html#cb22-5" aria-hidden="true" tabindex="-1"></a>                        dist, <span class="at">normalized =</span> <span class="cn">FALSE</span>))</span>
<span id="cb22-6"><a href="stage-route-annotations.html#cb22-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-7"><a href="stage-route-annotations.html#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="stage-route-annotations.html#cb22-8" aria-hidden="true" tabindex="-1"></a>coords_from_dist_along <span class="ot">=</span> <span class="cf">function</span>(route, dist){</span>
<span id="cb22-9"><a href="stage-route-annotations.html#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_coordinates</span>(<span class="fu">point_from_dist_along</span>(route, dist))</span>
<span id="cb22-10"><a href="stage-route-annotations.html#cb22-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-11"><a href="stage-route-annotations.html#cb22-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-12"><a href="stage-route-annotations.html#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="fu">point_from_dist_along</span>(utm_routes[<span class="dv">1</span>,], <span class="dv">1200</span>)</span></code></pre></div>
<pre><code>## Simple feature collection with 1 feature and 0 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: 728761.8 ymin: 4958594 xmax: 728761.8 ymax: 4958594
## CRS:            +proj=utm +zone=31 +datum=WGS84 +units=m +no_defs
##                   geometry
## 1 POINT (728761.8 4958594)</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="stage-route-annotations.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coords_from_dist_along</span>(utm_routes[<span class="dv">1</span>,], <span class="dv">1200</span>)</span></code></pre></div>
<pre><code>##          X       Y
## 1 728761.8 4958594</code></pre>
<p>And add the point to the dataframe:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="stage-route-annotations.html#cb26-1" aria-hidden="true" tabindex="-1"></a>geometry <span class="ot">=</span> <span class="fu">st_sfc</span>(<span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(splitPoints),</span>
<span id="cb26-2"><a href="stage-route-annotations.html#cb26-2" aria-hidden="true" tabindex="-1"></a>                         <span class="cf">function</span>(x) <span class="fu">st_point</span>()))</span>
<span id="cb26-3"><a href="stage-route-annotations.html#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="stage-route-annotations.html#cb26-4" aria-hidden="true" tabindex="-1"></a>splitPoints <span class="ot">=</span> <span class="fu">arrange</span>(splits_json<span class="sc">$</span>splitPoints, number)</span>
<span id="cb26-5"><a href="stage-route-annotations.html#cb26-5" aria-hidden="true" tabindex="-1"></a>splitPoints <span class="ot">=</span> <span class="fu">st_sf</span>(splitPoints, <span class="at">geometry =</span> geometry)</span>
<span id="cb26-6"><a href="stage-route-annotations.html#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="stage-route-annotations.html#cb26-7" aria-hidden="true" tabindex="-1"></a>splitPoints <span class="ot">=</span> splitPoints <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">geometry =</span> <span class="fu">st_geometry</span>(<span class="fu">point_from_dist_along</span>(utm_routes[<span class="dv">1</span>,], distance))) </span>
<span id="cb26-8"><a href="stage-route-annotations.html#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="stage-route-annotations.html#cb26-9" aria-hidden="true" tabindex="-1"></a>splitPoints</span></code></pre></div>
<pre><code>## Simple feature collection with 4 features and 4 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: 729180.3 ymin: 4957663 xmax: 729185.7 ymax: 4957675
## CRS:            +proj=utm +zone=31 +datum=WGS84 +units=m +no_defs
##   splitPointId stageId number distance                 geometry
## 1         3527    1701      1     6.46 POINT (729180.3 4957663)
## 2         3506    1701      2    10.99 POINT (729182.2 4957667)
## 3         3509    1701      3    17.50   POINT (729185 4957673)
## 4         3543    1701      4    19.10 POINT (729185.7 4957675)</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="stage-route-annotations.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_coordinates</span>(splitPoints )</span></code></pre></div>
<pre><code>##          X       Y
## 1 729180.3 4957663
## 2 729182.2 4957667
## 3 729185.0 4957673
## 4 729185.7 4957675</code></pre>
<p>We could also cast all the points to a multipoint:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="stage-route-annotations.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_multipoint</span>(<span class="fu">st_coordinates</span>(splitPoints))</span></code></pre></div>
<pre><code>## MULTIPOINT ((729180.3 4957663), (729182.2 4957667), (729185 4957673), (729185.7 4957675))</code></pre>
</div>
</div>
<div id="parallel-routes" class="section level2" number="6.3">
<h2><span class="header-section-number">6.3</span> Parallel Routes</h2>
<p>If we have access to multiple datasets along route, such as telemetry data sets for different cars, it may be useful to be able to plot each set on its own route line translated from the provided route.</p>
<p>The following example of how we might be able to achieve this is taken from <a href="https://andrewpwheeler.com/2015/10/08/one-sided-line-buffers-in-r-using-rgeos/"><em>One sided line buffers in R using rgeos</em></a> and represents a minimal proof of concept.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="stage-route-annotations.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb32-2"><a href="stage-route-annotations.html#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="stage-route-annotations.html#cb32-3" aria-hidden="true" tabindex="-1"></a>TwoBuf <span class="ot">&lt;-</span> <span class="cf">function</span>(line,width,minEx){</span>
<span id="cb32-4"><a href="stage-route-annotations.html#cb32-4" aria-hidden="true" tabindex="-1"></a>  Buf0 <span class="ot">&lt;-</span> <span class="fu">gBuffer</span>(line, <span class="at">width=</span>minEx, <span class="at">capStyle=</span><span class="st">&quot;SQUARE&quot;</span>)</span>
<span id="cb32-5"><a href="stage-route-annotations.html#cb32-5" aria-hidden="true" tabindex="-1"></a>  Buf1 <span class="ot">&lt;-</span> <span class="fu">gBuffer</span>(line, <span class="at">width=</span>width, <span class="at">capStyle=</span><span class="st">&quot;FLAT&quot;</span>)</span>
<span id="cb32-6"><a href="stage-route-annotations.html#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">disaggregate</span>(<span class="fu">gDifference</span>(Buf1,Buf0)))</span>
<span id="cb32-7"><a href="stage-route-annotations.html#cb32-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-8"><a href="stage-route-annotations.html#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="stage-route-annotations.html#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample the first few points from a route</span></span>
<span id="cb32-10"><a href="stage-route-annotations.html#cb32-10" aria-hidden="true" tabindex="-1"></a>cc <span class="ot">=</span> <span class="fu">st_coordinates</span>(geojson_sf[<span class="dv">1</span>,])[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,]</span>
<span id="cb32-11"><a href="stage-route-annotations.html#cb32-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-12"><a href="stage-route-annotations.html#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a linestring from the first few coordinates</span></span>
<span id="cb32-13"><a href="stage-route-annotations.html#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="co"># st_linestring expects a matrix,</span></span>
<span id="cb32-14"><a href="stage-route-annotations.html#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="co"># so create one with cbind on the long and lat columns</span></span>
<span id="cb32-15"><a href="stage-route-annotations.html#cb32-15" aria-hidden="true" tabindex="-1"></a>partial_route <span class="ot">=</span> <span class="fu">st_linestring</span>(<span class="fu">cbind</span>(<span class="at">x=</span>cc[,<span class="dv">1</span>], <span class="at">y=</span>cc[,<span class="dv">2</span>]))</span>
<span id="cb32-16"><a href="stage-route-annotations.html#cb32-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-17"><a href="stage-route-annotations.html#cb32-17" aria-hidden="true" tabindex="-1"></a>TortBuf <span class="ot">&lt;-</span> <span class="fu">TwoBuf</span>(<span class="at">line=</span><span class="fu">as</span>(partial_route,<span class="st">&#39;Spatial&#39;</span>),</span>
<span id="cb32-18"><a href="stage-route-annotations.html#cb32-18" aria-hidden="true" tabindex="-1"></a>                   <span class="at">width=</span><span class="fl">0.0001</span>, <span class="at">minEx=</span><span class="fl">0.00001</span>)</span>
<span id="cb32-19"><a href="stage-route-annotations.html#cb32-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-20"><a href="stage-route-annotations.html#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(TortBuf, <span class="at">col=</span><span class="fu">c</span>(<span class="st">&#39;red&#39;</span>, <span class="st">&#39;blue&#39;</span>))  <span class="co">#First object on left, second on right</span></span></code></pre></div>
<p><img src="images/stage-route-annotations-parallel-routes-simple-1.png" width="672" /></p>
<p>To make this approach more useful, it would probably make sense to project into UTM coordinates and set the parameters in units of meters.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introducing-map-projections.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="accessing-and-working-with-elevation-data-raster-files.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toc_depth": 3,
"toolbar": {
"position": "fixed"
},
"search": true,
"info": true
});
});
</script>

</body>

</html>
