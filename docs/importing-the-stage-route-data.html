<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Importing the Stage Route Data | Visualising WRC Rally Stages With rayshader and R</title>
  <meta name="description" content="Rally stage maps often appear on rally websites displayed via interactive web maps. The data used to generate the routes is often available as a digital data file of some sort. This book takes one such file and embarks on an adventure into the wilds of geocomputing using the R programming language to see just where such a file may take us. From web maps and elevation maps to interactive 3D displays, let the exploration commence…" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Importing the Stage Route Data | Visualising WRC Rally Stages With rayshader and R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Rally stage maps often appear on rally websites displayed via interactive web maps. The data used to generate the routes is often available as a digital data file of some sort. This book takes one such file and embarks on an adventure into the wilds of geocomputing using the R programming language to see just where such a file may take us. From web maps and elevation maps to interactive 3D displays, let the exploration commence…" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Importing the Stage Route Data | Visualising WRC Rally Stages With rayshader and R" />
  
  <meta name="twitter:description" content="Rally stage maps often appear on rally websites displayed via interactive web maps. The data used to generate the routes is often available as a digital data file of some sort. This book takes one such file and embarks on an adventure into the wilds of geocomputing using the R programming language to see just where such a file may take us. From web maps and elevation maps to interactive 3D displays, let the exploration commence…" />
  

<meta name="author" content="Tony Hirst" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="getting-started.html"/>
<link rel="next" href="working-with-route-data.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Index</a></li>
<li class="chapter" data-level="" data-path="in-the-beginning.html"><a href="in-the-beginning.html"><i class="fa fa-check"></i>In the beginning…</a></li>
<li class="chapter" data-level="" data-path="acknowledgements.html"><a href="acknowledgements.html"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#who-this-book-is-for"><i class="fa fa-check"></i><b>1.1</b> Who This Book Is For</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#what-this-book-isnt"><i class="fa fa-check"></i><b>1.2</b> What This Book Isn’t</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#structure-of-the-book"><i class="fa fa-check"></i><b>1.3</b> Structure of the Book</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#further-reading"><i class="fa fa-check"></i><b>1.4</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="getting-started.html"><a href="getting-started.html"><i class="fa fa-check"></i><b>2</b> Getting Started</a>
<ul>
<li class="chapter" data-level="2.1" data-path="getting-started.html"><a href="getting-started.html#setting-up-a-working-code-execution-environment"><i class="fa fa-check"></i><b>2.1</b> Setting Up a Working Code Execution Environment</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="getting-started.html"><a href="getting-started.html#installing-the-docker-environment"><i class="fa fa-check"></i><b>2.1.1</b> Installing the Docker Environment</a></li>
<li class="chapter" data-level="2.1.2" data-path="getting-started.html"><a href="getting-started.html#installing-the-required-r-packages-manually"><i class="fa fa-check"></i><b>2.1.2</b> Installing the Required R Packages Manually</a></li>
<li class="chapter" data-level="2.1.3" data-path="getting-started.html"><a href="getting-started.html#other-installation-dependencies"><i class="fa fa-check"></i><b>2.1.3</b> Other Installation Dependencies</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="getting-started.html"><a href="getting-started.html#using-the-rstudio-environment"><i class="fa fa-check"></i><b>2.2</b> Using the RStudio Environment</a></li>
<li class="chapter" data-level="2.3" data-path="getting-started.html"><a href="getting-started.html#using-a-jupyter-notebook-environment"><i class="fa fa-check"></i><b>2.3</b> Using a Jupyter Notebook Environment</a></li>
<li class="chapter" data-level="2.4" data-path="getting-started.html"><a href="getting-started.html#exploring-the-book-as-an-online-interactive-textbook-not-yet"><i class="fa fa-check"></i><b>2.4</b> Exploring the Book as an Online Interactive Textbook (Not Yet!)</a></li>
<li class="chapter" data-level="2.5" data-path="getting-started.html"><a href="getting-started.html#serving-your-own-map-tiles-and-elevation-raster-images"><i class="fa fa-check"></i><b>2.5</b> Serving Your Own Map Tiles and Elevation Raster Images</a></li>
<li class="chapter" data-level="2.6" data-path="getting-started.html"><a href="getting-started.html#donate"><i class="fa fa-check"></i><b>2.6</b> Donate</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html"><i class="fa fa-check"></i><b>3</b> Importing the Stage Route Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#downloading-the-stage-data-file"><i class="fa fa-check"></i><b>3.1</b> Downloading the Stage Data File</a></li>
<li class="chapter" data-level="3.2" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#opening-kml-geodata-files"><i class="fa fa-check"></i><b>3.2</b> Opening KML Geodata Files</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#using-rgdal-and-sp-to-open-geodata-files"><i class="fa fa-check"></i><b>3.2.1</b> Using <code>rgdal</code> and <code>sp</code> to Open Geodata Files</a></li>
<li class="chapter" data-level="3.2.2" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#using-sf-to-open-geodata-files"><i class="fa fa-check"></i><b>3.2.2</b> Using <code>sf</code> to Open Geodata Files</a></li>
<li class="chapter" data-level="3.2.3" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#accessing-route-data-as-a-geojson-string"><i class="fa fa-check"></i><b>3.2.3</b> Accessing Route Data as a geojson String</a></li>
<li class="chapter" data-level="3.2.4" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#saving-simple-features-data-to-various-geodata-file-formats"><i class="fa fa-check"></i><b>3.2.4</b> Saving Simple Features Data to Various Geodata File Formats</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#important-geodata-file-formats"><i class="fa fa-check"></i><b>3.3</b> Important Geodata File Formats</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#loading-geojson-data"><i class="fa fa-check"></i><b>3.3.1</b> Loading geojson Data</a></li>
<li class="chapter" data-level="3.3.2" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#loading-gpx-data"><i class="fa fa-check"></i><b>3.3.2</b> Loading GPX Data</a></li>
<li class="chapter" data-level="3.3.3" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#loading-flight-data-using-igc-format-gps-files"><i class="fa fa-check"></i><b>3.3.3</b> Loading Flight Data Using IGC format GPS Files</a></li>
<li class="chapter" data-level="3.3.4" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#reading-data-from-gps-devices"><i class="fa fa-check"></i><b>3.3.4</b> Reading Data from GPS Devices</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="working-with-route-data.html"><a href="working-with-route-data.html"><i class="fa fa-check"></i><b>4</b> Working with Route Data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="working-with-route-data.html"><a href="working-with-route-data.html#loading-in-the-route-data"><i class="fa fa-check"></i><b>4.1</b> Loading in the Route Data</a></li>
<li class="chapter" data-level="4.2" data-path="working-with-route-data.html"><a href="working-with-route-data.html#access-a-specific-stage"><i class="fa fa-check"></i><b>4.2</b> Access a specific stage</a></li>
<li class="chapter" data-level="4.3" data-path="working-with-route-data.html"><a href="working-with-route-data.html#visual-preview-of-route-geodata"><i class="fa fa-check"></i><b>4.3</b> Visual Preview of Route Geodata</a></li>
<li class="chapter" data-level="4.4" data-path="working-with-route-data.html"><a href="working-with-route-data.html#previews-using-ggplot2"><i class="fa fa-check"></i><b>4.4</b> Previews using <code>ggplot2</code></a></li>
<li class="chapter" data-level="4.5" data-path="working-with-route-data.html"><a href="working-with-route-data.html#identifying-the-start-and-end-of-the-stage"><i class="fa fa-check"></i><b>4.5</b> Identifying the Start and End of the Stage</a></li>
<li class="chapter" data-level="4.6" data-path="working-with-route-data.html"><a href="working-with-route-data.html#extracting-route-fragments"><i class="fa fa-check"></i><b>4.6</b> Extracting Route Fragments</a></li>
<li class="chapter" data-level="4.7" data-path="working-with-route-data.html"><a href="working-with-route-data.html#previews-using-leaflet-interactive-maps"><i class="fa fa-check"></i><b>4.7</b> Previews Using <code>leaflet</code> Interactive Maps</a></li>
<li class="chapter" data-level="4.8" data-path="working-with-route-data.html"><a href="working-with-route-data.html#creating-buffer-regions-around-features"><i class="fa fa-check"></i><b>4.8</b> Creating Buffer regions around features</a></li>
<li class="chapter" data-level="4.9" data-path="working-with-route-data.html"><a href="working-with-route-data.html#adding-additional-features-to-leaflet-maps"><i class="fa fa-check"></i><b>4.9</b> Adding Additional Features to <code>leaflet</code> maps</a>
<ul>
<li class="chapter" data-level="4.9.1" data-path="working-with-route-data.html"><a href="working-with-route-data.html#add-minimap-navigation"><i class="fa fa-check"></i><b>4.9.1</b> Add “minimap” navigation</a></li>
<li class="chapter" data-level="4.9.2" data-path="working-with-route-data.html"><a href="working-with-route-data.html#add-custom-symbol-legends"><i class="fa fa-check"></i><b>4.9.2</b> Add Custom Symbol Legends</a></li>
<li class="chapter" data-level="4.9.3" data-path="working-with-route-data.html"><a href="working-with-route-data.html#adding-mini-charts-to-maps"><i class="fa fa-check"></i><b>4.9.3</b> Adding Mini-Charts to Maps</a></li>
<li class="chapter" data-level="4.9.4" data-path="working-with-route-data.html"><a href="working-with-route-data.html#adding-html-content-to-popups"><i class="fa fa-check"></i><b>4.9.4</b> Adding HTML content to popups</a></li>
</ul></li>
<li class="chapter" data-level="4.10" data-path="working-with-route-data.html"><a href="working-with-route-data.html#using-mapview-to-create-leaflet-maps"><i class="fa fa-check"></i><b>4.10</b> Using <code>mapview</code> To Create <em>leaflet</em> Maps</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html"><i class="fa fa-check"></i><b>5</b> Introducing Map Projections</a>
<ul>
<li class="chapter" data-level="5.1" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#load-in-the-route-data"><i class="fa fa-check"></i><b>5.1</b> Load in the Route Data</a></li>
<li class="chapter" data-level="5.2" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#previewing-a-map-route"><i class="fa fa-check"></i><b>5.2</b> Previewing a Map Route</a></li>
<li class="chapter" data-level="5.3" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#plotting-latlong-naively"><i class="fa fa-check"></i><b>5.3</b> Plotting LatLong Naively</a></li>
<li class="chapter" data-level="5.4" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#using-the-utm-co-ordinate-reference-system"><i class="fa fa-check"></i><b>5.4</b> Using the UTM Co-ordinate Reference System</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#using-st_transform-for-projection-transformations"><i class="fa fa-check"></i><b>5.4.1</b> Using <code>st_transform</code> for Projection Transformations</a></li>
<li class="chapter" data-level="5.4.2" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#using-ggplot2coord_sf-to-render-projections"><i class="fa fa-check"></i><b>5.4.2</b> Using <code>ggplot2::coord_sf</code> to Render Projections</a></li>
<li class="chapter" data-level="5.4.3" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#exporting-the-route-data-as-a-dataframe"><i class="fa fa-check"></i><b>5.4.3</b> Exporting the Route Data As a Dataframe</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#alternative-crs-projections"><i class="fa fa-check"></i><b>5.5</b> Alternative CRS Projections</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="stage-route-annotations.html"><a href="stage-route-annotations.html"><i class="fa fa-check"></i><b>6</b> Stage Route Annotations</a>
<ul>
<li class="chapter" data-level="6.1" data-path="stage-route-annotations.html"><a href="stage-route-annotations.html#load-in-the-route-data-1"><i class="fa fa-check"></i><b>6.1</b> Load in the Route Data</a></li>
<li class="chapter" data-level="6.2" data-path="stage-route-annotations.html"><a href="stage-route-annotations.html#adding-split-point-locations"><i class="fa fa-check"></i><b>6.2</b> Adding Split Point Locations</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="stage-route-annotations.html"><a href="stage-route-annotations.html#using-geojson-to-find-the-distance-along-a-route"><i class="fa fa-check"></i><b>6.2.1</b> Using geojson to Find the Distance Along a Route</a></li>
<li class="chapter" data-level="6.2.2" data-path="stage-route-annotations.html"><a href="stage-route-annotations.html#using-rgeosginterpolate-to-find-the-distance-along-a-route"><i class="fa fa-check"></i><b>6.2.2</b> Using <code>rgeos::gInterpolate</code> to Find the Distance Along a Route</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="stage-route-annotations.html"><a href="stage-route-annotations.html#parallel-routes"><i class="fa fa-check"></i><b>6.3</b> Parallel Routes</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html"><i class="fa fa-check"></i><b>7</b> Accessing and Working With Elevation Data Raster Files</a>
<ul>
<li class="chapter" data-level="7.1" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#introducing-digital-elevation-model-dem-raster-images"><i class="fa fa-check"></i><b>7.1</b> Introducing Digital Elevation Model (DEM) Raster Images</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#what-is-raster-data"><i class="fa fa-check"></i><b>7.1.1</b> What Is Raster Data?</a></li>
<li class="chapter" data-level="7.1.2" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#what-are-digital-elevation-models-dems"><i class="fa fa-check"></i><b>7.1.2</b> What Are Digital Elevation Models (DEMs)?</a></li>
<li class="chapter" data-level="7.1.3" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#the-r-raster-package"><i class="fa fa-check"></i><b>7.1.3</b> The R <code>raster</code> Package</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#downloading-elevation-data"><i class="fa fa-check"></i><b>7.2</b> Downloading Elevation Data</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#loading-in-some-stage-data"><i class="fa fa-check"></i><b>7.2.1</b> Loading in some stage data</a></li>
<li class="chapter" data-level="7.2.2" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#obtaining-relief-elevation-raster-data-using-elevatr"><i class="fa fa-check"></i><b>7.2.2</b> Obtaining relief / elevation raster data using <code>elevatr</code></a></li>
<li class="chapter" data-level="7.2.3" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#plotting-rasters-as-ggplot-objects"><i class="fa fa-check"></i><b>7.2.3</b> Plotting Rasters As <code>ggplot</code> Objects</a></li>
<li class="chapter" data-level="7.2.4" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#interactive-raster-previews-with-plainview"><i class="fa fa-check"></i><b>7.2.4</b> Interactive Raster Previews with <code>plainview</code></a></li>
<li class="chapter" data-level="7.2.5" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#saving-the-image-raster-data-to-a-local-file"><i class="fa fa-check"></i><b>7.2.5</b> Saving the Image Raster Data to a Local File</a></li>
<li class="chapter" data-level="7.2.6" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#from-raster-to-terra"><i class="fa fa-check"></i><b>7.2.6</b> From <code>raster</code> to <code>terra</code></a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#overlaying-raster-images-on-leaflet-maps"><i class="fa fa-check"></i><b>7.3</b> Overlaying Raster Images on Leaflet Maps</a></li>
<li class="chapter" data-level="7.4" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#retrieving-descriptive-information-about-the-raster"><i class="fa fa-check"></i><b>7.4</b> Retrieving Descriptive Information About the Raster</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#using-mapzen-to-retrieve-dem-raster-data"><i class="fa fa-check"></i><b>7.4.1</b> Using Mapzen to Retrieve DEM raster data</a></li>
<li class="chapter" data-level="7.4.2" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#additional-elevation-data-downloading-tools"><i class="fa fa-check"></i><b>7.4.2</b> Additional Elevation Data Downloading Tools</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#manipulating-raster-images"><i class="fa fa-check"></i><b>7.5</b> Manipulating Raster Images</a></li>
<li class="chapter" data-level="7.6" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#ridge-maps"><i class="fa fa-check"></i><b>7.6</b> Ridge maps</a></li>
<li class="chapter" data-level="7.7" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#further-information"><i class="fa fa-check"></i><b>7.7</b> Further Information</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="determining-terrain-features-from-raster-data.html"><a href="determining-terrain-features-from-raster-data.html"><i class="fa fa-check"></i><b>8</b> Determining Terrain Features from Raster Data</a>
<ul>
<li class="chapter" data-level="8.1" data-path="determining-terrain-features-from-raster-data.html"><a href="determining-terrain-features-from-raster-data.html#load-in-base-data"><i class="fa fa-check"></i><b>8.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="8.2" data-path="determining-terrain-features-from-raster-data.html"><a href="determining-terrain-features-from-raster-data.html#rendering-terrain-over-raster-images"><i class="fa fa-check"></i><b>8.2</b> Rendering Terrain Over Raster Images</a></li>
<li class="chapter" data-level="8.3" data-path="determining-terrain-features-from-raster-data.html"><a href="determining-terrain-features-from-raster-data.html#adding-contours-to-raster-images"><i class="fa fa-check"></i><b>8.3</b> Adding Contours to <code>raster</code> Images</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="using-rayshader-to-render-2d-elevation-and-shade-views.html"><a href="using-rayshader-to-render-2d-elevation-and-shade-views.html"><i class="fa fa-check"></i><b>9</b> Using <code>rayshader</code> to Render 2D Elevation and Shade Views</a>
<ul>
<li class="chapter" data-level="9.1" data-path="using-rayshader-to-render-2d-elevation-and-shade-views.html"><a href="using-rayshader-to-render-2d-elevation-and-shade-views.html#load-in-base-data-1"><i class="fa fa-check"></i><b>9.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="9.2" data-path="using-rayshader-to-render-2d-elevation-and-shade-views.html"><a href="using-rayshader-to-render-2d-elevation-and-shade-views.html#rendering-imagery-from-the-dem-raster"><i class="fa fa-check"></i><b>9.2</b> Rendering imagery from the DEM raster</a></li>
<li class="chapter" data-level="9.3" data-path="using-rayshader-to-render-2d-elevation-and-shade-views.html"><a href="using-rayshader-to-render-2d-elevation-and-shade-views.html#roundtripping-rayshader-rasters-and-matrices"><i class="fa fa-check"></i><b>9.3</b> Roundtripping <code>rayshader</code> Rasters and Matrices</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html"><i class="fa fa-check"></i><b>10</b> Overlaying 2D <code>rayshader</code> Maps</a>
<ul>
<li class="chapter" data-level="10.1" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#load-in-base-data-2"><i class="fa fa-check"></i><b>10.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="10.2" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#adding-overlays"><i class="fa fa-check"></i><b>10.2</b> Adding overlays</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#adding-shadows-to-rayshader-maps"><i class="fa fa-check"></i><b>10.2.1</b> Adding Shadows to <code>rayshader</code> Maps</a></li>
<li class="chapter" data-level="10.2.2" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#adding-water-features"><i class="fa fa-check"></i><b>10.2.2</b> Adding Water Features</a></li>
<li class="chapter" data-level="10.2.3" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#overlaying-map-tiles"><i class="fa fa-check"></i><b>10.2.3</b> Overlaying Map Tiles</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#adding-a-stage-route-layer"><i class="fa fa-check"></i><b>10.3</b> Adding a Stage Route Layer</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#buffering-the-stage-route-view"><i class="fa fa-check"></i><b>10.3.1</b> Buffering the Stage Route View</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#modeling-increased-water-levels"><i class="fa fa-check"></i><b>10.4</b> Modeling Increased Water Levels</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="annotating-rayshader-maps.html"><a href="annotating-rayshader-maps.html"><i class="fa fa-check"></i><b>11</b> Annotating <code>rayshader</code> maps</a>
<ul>
<li class="chapter" data-level="11.1" data-path="annotating-rayshader-maps.html"><a href="annotating-rayshader-maps.html#load-in-base-data-3"><i class="fa fa-check"></i><b>11.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="11.2" data-path="annotating-rayshader-maps.html"><a href="annotating-rayshader-maps.html#adding-a-title-to-a-map"><i class="fa fa-check"></i><b>11.2</b> Adding a Title to a Map</a></li>
<li class="chapter" data-level="11.3" data-path="annotating-rayshader-maps.html"><a href="annotating-rayshader-maps.html#adding-contours-to-rayshader-stage-maps"><i class="fa fa-check"></i><b>11.3</b> Adding Contours to <code>rayshader</code> Stage Maps</a></li>
<li class="chapter" data-level="11.4" data-path="annotating-rayshader-maps.html"><a href="annotating-rayshader-maps.html#overlaying-image-tiles"><i class="fa fa-check"></i><b>11.4</b> Overlaying Image Tiles</a></li>
<li class="chapter" data-level="11.5" data-path="annotating-rayshader-maps.html"><a href="annotating-rayshader-maps.html#plotting-route-layers-on-rayshader-maps"><i class="fa fa-check"></i><b>11.5</b> Plotting Route Layers on <code>rayshader</code> Maps</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="an-aside-the-penny-red.html"><a href="an-aside-the-penny-red.html"><i class="fa fa-check"></i>An Aside - The Penny Red</a>
<ul>
<li><a href="an-aside-the-penny-red.html#d-rendering-of-colour-images-using-rayshader">3D Rendering of Colour Images Using <code>rayshader</code></a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="an-aside-the-penny-red.html"><a href="an-aside-the-penny-red.html#rendering-the-image-directly-from-ggplot2"><i class="fa fa-check"></i><b>11.5.1</b> Rendering the image directly from <code>ggplot2</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="an-aside-the-penny-red.html"><a href="an-aside-the-penny-red.html#rendering-a-movie"><i class="fa fa-check"></i>Rendering a Movie</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html"><i class="fa fa-check"></i><b>12</b> Introducing 3D <code>rayshader</code> Models</a>
<ul>
<li class="chapter" data-level="12.1" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#rendering-the-3d-maps-in-rstudio-and-knitrable-rmd-documents"><i class="fa fa-check"></i><b>12.1</b> Rendering the 3D Maps in <em>RStudio&amp; and <code>knitr</code>able </em>Rmd* Documents</a></li>
<li class="chapter" data-level="12.2" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#rendering-a-3d-view"><i class="fa fa-check"></i><b>12.2</b> Rendering a 3D View</a></li>
<li class="chapter" data-level="12.3" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#the-rayshader-3d-model-plinth"><i class="fa fa-check"></i><b>12.3</b> The <code>rayshader</code> 3D Model Plinth</a></li>
<li class="chapter" data-level="12.4" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#saving-the-widget-as-an-html-file"><i class="fa fa-check"></i><b>12.4</b> Saving the Widget as an HTML File</a></li>
<li class="chapter" data-level="12.5" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#rendering-the-model-to-an-image-file"><i class="fa fa-check"></i><b>12.5</b> Rendering the Model to an Image File</a></li>
<li class="chapter" data-level="12.6" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#rendering-high-quality-models"><i class="fa fa-check"></i><b>12.6</b> Rendering High Quality Models</a></li>
<li class="chapter" data-level="12.7" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#making-a-3d-print-file"><i class="fa fa-check"></i><b>12.7</b> Making a 3D Print File</a></li>
<li class="chapter" data-level="12.8" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#saving-a-movie-of-a-3d-model"><i class="fa fa-check"></i><b>12.8</b> Saving a Movie of a 3D Model</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="rendering-3d-rayshader-stage-route-maps.html"><a href="rendering-3d-rayshader-stage-route-maps.html"><i class="fa fa-check"></i><b>13</b> Rendering 3D <code>rayshader</code> Stage Route Maps</a>
<ul>
<li class="chapter" data-level="13.1" data-path="rendering-3d-rayshader-stage-route-maps.html"><a href="rendering-3d-rayshader-stage-route-maps.html#load-in-base-data-4"><i class="fa fa-check"></i><b>13.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="13.2" data-path="rendering-3d-rayshader-stage-route-maps.html"><a href="rendering-3d-rayshader-stage-route-maps.html#setting-up-3d-embedded-plots"><i class="fa fa-check"></i><b>13.2</b> Setting Up 3D Embedded Plots</a></li>
<li class="chapter" data-level="13.3" data-path="rendering-3d-rayshader-stage-route-maps.html"><a href="rendering-3d-rayshader-stage-route-maps.html#rendering-a-simple-stage-route-model"><i class="fa fa-check"></i><b>13.3</b> Rendering a Simple Stage Route Model</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="rendering-3d-rayshader-stage-route-maps.html"><a href="rendering-3d-rayshader-stage-route-maps.html#decorating-3d-views-with-map-tile-overlays"><i class="fa fa-check"></i><b>13.3.1</b> Decorating 3D Views With Map Tile Overlays</a></li>
<li class="chapter" data-level="13.3.2" data-path="rendering-3d-rayshader-stage-route-maps.html"><a href="rendering-3d-rayshader-stage-route-maps.html#adding-labels-to-3d-rayshader-maps"><i class="fa fa-check"></i><b>13.3.2</b> Adding Labels to 3D <code>rayshader</code> Maps</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="creating-cropped-3d-rayshader-models.html"><a href="creating-cropped-3d-rayshader-models.html"><i class="fa fa-check"></i><b>14</b> Creating Cropped 3d <code>rayshader</code> Models</a>
<ul>
<li class="chapter" data-level="14.1" data-path="creating-cropped-3d-rayshader-models.html"><a href="creating-cropped-3d-rayshader-models.html#load-in-base-data-5"><i class="fa fa-check"></i><b>14.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="14.2" data-path="creating-cropped-3d-rayshader-models.html"><a href="creating-cropped-3d-rayshader-models.html#cropping-the-rendered-3d-view"><i class="fa fa-check"></i><b>14.2</b> Cropping the Rendered 3D View</a></li>
<li class="chapter" data-level="14.3" data-path="creating-cropped-3d-rayshader-models.html"><a href="creating-cropped-3d-rayshader-models.html#cropping-3d-models-to-a-buffered-region"><i class="fa fa-check"></i><b>14.3</b> Cropping 3D Models to a Buffered Region</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="obtaining-shadows-for-a-particular-date-and-time.html"><a href="obtaining-shadows-for-a-particular-date-and-time.html"><i class="fa fa-check"></i><b>15</b> Obtaining Shadows for a Particular Date and Time</a>
<ul>
<li class="chapter" data-level="15.1" data-path="obtaining-shadows-for-a-particular-date-and-time.html"><a href="obtaining-shadows-for-a-particular-date-and-time.html#load-in-base-data-6"><i class="fa fa-check"></i><b>15.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="15.2" data-path="obtaining-shadows-for-a-particular-date-and-time.html"><a href="obtaining-shadows-for-a-particular-date-and-time.html#sunlight-times-vocabulary"><i class="fa fa-check"></i><b>15.2</b> Sunlight Times Vocabulary</a></li>
<li class="chapter" data-level="15.3" data-path="obtaining-shadows-for-a-particular-date-and-time.html"><a href="obtaining-shadows-for-a-particular-date-and-time.html#finding-sunrise-and-sunset-times"><i class="fa fa-check"></i><b>15.3</b> Finding Sunrise and Sunset Times</a></li>
<li class="chapter" data-level="15.4" data-path="obtaining-shadows-for-a-particular-date-and-time.html"><a href="obtaining-shadows-for-a-particular-date-and-time.html#animating-shade"><i class="fa fa-check"></i><b>15.4</b> Animating Shade</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html"><i class="fa fa-check"></i><b>16</b> Composing <code>rayshader</code> Stills and Movies</a>
<ul>
<li class="chapter" data-level="16.1" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html#load-in-base-data-7"><i class="fa fa-check"></i><b>16.1</b> Load in Base Data</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html#adding-complications"><i class="fa fa-check"></i><b>16.1.1</b> Adding Complications…</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html#setting-up-the-camera-shots-in-rayshader"><i class="fa fa-check"></i><b>16.2</b> Setting Up the Camera Shots in <code>rayshader</code></a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html#depth-of-field"><i class="fa fa-check"></i><b>16.2.1</b> Depth of Field</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html#camera-positioning"><i class="fa fa-check"></i><b>16.3</b> Camera Positioning</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html#lighting-effects"><i class="fa fa-check"></i><b>16.3.1</b> Lighting Effects</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html#making-3d-video-tracking-shots"><i class="fa fa-check"></i><b>16.4</b> Making 3D Video Tracking Shots</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html"><i class="fa fa-check"></i><b>17</b> Stage Route Analysis</a>
<ul>
<li class="chapter" data-level="17.1" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#load-in-base-data-8"><i class="fa fa-check"></i><b>17.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="17.2" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#generating-stage-route-profiles"><i class="fa fa-check"></i><b>17.2</b> Generating Stage Route Profiles</a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#an-aside---twists-and-turns-of-rally-stages"><i class="fa fa-check"></i><b>17.2.1</b> An Aside - Twists and Turns of Rally Stages</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#finding-stage-route-lengths"><i class="fa fa-check"></i><b>17.3</b> Finding Stage Route Lengths</a></li>
<li class="chapter" data-level="17.4" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#using-ecological-movement-analysis-tools-to-analyse-stage-routes"><i class="fa fa-check"></i><b>17.4</b> Using Ecological Movement Analysis Tools to Analyse Stage Routes</a></li>
<li class="chapter" data-level="17.5" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#using-trajr-for-stage-route-profiling"><i class="fa fa-check"></i><b>17.5</b> Using <code>trajr</code> for Stage Route Profiling</a>
<ul>
<li class="chapter" data-level="17.5.1" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#smoothing-a-trajectory"><i class="fa fa-check"></i><b>17.5.1</b> Smoothing a Trajectory</a></li>
<li class="chapter" data-level="17.5.2" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#resampling-locations"><i class="fa fa-check"></i><b>17.5.2</b> Resampling Locations</a></li>
<li class="chapter" data-level="17.5.3" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#resampling-against-distance"><i class="fa fa-check"></i><b>17.5.3</b> Resampling Against Distance</a></li>
<li class="chapter" data-level="17.5.4" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#splitting-a-trajectory"><i class="fa fa-check"></i><b>17.5.4</b> Splitting a Trajectory</a></li>
<li class="chapter" data-level="17.5.5" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#rotating-the-stage-trajectory"><i class="fa fa-check"></i><b>17.5.5</b> Rotating the Stage Trajectory</a></li>
<li class="chapter" data-level="17.5.6" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#straightness-and-sinuosity"><i class="fa fa-check"></i><b>17.5.6</b> Straightness and Sinuosity</a></li>
<li class="chapter" data-level="17.5.7" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#directional-change"><i class="fa fa-check"></i><b>17.5.7</b> Directional Change</a></li>
<li class="chapter" data-level="17.5.8" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#tracking-turning-angles"><i class="fa fa-check"></i><b>17.5.8</b> Tracking Turning Angles</a></li>
<li class="chapter" data-level="17.5.9" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#visualising-trajectory-direction-changes"><i class="fa fa-check"></i><b>17.5.9</b> Visualising Trajectory Direction Changes</a></li>
<li class="chapter" data-level="17.5.10" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#using-amt-for-stage-route-profiling"><i class="fa fa-check"></i><b>17.5.10</b> Using <code>amt</code> for Stage Route Profiling</a></li>
<li class="chapter" data-level="17.5.11" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#creating-tracks"><i class="fa fa-check"></i><b>17.5.11</b> Creating Tracks</a></li>
<li class="chapter" data-level="17.5.12" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#converting-to-other-track-formats"><i class="fa fa-check"></i><b>17.5.12</b> Converting to Other Track Formats</a></li>
</ul></li>
<li class="chapter" data-level="17.6" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#using-amt-for-stage-route-analysis"><i class="fa fa-check"></i><b>17.6</b> Using <code>amt</code> for Stage Route Analysis</a></li>
<li class="chapter" data-level="17.7" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#using-rlft-for-profiling-along-a-stage-route"><i class="fa fa-check"></i><b>17.7</b> Using `rLFT`` for Profiling Along a Stage Route</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html"><i class="fa fa-check"></i><b>18</b> Elevation Data Revisited</a>
<ul>
<li class="chapter" data-level="18.1" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#load-in-base-data-9"><i class="fa fa-check"></i><b>18.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="18.2" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#generating-elevation-maps"><i class="fa fa-check"></i><b>18.2</b> Generating Elevation Maps</a>
<ul>
<li class="chapter" data-level="18.2.1" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#accessing-elevation-values-along-a-route-from-an-elevation-raster"><i class="fa fa-check"></i><b>18.2.1</b> Accessing Elevation Values Along a Route from an Elevation Raster</a></li>
<li class="chapter" data-level="18.2.2" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#using-geospheredistgeo-to-find-distance-along-a-route"><i class="fa fa-check"></i><b>18.2.2</b> Using <code>geosphere::distGeo</code> to Find Distance Along a Route</a></li>
<li class="chapter" data-level="18.2.3" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#using-spspdists-to-find-distance-along-a-route"><i class="fa fa-check"></i><b>18.2.3</b> Using <code>sp::spDists</code> to Find Distance Along a Route</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#generating-a-3d-ribbon-plot-of-the-stage-route"><i class="fa fa-check"></i><b>18.3</b> Generating a 3D Ribbon Plot of the Stage Route</a></li>
<li class="chapter" data-level="18.4" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#identifying-road-type"><i class="fa fa-check"></i><b>18.4</b> Identifying Road Type</a></li>
<li class="chapter" data-level="18.5" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#displaying-route-twistiness-and-elevation"><i class="fa fa-check"></i><b>18.5</b> Displaying Route Twistiness and Elevation</a>
<ul>
<li class="chapter" data-level="18.5.1" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#making-a-3d-print-file-of-the-model"><i class="fa fa-check"></i><b>18.5.1</b> Making a 3D Print File of the Model</a></li>
<li class="chapter" data-level="18.5.2" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#rendering-a-3d-movie-of-the-model"><i class="fa fa-check"></i><b>18.5.2</b> Rendering a 3D movie of the Model</a></li>
</ul></li>
<li class="chapter" data-level="18.6" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#using-the-slopes-package-to-analyse-stage-elevation-data"><i class="fa fa-check"></i><b>18.6</b> Using the <code>slopes</code> Package to Analyse Stage Elevation Data</a></li>
<li class="chapter" data-level="18.7" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#analysing-route-elevation-from-first-principles"><i class="fa fa-check"></i><b>18.7</b> Analysing Route Elevation from First Principles</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html"><i class="fa fa-check"></i><b>19</b> Adding <em>OpenStreetMap</em> Data</a>
<ul>
<li class="chapter" data-level="19.1" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#load-in-base-data-10"><i class="fa fa-check"></i><b>19.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="19.2" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#adding-detail-and-features-from-openstreetmap"><i class="fa fa-check"></i><b>19.2</b> Adding Detail and Features from OpenStreetMap</a>
<ul>
<li class="chapter" data-level="19.2.1" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#plotting-osm-highways"><i class="fa fa-check"></i><b>19.2.1</b> Plotting OSM Highways</a></li>
</ul></li>
<li class="chapter" data-level="19.3" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#viewing-roads-in-the-vicinity-of-a-route"><i class="fa fa-check"></i><b>19.3</b> Viewing Roads in the Vicinity of a Route</a>
<ul>
<li class="chapter" data-level="19.3.1" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#using-sfst_buffer-to-create-buffered-areas"><i class="fa fa-check"></i><b>19.3.1</b> Using <code>sf::st_buffer</code> to Create Buffered Areas</a></li>
<li class="chapter" data-level="19.3.2" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#using-rgeosgbuffer-to-create-buffered-areas"><i class="fa fa-check"></i><b>19.3.2</b> Using <code>rgeos::gBuffer</code> to Create Buffered Areas</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#adding-additional-data-from-osm"><i class="fa fa-check"></i><b>19.4</b> Adding Additional Data From OSM</a>
<ul>
<li class="chapter" data-level="19.4.1" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#adding-building-layers-from-openstreetmap"><i class="fa fa-check"></i><b>19.4.1</b> Adding Building Layers from <em>OpenStreetMap</em></a></li>
<li class="chapter" data-level="19.4.2" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#the-wide-variety-of-osm-features"><i class="fa fa-check"></i><b>19.4.2</b> The Wide Variety of OSM Features</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="20" data-path="automatically-generating-stage-descriptions.html"><a href="automatically-generating-stage-descriptions.html"><i class="fa fa-check"></i><b>20</b> Automatically Generating Stage Descriptions</a>
<ul>
<li class="chapter" data-level="20.1" data-path="automatically-generating-stage-descriptions.html"><a href="automatically-generating-stage-descriptions.html#jemba-inertia-notes-system"><i class="fa fa-check"></i><b>20.1</b> Jemba Inertia Notes System</a></li>
<li class="chapter" data-level="20.2" data-path="automatically-generating-stage-descriptions.html"><a href="automatically-generating-stage-descriptions.html#generating-stage-descriptions"><i class="fa fa-check"></i><b>20.2</b> Generating Stage Descriptions</a></li>
<li class="chapter" data-level="20.3" data-path="automatically-generating-stage-descriptions.html"><a href="automatically-generating-stage-descriptions.html#load-in-base-data-11"><i class="fa fa-check"></i><b>20.3</b> Load in Base Data</a></li>
<li class="chapter" data-level="20.4" data-path="automatically-generating-stage-descriptions.html"><a href="automatically-generating-stage-descriptions.html#identifying-corners-based-on-trajr-step-gradients"><i class="fa fa-check"></i><b>20.4</b> Identifying Corners Based on <code>trajr</code> Step Gradients</a>
<ul>
<li class="chapter" data-level="20.4.1" data-path="automatically-generating-stage-descriptions.html"><a href="automatically-generating-stage-descriptions.html#numbering-corners"><i class="fa fa-check"></i><b>20.4.1</b> Numbering Corners</a></li>
</ul></li>
<li class="chapter" data-level="20.5" data-path="automatically-generating-stage-descriptions.html"><a href="automatically-generating-stage-descriptions.html#categorising-corners-using-rlft-convexity"><i class="fa fa-check"></i><b>20.5</b> Categorising Corners Using <code>rLFT</code> Convexity</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html"><i class="fa fa-check"></i><b>21</b> Creating A Road Book</a>
<ul>
<li class="chapter" data-level="21.1" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#motorsport-uk-specific-regulations-for-rallying"><i class="fa fa-check"></i><b>21.1</b> Motorsport UK Specific Regulations for Rallying</a></li>
<li class="chapter" data-level="21.2" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#load-in-base-data-12"><i class="fa fa-check"></i><b>21.2</b> Load in Base Data</a></li>
<li class="chapter" data-level="21.3" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#using-sfnetworks-to-represent-routes-and-road-networks"><i class="fa fa-check"></i><b>21.3</b> Using <code>sfnetworks</code> to Represent Routes and Road Networks</a></li>
<li class="chapter" data-level="21.4" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#analysing-road-networks-with-sfnetworks"><i class="fa fa-check"></i><b>21.4</b> Analysing Road Networks with <code>sfnetworks</code></a>
<ul>
<li class="chapter" data-level="21.4.1" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#creating-an-sfnetworks-graph"><i class="fa fa-check"></i><b>21.4.1</b> Creating an <code>sfnetworks</code> Graph</a></li>
<li class="chapter" data-level="21.4.2" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#filtering-an-sfnetworks-graph"><i class="fa fa-check"></i><b>21.4.2</b> Filtering an <code>sfnetworks</code> Graph</a></li>
<li class="chapter" data-level="21.4.3" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#viewing-a-buffered-area-around-a-junction-node"><i class="fa fa-check"></i><b>21.4.3</b> Viewing a Buffered Area Around a Junction Node</a></li>
<li class="chapter" data-level="21.4.4" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#snapping-a-route-to-a-road-network"><i class="fa fa-check"></i><b>21.4.4</b> Snapping a Route to a Road Network</a></li>
<li class="chapter" data-level="21.4.5" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#snapping-a-full-stage-route-to-the-road-network"><i class="fa fa-check"></i><b>21.4.5</b> Snapping a Full Stage Route to the Road Network</a></li>
</ul></li>
<li class="chapter" data-level="21.5" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#using-dodgr-to-represent-routes-and-road-networks"><i class="fa fa-check"></i><b>21.5</b> Using <code>dodgr</code> to Represent Routes and Road Networks</a></li>
<li class="chapter" data-level="21.6" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#route-stage-time-simulation"><i class="fa fa-check"></i><b>21.6</b> Route Stage Time Simulation</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="where-next.html"><a href="where-next.html"><i class="fa fa-check"></i><b>22</b> Where Next?</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Visualising WRC Rally Stages With <code>rayshader</code> and R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="importing-the-stage-route-data" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Importing the Stage Route Data</h1>
<p>The starting point for this adventure is an XML text file downloaded from the WRC website. The file contains data that describes the stage routes for the 2021 <em>Rallye Monte Carlo</em> using the KML file format. This format (“Keyhole Markup Language”) was originally developed as a way loading data into the application that became Google Earth following its acquisition by Google. KML is now an <a href="https://www.ogc.org/standards/kml">international standard</a> maintained by the Open Geospatial Consortium, Inc. (OGC).</p>
<p><em>If you see the <code>.kmz</code> file suffix attached a file, the file is a compressed (zipped) KML file.</em></p>
<p>The first part of this chapter is the boring part, describing how to load the data in and some differences that arise depending on <em>how</em> you load it in. (If you do a web search, you’ll find there are various tools for opening KML files into an R program.) The second part shows how we can actually start to preview the data in a graphical way.</p>
<div id="downloading-the-stage-data-file" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Downloading the Stage Data File</h2>
<p>Let’s start by downloading the data from its web location:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="importing-the-stage-route-data.html#cb1-1" aria-hidden="true" tabindex="-1"></a>file.url <span class="ot">=</span> <span class="st">&#39;https://webapps.wrc.com/2020/web/obc/kml/montecarlo_2021.xml&#39;</span></span>
<span id="cb1-2"><a href="importing-the-stage-route-data.html#cb1-2" aria-hidden="true" tabindex="-1"></a>downladed.filename <span class="ot">=</span> <span class="st">&#39;montecarlo_2021.xml&#39;</span></span>
<span id="cb1-3"><a href="importing-the-stage-route-data.html#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="importing-the-stage-route-data.html#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Download the file from a specified web location to a specifically named file</span></span>
<span id="cb1-5"><a href="importing-the-stage-route-data.html#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(file.url, downladed.filename)</span></code></pre></div>
</div>
<div id="opening-kml-geodata-files" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Opening KML Geodata Files</h2>
<p>A wide variety of geodata file formats can be opened using general purpose geodata packages as well as certain specialist packages.</p>
<p>Two powerful general purpose packages are <code>rgdal</code> and <code>sf</code>, the <em>simple features</em> package.</p>
<div id="using-rgdal-and-sp-to-open-geodata-files" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Using <code>rgdal</code> and <code>sp</code> to Open Geodata Files</h3>
<p>One way of reading in the file we have just downloaded is to use the <code>readOGR()</code> function found in the <code>rgdal</code> package. We can call this function explicitly from the package as <code>rgdal::readOGR()</code> or we can import the package and then access the function simply by calling it by name:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="importing-the-stage-route-data.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import the rgdal package</span></span>
<span id="cb2-2"><a href="importing-the-stage-route-data.html#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb2-3"><a href="importing-the-stage-route-data.html#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="importing-the-stage-route-data.html#cb2-4" aria-hidden="true" tabindex="-1"></a>kml.file <span class="ot">&lt;-</span> <span class="st">&quot;montecarlo_2021.xml&quot;</span></span>
<span id="cb2-5"><a href="importing-the-stage-route-data.html#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="importing-the-stage-route-data.html#cb2-6" aria-hidden="true" tabindex="-1"></a>kml_sp <span class="ot">=</span> <span class="fu">readOGR</span>(kml.file)</span></code></pre></div>
<pre><code>## OGR data source with driver: KML 
## Source: &quot;/Users/tonyhirst/Documents/GitHub/visualising-rally-stages/montecarlo_2021.xml&quot;, layer: &quot;Meine Orte&quot;
## with 9 features
## It has 2 fields</code></pre>
<pre><code>## Warning in readOGR(kml.file): Z-dimension discarded</code></pre>
<p>The <code>readOGR()</code> function is capable of loading in a wide variety of geo-related file formats and automatically detecting what sort of format the file represents.</p>
<p>We can see what sort of object is loaded in by inspecting its <code>class()</code>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="importing-the-stage-route-data.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(kml_sp)</span></code></pre></div>
<pre><code>## [1] &quot;SpatialLinesDataFrame&quot;
## attr(,&quot;package&quot;)
## [1] &quot;sp&quot;</code></pre>
<p>In this case, the KML file is loaded in and parsed into a <code>SpatialLinesDataFrame</code> object although as you may have noticed from a warning message when the file was loaded that the Z (altitude) dimension been discarded (as we shall see later, it is actually contains zero values anyway).</p>
<p>The <code>SpatialLinesDataFrame</code> datatype, along with other spatial datatypes, is defined in the R <code>sp</code> package. To a certain extent, the classes (that is, data types) declared by this package have been superseded by a different datatype hierarchy defined by the more recent <code>sf</code> package. However, the <code>sp</code> package is still a dependency of many of R’s spatial data packages and some functions rely on being presented with <code>SpatialLinesDataFrame</code> object data, for example.</p>
</div>
<div id="using-sf-to-open-geodata-files" class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Using <code>sf</code> to Open Geodata Files</h3>
<p>The <code>sf</code> package is a more recently created package for working with geodata primitives and is maintained under the auspices of the <a href="https://github.com/r-spatial"><code>r-spatial</code> Github organisation</a>.</p>
<p>We can load in data from a wide range of geodata file formats using the <code>sf::st_read()</code> function:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="importing-the-stage-route-data.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb7-2"><a href="importing-the-stage-route-data.html#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="importing-the-stage-route-data.html#cb7-3" aria-hidden="true" tabindex="-1"></a>kml_sf <span class="ot">=</span> <span class="fu">st_read</span>(kml.file)</span></code></pre></div>
<pre><code>## Reading layer `Meine Orte&#39; from data source `/Users/tonyhirst/Documents/GitHub/visualising-rally-stages/montecarlo_2021.xml&#39; using driver `KML&#39;
## Simple feature collection with 9 features and 2 fields
## geometry type:  LINESTRING
## dimension:      XYZ
## bbox:           xmin: 5.243488 ymin: 43.87633 xmax: 6.951953 ymax: 44.81973
## z_range:        zmin: 0 zmax: 0
## geographic CRS: WGS 84</code></pre>
<p>In this case, we notice that the data has been loaded into a spatial features <em>simple feature</em> collection.</p>
<p>The data loaded into each object is the same, but it is represented differently. There are ways of converting between various forms of the two representations as we shall see later.</p>
<p>One thing to note in each case that the data appears to have been loaded in from a particular <em>layer</em>. The KML file format is capable of grouping various sets of data together in different ways. Where the datafile contains only one element that is decoded as a “layer”, that is loaded in by default. If multiple layers are detected they will be reported and can then be loaded in and “unpacked” by name.</p>
<p>We can also review the contents of the file by opening it with the <code>sf::st_layers()</code> function:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="importing-the-stage-route-data.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the file layers</span></span>
<span id="cb9-2"><a href="importing-the-stage-route-data.html#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_layers</span>(kml.file)</span></code></pre></div>
<pre><code>## Driver: KML 
## Available layers:
##   layer_name  geometry_type features fields
## 1 Meine Orte 3D Line String        9      2</code></pre>
<p>If there is more than one layer, we can load it in by name:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="importing-the-stage-route-data.html#cb11-1" aria-hidden="true" tabindex="-1"></a>kml_sf <span class="ot">=</span> <span class="fu">st_read</span>(kml.file, <span class="st">&quot;Meine Orte&quot;</span>)</span></code></pre></div>
<pre><code>## Reading layer `Meine Orte&#39; from data source `/Users/tonyhirst/Documents/GitHub/visualising-rally-stages/montecarlo_2021.xml&#39; using driver `KML&#39;
## Simple feature collection with 9 features and 2 fields
## geometry type:  LINESTRING
## dimension:      XYZ
## bbox:           xmin: 5.243488 ymin: 43.87633 xmax: 6.951953 ymax: 44.81973
## z_range:        zmin: 0 zmax: 0
## geographic CRS: WGS 84</code></pre>
<div id="reviewing-the-sf-feature-collection" class="section level4" number="3.2.2.1">
<h4><span class="header-section-number">3.2.2.1</span> Reviewing the <code>sf</code> Feature Collection</h4>
<p>The layer contains a feature collection with features containing linestrings in 3-dimensions (XYZ). There are several keys things to note:</p>
<ul>
<li>the <em>projection</em> is WGS 84, the common “lat long” projection</li>
<li>the Z-range (altitude, or elevation) appears to be zeroed.</li>
</ul>
<p>If we refer back to the data object loaded in using the <code>rdgal::readOGR</code> function, we note that it does not contain the Z co-ordinate. We can see this more clearly if we convert that <code>sp</code> <em>SpatialDataFrame</em> object to a simple features object using the <code>sf::st_as_sf()</code> function:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="importing-the-stage-route-data.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_as_sf</span>(kml_sp)</span></code></pre></div>
<pre><code>## Simple feature collection with 9 features and 2 fields
## geometry type:  LINESTRING
## dimension:      XY
## bbox:           xmin: 5.243488 ymin: 43.87633 xmax: 6.951953 ymax: 44.81973
## geographic CRS: WGS 84
##       Name Description                       geometry
## 0     SS 1             LINESTRING (5.894486 44.735...
## 1     SS 2             LINESTRING (6.09604 44.8040...
## 2   SS 3/6             LINESTRING (5.722938 44.487...
## 3   SS 4/7             LINESTRING (5.355052 44.500...
## 4     SS 5             LINESTRING (5.518181 44.283...
## 5  SS 9/11             LINESTRING (6.30413 44.4428...
## 6    SS 10             LINESTRING (6.57791 44.6499...
## 7 SS 12/14             LINESTRING (6.900294 43.950...
## 8 SS 13/15             LINESTRING (6.77335 43.8763...</code></pre>
<p>A conversion also exists back from the <code>sf</code> object to the <code>sp</code> representation:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="importing-the-stage-route-data.html#cb15-1" aria-hidden="true" tabindex="-1"></a>round_trip <span class="ot">=</span> <span class="fu">as</span>( <span class="fu">st_as_sf</span>(kml_sp), <span class="st">&quot;Spatial&quot;</span>)</span></code></pre></div>
<p>However, if we try the same conversion on the simple features collection created directly from the parsed KML file, we get an error:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="importing-the-stage-route-data.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#round_trip2 = as( kml_sf, &quot;Spatial&quot;)</span></span></code></pre></div>
<p>The problem appears to be the Z layer. If we drop the zeroed Z layer manually, whilst preserving the projection:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="importing-the-stage-route-data.html#cb17-1" aria-hidden="true" tabindex="-1"></a>kml_sf <span class="ot">=</span> <span class="fu">st_zm</span>(kml_sf, <span class="at">drop =</span> <span class="cn">TRUE</span>, <span class="at">what =</span> <span class="st">&quot;ZM&quot;</span>)</span></code></pre></div>
<p>we can then convert this simple feature collection to a <em>SpatialDataFrame</em> <code>Spatial</code> object:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="importing-the-stage-route-data.html#cb18-1" aria-hidden="true" tabindex="-1"></a>round_trip2 <span class="ot">=</span> <span class="fu">as</span>( kml_sf, <span class="st">&quot;Spatial&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="accessing-route-data-as-a-geojson-string" class="section level3" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> Accessing Route Data as a geojson String</h3>
<p>GeoJSON is a widely used format for getting geodata into web pages. We can get the route for a stage from the routes spatial collection and cast it to JSON using the <code>geojsonio::geojson_json</code> function:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="importing-the-stage-route-data.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Retrieve the geojson for a single stage and</span></span>
<span id="cb19-2"><a href="importing-the-stage-route-data.html#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co"># from within that, the linestring geometry,</span></span>
<span id="cb19-3"><a href="importing-the-stage-route-data.html#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># casting it to a geojson string</span></span>
<span id="cb19-4"><a href="importing-the-stage-route-data.html#cb19-4" aria-hidden="true" tabindex="-1"></a>stage_route_gj <span class="ot">=</span> geojsonio<span class="sc">::</span><span class="fu">geojson_json</span>(kml_sf[<span class="dv">1</span>,]<span class="sc">$</span>geometry)</span></code></pre></div>
</div>
<div id="saving-simple-features-data-to-various-geodata-file-formats" class="section level3" number="3.2.4">
<h3><span class="header-section-number">3.2.4</span> Saving Simple Features Data to Various Geodata File Formats</h3>
<p>The <code>st_write</code> function has a range of output drivers for writing geodata to different output types. although data may be last and/or the conversion of a dataset loaded from one format and output to another may not be as meaningful as may be desired.</p>
<p>For example, we can write an object out to a geojson file:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="importing-the-stage-route-data.html#cb20-1" aria-hidden="true" tabindex="-1"></a>geojson_filename <span class="ot">=</span> <span class="st">&#39;montecarlo_2021.geojson&#39;</span></span>
<span id="cb20-2"><a href="importing-the-stage-route-data.html#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="importing-the-stage-route-data.html#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The st_write function can update files or create new ones, but not</span></span>
<span id="cb20-4"><a href="importing-the-stage-route-data.html#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># replace existing ones. So let&#39;s make sure the file doesn&#39;t exist</span></span>
<span id="cb20-5"><a href="importing-the-stage-route-data.html#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># by deleting it if it does...</span></span>
<span id="cb20-6"><a href="importing-the-stage-route-data.html#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file.exists</span>(geojson_filename)) {</span>
<span id="cb20-7"><a href="importing-the-stage-route-data.html#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Delete file if it exists</span></span>
<span id="cb20-8"><a href="importing-the-stage-route-data.html#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.remove</span>(geojson_filename)</span>
<span id="cb20-9"><a href="importing-the-stage-route-data.html#cb20-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="importing-the-stage-route-data.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(kml_sf, geojson_filename, <span class="at">driver=</span><span class="st">&#39;geojson&#39;</span>)</span></code></pre></div>
<pre><code>## Writing layer `montecarlo_2021&#39; to data source `montecarlo_2021.geojson&#39; using driver `geojson&#39;
## Writing 9 features with 2 fields and geometry type Line String.</code></pre>
<p>Equally, we can we write out the data loaded as a GPX data file (GPX data files are often used to share data collected from cycling or running route logging applications and devices):</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="importing-the-stage-route-data.html#cb24-1" aria-hidden="true" tabindex="-1"></a>gpx_filename <span class="ot">=</span> <span class="st">&#39;route.gpx&#39;</span></span>
<span id="cb24-2"><a href="importing-the-stage-route-data.html#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="importing-the-stage-route-data.html#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove any previous instances of this file</span></span>
<span id="cb24-4"><a href="importing-the-stage-route-data.html#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file.exists</span>(gpx_filename)) {</span>
<span id="cb24-5"><a href="importing-the-stage-route-data.html#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Delete file if it exists</span></span>
<span id="cb24-6"><a href="importing-the-stage-route-data.html#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.remove</span>(gpx_filename)</span>
<span id="cb24-7"><a href="importing-the-stage-route-data.html#cb24-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="importing-the-stage-route-data.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(kml_sf, gpx_filename, </span>
<span id="cb26-2"><a href="importing-the-stage-route-data.html#cb26-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">driver=</span><span class="st">&#39;GPX&#39;</span>, <span class="at">dataset_options =</span><span class="st">&quot;GPX_USE_EXTENSIONS=yes&quot;</span> )</span></code></pre></div>
<pre><code>## options:        GPX_USE_EXTENSIONS=yes 
## Writing layer `route&#39; to data source `route.gpx&#39; using driver `GPX&#39;
## Writing 9 features with 2 fields and geometry type Line String.</code></pre>
<p>If we have access to car telemetry data in a simple tabular form, it may be convenient to save it using the GPX format as a convenient way of serialising that data.</p>
</div>
</div>
<div id="important-geodata-file-formats" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Important Geodata File Formats</h2>
<p>The <code>sf::st_read()</code> (as well as the <code>rdgal::readOGR()</code> function) is capable of reading in data from a wide variety of file formats.</p>
<p>We have already seen how it can load in data from a KML file, so let’s see how it copes with some other file formats.</p>
<div id="loading-geojson-data" class="section level3" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Loading geojson Data</h3>
<p>As well as KML files, route data is may be available in the GeoJSON text format. We can read <em>geojson</em> data file into R using the <code>sf::st_read()</code> function , returning the data as a spatial object:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="importing-the-stage-route-data.html#cb28-1" aria-hidden="true" tabindex="-1"></a>geojson_sf <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_read</span>(geojson_filename)</span></code></pre></div>
<pre><code>## Reading layer `montecarlo_2021&#39; from data source `/Users/tonyhirst/Documents/GitHub/visualising-rally-stages/montecarlo_2021.geojson&#39; using driver `GeoJSON&#39;
## Simple feature collection with 9 features and 2 fields
## geometry type:  LINESTRING
## dimension:      XY
## bbox:           xmin: 5.243488 ymin: 43.87633 xmax: 6.951953 ymax: 44.81973
## geographic CRS: WGS 84</code></pre>
<p>As before, we can convert the simple features object to a <code>Spatial</code> dataframe by dropping the z-axis and then converting:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="importing-the-stage-route-data.html#cb30-1" aria-hidden="true" tabindex="-1"></a>geojson_sf <span class="ot">=</span> <span class="fu">as</span>(<span class="fu">st_zm</span>(geojson_sf, <span class="at">drop =</span> <span class="cn">TRUE</span>, <span class="at">what =</span> <span class="st">&quot;ZM&quot;</span>), <span class="st">&quot;Spatial&quot;</span>)</span></code></pre></div>
<p>If you have a geojson string, you can cast it to a spatial object using the <code>geojsonio::geojson_sp(geojson_str)</code> function:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="importing-the-stage-route-data.html#cb31-1" aria-hidden="true" tabindex="-1"></a>geojson_str <span class="ot">=</span> <span class="st">&#39;{&quot;type&quot;: &quot;Point&quot;,&quot;coordinates&quot;: [-105.01621,39.57422]}&#39;</span></span>
<span id="cb31-2"><a href="importing-the-stage-route-data.html#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="importing-the-stage-route-data.html#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>( geojsonio<span class="sc">::</span><span class="fu">geojson_sp</span>(geojson_str) )</span></code></pre></div>
<pre><code>## [1] &quot;SpatialPointsDataFrame&quot;
## attr(,&quot;package&quot;)
## [1] &quot;sp&quot;</code></pre>
</div>
<div id="loading-gpx-data" class="section level3" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Loading GPX Data</h3>
<p>Route data collected by personal GPS devices is often shared using GPX files.</p>
<p>We can read in GPX files using <code>sf::st_read</code>:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="importing-the-stage-route-data.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_read</span>(gpx_filename)</span></code></pre></div>
<pre><code>## Multiple layers are present in data source /Users/tonyhirst/Documents/GitHub/visualising-rally-stages/route.gpx, reading layer `waypoints&#39;.
## Use `st_layers&#39; to list all layer names and their type in a data source.
## Set the `layer&#39; argument in `st_read&#39; to read a particular layer.</code></pre>
<pre><code>## Warning in evalq((function (..., call. = TRUE, immediate. = FALSE, noBreaks. =
## FALSE, : automatically selected the first layer in a data source containing more
## than one.</code></pre>
<pre><code>## Reading layer `waypoints&#39; from data source `/Users/tonyhirst/Documents/GitHub/visualising-rally-stages/route.gpx&#39; using driver `GPX&#39;
## Simple feature collection with 0 features and 23 fields
## bbox:           xmin: NA ymin: NA xmax: NA ymax: NA
## geographic CRS: WGS 84</code></pre>
<p>The <code>plotKML</code> package, which has a wide range of tools for creating KML files and rendering KML into Google Earth, also has a custom function for loading in GPX files:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="importing-the-stage-route-data.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">#http://plotkml.r-forge.r-project.org/readGPX.html</span></span>
<span id="cb37-2"><a href="importing-the-stage-route-data.html#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotKML)</span>
<span id="cb37-3"><a href="importing-the-stage-route-data.html#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="importing-the-stage-route-data.html#cb37-4" aria-hidden="true" tabindex="-1"></a>gpx <span class="ot">=</span> <span class="fu">readGPX</span>(gpx_filename)</span></code></pre></div>
<p>In this particular case, the GPX file contains multiple routes which we index by name.</p>
<p>A dataframe of point values, one point per row, is associated with each route:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="importing-the-stage-route-data.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gpx<span class="sc">$</span>routes<span class="sc">$</span><span class="st">`</span><span class="at">SS 1</span><span class="st">`</span>, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##        lon      lat name  cmt desc  sym type
## 1 5.894486 44.73562 &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;
## 2 5.894618 44.73580 &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;
## 3 5.894778 44.73602 &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;</code></pre>
<p>In a “born GPX” file, we might expect to see more of the columns populated. As it currently stands, the GPX file we created from the original data, which was more or less limited to simple 2D linestrings, contains just the latitude and longitude data, albeit still in distinct stage identifiable routes.</p>
</div>
<div id="loading-flight-data-using-igc-format-gps-files" class="section level3" number="3.3.3">
<h3><span class="header-section-number">3.3.3</span> Loading Flight Data Using IGC format GPS Files</h3>
<p>GPS route data contained in <a href="https://xp-soaring.github.io/igc_file_format/igc_format_2008.html">IGC</a> formatted flight data files can be loaded in using the <code>geoviz::read_igc("path/to/your/file.igc")</code> function.</p>
</div>
<div id="reading-data-from-gps-devices" class="section level3" number="3.3.4">
<h3><span class="header-section-number">3.3.4</span> Reading Data from GPS Devices</h3>
<p>The <a href="https://rdrr.io/cran/pgirmess/"><code>pgirmess</code> <em>Spatial Analysis and Data Mining for Field Ecologists) package</em></a> package provides a range of tools for retrieving data from GPS devices and then analysing them. The <code>pgirmess::gps2gpx()</code> function provides support from retrieving GPS data from a range of devices via the <em>GPSBabel</em> application](<a href="http://www.gpsbabel.org/" class="uri">http://www.gpsbabel.org/</a>), writing waypoint or track data to GPX files to local storage with the <code>pgirmess::writeGPX()</code> function, and uploading GPX data back up to Garmin GPS devices (<code>pgirmess::uploadGPS()</code>).</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="getting-started.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="working-with-route-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toc_depth": 3,
"toolbar": {
"position": "fixed"
},
"search": true,
"info": true
});
});
</script>

</body>

</html>
