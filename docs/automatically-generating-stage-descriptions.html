<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>20 Automatically Generating Stage Descriptions | Visualising WRC Rally Stages With rayshader and R</title>
  <meta name="description" content="Rally stage maps often appear on rally websites displayed via interactive web maps. The data used to generate the routes is often available as a digital data file of some sort. This book takes one such file and embarks on an adventure into the wilds of geocomputing using the R programming language to see just where such a file may take us. From web maps and elevation maps to interactive 3D displays, let the exploration commence…" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="20 Automatically Generating Stage Descriptions | Visualising WRC Rally Stages With rayshader and R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Rally stage maps often appear on rally websites displayed via interactive web maps. The data used to generate the routes is often available as a digital data file of some sort. This book takes one such file and embarks on an adventure into the wilds of geocomputing using the R programming language to see just where such a file may take us. From web maps and elevation maps to interactive 3D displays, let the exploration commence…" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="20 Automatically Generating Stage Descriptions | Visualising WRC Rally Stages With rayshader and R" />
  
  <meta name="twitter:description" content="Rally stage maps often appear on rally websites displayed via interactive web maps. The data used to generate the routes is often available as a digital data file of some sort. This book takes one such file and embarks on an adventure into the wilds of geocomputing using the R programming language to see just where such a file may take us. From web maps and elevation maps to interactive 3D displays, let the exploration commence…" />
  

<meta name="author" content="Tony Hirst" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="adding-openstreetmap-data.html"/>
<link rel="next" href="creating-a-road-book.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/vembedr-0.1.4/css/vembedr.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"><strong>Visualising WRC Rally Stages</strong></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Index</a></li>
<li class="chapter" data-level="" data-path="in-the-beginning.html"><a href="in-the-beginning.html"><i class="fa fa-check"></i>In the beginning…</a></li>
<li class="chapter" data-level="" data-path="acknowledgements.html"><a href="acknowledgements.html"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#who-this-book-is-for"><i class="fa fa-check"></i><b>1.1</b> Who This Book Is For</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#what-this-book-isnt"><i class="fa fa-check"></i><b>1.2</b> What This Book Isn’t</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#structure-of-the-book"><i class="fa fa-check"></i><b>1.3</b> Structure of the Book</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#further-reading"><i class="fa fa-check"></i><b>1.4</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="getting-started.html"><a href="getting-started.html"><i class="fa fa-check"></i><b>2</b> Getting Started</a>
<ul>
<li class="chapter" data-level="2.1" data-path="getting-started.html"><a href="getting-started.html#setting-up-a-working-code-execution-environment"><i class="fa fa-check"></i><b>2.1</b> Setting Up a Working Code Execution Environment</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="getting-started.html"><a href="getting-started.html#installing-the-docker-environment"><i class="fa fa-check"></i><b>2.1.1</b> Installing the Docker Environment</a></li>
<li class="chapter" data-level="2.1.2" data-path="getting-started.html"><a href="getting-started.html#installing-the-required-r-packages-manually"><i class="fa fa-check"></i><b>2.1.2</b> Installing the Required R Packages Manually</a></li>
<li class="chapter" data-level="2.1.3" data-path="getting-started.html"><a href="getting-started.html#other-installation-dependencies"><i class="fa fa-check"></i><b>2.1.3</b> Other Installation Dependencies</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="getting-started.html"><a href="getting-started.html#using-the-rstudio-environment"><i class="fa fa-check"></i><b>2.2</b> Using the RStudio Environment</a></li>
<li class="chapter" data-level="2.3" data-path="getting-started.html"><a href="getting-started.html#using-a-jupyter-notebook-environment"><i class="fa fa-check"></i><b>2.3</b> Using a Jupyter Notebook Environment</a></li>
<li class="chapter" data-level="2.4" data-path="getting-started.html"><a href="getting-started.html#exploring-the-book-as-an-online-interactive-textbook-not-yet"><i class="fa fa-check"></i><b>2.4</b> Exploring the Book as an Online Interactive Textbook (Not Yet!)</a></li>
<li class="chapter" data-level="2.5" data-path="getting-started.html"><a href="getting-started.html#serving-your-own-map-tiles-and-elevation-raster-images"><i class="fa fa-check"></i><b>2.5</b> Serving Your Own Map Tiles and Elevation Raster Images</a></li>
<li class="chapter" data-level="2.6" data-path="getting-started.html"><a href="getting-started.html#donate"><i class="fa fa-check"></i><b>2.6</b> Donate</a></li>
</ul></li>
<li class="part"><span><b>I Accessing Stage Data</b></span></li>
<li class="chapter" data-level="3" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html"><i class="fa fa-check"></i><b>3</b> Importing the Stage Route Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#downloading-the-stage-data-file"><i class="fa fa-check"></i><b>3.1</b> Downloading the Stage Data File</a></li>
<li class="chapter" data-level="3.2" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#opening-kml-geodata-files"><i class="fa fa-check"></i><b>3.2</b> Opening KML Geodata Files</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#using-rgdal-and-sp-to-open-geodata-files"><i class="fa fa-check"></i><b>3.2.1</b> Using <code>rgdal</code> and <code>sp</code> to Open Geodata Files</a></li>
<li class="chapter" data-level="3.2.2" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#using-sf-to-open-geodata-files"><i class="fa fa-check"></i><b>3.2.2</b> Using <code>sf</code> to Open Geodata Files</a></li>
<li class="chapter" data-level="3.2.3" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#accessing-route-data-as-a-geojson-string"><i class="fa fa-check"></i><b>3.2.3</b> Accessing Route Data as a geojson String</a></li>
<li class="chapter" data-level="3.2.4" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#saving-simple-features-data-to-various-geodata-file-formats"><i class="fa fa-check"></i><b>3.2.4</b> Saving Simple Features Data to Various Geodata File Formats</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#important-geodata-file-formats"><i class="fa fa-check"></i><b>3.3</b> Important Geodata File Formats</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#loading-geojson-data"><i class="fa fa-check"></i><b>3.3.1</b> Loading geojson Data</a></li>
<li class="chapter" data-level="3.3.2" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#loading-gpx-data"><i class="fa fa-check"></i><b>3.3.2</b> Loading GPX Data</a></li>
<li class="chapter" data-level="3.3.3" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#loading-flight-data-using-igc-format-gps-files"><i class="fa fa-check"></i><b>3.3.3</b> Loading Flight Data Using IGC format GPS Files</a></li>
<li class="chapter" data-level="3.3.4" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#reading-data-from-gps-devices"><i class="fa fa-check"></i><b>3.3.4</b> Reading Data from GPS Devices</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="working-with-route-data.html"><a href="working-with-route-data.html"><i class="fa fa-check"></i><b>4</b> Working with Route Data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="working-with-route-data.html"><a href="working-with-route-data.html#loading-in-the-route-data"><i class="fa fa-check"></i><b>4.1</b> Loading in the Route Data</a></li>
<li class="chapter" data-level="4.2" data-path="working-with-route-data.html"><a href="working-with-route-data.html#access-a-specific-stage"><i class="fa fa-check"></i><b>4.2</b> Access a specific stage</a></li>
<li class="chapter" data-level="4.3" data-path="working-with-route-data.html"><a href="working-with-route-data.html#visual-preview-of-route-geodata"><i class="fa fa-check"></i><b>4.3</b> Visual Preview of Route Geodata</a></li>
<li class="chapter" data-level="4.4" data-path="working-with-route-data.html"><a href="working-with-route-data.html#previews-using-ggplot2"><i class="fa fa-check"></i><b>4.4</b> Previews using <code>ggplot2</code></a></li>
<li class="chapter" data-level="4.5" data-path="working-with-route-data.html"><a href="working-with-route-data.html#identifying-the-start-and-end-of-the-stage"><i class="fa fa-check"></i><b>4.5</b> Identifying the Start and End of the Stage</a></li>
<li class="chapter" data-level="4.6" data-path="working-with-route-data.html"><a href="working-with-route-data.html#extracting-route-fragments"><i class="fa fa-check"></i><b>4.6</b> Extracting Route Fragments</a></li>
<li class="chapter" data-level="4.7" data-path="working-with-route-data.html"><a href="working-with-route-data.html#previews-using-leaflet-interactive-maps"><i class="fa fa-check"></i><b>4.7</b> Previews Using <code>leaflet</code> Interactive Maps</a></li>
<li class="chapter" data-level="4.8" data-path="working-with-route-data.html"><a href="working-with-route-data.html#creating-buffer-regions-around-features"><i class="fa fa-check"></i><b>4.8</b> Creating Buffer regions around features</a></li>
<li class="chapter" data-level="4.9" data-path="working-with-route-data.html"><a href="working-with-route-data.html#adding-additional-features-to-leaflet-maps"><i class="fa fa-check"></i><b>4.9</b> Adding Additional Features to <code>leaflet</code> maps</a>
<ul>
<li class="chapter" data-level="4.9.1" data-path="working-with-route-data.html"><a href="working-with-route-data.html#add-minimap-navigation"><i class="fa fa-check"></i><b>4.9.1</b> Add “minimap” navigation</a></li>
<li class="chapter" data-level="4.9.2" data-path="working-with-route-data.html"><a href="working-with-route-data.html#add-custom-symbol-legends"><i class="fa fa-check"></i><b>4.9.2</b> Add Custom Symbol Legends</a></li>
<li class="chapter" data-level="4.9.3" data-path="working-with-route-data.html"><a href="working-with-route-data.html#adding-mini-charts-to-maps"><i class="fa fa-check"></i><b>4.9.3</b> Adding Mini-Charts to Maps</a></li>
<li class="chapter" data-level="4.9.4" data-path="working-with-route-data.html"><a href="working-with-route-data.html#adding-html-content-to-popups"><i class="fa fa-check"></i><b>4.9.4</b> Adding HTML content to popups</a></li>
</ul></li>
<li class="chapter" data-level="4.10" data-path="working-with-route-data.html"><a href="working-with-route-data.html#using-mapview-to-create-leaflet-maps"><i class="fa fa-check"></i><b>4.10</b> Using <code>mapview</code> To Create <em>leaflet</em> Maps</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html"><i class="fa fa-check"></i><b>5</b> Introducing Map Projections</a>
<ul>
<li class="chapter" data-level="5.1" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#load-in-the-route-data"><i class="fa fa-check"></i><b>5.1</b> Load in the Route Data</a></li>
<li class="chapter" data-level="5.2" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#previewing-a-map-route"><i class="fa fa-check"></i><b>5.2</b> Previewing a Map Route</a></li>
<li class="chapter" data-level="5.3" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#plotting-latlong-naively"><i class="fa fa-check"></i><b>5.3</b> Plotting LatLong Naively</a></li>
<li class="chapter" data-level="5.4" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#using-the-utm-co-ordinate-reference-system"><i class="fa fa-check"></i><b>5.4</b> Using the UTM Co-ordinate Reference System</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#using-st_transform-for-projection-transformations"><i class="fa fa-check"></i><b>5.4.1</b> Using <code>st_transform</code> for Projection Transformations</a></li>
<li class="chapter" data-level="5.4.2" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#using-ggplot2coord_sf-to-render-projections"><i class="fa fa-check"></i><b>5.4.2</b> Using <code>ggplot2::coord_sf</code> to Render Projections</a></li>
<li class="chapter" data-level="5.4.3" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#exporting-the-route-data-as-a-dataframe"><i class="fa fa-check"></i><b>5.4.3</b> Exporting the Route Data As a Dataframe</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#alternative-crs-projections"><i class="fa fa-check"></i><b>5.5</b> Alternative CRS Projections</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="stage-route-annotations.html"><a href="stage-route-annotations.html"><i class="fa fa-check"></i><b>6</b> Stage Route Annotations</a>
<ul>
<li class="chapter" data-level="6.1" data-path="stage-route-annotations.html"><a href="stage-route-annotations.html#load-in-the-route-data-1"><i class="fa fa-check"></i><b>6.1</b> Load in the Route Data</a></li>
<li class="chapter" data-level="6.2" data-path="stage-route-annotations.html"><a href="stage-route-annotations.html#adding-split-point-locations"><i class="fa fa-check"></i><b>6.2</b> Adding Split Point Locations</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="stage-route-annotations.html"><a href="stage-route-annotations.html#using-geojson-to-find-the-distance-along-a-route"><i class="fa fa-check"></i><b>6.2.1</b> Using geojson to Find the Distance Along a Route</a></li>
<li class="chapter" data-level="6.2.2" data-path="stage-route-annotations.html"><a href="stage-route-annotations.html#using-rgeosginterpolate-to-find-the-distance-along-a-route"><i class="fa fa-check"></i><b>6.2.2</b> Using <code>rgeos::gInterpolate</code> to Find the Distance Along a Route</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="stage-route-annotations.html"><a href="stage-route-annotations.html#parallel-routes"><i class="fa fa-check"></i><b>6.3</b> Parallel Routes</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html"><i class="fa fa-check"></i><b>7</b> Accessing and Working With Elevation Data Raster Files</a>
<ul>
<li class="chapter" data-level="7.1" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#introducing-digital-elevation-model-dem-raster-images"><i class="fa fa-check"></i><b>7.1</b> Introducing Digital Elevation Model (DEM) Raster Images</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#what-is-raster-data"><i class="fa fa-check"></i><b>7.1.1</b> What Is Raster Data?</a></li>
<li class="chapter" data-level="7.1.2" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#what-are-digital-elevation-models-dems"><i class="fa fa-check"></i><b>7.1.2</b> What Are Digital Elevation Models (DEMs)?</a></li>
<li class="chapter" data-level="7.1.3" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#the-r-raster-package"><i class="fa fa-check"></i><b>7.1.3</b> The R <code>raster</code> Package</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#downloading-elevation-data"><i class="fa fa-check"></i><b>7.2</b> Downloading Elevation Data</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#loading-in-some-stage-data"><i class="fa fa-check"></i><b>7.2.1</b> Loading in some stage data</a></li>
<li class="chapter" data-level="7.2.2" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#obtaining-relief-elevation-raster-data-using-elevatr"><i class="fa fa-check"></i><b>7.2.2</b> Obtaining relief / elevation raster data using <code>elevatr</code></a></li>
<li class="chapter" data-level="7.2.3" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#plotting-rasters-as-ggplot-objects"><i class="fa fa-check"></i><b>7.2.3</b> Plotting Rasters As <code>ggplot</code> Objects</a></li>
<li class="chapter" data-level="7.2.4" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#interactive-raster-previews-with-plainview"><i class="fa fa-check"></i><b>7.2.4</b> Interactive Raster Previews with <code>plainview</code></a></li>
<li class="chapter" data-level="7.2.5" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#saving-the-image-raster-data-to-a-local-file"><i class="fa fa-check"></i><b>7.2.5</b> Saving the Image Raster Data to a Local File</a></li>
<li class="chapter" data-level="7.2.6" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#from-raster-to-terra"><i class="fa fa-check"></i><b>7.2.6</b> From <code>raster</code> to <code>terra</code></a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#overlaying-raster-images-on-leaflet-maps"><i class="fa fa-check"></i><b>7.3</b> Overlaying Raster Images on Leaflet Maps</a></li>
<li class="chapter" data-level="7.4" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#retrieving-descriptive-information-about-the-raster"><i class="fa fa-check"></i><b>7.4</b> Retrieving Descriptive Information About the Raster</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#using-mapzen-to-retrieve-dem-raster-data"><i class="fa fa-check"></i><b>7.4.1</b> Using Mapzen to Retrieve DEM raster data</a></li>
<li class="chapter" data-level="7.4.2" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#additional-elevation-data-downloading-tools"><i class="fa fa-check"></i><b>7.4.2</b> Additional Elevation Data Downloading Tools</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#manipulating-raster-images"><i class="fa fa-check"></i><b>7.5</b> Manipulating Raster Images</a></li>
<li class="chapter" data-level="7.6" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#ridge-maps"><i class="fa fa-check"></i><b>7.6</b> Ridge maps</a></li>
<li class="chapter" data-level="7.7" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#further-information"><i class="fa fa-check"></i><b>7.7</b> Further Information</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="determining-terrain-features-from-raster-data.html"><a href="determining-terrain-features-from-raster-data.html"><i class="fa fa-check"></i><b>8</b> Determining Terrain Features from Raster Data</a>
<ul>
<li class="chapter" data-level="8.1" data-path="determining-terrain-features-from-raster-data.html"><a href="determining-terrain-features-from-raster-data.html#load-in-base-data"><i class="fa fa-check"></i><b>8.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="8.2" data-path="determining-terrain-features-from-raster-data.html"><a href="determining-terrain-features-from-raster-data.html#rendering-terrain-over-raster-images"><i class="fa fa-check"></i><b>8.2</b> Rendering Terrain Over Raster Images</a></li>
<li class="chapter" data-level="8.3" data-path="determining-terrain-features-from-raster-data.html"><a href="determining-terrain-features-from-raster-data.html#adding-contours-to-raster-images"><i class="fa fa-check"></i><b>8.3</b> Adding Contours to <code>raster</code> Images</a></li>
</ul></li>
<li class="part"><span><b>II Introducing <code>rayshader</code></b></span></li>
<li class="chapter" data-level="9" data-path="using-rayshader-to-render-2d-elevation-and-shade-views.html"><a href="using-rayshader-to-render-2d-elevation-and-shade-views.html"><i class="fa fa-check"></i><b>9</b> Using <code>rayshader</code> to Render 2D Elevation and Shade Views</a>
<ul>
<li class="chapter" data-level="9.1" data-path="using-rayshader-to-render-2d-elevation-and-shade-views.html"><a href="using-rayshader-to-render-2d-elevation-and-shade-views.html#load-in-base-data-1"><i class="fa fa-check"></i><b>9.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="9.2" data-path="using-rayshader-to-render-2d-elevation-and-shade-views.html"><a href="using-rayshader-to-render-2d-elevation-and-shade-views.html#rendering-imagery-from-the-dem-raster"><i class="fa fa-check"></i><b>9.2</b> Rendering imagery from the DEM raster</a></li>
<li class="chapter" data-level="9.3" data-path="using-rayshader-to-render-2d-elevation-and-shade-views.html"><a href="using-rayshader-to-render-2d-elevation-and-shade-views.html#roundtripping-rayshader-rasters-and-matrices"><i class="fa fa-check"></i><b>9.3</b> Roundtripping <code>rayshader</code> Rasters and Matrices</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html"><i class="fa fa-check"></i><b>10</b> Overlaying 2D <code>rayshader</code> Maps</a>
<ul>
<li class="chapter" data-level="10.1" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#load-in-base-data-2"><i class="fa fa-check"></i><b>10.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="10.2" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#adding-overlays"><i class="fa fa-check"></i><b>10.2</b> Adding overlays</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#adding-shadows-to-rayshader-maps"><i class="fa fa-check"></i><b>10.2.1</b> Adding Shadows to <code>rayshader</code> Maps</a></li>
<li class="chapter" data-level="10.2.2" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#adding-water-features"><i class="fa fa-check"></i><b>10.2.2</b> Adding Water Features</a></li>
<li class="chapter" data-level="10.2.3" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#overlaying-map-tiles"><i class="fa fa-check"></i><b>10.2.3</b> Overlaying Map Tiles</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#adding-a-stage-route-layer"><i class="fa fa-check"></i><b>10.3</b> Adding a Stage Route Layer</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#buffering-the-stage-route-view"><i class="fa fa-check"></i><b>10.3.1</b> Buffering the Stage Route View</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#modeling-increased-water-levels"><i class="fa fa-check"></i><b>10.4</b> Modeling Increased Water Levels</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="annotating-rayshader-maps.html"><a href="annotating-rayshader-maps.html"><i class="fa fa-check"></i><b>11</b> Annotating <code>rayshader</code> maps</a>
<ul>
<li class="chapter" data-level="11.1" data-path="annotating-rayshader-maps.html"><a href="annotating-rayshader-maps.html#load-in-base-data-3"><i class="fa fa-check"></i><b>11.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="11.2" data-path="annotating-rayshader-maps.html"><a href="annotating-rayshader-maps.html#adding-a-title-to-a-map"><i class="fa fa-check"></i><b>11.2</b> Adding a Title to a Map</a></li>
<li class="chapter" data-level="11.3" data-path="annotating-rayshader-maps.html"><a href="annotating-rayshader-maps.html#adding-contours-to-rayshader-stage-maps"><i class="fa fa-check"></i><b>11.3</b> Adding Contours to <code>rayshader</code> Stage Maps</a></li>
<li class="chapter" data-level="11.4" data-path="annotating-rayshader-maps.html"><a href="annotating-rayshader-maps.html#overlaying-image-tiles"><i class="fa fa-check"></i><b>11.4</b> Overlaying Image Tiles</a></li>
<li class="chapter" data-level="11.5" data-path="annotating-rayshader-maps.html"><a href="annotating-rayshader-maps.html#plotting-route-layers-on-rayshader-maps"><i class="fa fa-check"></i><b>11.5</b> Plotting Route Layers on <code>rayshader</code> Maps</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="an-aside-the-penny-red.html"><a href="an-aside-the-penny-red.html"><i class="fa fa-check"></i>An Aside - The Penny Red</a>
<ul>
<li><a href="an-aside-the-penny-red.html#d-rendering-of-colour-images-using-rayshader">3D Rendering of Colour Images Using <code>rayshader</code></a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="an-aside-the-penny-red.html"><a href="an-aside-the-penny-red.html#rendering-the-image-directly-from-ggplot2"><i class="fa fa-check"></i><b>11.5.1</b> Rendering the image directly from <code>ggplot2</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="an-aside-the-penny-red.html"><a href="an-aside-the-penny-red.html#rendering-a-movie"><i class="fa fa-check"></i>Rendering a Movie</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html"><i class="fa fa-check"></i><b>12</b> Introducing 3D <code>rayshader</code> Models</a>
<ul>
<li class="chapter" data-level="12.1" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#rendering-the-3d-maps-in-rstudio-and-knitrable-rmd-documents"><i class="fa fa-check"></i><b>12.1</b> Rendering the 3D Maps in <em>RStudio&amp; and <code>knitr</code>able </em>Rmd* Documents</a></li>
<li class="chapter" data-level="12.2" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#rendering-a-3d-view"><i class="fa fa-check"></i><b>12.2</b> Rendering a 3D View</a></li>
<li class="chapter" data-level="12.3" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#the-rayshader-3d-model-plinth"><i class="fa fa-check"></i><b>12.3</b> The <code>rayshader</code> 3D Model Plinth</a></li>
<li class="chapter" data-level="12.4" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#saving-the-widget-as-an-html-file"><i class="fa fa-check"></i><b>12.4</b> Saving the Widget as an HTML File</a></li>
<li class="chapter" data-level="12.5" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#rendering-the-model-to-an-image-file"><i class="fa fa-check"></i><b>12.5</b> Rendering the Model to an Image File</a></li>
<li class="chapter" data-level="12.6" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#rendering-high-quality-models"><i class="fa fa-check"></i><b>12.6</b> Rendering High Quality Models</a></li>
<li class="chapter" data-level="12.7" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#making-a-3d-print-file"><i class="fa fa-check"></i><b>12.7</b> Making a 3D Print File</a></li>
<li class="chapter" data-level="12.8" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#saving-a-movie-of-a-3d-model"><i class="fa fa-check"></i><b>12.8</b> Saving a Movie of a 3D Model</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="rendering-3d-rayshader-stage-route-maps.html"><a href="rendering-3d-rayshader-stage-route-maps.html"><i class="fa fa-check"></i><b>13</b> Rendering 3D <code>rayshader</code> Stage Route Maps</a>
<ul>
<li class="chapter" data-level="13.1" data-path="rendering-3d-rayshader-stage-route-maps.html"><a href="rendering-3d-rayshader-stage-route-maps.html#load-in-base-data-4"><i class="fa fa-check"></i><b>13.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="13.2" data-path="rendering-3d-rayshader-stage-route-maps.html"><a href="rendering-3d-rayshader-stage-route-maps.html#setting-up-3d-embedded-plots"><i class="fa fa-check"></i><b>13.2</b> Setting Up 3D Embedded Plots</a></li>
<li class="chapter" data-level="13.3" data-path="rendering-3d-rayshader-stage-route-maps.html"><a href="rendering-3d-rayshader-stage-route-maps.html#rendering-a-simple-stage-route-model"><i class="fa fa-check"></i><b>13.3</b> Rendering a Simple Stage Route Model</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="rendering-3d-rayshader-stage-route-maps.html"><a href="rendering-3d-rayshader-stage-route-maps.html#decorating-3d-views-with-map-tile-overlays"><i class="fa fa-check"></i><b>13.3.1</b> Decorating 3D Views With Map Tile Overlays</a></li>
<li class="chapter" data-level="13.3.2" data-path="rendering-3d-rayshader-stage-route-maps.html"><a href="rendering-3d-rayshader-stage-route-maps.html#adding-labels-to-3d-rayshader-maps"><i class="fa fa-check"></i><b>13.3.2</b> Adding Labels to 3D <code>rayshader</code> Maps</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="creating-cropped-3d-rayshader-models.html"><a href="creating-cropped-3d-rayshader-models.html"><i class="fa fa-check"></i><b>14</b> Creating Cropped 3d <code>rayshader</code> Models</a>
<ul>
<li class="chapter" data-level="14.1" data-path="creating-cropped-3d-rayshader-models.html"><a href="creating-cropped-3d-rayshader-models.html#load-in-base-data-5"><i class="fa fa-check"></i><b>14.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="14.2" data-path="creating-cropped-3d-rayshader-models.html"><a href="creating-cropped-3d-rayshader-models.html#cropping-the-rendered-3d-view"><i class="fa fa-check"></i><b>14.2</b> Cropping the Rendered 3D View</a></li>
<li class="chapter" data-level="14.3" data-path="creating-cropped-3d-rayshader-models.html"><a href="creating-cropped-3d-rayshader-models.html#cropping-3d-models-to-a-buffered-region"><i class="fa fa-check"></i><b>14.3</b> Cropping 3D Models to a Buffered Region</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="obtaining-shadows-for-a-particular-date-and-time.html"><a href="obtaining-shadows-for-a-particular-date-and-time.html"><i class="fa fa-check"></i><b>15</b> Obtaining Shadows for a Particular Date and Time</a>
<ul>
<li class="chapter" data-level="15.1" data-path="obtaining-shadows-for-a-particular-date-and-time.html"><a href="obtaining-shadows-for-a-particular-date-and-time.html#load-in-base-data-6"><i class="fa fa-check"></i><b>15.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="15.2" data-path="obtaining-shadows-for-a-particular-date-and-time.html"><a href="obtaining-shadows-for-a-particular-date-and-time.html#sunlight-times-vocabulary"><i class="fa fa-check"></i><b>15.2</b> Sunlight Times Vocabulary</a></li>
<li class="chapter" data-level="15.3" data-path="obtaining-shadows-for-a-particular-date-and-time.html"><a href="obtaining-shadows-for-a-particular-date-and-time.html#finding-sunrise-and-sunset-times"><i class="fa fa-check"></i><b>15.3</b> Finding Sunrise and Sunset Times</a></li>
<li class="chapter" data-level="15.4" data-path="obtaining-shadows-for-a-particular-date-and-time.html"><a href="obtaining-shadows-for-a-particular-date-and-time.html#animating-shade"><i class="fa fa-check"></i><b>15.4</b> Animating Shade</a></li>
<li class="chapter" data-level="15.5" data-path="obtaining-shadows-for-a-particular-date-and-time.html"><a href="obtaining-shadows-for-a-particular-date-and-time.html#getting-moon-information"><i class="fa fa-check"></i><b>15.5</b> Getting Moon Information</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html"><i class="fa fa-check"></i><b>16</b> Composing <code>rayshader</code> Stills and Movies</a>
<ul>
<li class="chapter" data-level="16.1" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html#load-in-base-data-7"><i class="fa fa-check"></i><b>16.1</b> Load in Base Data</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html#adding-complications"><i class="fa fa-check"></i><b>16.1.1</b> Adding Complications…</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html#setting-up-the-camera-shots-in-rayshader"><i class="fa fa-check"></i><b>16.2</b> Setting Up the Camera Shots in <code>rayshader</code></a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html#depth-of-field"><i class="fa fa-check"></i><b>16.2.1</b> Depth of Field</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html#camera-positioning"><i class="fa fa-check"></i><b>16.3</b> Camera Positioning</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html#lighting-effects"><i class="fa fa-check"></i><b>16.3.1</b> Lighting Effects</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html#making-3d-video-tracking-shots"><i class="fa fa-check"></i><b>16.4</b> Making 3D Video Tracking Shots</a></li>
</ul></li>
<li class="part"><span><b>III Stage Route Metrics</b></span></li>
<li class="chapter" data-level="17" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html"><i class="fa fa-check"></i><b>17</b> Stage Route Analysis</a>
<ul>
<li class="chapter" data-level="17.1" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#load-in-base-data-8"><i class="fa fa-check"></i><b>17.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="17.2" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#generating-stage-route-profiles"><i class="fa fa-check"></i><b>17.2</b> Generating Stage Route Profiles</a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#an-aside---twists-and-turns-of-rally-stages"><i class="fa fa-check"></i><b>17.2.1</b> An Aside - Twists and Turns of Rally Stages</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#finding-stage-route-lengths"><i class="fa fa-check"></i><b>17.3</b> Finding Stage Route Lengths</a></li>
<li class="chapter" data-level="17.4" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#using-ecological-movement-analysis-tools-to-analyse-stage-routes"><i class="fa fa-check"></i><b>17.4</b> Using Ecological Movement Analysis Tools to Analyse Stage Routes</a></li>
<li class="chapter" data-level="17.5" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#using-trajr-for-stage-route-profiling"><i class="fa fa-check"></i><b>17.5</b> Using <code>trajr</code> for Stage Route Profiling</a>
<ul>
<li class="chapter" data-level="17.5.1" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#smoothing-a-trajectory"><i class="fa fa-check"></i><b>17.5.1</b> Smoothing a Trajectory</a></li>
<li class="chapter" data-level="17.5.2" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#resampling-locations"><i class="fa fa-check"></i><b>17.5.2</b> Resampling Locations</a></li>
<li class="chapter" data-level="17.5.3" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#resampling-against-distance"><i class="fa fa-check"></i><b>17.5.3</b> Resampling Against Distance</a></li>
<li class="chapter" data-level="17.5.4" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#splitting-a-trajectory"><i class="fa fa-check"></i><b>17.5.4</b> Splitting a Trajectory</a></li>
<li class="chapter" data-level="17.5.5" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#rotating-the-stage-trajectory"><i class="fa fa-check"></i><b>17.5.5</b> Rotating the Stage Trajectory</a></li>
<li class="chapter" data-level="17.5.6" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#straightness-and-sinuosity"><i class="fa fa-check"></i><b>17.5.6</b> Straightness and Sinuosity</a></li>
<li class="chapter" data-level="17.5.7" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#directional-change"><i class="fa fa-check"></i><b>17.5.7</b> Directional Change</a></li>
<li class="chapter" data-level="17.5.8" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#tracking-turning-angles"><i class="fa fa-check"></i><b>17.5.8</b> Tracking Turning Angles</a></li>
<li class="chapter" data-level="17.5.9" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#visualising-trajectory-direction-changes"><i class="fa fa-check"></i><b>17.5.9</b> Visualising Trajectory Direction Changes</a></li>
</ul></li>
<li class="chapter" data-level="17.6" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#using-amt-for-stage-route-profiling"><i class="fa fa-check"></i><b>17.6</b> Using <code>amt</code> for Stage Route Profiling</a>
<ul>
<li class="chapter" data-level="17.6.1" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#creating-tracks"><i class="fa fa-check"></i><b>17.6.1</b> Creating Tracks</a></li>
<li class="chapter" data-level="17.6.2" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#converting-to-other-track-formats"><i class="fa fa-check"></i><b>17.6.2</b> Converting to Other Track Formats</a></li>
</ul></li>
<li class="chapter" data-level="17.7" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#using-amt-for-stage-route-analysis"><i class="fa fa-check"></i><b>17.7</b> Using <code>amt</code> for Stage Route Analysis</a></li>
<li class="chapter" data-level="17.8" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#using-rlft-for-stage-route-profiling"><i class="fa fa-check"></i><b>17.8</b> Using <code>rLFT</code> for Stage Route Profiling</a>
<ul>
<li class="chapter" data-level="17.8.1" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#convexity-profile-of-a-stage-route"><i class="fa fa-check"></i><b>17.8.1</b> Convexity Profile of a Stage Route</a></li>
<li class="chapter" data-level="17.8.2" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#previewing-significant-corners"><i class="fa fa-check"></i><b>17.8.2</b> Previewing Significant Corners</a></li>
<li class="chapter" data-level="17.8.3" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#convexity-as-a-3d-plot"><i class="fa fa-check"></i><b>17.8.3</b> Convexity as a 3D Plot</a></li>
</ul></li>
<li class="chapter" data-level="17.9" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#finding-curvature-of-a-route"><i class="fa fa-check"></i><b>17.9</b> Finding Curvature of a Route</a>
<ul>
<li class="chapter" data-level="17.9.1" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#percentage-in-turn"><i class="fa fa-check"></i><b>17.9.1</b> Percentage in Turn</a></li>
</ul></li>
<li class="chapter" data-level="17.10" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#estimating-speeds"><i class="fa fa-check"></i><b>17.10</b> Estimating Speeds</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html"><i class="fa fa-check"></i><b>18</b> Elevation Data Revisited</a>
<ul>
<li class="chapter" data-level="18.1" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#load-in-base-data-9"><i class="fa fa-check"></i><b>18.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="18.2" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#generating-elevation-maps"><i class="fa fa-check"></i><b>18.2</b> Generating Elevation Maps</a>
<ul>
<li class="chapter" data-level="18.2.1" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#accessing-elevation-values-along-a-route-from-an-elevation-raster"><i class="fa fa-check"></i><b>18.2.1</b> Accessing Elevation Values Along a Route from an Elevation Raster</a></li>
<li class="chapter" data-level="18.2.2" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#using-geospheredistgeo-to-find-distance-along-a-route"><i class="fa fa-check"></i><b>18.2.2</b> Using <code>geosphere::distGeo</code> to Find Distance Along a Route</a></li>
<li class="chapter" data-level="18.2.3" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#using-spspdists-to-find-distance-along-a-route"><i class="fa fa-check"></i><b>18.2.3</b> Using <code>sp::spDists</code> to Find Distance Along a Route</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#generating-a-3d-ribbon-plot-of-the-stage-route"><i class="fa fa-check"></i><b>18.3</b> Generating a 3D Ribbon Plot of the Stage Route</a></li>
<li class="chapter" data-level="18.4" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#identifying-road-type"><i class="fa fa-check"></i><b>18.4</b> Identifying Road Type</a></li>
<li class="chapter" data-level="18.5" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#displaying-route-twistiness-and-elevation"><i class="fa fa-check"></i><b>18.5</b> Displaying Route Twistiness and Elevation</a>
<ul>
<li class="chapter" data-level="18.5.1" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#making-a-3d-print-file-of-the-model"><i class="fa fa-check"></i><b>18.5.1</b> Making a 3D Print File of the Model</a></li>
<li class="chapter" data-level="18.5.2" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#rendering-a-3d-movie-of-the-model"><i class="fa fa-check"></i><b>18.5.2</b> Rendering a 3D movie of the Model</a></li>
</ul></li>
<li class="chapter" data-level="18.6" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#using-the-slopes-package-to-analyse-stage-elevation-data"><i class="fa fa-check"></i><b>18.6</b> Using the <code>slopes</code> Package to Analyse Stage Elevation Data</a></li>
<li class="chapter" data-level="18.7" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#analysing-route-elevation-from-first-principles"><i class="fa fa-check"></i><b>18.7</b> Analysing Route Elevation from First Principles</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html"><i class="fa fa-check"></i><b>19</b> Adding <em>OpenStreetMap</em> Data</a>
<ul>
<li class="chapter" data-level="19.1" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#load-in-base-data-10"><i class="fa fa-check"></i><b>19.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="19.2" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#adding-detail-and-features-from-openstreetmap"><i class="fa fa-check"></i><b>19.2</b> Adding Detail and Features from OpenStreetMap</a>
<ul>
<li class="chapter" data-level="19.2.1" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#plotting-osm-highways"><i class="fa fa-check"></i><b>19.2.1</b> Plotting OSM Highways</a></li>
</ul></li>
<li class="chapter" data-level="19.3" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#viewing-roads-in-the-vicinity-of-a-route"><i class="fa fa-check"></i><b>19.3</b> Viewing Roads in the Vicinity of a Route</a>
<ul>
<li class="chapter" data-level="19.3.1" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#using-sfst_buffer-to-create-buffered-areas"><i class="fa fa-check"></i><b>19.3.1</b> Using <code>sf::st_buffer</code> to Create Buffered Areas</a></li>
<li class="chapter" data-level="19.3.2" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#using-rgeosgbuffer-to-create-buffered-areas"><i class="fa fa-check"></i><b>19.3.2</b> Using <code>rgeos::gBuffer</code> to Create Buffered Areas</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#adding-additional-data-from-osm"><i class="fa fa-check"></i><b>19.4</b> Adding Additional Data From OSM</a>
<ul>
<li class="chapter" data-level="19.4.1" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#adding-building-layers-from-openstreetmap"><i class="fa fa-check"></i><b>19.4.1</b> Adding Building Layers from <em>OpenStreetMap</em></a></li>
<li class="chapter" data-level="19.4.2" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#the-wide-variety-of-osm-features"><i class="fa fa-check"></i><b>19.4.2</b> The Wide Variety of OSM Features</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="20" data-path="automatically-generating-stage-descriptions.html"><a href="automatically-generating-stage-descriptions.html"><i class="fa fa-check"></i><b>20</b> Automatically Generating Stage Descriptions</a>
<ul>
<li class="chapter" data-level="20.1" data-path="automatically-generating-stage-descriptions.html"><a href="automatically-generating-stage-descriptions.html#jemba-inertia-notes-system"><i class="fa fa-check"></i><b>20.1</b> Jemba Inertia Notes System</a></li>
<li class="chapter" data-level="20.2" data-path="automatically-generating-stage-descriptions.html"><a href="automatically-generating-stage-descriptions.html#generating-stage-descriptions"><i class="fa fa-check"></i><b>20.2</b> Generating Stage Descriptions</a></li>
<li class="chapter" data-level="20.3" data-path="automatically-generating-stage-descriptions.html"><a href="automatically-generating-stage-descriptions.html#load-in-base-data-11"><i class="fa fa-check"></i><b>20.3</b> Load in Base Data</a></li>
<li class="chapter" data-level="20.4" data-path="automatically-generating-stage-descriptions.html"><a href="automatically-generating-stage-descriptions.html#identifying-corners-based-on-trajr-step-gradients"><i class="fa fa-check"></i><b>20.4</b> Identifying Corners Based on <code>trajr</code> Step Gradients</a></li>
<li class="chapter" data-level="20.5" data-path="automatically-generating-stage-descriptions.html"><a href="automatically-generating-stage-descriptions.html#identifying-straights"><i class="fa fa-check"></i><b>20.5</b> Identifying Straights</a></li>
<li class="chapter" data-level="20.6" data-path="automatically-generating-stage-descriptions.html"><a href="automatically-generating-stage-descriptions.html#plotting-trajectory-segments"><i class="fa fa-check"></i><b>20.6</b> Plotting Trajectory Segments</a>
<ul>
<li class="chapter" data-level="20.6.1" data-path="automatically-generating-stage-descriptions.html"><a href="automatically-generating-stage-descriptions.html#segmenting-the-route"><i class="fa fa-check"></i><b>20.6.1</b> Segmenting the Route</a></li>
<li class="chapter" data-level="20.6.2" data-path="automatically-generating-stage-descriptions.html"><a href="automatically-generating-stage-descriptions.html#numbering-corners"><i class="fa fa-check"></i><b>20.6.2</b> Numbering Corners</a></li>
</ul></li>
<li class="chapter" data-level="20.7" data-path="automatically-generating-stage-descriptions.html"><a href="automatically-generating-stage-descriptions.html#categorising-corners-using-rlft-convexity"><i class="fa fa-check"></i><b>20.7</b> Categorising Corners Using <code>rLFT</code> Convexity</a></li>
<li class="chapter" data-level="20.8" data-path="automatically-generating-stage-descriptions.html"><a href="automatically-generating-stage-descriptions.html#stage-segmenting"><i class="fa fa-check"></i><b>20.8</b> Stage Segmenting</a></li>
<li class="chapter" data-level="20.9" data-path="automatically-generating-stage-descriptions.html"><a href="automatically-generating-stage-descriptions.html#corner-severity-numbering"><i class="fa fa-check"></i><b>20.9</b> Corner Severity Numbering</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html"><i class="fa fa-check"></i><b>21</b> Creating A Road Book</a>
<ul>
<li class="chapter" data-level="21.1" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#motorsport-uk-specific-regulations-for-rallying"><i class="fa fa-check"></i><b>21.1</b> Motorsport UK Specific Regulations for Rallying</a></li>
<li class="chapter" data-level="21.2" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#load-in-base-data-12"><i class="fa fa-check"></i><b>21.2</b> Load in Base Data</a></li>
<li class="chapter" data-level="21.3" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#using-sfnetworks-to-represent-routes-and-road-networks"><i class="fa fa-check"></i><b>21.3</b> Using <code>sfnetworks</code> to Represent Routes and Road Networks</a></li>
<li class="chapter" data-level="21.4" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#analysing-road-networks-with-sfnetworks"><i class="fa fa-check"></i><b>21.4</b> Analysing Road Networks with <code>sfnetworks</code></a>
<ul>
<li class="chapter" data-level="21.4.1" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#creating-an-sfnetworks-graph"><i class="fa fa-check"></i><b>21.4.1</b> Creating an <code>sfnetworks</code> Graph</a></li>
<li class="chapter" data-level="21.4.2" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#filtering-an-sfnetworks-graph"><i class="fa fa-check"></i><b>21.4.2</b> Filtering an <code>sfnetworks</code> Graph</a></li>
<li class="chapter" data-level="21.4.3" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#viewing-a-buffered-area-around-a-junction-node"><i class="fa fa-check"></i><b>21.4.3</b> Viewing a Buffered Area Around a Junction Node</a></li>
<li class="chapter" data-level="21.4.4" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#snapping-a-route-to-a-road-network"><i class="fa fa-check"></i><b>21.4.4</b> Snapping a Route to a Road Network</a></li>
<li class="chapter" data-level="21.4.5" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#snapping-a-full-stage-route-to-the-road-network"><i class="fa fa-check"></i><b>21.4.5</b> Snapping a Full Stage Route to the Road Network</a></li>
</ul></li>
<li class="chapter" data-level="21.5" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#using-dodgr-to-represent-routes-and-road-networks"><i class="fa fa-check"></i><b>21.5</b> Using <code>dodgr</code> to Represent Routes and Road Networks</a></li>
<li class="chapter" data-level="21.6" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#route-stage-time-simulation"><i class="fa fa-check"></i><b>21.6</b> Route Stage Time Simulation</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="where-next.html"><a href="where-next.html"><i class="fa fa-check"></i><b>22</b> Where Next?</a></li>
<li class="divider"></li>
<li><a href="https://rallydatajunkie.com/"><em>RallyDataJunkie.com</em></a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Visualising WRC Rally Stages With <code>rayshader</code> and R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="automatically-generating-stage-descriptions" class="section level1" number="20">
<h1><span class="header-section-number">20</span> Automatically Generating Stage Descriptions</h1>
<p>Having annotated each line segment that makes up a rally stage route, can we use that information to help us create visual or even written, descriptions of a stage?</p>
<p>In terms of categorising turns in a way that’s meaningful in a rally context, let’s have a recap on what sorts of thing a rally navigator or co-driver is likely to be saying:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="automatically-generating-stage-descriptions.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">embed_url</span>(<span class="st">&quot;https://www.youtube.com/watch?v=KFjRj25uclQ&quot;</span>)</span></code></pre></div>
<div class="vembedr">
<div>
<iframe src="https://www.youtube.com/embed/KFjRj25uclQ" width="533" height="300" frameborder="0" allowfullscreen=""></iframe>
</div>
</div>
<p>And let’s review what we actually mean by a corner…</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="automatically-generating-stage-descriptions.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">embed_url</span>(<span class="st">&quot;https://www.youtube.com/watch?v=YXOYckDATWE&quot;</span>)</span></code></pre></div>
<div class="vembedr">
<div>
<iframe src="https://www.youtube.com/embed/YXOYckDATWE" width="533" height="300" frameborder="0" allowfullscreen=""></iframe>
</div>
</div>
<p>In terms of actual corners, the convexity interesting may be one of the more interesting properties. Finding a good way of representing variable radius turns (you did watch the “corners” video, didn’t you?!) will also be important if we want to be able to identify “tightens” or “lessens” (that is, “opens”) corner features. Any elevation changes in the vicinity of a corner are likely to be important if we are trying to characterise braking zone requirements…</p>
<div id="jemba-inertia-notes-system" class="section level2" number="20.1">
<h2><span class="header-section-number">20.1</span> Jemba Inertia Notes System</h2>
<p>In a section entitled <em>Using data to assess the suitability of a special stage</em>, the <a href="https://www.fia.com/sites/default/files/2printable_rally_safety_guidelines_1.pdf"><em>FIA Rally Safety Guidelines 2020</em></a> suggest that as well as using historic information, the “Jemba System” for recording terrain data, including “the inclines, the dips, the bends and crests”. By also taking the road terrain (for example, gravel or asphalt) into account, and likely car classes, average speeds over the stage as well as highest speed and heaviest braking areas can also be determined. THe system <a href="https://jemba.se/inertia.htm">can also report</a> the <em>margin for critical braking dist before stop</em> (“how far you may carry on at competitive speed until you have to start braking to be able to stop at the stop control”) and the Jemba Safety Index (J/kg), the average kinetic energy of a car going through the corners.</p>
<p>The FIA Safety Guidelines illustrate how speeds might be visualised over a Google Earth map using a three colour scale (purple:over 150kph; red: over 90kph; yellow – 7590kph). The report also suggests that the Jemba system can predict the maximum cornering speed for any particular bend.</p>
<p>A Wikipedia page describing the <a href="https://en.wikipedia.org/wiki/Jemba_Inertia_Notes_System"><em>Jemba Inertia Notes System</em></a> gives examples of the descriptive and numerical labels that the Jemba system can generate as it converts odometry and accelerometer data into something rather more human understandable. A <a href="http://www.jemba.se/GradeUSA.jpg">visual grading</a> shows how descriptive labels correspond to turn angle.</p>
</div>
<div id="generating-stage-descriptions" class="section level2" number="20.2">
<h2><span class="header-section-number">20.2</span> Generating Stage Descriptions</h2>
<p>Being able to display route profiles on a map as colour highlighted routes is very useful and could be made more so adding the data to a <em>leaflet.js</em> extension such as <a href="https://github.com/GIScience/Leaflet.Heightgraph"><code>Leaflet.Heightgraph</code></a>, which displays arbitrary traces (to integrate this in the current workflow properly would require the development of an extension to the <em>R</em> <code>leaflet</code> package).</p>
<p>Another possibility would be to try to automate the creation of text based route descriptions (“robot journalism”), which I’ve crudely explored in other contexts elsewhere. The <a href="https://itgetsfasternow.com/2021/01/19/route-preview-rallye-monte-carlo-2021/"><em>It Gets Faster Now</em></a> blog publishes stage descriptions for WRC stage routes, so this could be a good place to learn tropes from.</p>
</div>
<div id="load-in-base-data-11" class="section level2" number="20.3">
<h2><span class="header-section-number">20.3</span> Load in Base Data</h2>
<p>As ever, let’s load in our stage data and the elevation raster and create a demo map:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="automatically-generating-stage-descriptions.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb3-2"><a href="automatically-generating-stage-descriptions.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb3-3"><a href="automatically-generating-stage-descriptions.html#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rayshader)</span>
<span id="cb3-4"><a href="automatically-generating-stage-descriptions.html#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="automatically-generating-stage-descriptions.html#cb3-5" aria-hidden="true" tabindex="-1"></a>geojson_filename <span class="ot">=</span> <span class="st">&#39;montecarlo_2021.geojson&#39;</span></span>
<span id="cb3-6"><a href="automatically-generating-stage-descriptions.html#cb3-6" aria-hidden="true" tabindex="-1"></a>geojson_sf <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_read</span>(geojson_filename)</span></code></pre></div>
<pre><code>## Reading layer `montecarlo_2021&#39; from data source `/Users/tonyhirst/Documents/GitHub/visualising-rally-stages/montecarlo_2021.geojson&#39; using driver `GeoJSON&#39;
## Simple feature collection with 9 features and 2 fields
## geometry type:  LINESTRING
## dimension:      XY
## bbox:           xmin: 5.243488 ymin: 43.87633 xmax: 6.951953 ymax: 44.81973
## geographic CRS: WGS 84</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="automatically-generating-stage-descriptions.html#cb5-1" aria-hidden="true" tabindex="-1"></a>stage_route_gj <span class="ot">=</span> geojsonio<span class="sc">::</span><span class="fu">geojson_json</span>(geojson_sf[<span class="dv">1</span>,]<span class="sc">$</span>geometry)</span>
<span id="cb5-2"><a href="automatically-generating-stage-descriptions.html#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="automatically-generating-stage-descriptions.html#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Previously downloaded TIF digital elevation model (DEM) file</span></span>
<span id="cb5-4"><a href="automatically-generating-stage-descriptions.html#cb5-4" aria-hidden="true" tabindex="-1"></a>stage_tif <span class="ot">=</span> <span class="st">&quot;stage_elevation.tif&quot;</span></span>
<span id="cb5-5"><a href="automatically-generating-stage-descriptions.html#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="automatically-generating-stage-descriptions.html#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Load in the previously saved image raster</span></span>
<span id="cb5-7"><a href="automatically-generating-stage-descriptions.html#cb5-7" aria-hidden="true" tabindex="-1"></a>elev_img <span class="ot">=</span> <span class="fu">raster</span>(stage_tif)</span>
<span id="cb5-8"><a href="automatically-generating-stage-descriptions.html#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="automatically-generating-stage-descriptions.html#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Note we can pass in a file name or a raster object</span></span>
<span id="cb5-10"><a href="automatically-generating-stage-descriptions.html#cb5-10" aria-hidden="true" tabindex="-1"></a>elmat <span class="ot">=</span> <span class="fu">raster_to_matrix</span>(stage_tif)</span></code></pre></div>
<pre><code>## [1] &quot;Dimensions of matrix are: 382x565.&quot;</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="automatically-generating-stage-descriptions.html#cb7-1" aria-hidden="true" tabindex="-1"></a>demo_map <span class="ot">=</span> elmat <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="automatically-generating-stage-descriptions.html#cb7-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">sphere_shade</span>(<span class="at">texture =</span> <span class="st">&quot;desert&quot;</span>,</span>
<span id="cb7-3"><a href="automatically-generating-stage-descriptions.html#cb7-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">progbar =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>Let’s also get a UTM projection of the stage routes:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="automatically-generating-stage-descriptions.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Detect the UTM zone as an EPSG code</span></span>
<span id="cb8-2"><a href="automatically-generating-stage-descriptions.html#cb8-2" aria-hidden="true" tabindex="-1"></a>lonlat2UTMzone <span class="ot">=</span> <span class="cf">function</span>(lonlat) {</span>
<span id="cb8-3"><a href="automatically-generating-stage-descriptions.html#cb8-3" aria-hidden="true" tabindex="-1"></a>  utm <span class="ot">=</span> (<span class="fu">floor</span>((lonlat[<span class="dv">1</span>] <span class="sc">+</span> <span class="dv">180</span>) <span class="sc">/</span> <span class="dv">6</span>) <span class="sc">%%</span> <span class="dv">60</span>) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb8-4"><a href="automatically-generating-stage-descriptions.html#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(lonlat[<span class="dv">2</span>] <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb8-5"><a href="automatically-generating-stage-descriptions.html#cb8-5" aria-hidden="true" tabindex="-1"></a>    utm <span class="sc">+</span> <span class="dv">32600</span></span>
<span id="cb8-6"><a href="automatically-generating-stage-descriptions.html#cb8-6" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb8-7"><a href="automatically-generating-stage-descriptions.html#cb8-7" aria-hidden="true" tabindex="-1"></a>    utm <span class="sc">+</span> <span class="dv">32700</span></span>
<span id="cb8-8"><a href="automatically-generating-stage-descriptions.html#cb8-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-9"><a href="automatically-generating-stage-descriptions.html#cb8-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-10"><a href="automatically-generating-stage-descriptions.html#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="automatically-generating-stage-descriptions.html#cb8-11" aria-hidden="true" tabindex="-1"></a>get_utm_projection <span class="ot">=</span> <span class="cf">function</span>(routes){</span>
<span id="cb8-12"><a href="automatically-generating-stage-descriptions.html#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Keep track of the original proj4 string</span></span>
<span id="cb8-13"><a href="automatically-generating-stage-descriptions.html#cb8-13" aria-hidden="true" tabindex="-1"></a>  old_crs <span class="ot">=</span> <span class="fu">st_crs</span>(geojson_sf[<span class="dv">1</span>,])<span class="sc">$</span>proj4string</span>
<span id="cb8-14"><a href="automatically-generating-stage-descriptions.html#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="automatically-generating-stage-descriptions.html#cb8-15" aria-hidden="true" tabindex="-1"></a>  sample_location_x <span class="ot">=</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(routes[<span class="dv">1</span>,]))[<span class="dv">1</span>]</span>
<span id="cb8-16"><a href="automatically-generating-stage-descriptions.html#cb8-16" aria-hidden="true" tabindex="-1"></a>  sample_location_y <span class="ot">=</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(routes[<span class="dv">1</span>,]))[<span class="dv">2</span>]</span>
<span id="cb8-17"><a href="automatically-generating-stage-descriptions.html#cb8-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-18"><a href="automatically-generating-stage-descriptions.html#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate a new projection in the appropriate UTM zone</span></span>
<span id="cb8-19"><a href="automatically-generating-stage-descriptions.html#cb8-19" aria-hidden="true" tabindex="-1"></a>  crs_zone <span class="ot">=</span> <span class="fu">lonlat2UTMzone</span>(<span class="fu">c</span>(sample_location_x,</span>
<span id="cb8-20"><a href="automatically-generating-stage-descriptions.html#cb8-20" aria-hidden="true" tabindex="-1"></a>                              sample_location_y))</span>
<span id="cb8-21"><a href="automatically-generating-stage-descriptions.html#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="automatically-generating-stage-descriptions.html#cb8-22" aria-hidden="true" tabindex="-1"></a>  new_proj4_string <span class="ot">=</span> <span class="fu">st_crs</span>(crs_zone)<span class="sc">$</span>proj4string</span>
<span id="cb8-23"><a href="automatically-generating-stage-descriptions.html#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="automatically-generating-stage-descriptions.html#cb8-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Transform the route to the UTM projection</span></span>
<span id="cb8-25"><a href="automatically-generating-stage-descriptions.html#cb8-25" aria-hidden="true" tabindex="-1"></a>  utm_routes <span class="ot">=</span> <span class="fu">st_transform</span>(geojson_sf, <span class="at">crs=</span>new_proj4_string)</span>
<span id="cb8-26"><a href="automatically-generating-stage-descriptions.html#cb8-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-27"><a href="automatically-generating-stage-descriptions.html#cb8-27" aria-hidden="true" tabindex="-1"></a>  utm_routes</span>
<span id="cb8-28"><a href="automatically-generating-stage-descriptions.html#cb8-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Or should we returned a named list</span></span>
<span id="cb8-29"><a href="automatically-generating-stage-descriptions.html#cb8-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># e.g. including the original projection?</span></span>
<span id="cb8-30"><a href="automatically-generating-stage-descriptions.html#cb8-30" aria-hidden="true" tabindex="-1"></a>  <span class="co">#list(utm_routes = utm_routes, orig_crs=old_crs)</span></span>
<span id="cb8-31"><a href="automatically-generating-stage-descriptions.html#cb8-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-32"><a href="automatically-generating-stage-descriptions.html#cb8-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-33"><a href="automatically-generating-stage-descriptions.html#cb8-33" aria-hidden="true" tabindex="-1"></a>utm_routes <span class="ot">=</span> <span class="fu">get_utm_projection</span>(geojson_sf)</span></code></pre></div>
</div>
<div id="identifying-corners-based-on-trajr-step-gradients" class="section level2" number="20.4">
<h2><span class="header-section-number">20.4</span> Identifying Corners Based on <code>trajr</code> Step Gradients</h2>
<p>Let’s start by trying to identify straight sections. Trivially, given that the stage route is given by a linestring made of straight line segments arranged at different angles relative to each other, every line segment is a straight. So what we really mean by a straight is a sequence of connected lines segments where each line segment is at an angle less than +/- 5 degrees to the to segment before it, for example, where the start of the straight has a preceding segment more than +/- 5 degrees to it (for example) and the end of the straight has a following line segment at more than +/- five degrees to it.</p>
<p>Let’s use the <code>trajr</code> <em>stepangle</em> to try to categorise straights:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="automatically-generating-stage-descriptions.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(trajr)</span>
<span id="cb9-2"><a href="automatically-generating-stage-descriptions.html#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="automatically-generating-stage-descriptions.html#cb9-3" aria-hidden="true" tabindex="-1"></a>trj <span class="ot">&lt;-</span> <span class="fu">TrajFromCoords</span>(<span class="fu">as.data.frame</span>(<span class="fu">st_coordinates</span>(utm_routes[<span class="dv">1</span>,])))</span>
<span id="cb9-4"><a href="automatically-generating-stage-descriptions.html#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="automatically-generating-stage-descriptions.html#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove duplicate x,y rows - assume non-crossing route]</span></span>
<span id="cb9-6"><a href="automatically-generating-stage-descriptions.html#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Should probably flag this removal via a warning</span></span>
<span id="cb9-7"><a href="automatically-generating-stage-descriptions.html#cb9-7" aria-hidden="true" tabindex="-1"></a>trj <span class="ot">=</span>  trj[<span class="sc">!</span><span class="fu">duplicated</span>(trj[,<span class="fu">c</span>(<span class="st">&#39;x&#39;</span>,<span class="st">&#39;y&#39;</span>)]),]</span>
<span id="cb9-8"><a href="automatically-generating-stage-descriptions.html#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="automatically-generating-stage-descriptions.html#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co"># displacement is a complex number, so we can get the actual distance:</span></span>
<span id="cb9-10"><a href="automatically-generating-stage-descriptions.html#cb9-10" aria-hidden="true" tabindex="-1"></a>trj<span class="sc">$</span>distance <span class="ot">=</span> <span class="fu">Mod</span>(trj<span class="sc">$</span>displacement)</span>
<span id="cb9-11"><a href="automatically-generating-stage-descriptions.html#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="automatically-generating-stage-descriptions.html#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the accumulated distance at each step</span></span>
<span id="cb9-13"><a href="automatically-generating-stage-descriptions.html#cb9-13" aria-hidden="true" tabindex="-1"></a>trj<span class="sc">$</span>cum_dist <span class="ot">=</span> <span class="fu">cumsum</span>(trj<span class="sc">$</span>distance)</span>
<span id="cb9-14"><a href="automatically-generating-stage-descriptions.html#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="automatically-generating-stage-descriptions.html#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Step angle in radians relative to previous</span></span>
<span id="cb9-16"><a href="automatically-generating-stage-descriptions.html#cb9-16" aria-hidden="true" tabindex="-1"></a>trj<span class="sc">$</span>stepangle <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">TrajAngles</span>(trj, <span class="at">compass.direction =</span> <span class="cn">NULL</span>) <span class="sc">*</span> <span class="dv">180</span> <span class="sc">/</span> pi, <span class="cn">NA</span>) </span>
<span id="cb9-17"><a href="automatically-generating-stage-descriptions.html#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="automatically-generating-stage-descriptions.html#cb9-18" aria-hidden="true" tabindex="-1"></a>trj<span class="sc">$</span>cumstepangle <span class="ot">=</span> <span class="fu">cumsum</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">TrajAngles</span>(trj, <span class="at">compass.direction =</span> <span class="cn">NULL</span>) <span class="sc">*</span> <span class="dv">180</span> <span class="sc">/</span> pi, <span class="cn">NA</span>))</span>
<span id="cb9-19"><a href="automatically-generating-stage-descriptions.html#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="automatically-generating-stage-descriptions.html#cb9-20" aria-hidden="true" tabindex="-1"></a>trj<span class="sc">$</span>stepheading <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">TrajAngles</span>(trj, <span class="at">compass.direction =</span> <span class="dv">0</span>)<span class="sc">*</span> <span class="dv">180</span> <span class="sc">/</span> pi, <span class="cn">NA</span>) </span>
<span id="cb9-21"><a href="automatically-generating-stage-descriptions.html#cb9-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-22"><a href="automatically-generating-stage-descriptions.html#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the gradient of the accumulated angle</span></span>
<span id="cb9-23"><a href="automatically-generating-stage-descriptions.html#cb9-23" aria-hidden="true" tabindex="-1"></a>trj<span class="sc">$</span>step_gradient <span class="ot">=</span> pracma<span class="sc">::</span><span class="fu">gradient</span>(trj<span class="sc">$</span>cumstepangle, trj<span class="sc">$</span>cum_dist)</span></code></pre></div>
<p>We can view the gradients:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="automatically-generating-stage-descriptions.html#cb10-1" aria-hidden="true" tabindex="-1"></a>g <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data=</span>trj,</span>
<span id="cb10-2"><a href="automatically-generating-stage-descriptions.html#cb10-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y)) <span class="sc">+</span> <span class="fu">geom_path</span>(<span class="at">color=</span><span class="st">&#39;grey&#39;</span>) <span class="sc">+</span> <span class="fu">coord_sf</span>()</span>
<span id="cb10-3"><a href="automatically-generating-stage-descriptions.html#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="automatically-generating-stage-descriptions.html#cb10-4" aria-hidden="true" tabindex="-1"></a>g <span class="sc">+</span> <span class="fu">geom_point</span>( <span class="at">size=</span><span class="fl">0.2</span>, <span class="at">color=</span><span class="st">&#39;blue&#39;</span>,</span>
<span id="cb10-5"><a href="automatically-generating-stage-descriptions.html#cb10-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">data=</span>trj[trj<span class="sc">$</span>step_gradient<span class="sc">&gt;</span><span class="fl">0.2</span>,]) <span class="sc">+</span></span>
<span id="cb10-6"><a href="automatically-generating-stage-descriptions.html#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size=</span><span class="fl">0.2</span>,</span>
<span id="cb10-7"><a href="automatically-generating-stage-descriptions.html#cb10-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">data=</span>trj[trj<span class="sc">$</span>step_gradient<span class="sc">&lt;=-</span><span class="fl">0.2</span>,],</span>
<span id="cb10-8"><a href="automatically-generating-stage-descriptions.html#cb10-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">color=</span><span class="st">&#39;red&#39;</span>)</span></code></pre></div>
<p><img src="images/stage-description-sd-preview-1.png" width="672" /></p>
<p>If we have several consecutive points with a gradient of the <em>same</em> sign, then we might consider them to be part of the same corner, albeit one that maybe tightens or opens. If the gradients of consecutive segments have a <em>different</em> sign, then we have a change of direction from e.g. left to right or right to left.</p>
<p>We can create a flag that identifies when the sign changes across consecutive rows of the <em>step_gradient</em> column. We can check this by lagging the contents of the <em>step_gradient</em> column by one step using the <code>dplyr::lag()</code> function and comparing its sign to the sign of the unlagged value. If we then <em>dplyr::lead()</em> the result, we can see if a change in direction happens at the end of a step:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="automatically-generating-stage-descriptions.html#cb11-1" aria-hidden="true" tabindex="-1"></a>trj <span class="ot">=</span> trj <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="automatically-generating-stage-descriptions.html#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dirChange =</span> <span class="fu">lead</span>(<span class="fu">sign</span>(step_gradient) <span class="sc">!=</span> <span class="fu">sign</span>(<span class="fu">lag</span>(step_gradient))))</span>
<span id="cb11-3"><a href="automatically-generating-stage-descriptions.html#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="automatically-generating-stage-descriptions.html#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(trj[,<span class="fu">c</span>(<span class="st">&#39;step_gradient&#39;</span>, <span class="st">&#39;dirChange&#39;</span>)])</span></code></pre></div>
<pre><code>##   step_gradient dirChange
## 1    0.02722146     FALSE
## 2    0.43059007     FALSE
## 3    1.18714584     FALSE
## 4    1.94367547     FALSE
## 5    1.42337267      TRUE
## 6   -0.07676768     FALSE</code></pre>
<p>Let’s plot points on the route where we seem to have a direction change:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="automatically-generating-stage-descriptions.html#cb13-1" aria-hidden="true" tabindex="-1"></a>g <span class="sc">+</span></span>
<span id="cb13-2"><a href="automatically-generating-stage-descriptions.html#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="at">size=</span><span class="fl">0.2</span>, <span class="at">color=</span><span class="st">&#39;blue&#39;</span>,</span>
<span id="cb13-3"><a href="automatically-generating-stage-descriptions.html#cb13-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">data=</span>trj[trj<span class="sc">$</span>dirChange,]) <span class="sc">+</span></span>
<span id="cb13-4"><a href="automatically-generating-stage-descriptions.html#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>))</span></code></pre></div>
<p><img src="images/stage-description-sd-dirchange-1.png" width="672" />
Let’s zoom in a bit:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="automatically-generating-stage-descriptions.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Zoom in on part of the route</span></span>
<span id="cb14-2"><a href="automatically-generating-stage-descriptions.html#cb14-2" aria-hidden="true" tabindex="-1"></a>zoom1 <span class="ot">=</span> trj<span class="sc">$</span>y<span class="sc">&gt;</span><span class="dv">4964000</span> <span class="sc">&amp;</span> trj<span class="sc">$</span>y<span class="sc">&lt;</span><span class="dv">4965000</span> </span>
<span id="cb14-3"><a href="automatically-generating-stage-descriptions.html#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="automatically-generating-stage-descriptions.html#cb14-4" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data=</span>trj[zoom1, ],</span>
<span id="cb14-5"><a href="automatically-generating-stage-descriptions.html#cb14-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y)) <span class="sc">+</span> <span class="fu">geom_path</span>(<span class="at">color=</span><span class="st">&#39;grey&#39;</span>) <span class="sc">+</span> <span class="fu">coord_sf</span>()</span>
<span id="cb14-6"><a href="automatically-generating-stage-descriptions.html#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="automatically-generating-stage-descriptions.html#cb14-7" aria-hidden="true" tabindex="-1"></a>g1 <span class="sc">+</span>  <span class="fu">geom_point</span>( <span class="at">size=</span><span class="fl">0.2</span>, <span class="at">color=</span><span class="st">&#39;blue&#39;</span>,</span>
<span id="cb14-8"><a href="automatically-generating-stage-descriptions.html#cb14-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">data=</span>trj[zoom1 <span class="sc">&amp;</span> trj<span class="sc">$</span>dirChange,]) <span class="sc">+</span></span>
<span id="cb14-9"><a href="automatically-generating-stage-descriptions.html#cb14-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>))</span></code></pre></div>
<p><img src="images/stage-description-sd-dirchange-zoom-1.png" width="672" />
We notice that we seem to be missing some corners that are perhaps not direction changes, but significant angle changes in the same direction. And we also notice a direction change flagged in what appears to be the middle of a straight.</p>
<p>Let’s look at the apparent turn in the middle of the straight first. If we have opposing angles from one segment to the next, then we currently class the first point as a corner because the direction has changed. But we aren’t really interested in slight direction changes or even slight direction changes in the same direction.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="automatically-generating-stage-descriptions.html#cb15-1" aria-hidden="true" tabindex="-1"></a>slight_gradient <span class="ot">=</span> <span class="fl">0.35</span></span>
<span id="cb15-2"><a href="automatically-generating-stage-descriptions.html#cb15-2" aria-hidden="true" tabindex="-1"></a>large_angle <span class="ot">=</span> <span class="dv">20</span></span>
<span id="cb15-3"><a href="automatically-generating-stage-descriptions.html#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="automatically-generating-stage-descriptions.html#cb15-4" aria-hidden="true" tabindex="-1"></a>trj <span class="ot">=</span> trj <span class="sc">%&gt;%</span> </span>
<span id="cb15-5"><a href="automatically-generating-stage-descriptions.html#cb15-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">straightish =</span>  (<span class="fu">abs</span>(step_gradient) <span class="sc">&lt;</span> slight_gradient) <span class="sc">&amp;</span></span>
<span id="cb15-6"><a href="automatically-generating-stage-descriptions.html#cb15-6" aria-hidden="true" tabindex="-1"></a>                               (stepangle <span class="sc">&lt;</span> large_angle))</span>
<span id="cb15-7"><a href="automatically-generating-stage-descriptions.html#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="automatically-generating-stage-descriptions.html#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>trj[zoom1, ],</span>
<span id="cb15-9"><a href="automatically-generating-stage-descriptions.html#cb15-9" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y)) <span class="sc">+</span> <span class="fu">geom_path</span>(<span class="at">color=</span><span class="st">&#39;grey&#39;</span>) <span class="sc">+</span> <span class="fu">coord_sf</span>() <span class="sc">+</span></span>
<span id="cb15-10"><a href="automatically-generating-stage-descriptions.html#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="at">size=</span><span class="dv">1</span>, <span class="fu">aes</span>(<span class="at">color =</span> straightish)) <span class="sc">+</span></span>
<span id="cb15-11"><a href="automatically-generating-stage-descriptions.html#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>))</span></code></pre></div>
<p><img src="images/stage-description-sd-straightish-1.png" width="672" /></p>
<p>We now want to identify the first node in a close sequence of nodes that identify a turn that doesn’t change direction.</p>
<p>Which is to say we want a not straightish node whose next node is nearby and not straightish and in the same direction, or not nearby:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="automatically-generating-stage-descriptions.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Close distance threshold</span></span>
<span id="cb16-2"><a href="automatically-generating-stage-descriptions.html#cb16-2" aria-hidden="true" tabindex="-1"></a>closeby <span class="ot">=</span> <span class="dv">25</span></span>
<span id="cb16-3"><a href="automatically-generating-stage-descriptions.html#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="automatically-generating-stage-descriptions.html#cb16-4" aria-hidden="true" tabindex="-1"></a>trj <span class="ot">=</span> trj <span class="sc">%&gt;%</span></span>
<span id="cb16-5"><a href="automatically-generating-stage-descriptions.html#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nearby =</span> (distance <span class="sc">&lt;</span> closeby) ) <span class="sc">%&gt;%</span></span>
<span id="cb16-6"><a href="automatically-generating-stage-descriptions.html#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">firstish =</span> <span class="sc">!</span>straightish <span class="sc">&amp;</span> </span>
<span id="cb16-7"><a href="automatically-generating-stage-descriptions.html#cb16-7" aria-hidden="true" tabindex="-1"></a>                    ((nearby <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">lag</span>(straightish) <span class="sc">&amp;</span> <span class="fu">lag</span>(dirChange)) <span class="sc">|</span></span>
<span id="cb16-8"><a href="automatically-generating-stage-descriptions.html#cb16-8" aria-hidden="true" tabindex="-1"></a>                     (<span class="sc">!</span>nearby) ) )</span>
<span id="cb16-9"><a href="automatically-generating-stage-descriptions.html#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="automatically-generating-stage-descriptions.html#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>trj[zoom1, ],</span>
<span id="cb16-11"><a href="automatically-generating-stage-descriptions.html#cb16-11" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y)) <span class="sc">+</span> <span class="fu">geom_path</span>(<span class="at">color=</span><span class="st">&#39;grey&#39;</span>) <span class="sc">+</span> <span class="fu">coord_sf</span>() <span class="sc">+</span></span>
<span id="cb16-12"><a href="automatically-generating-stage-descriptions.html#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="at">size=</span><span class="dv">1</span>, <span class="fu">aes</span>(<span class="at">color =</span> firstish)) <span class="sc">+</span></span>
<span id="cb16-13"><a href="automatically-generating-stage-descriptions.html#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>))</span></code></pre></div>
<p><img src="images/stage-description-sd-firstish-1.png" width="672" /></p>
<p>That’s identifying some of the corners, but what’s going on top left?</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="automatically-generating-stage-descriptions.html#cb17-1" aria-hidden="true" tabindex="-1"></a>zoom2 <span class="ot">=</span> zoom1 <span class="sc">&amp;</span> trj<span class="sc">$</span>x<span class="sc">&lt;</span><span class="dv">730100</span></span>
<span id="cb17-2"><a href="automatically-generating-stage-descriptions.html#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="automatically-generating-stage-descriptions.html#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>trj[zoom2,],</span>
<span id="cb17-4"><a href="automatically-generating-stage-descriptions.html#cb17-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y)) <span class="sc">+</span> <span class="fu">geom_path</span>(<span class="at">color=</span><span class="st">&#39;grey&#39;</span>) <span class="sc">+</span> <span class="fu">coord_sf</span>() <span class="sc">+</span></span>
<span id="cb17-5"><a href="automatically-generating-stage-descriptions.html#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="at">size=</span><span class="dv">1</span>, <span class="fu">aes</span>(<span class="at">color =</span> firstish)) <span class="sc">+</span></span>
<span id="cb17-6"><a href="automatically-generating-stage-descriptions.html#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>))</span></code></pre></div>
<p><img src="images/stage-description-sd-firstish-zoom-1.png" width="672" />
Ah, ok, maybe we could categorise those as turns, but perhaps gentle ones. We maybe need to flag these as “flowing” if they aren’t too tight and have a long run in and out:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="automatically-generating-stage-descriptions.html#cb18-1" aria-hidden="true" tabindex="-1"></a>tight_gradient <span class="ot">=</span> <span class="fl">0.5</span></span>
<span id="cb18-2"><a href="automatically-generating-stage-descriptions.html#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="automatically-generating-stage-descriptions.html#cb18-3" aria-hidden="true" tabindex="-1"></a>trj <span class="ot">=</span> trj <span class="sc">%&gt;%</span></span>
<span id="cb18-4"><a href="automatically-generating-stage-descriptions.html#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">significant =</span> <span class="fu">abs</span>(step_gradient) <span class="sc">&gt;</span> tight_gradient ) <span class="sc">%&gt;%</span></span>
<span id="cb18-5"><a href="automatically-generating-stage-descriptions.html#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">flowing =</span> <span class="sc">!</span>nearby <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">lead</span>(nearby) <span class="sc">&amp;</span> </span>
<span id="cb18-6"><a href="automatically-generating-stage-descriptions.html#cb18-6" aria-hidden="true" tabindex="-1"></a>                   <span class="sc">!</span>straightish <span class="sc">&amp;</span> <span class="sc">!</span>significant )</span>
<span id="cb18-7"><a href="automatically-generating-stage-descriptions.html#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="automatically-generating-stage-descriptions.html#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>trj[zoom2,],</span>
<span id="cb18-9"><a href="automatically-generating-stage-descriptions.html#cb18-9" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y)) <span class="sc">+</span> <span class="fu">geom_path</span>(<span class="at">color=</span><span class="st">&#39;grey&#39;</span>) <span class="sc">+</span> <span class="fu">coord_sf</span>() <span class="sc">+</span></span>
<span id="cb18-10"><a href="automatically-generating-stage-descriptions.html#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="at">size=</span><span class="dv">3</span>, <span class="fu">aes</span>(<span class="at">color =</span> flowing,</span>
<span id="cb18-11"><a href="automatically-generating-stage-descriptions.html#cb18-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">shape =</span> dirChange)) <span class="sc">+</span></span>
<span id="cb18-12"><a href="automatically-generating-stage-descriptions.html#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>))</span></code></pre></div>
<p><img src="images/stage-description-sd-flowing-1.png" width="672" /></p>
<p>We can also tweak firstish to recognise significance:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="automatically-generating-stage-descriptions.html#cb19-1" aria-hidden="true" tabindex="-1"></a>trj <span class="ot">=</span> trj <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="automatically-generating-stage-descriptions.html#cb19-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">firstish =</span> (significant <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">lag</span>(significant)) <span class="sc">|</span></span>
<span id="cb19-3"><a href="automatically-generating-stage-descriptions.html#cb19-3" aria-hidden="true" tabindex="-1"></a>                            (<span class="sc">!</span>straightish <span class="sc">&amp;</span> </span>
<span id="cb19-4"><a href="automatically-generating-stage-descriptions.html#cb19-4" aria-hidden="true" tabindex="-1"></a>                            ((nearby <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">lag</span>(straightish) <span class="sc">&amp;</span> <span class="fu">lag</span>(dirChange)) <span class="sc">|</span></span>
<span id="cb19-5"><a href="automatically-generating-stage-descriptions.html#cb19-5" aria-hidden="true" tabindex="-1"></a>                            (<span class="sc">!</span>nearby) ) )) <span class="sc">%&gt;%</span></span>
<span id="cb19-6"><a href="automatically-generating-stage-descriptions.html#cb19-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Desensitise firstish</span></span>
<span id="cb19-7"><a href="automatically-generating-stage-descriptions.html#cb19-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">firstish =</span> firstish <span class="sc">&amp;</span> <span class="sc">!</span>(<span class="fu">lag</span>(firstish)))</span></code></pre></div>
<p>And how about over a wider part of the stage?</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="automatically-generating-stage-descriptions.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>trj[zoom1, ],</span>
<span id="cb20-2"><a href="automatically-generating-stage-descriptions.html#cb20-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y)) <span class="sc">+</span> <span class="fu">geom_path</span>(<span class="at">color=</span><span class="st">&#39;grey&#39;</span>) <span class="sc">+</span> <span class="fu">coord_sf</span>() <span class="sc">+</span></span>
<span id="cb20-3"><a href="automatically-generating-stage-descriptions.html#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="at">size=</span><span class="dv">2</span>, <span class="fu">aes</span>(<span class="at">color =</span> firstish,</span>
<span id="cb20-4"><a href="automatically-generating-stage-descriptions.html#cb20-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">shape =</span> flowing)) <span class="sc">+</span></span>
<span id="cb20-5"><a href="automatically-generating-stage-descriptions.html#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>))</span></code></pre></div>
<p><img src="images/stage-description-sd-flowing2-1.png" width="672" /></p>
<p>We could also then create a <em>!flowing &amp; firstish</em> flag to provide better indexing of the starts of corners.</p>
<p>We’d need to test the approach on further stages to see whether it gives false positives or false negatives on identifying various corners, and we’d maybe also want to try to identify tightens and opens.</p>
<p>Let’s have a go at tightens. At a first approximation, a corner <em>tightens</em> if a node isn’t firstish, is above a certain gradient, is close to the previous step and the magnitude of the gradient has increased and is the same sign as the previous step:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="automatically-generating-stage-descriptions.html#cb21-1" aria-hidden="true" tabindex="-1"></a>trj <span class="ot">=</span> trj <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="automatically-generating-stage-descriptions.html#cb21-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">tightens =</span> <span class="sc">!</span>firstish <span class="sc">&amp;</span> significant <span class="sc">&amp;</span> <span class="fu">lead</span>(nearby) <span class="sc">&amp;</span></span>
<span id="cb21-3"><a href="automatically-generating-stage-descriptions.html#cb21-3" aria-hidden="true" tabindex="-1"></a>                            ((<span class="fu">sign</span>(<span class="fu">lead</span>(step_gradient))<span class="sc">==</span><span class="fu">sign</span>(step_gradient)) <span class="sc">&amp;</span> (<span class="fu">abs</span>(<span class="fu">lead</span>(stepangle)) <span class="sc">&gt;</span> <span class="fu">abs</span>(step_gradient))))</span>
<span id="cb21-4"><a href="automatically-generating-stage-descriptions.html#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="automatically-generating-stage-descriptions.html#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="automatically-generating-stage-descriptions.html#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>trj[zoom1, ],</span>
<span id="cb21-7"><a href="automatically-generating-stage-descriptions.html#cb21-7" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y)) <span class="sc">+</span> <span class="fu">geom_path</span>(<span class="at">color=</span><span class="st">&#39;grey&#39;</span>) <span class="sc">+</span> <span class="fu">coord_sf</span>() <span class="sc">+</span></span>
<span id="cb21-8"><a href="automatically-generating-stage-descriptions.html#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="at">size=</span><span class="dv">2</span>, <span class="fu">aes</span>(<span class="at">color =</span> tightens,</span>
<span id="cb21-9"><a href="automatically-generating-stage-descriptions.html#cb21-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">shape =</span> firstish)) <span class="sc">+</span></span>
<span id="cb21-10"><a href="automatically-generating-stage-descriptions.html#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>))</span></code></pre></div>
<p><img src="images/stage-description-sd-tightens-1.png" width="672" />
The corner <em>opens</em> (“lessens”) if a node isn’t firstish, is above a certain gradient, is close to the previous step and the gradient is in the same direction and has decreased:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="automatically-generating-stage-descriptions.html#cb22-1" aria-hidden="true" tabindex="-1"></a>trj <span class="ot">=</span> trj <span class="sc">%&gt;%</span> </span>
<span id="cb22-2"><a href="automatically-generating-stage-descriptions.html#cb22-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">opens =</span> <span class="sc">!</span>firstish <span class="sc">&amp;</span> significant <span class="sc">&amp;</span> <span class="fu">lead</span>(nearby) <span class="sc">&amp;</span></span>
<span id="cb22-3"><a href="automatically-generating-stage-descriptions.html#cb22-3" aria-hidden="true" tabindex="-1"></a>                            ((<span class="fu">sign</span>(<span class="fu">lead</span>(step_gradient))<span class="sc">==</span><span class="fu">sign</span>(step_gradient)) <span class="sc">&amp;</span> (<span class="fu">abs</span>(<span class="fu">lead</span>(stepangle)) <span class="sc">&lt;</span> <span class="fu">abs</span>(step_gradient))))</span>
<span id="cb22-4"><a href="automatically-generating-stage-descriptions.html#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="automatically-generating-stage-descriptions.html#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="automatically-generating-stage-descriptions.html#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>trj[zoom1, ],</span>
<span id="cb22-7"><a href="automatically-generating-stage-descriptions.html#cb22-7" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y)) <span class="sc">+</span> <span class="fu">geom_path</span>(<span class="at">color=</span><span class="st">&#39;grey&#39;</span>) <span class="sc">+</span> <span class="fu">coord_sf</span>() <span class="sc">+</span></span>
<span id="cb22-8"><a href="automatically-generating-stage-descriptions.html#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="at">size=</span><span class="dv">2</span>, <span class="fu">aes</span>(<span class="at">color =</span> opens,</span>
<span id="cb22-9"><a href="automatically-generating-stage-descriptions.html#cb22-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">shape =</span> firstish)) <span class="sc">+</span></span>
<span id="cb22-10"><a href="automatically-generating-stage-descriptions.html#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>))</span></code></pre></div>
<p><img src="images/stage-description-sd-opens-1.png" width="672" /></p>
<p>We might also try for “continues” if the angle is about the same gradient but not tightening.</p>
</div>
<div id="identifying-straights" class="section level2" number="20.5">
<h2><span class="header-section-number">20.5</span> Identifying Straights</h2>
<p>One of the important considerations when assessing a stage is identifying the fast areas of the stage represented by significant straights. So how can we identify a straight?</p>
<p>One way might be to define a simple rule that identifies a straight as a sequence of <code>straightish</code> segments that appear between segments that are not <code>straightish</code>.</p>
<p>We can create such groupings by flagging the presence of the <em>start</em> of a potential run of straightish segments. We can then number each start and propagate this run number down the following segments until the next straight segment is reached. We can then number all non-straighish elements with a “not straight” count number (e.g. <em>-1</em>).</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="automatically-generating-stage-descriptions.html#cb23-1" aria-hidden="true" tabindex="-1"></a>trj <span class="ot">=</span> trj <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">startStraight =</span> <span class="fu">lag</span>(<span class="sc">!</span>straightish, <span class="at">default=</span><span class="cn">TRUE</span>) <span class="sc">&amp;</span> straightish) <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="automatically-generating-stage-descriptions.html#cb23-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">strcount =</span> <span class="fu">cumsum</span>(startStraight))</span>
<span id="cb23-3"><a href="automatically-generating-stage-descriptions.html#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="automatically-generating-stage-descriptions.html#cb23-4" aria-hidden="true" tabindex="-1"></a>trj<span class="sc">$</span>strcount[<span class="sc">!</span>trj<span class="sc">$</span>straightish] <span class="ot">=</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb23-5"><a href="automatically-generating-stage-descriptions.html#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="automatically-generating-stage-descriptions.html#cb23-6" aria-hidden="true" tabindex="-1"></a>trj[, <span class="fu">c</span>(<span class="st">&#39;straightish&#39;</span>, <span class="st">&#39;startStraight&#39;</span>, <span class="st">&#39;strcount&#39;</span>, <span class="st">&#39;distance&#39;</span>)]</span></code></pre></div>
<pre><code>##     straightish startStraight strcount   distance
## 1          TRUE          TRUE        1   0.000000
## 2         FALSE         FALSE       -1  22.576096
## 3         FALSE         FALSE       -1  27.939693
## 4         FALSE         FALSE       -1  21.006147
## 5         FALSE         FALSE       -1  20.385688
## 6          TRUE          TRUE        2  21.776253
## 7         FALSE         FALSE       -1  39.225069
## 8          TRUE          TRUE        3  28.173437
## 9          TRUE         FALSE        3 176.799671
## 10        FALSE         FALSE       -1  34.213905
## 11        FALSE         FALSE       -1  33.435610
## 12        FALSE         FALSE       -1  33.180079
## 13         TRUE          TRUE        4  32.988458
## 14        FALSE         FALSE       -1  32.653388
## 15        FALSE         FALSE       -1  30.955250
## 16         TRUE          TRUE        5  52.133335
## 17         TRUE         FALSE        5 254.411703
## 18        FALSE         FALSE       -1  41.724705
## 19        FALSE         FALSE       -1  89.520784
## 20        FALSE         FALSE       -1  15.962401
## 21        FALSE         FALSE       -1  16.560182
## 22        FALSE         FALSE       -1  18.258302
## 23         TRUE          TRUE        6  85.379552
## 24         TRUE         FALSE        6  32.448662
## 25         TRUE         FALSE        6  51.783361
## 26        FALSE         FALSE       -1 102.162288
## 27        FALSE         FALSE       -1  29.056251
## 28         TRUE          TRUE        7  30.779766
## 29        FALSE         FALSE       -1  74.149638
## 30         TRUE          TRUE        8  30.943330
## 31         TRUE         FALSE        8  85.171697
## 32        FALSE         FALSE       -1  51.410943
## 33         TRUE          TRUE        9  65.299139
## 34        FALSE         FALSE       -1  33.110534
## 35        FALSE         FALSE       -1  34.904722
## 36         TRUE          TRUE       10  62.641285
## 37         TRUE         FALSE       10  79.381427
## 38         TRUE         FALSE       10  50.463921
## 39        FALSE         FALSE       -1  45.234343
## 40         TRUE          TRUE       11  24.320789
## 41        FALSE         FALSE       -1  28.123378
## 42         TRUE          TRUE       12  29.680685
## 43        FALSE         FALSE       -1  62.350861
## 44        FALSE         FALSE       -1   8.561852
## 45        FALSE         FALSE       -1  19.176687
## 46        FALSE         FALSE       -1  51.746203
## 47        FALSE         FALSE       -1   9.929782
## 48        FALSE         FALSE       -1  25.986880
## 49         TRUE          TRUE       13  24.790260
## 50         TRUE         FALSE       13 200.394033
## 51         TRUE         FALSE       13  79.003846
## 52         TRUE         FALSE       13 101.740035
## 53         TRUE         FALSE       13  51.526089
## 54        FALSE         FALSE       -1  78.114767
## 55         TRUE          TRUE       14  25.987677
## 56        FALSE         FALSE       -1  28.443655
## 57         TRUE          TRUE       15  30.354745
## 58        FALSE         FALSE       -1  45.272690
## 59         TRUE          TRUE       16  30.072585
## 60        FALSE         FALSE       -1 118.383431
## 61         TRUE          TRUE       17  18.073097
## 62        FALSE         FALSE       -1  57.463884
## 63         TRUE          TRUE       18  22.527126
## 64        FALSE         FALSE       -1  71.698716
## 65         TRUE          TRUE       19  19.073636
## 66         TRUE         FALSE       19  33.669783
## 67         TRUE         FALSE       19 100.195791
## 68         TRUE         FALSE       19  54.629746
## 69         TRUE         FALSE       19  81.943726
## 70         TRUE         FALSE       19  82.769644
## 71         TRUE         FALSE       19  88.612474
## 72         TRUE         FALSE       19  64.939488
## 73         TRUE         FALSE       19  58.082143
## 74         TRUE         FALSE       19  31.622830
## 75         TRUE         FALSE       19  44.266782
## 76        FALSE         FALSE       -1  32.481888
## 77         TRUE          TRUE       20  35.795692
## 78         TRUE         FALSE       20  93.700955
## 79         TRUE         FALSE       20  74.648418
## 80         TRUE         FALSE       20  87.518624
## 81         TRUE         FALSE       20  39.425264
## 82        FALSE         FALSE       -1  34.453996
## 83         TRUE          TRUE       21  22.856731
## 84         TRUE         FALSE       21 155.837831
## 85         TRUE         FALSE       21  59.493071
## 86         TRUE         FALSE       21  54.692563
## 87        FALSE         FALSE       -1  41.676102
## 88         TRUE          TRUE       22  20.134693
## 89        FALSE         FALSE       -1  42.504888
## 90        FALSE         FALSE       -1  10.319788
## 91        FALSE         FALSE       -1  10.082093
## 92        FALSE         FALSE       -1  19.947176
## 93        FALSE         FALSE       -1  16.696573
## 94         TRUE          TRUE       23  15.147739
## 95        FALSE         FALSE       -1  36.072187
## 96         TRUE          TRUE       24  30.108972
## 97        FALSE         FALSE       -1  66.401404
## 98        FALSE         FALSE       -1  31.078879
## 99         TRUE          TRUE       25  32.097088
## 100        TRUE         FALSE       25  70.861823
## 101        TRUE         FALSE       25  78.076153
## 102        TRUE         FALSE       25 107.148370
## 103        TRUE         FALSE       25  30.689626
## 104       FALSE         FALSE       -1  37.068369
## 105       FALSE         FALSE       -1  23.433769
## 106       FALSE         FALSE       -1  35.736928
## 107        TRUE          TRUE       26  10.809889
## 108       FALSE         FALSE       -1  41.278750
## 109       FALSE         FALSE       -1  21.243105
## 110        TRUE          TRUE       27  25.242190
## 111        TRUE         FALSE       27  48.187023
## 112        TRUE         FALSE       27  66.565053
## 113        TRUE         FALSE       27 110.173299
## 114        TRUE         FALSE       27  99.330798
## 115       FALSE         FALSE       -1  29.736978
## 116        TRUE          TRUE       28  43.479484
## 117        TRUE         FALSE       28  37.302236
## 118       FALSE         FALSE       -1  52.131224
## 119       FALSE         FALSE       -1  54.558722
## 120       FALSE         FALSE       -1  22.235672
## 121        TRUE          TRUE       29  22.448675
## 122        TRUE         FALSE       29  89.531050
## 123       FALSE         FALSE       -1 112.844215
## 124       FALSE         FALSE       -1  28.208403
## 125        TRUE          TRUE       30  29.689502
## 126        TRUE         FALSE       30  64.716386
## 127        TRUE         FALSE       30  47.552609
## 128       FALSE         FALSE       -1  40.762039
## 129       FALSE         FALSE       -1  24.293957
## 130       FALSE         FALSE       -1  55.480416
## 131        TRUE          TRUE       31  18.609341
## 132       FALSE         FALSE       -1  57.742931
## 133       FALSE         FALSE       -1  17.900876
## 134       FALSE         FALSE       -1  24.657085
## 135       FALSE         FALSE       -1   3.910547
## 136       FALSE         FALSE       -1   6.281999
## 137       FALSE         FALSE       -1  22.208888
## 138       FALSE         FALSE       -1  56.046544
## 139        TRUE          TRUE       32  18.390054
## 140        TRUE         FALSE       32 111.373808
## 141        TRUE         FALSE       32 125.767864
## 142        TRUE         FALSE       32  66.618897
## 143       FALSE         FALSE       -1  29.975148
## 144       FALSE         FALSE       -1  28.384868
## 145       FALSE         FALSE       -1  40.239085
## 146       FALSE         FALSE       -1  13.838288
## 147       FALSE         FALSE       -1  15.598591
## 148       FALSE         FALSE       -1  46.091581
## 149       FALSE         FALSE       -1  23.500236
## 150        TRUE          TRUE       33  24.854582
## 151        TRUE         FALSE       33  42.943277
## 152        TRUE         FALSE       33  59.516315
## 153       FALSE         FALSE       -1  27.085080
## 154       FALSE         FALSE       -1  86.155677
## 155       FALSE         FALSE       -1  13.499961
## 156       FALSE         FALSE       -1   6.781840
## 157        TRUE          TRUE       34  17.789179
## 158        TRUE         FALSE       34  68.720036
## 159        TRUE         FALSE       34  46.517087
## 160        TRUE         FALSE       34  84.947862
## 161        TRUE         FALSE       34 134.380640
## 162        TRUE         FALSE       34 170.177457
## 163       FALSE         FALSE       -1  88.585179
## 164       FALSE         FALSE       -1  17.936243
## 165       FALSE         FALSE       -1  21.604093
## 166       FALSE         FALSE       -1  39.653677
## 167       FALSE         FALSE       -1  27.667933
## 168       FALSE         FALSE       -1  79.679163
## 169       FALSE         FALSE       -1  13.988367
## 170       FALSE         FALSE       -1  13.865176
## 171       FALSE         FALSE       -1  22.728199
## 172       FALSE         FALSE       -1  20.813460
## 173       FALSE         FALSE       -1   8.714071
## 174       FALSE         FALSE       -1  10.860020
## 175       FALSE         FALSE       -1  25.095519
## 176       FALSE         FALSE       -1  18.796776
## 177        TRUE          TRUE       35  18.592286
## 178       FALSE         FALSE       -1  73.171879
## 179        TRUE          TRUE       36  18.603466
## 180        TRUE         FALSE       36  95.265566
## 181       FALSE         FALSE       -1  50.723320
## 182       FALSE         FALSE       -1  20.362347
## 183        TRUE          TRUE       37  46.707566
## 184       FALSE         FALSE       -1  26.893695
## 185       FALSE         FALSE       -1  62.138755
## 186       FALSE         FALSE       -1  15.898919
## 187       FALSE         FALSE       -1  15.380670
## 188       FALSE         FALSE       -1   8.399971
## 189        TRUE          TRUE       38  19.153761
## 190        TRUE         FALSE       38  32.612671
## 191        TRUE         FALSE       38  69.641579
## 192       FALSE         FALSE       -1  77.022940
## 193       FALSE         FALSE       -1  17.922554
## 194       FALSE         FALSE       -1  17.353440
## 195        TRUE          TRUE       39  17.998275
## 196        TRUE         FALSE       39  31.483513
## 197       FALSE         FALSE       -1  30.179470
## 198       FALSE         FALSE       -1   8.963272
## 199        TRUE          TRUE       40  19.384632
## 200       FALSE         FALSE       -1  39.132116
## 201        TRUE          TRUE       41  48.257443
## 202        TRUE         FALSE       41  32.451880
## 203       FALSE         FALSE       -1  80.460236
## 204        TRUE          TRUE       42  28.347748
## 205        TRUE         FALSE       42  46.430039
## 206        TRUE         FALSE       42  43.567374
## 207        TRUE         FALSE       42  46.393037
## 208       FALSE         FALSE       -1  25.224961
## 209       FALSE         FALSE       -1  43.088705
## 210       FALSE         FALSE       -1  31.923523
## 211       FALSE         FALSE       -1  10.849289
## 212       FALSE         FALSE       -1  12.114653
## 213        TRUE          TRUE       43  17.572277
## 214       FALSE         FALSE       -1  59.816627
## 215       FALSE         FALSE       -1  33.021708
## 216        TRUE          TRUE       44  18.460152
## 217       FALSE         FALSE       -1  20.971806
## 218       FALSE         FALSE       -1  23.966974
## 219       FALSE         FALSE       -1  23.572275
## 220       FALSE         FALSE       -1  25.137897
## 221       FALSE         FALSE       -1  26.873206
## 222       FALSE         FALSE       -1  24.681305
## 223       FALSE         FALSE       -1  22.047708
## 224       FALSE         FALSE       -1  21.229788
## 225       FALSE         FALSE       -1   9.116143
## 226       FALSE         FALSE       -1  17.934112
## 227       FALSE         FALSE       -1  22.204232
## 228       FALSE         FALSE       -1  24.805501
## 229       FALSE         FALSE       -1  26.569158
## 230        TRUE          TRUE       45  49.681680
## 231        TRUE         FALSE       45  29.486036
## 232       FALSE         FALSE       -1  43.292373
## 233       FALSE         FALSE       -1  25.696007
## 234       FALSE         FALSE       -1   6.012008
## 235        TRUE          TRUE       46  13.917710
## 236       FALSE         FALSE       -1  27.871234
## 237       FALSE         FALSE       -1  46.206343
## 238       FALSE         FALSE       -1  20.573803
## 239       FALSE         FALSE       -1  22.761959
## 240       FALSE         FALSE       -1  25.593368
## 241       FALSE         FALSE       -1   5.734797
## 242       FALSE         FALSE       -1   5.551412
## 243       FALSE         FALSE       -1  14.287284
## 244       FALSE         FALSE       -1  44.592234
## 245       FALSE         FALSE       -1  26.502139
## 246       FALSE         FALSE       -1  47.573393
## 247       FALSE         FALSE       -1  31.386847
## 248       FALSE         FALSE       -1  19.538209
## 249        TRUE          TRUE       47  36.943922
## 250        TRUE         FALSE       47  88.755110
##  [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 169 rows ]</code></pre>
<p>Having identified straights, we realise that what we are actually interested in are <em>long</em> straights. The length of each straight can be found by grouping segments by straight number and summing the distances of segments within each group:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="automatically-generating-stage-descriptions.html#cb25-1" aria-hidden="true" tabindex="-1"></a>straight_lengths <span class="ot">=</span> trj <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="automatically-generating-stage-descriptions.html#cb25-2" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># We only want straightish segments...</span></span>
<span id="cb25-3"><a href="automatically-generating-stage-descriptions.html#cb25-3" aria-hidden="true" tabindex="-1"></a>                        dplyr<span class="sc">::</span><span class="fu">filter</span>(strcount<span class="sc">&gt;=</span><span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-4"><a href="automatically-generating-stage-descriptions.html#cb25-4" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># Group by straight number</span></span>
<span id="cb25-5"><a href="automatically-generating-stage-descriptions.html#cb25-5" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">group_by</span>(strcount)  <span class="sc">%&gt;%</span></span>
<span id="cb25-6"><a href="automatically-generating-stage-descriptions.html#cb25-6" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># Find the length of each straight</span></span>
<span id="cb25-7"><a href="automatically-generating-stage-descriptions.html#cb25-7" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">summarize</span>(<span class="at">strdistance =</span> <span class="fu">sum</span>(distance))</span>
<span id="cb25-8"><a href="automatically-generating-stage-descriptions.html#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="automatically-generating-stage-descriptions.html#cb25-9" aria-hidden="true" tabindex="-1"></a>straight_lengths</span></code></pre></div>
<pre><code>## # A tibble: 77 x 2
##    strcount strdistance
##  *    &lt;dbl&gt;       &lt;dbl&gt;
##  1        1         0  
##  2        2        21.8
##  3        3       205. 
##  4        4        33.0
##  5        5       307. 
##  6        6       170. 
##  7        7        30.8
##  8        8       116. 
##  9        9        65.3
## 10       10       192. 
## # … with 67 more rows</code></pre>
<p>Let’s now filter our long straights, eg straights at least 200m long</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="automatically-generating-stage-descriptions.html#cb27-1" aria-hidden="true" tabindex="-1"></a>longstraights <span class="ot">=</span> straight_lengths <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="automatically-generating-stage-descriptions.html#cb27-2" aria-hidden="true" tabindex="-1"></a>                        dplyr<span class="sc">::</span><span class="fu">filter</span>(strdistance<span class="sc">&gt;=</span><span class="dv">200</span>)</span>
<span id="cb27-3"><a href="automatically-generating-stage-descriptions.html#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="automatically-generating-stage-descriptions.html#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(longstraights, <span class="at">n=</span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   strcount strdistance
##      &lt;dbl&gt;       &lt;dbl&gt;
## 1        3        205.
## 2        5        307.
## 3       13        457.</code></pre>
<p>Let’s see how those look:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="automatically-generating-stage-descriptions.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>trj,</span>
<span id="cb29-2"><a href="automatically-generating-stage-descriptions.html#cb29-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y)) <span class="sc">+</span> <span class="fu">geom_path</span>(<span class="at">color=</span><span class="st">&#39;grey&#39;</span>) <span class="sc">+</span> <span class="fu">coord_sf</span>() <span class="sc">+</span></span>
<span id="cb29-3"><a href="automatically-generating-stage-descriptions.html#cb29-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_point</span>(<span class="at">data=</span>trj[(trj<span class="sc">$</span>startStraight) <span class="sc">&amp;</span> </span>
<span id="cb29-4"><a href="automatically-generating-stage-descriptions.html#cb29-4" aria-hidden="true" tabindex="-1"></a>                           (trj<span class="sc">$</span>strcount <span class="sc">%in%</span> longstraights<span class="sc">$</span>strcount),],</span>
<span id="cb29-5"><a href="automatically-generating-stage-descriptions.html#cb29-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">color=</span><span class="st">&#39;black&#39;</span>, <span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb29-6"><a href="automatically-generating-stage-descriptions.html#cb29-6" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_point</span>(<span class="at">data=</span>trj[(<span class="sc">!</span>trj<span class="sc">$</span>startStraight) <span class="sc">&amp;</span> </span>
<span id="cb29-7"><a href="automatically-generating-stage-descriptions.html#cb29-7" aria-hidden="true" tabindex="-1"></a>                           (trj<span class="sc">$</span>strcount <span class="sc">%in%</span> longstraights<span class="sc">$</span>strcount),],</span>
<span id="cb29-8"><a href="automatically-generating-stage-descriptions.html#cb29-8" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">color=</span><span class="st">&#39;darkgrey&#39;</span>, <span class="at">size=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb29-9"><a href="automatically-generating-stage-descriptions.html#cb29-9" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_point</span>(<span class="at">data=</span>trj[(trj<span class="sc">$</span>firstish),],</span>
<span id="cb29-10"><a href="automatically-generating-stage-descriptions.html#cb29-10" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">color=</span><span class="st">&#39;pink&#39;</span>, <span class="at">size=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb29-11"><a href="automatically-generating-stage-descriptions.html#cb29-11" aria-hidden="true" tabindex="-1"></a>       <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb29-12"><a href="automatically-generating-stage-descriptions.html#cb29-12" aria-hidden="true" tabindex="-1"></a>       <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>)) </span></code></pre></div>
<p><img src="images/stage-description-long_straights-1.png" width="672" /></p>
</div>
<div id="plotting-trajectory-segments" class="section level2" number="20.6">
<h2><span class="header-section-number">20.6</span> Plotting Trajectory Segments</h2>
<p>It will be convenient to be able ot plot segments of a trajectory for particular stretches of a route, so let’s create a function that helps us do that:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="automatically-generating-stage-descriptions.html#cb30-1" aria-hidden="true" tabindex="-1"></a>trj_segment_plot <span class="ot">=</span> <span class="cf">function</span>(trj, start, end,</span>
<span id="cb30-2"><a href="automatically-generating-stage-descriptions.html#cb30-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">x=</span><span class="st">&#39;x&#39;</span>, <span class="at">y=</span><span class="st">&#39;y&#39;</span>,</span>
<span id="cb30-3"><a href="automatically-generating-stage-descriptions.html#cb30-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">title=</span><span class="st">&#39;&#39;</span>, <span class="at">fix_coords=</span><span class="cn">TRUE</span>,</span>
<span id="cb30-4"><a href="automatically-generating-stage-descriptions.html#cb30-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">rotate=</span><span class="cn">NULL</span>,</span>
<span id="cb30-5"><a href="automatically-generating-stage-descriptions.html#cb30-5" aria-hidden="true" tabindex="-1"></a>                            <span class="at">gradients=</span><span class="dv">0</span>, <span class="at">gradient_size=</span><span class="dv">2</span>) {</span>
<span id="cb30-6"><a href="automatically-generating-stage-descriptions.html#cb30-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-7"><a href="automatically-generating-stage-descriptions.html#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the route distance filter limits</span></span>
<span id="cb30-8"><a href="automatically-generating-stage-descriptions.html#cb30-8" aria-hidden="true" tabindex="-1"></a>  segment_filter <span class="ot">=</span> trj<span class="sc">$</span>cum_dist <span class="sc">&gt;=</span> start <span class="sc">&amp;</span></span>
<span id="cb30-9"><a href="automatically-generating-stage-descriptions.html#cb30-9" aria-hidden="true" tabindex="-1"></a>                    trj<span class="sc">$</span>cum_dist <span class="sc">&lt;=</span> end</span>
<span id="cb30-10"><a href="automatically-generating-stage-descriptions.html#cb30-10" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb30-11"><a href="automatically-generating-stage-descriptions.html#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter the route</span></span>
<span id="cb30-12"><a href="automatically-generating-stage-descriptions.html#cb30-12" aria-hidden="true" tabindex="-1"></a>  route_segment <span class="ot">=</span> trj[segment_filter,]</span>
<span id="cb30-13"><a href="automatically-generating-stage-descriptions.html#cb30-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-14"><a href="automatically-generating-stage-descriptions.html#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(rotate))</span>
<span id="cb30-15"><a href="automatically-generating-stage-descriptions.html#cb30-15" aria-hidden="true" tabindex="-1"></a>    route_segment <span class="ot">=</span> <span class="fu">TrajRotate</span>(route_segment,</span>
<span id="cb30-16"><a href="automatically-generating-stage-descriptions.html#cb30-16" aria-hidden="true" tabindex="-1"></a>                               <span class="at">angle =</span> rotate,</span>
<span id="cb30-17"><a href="automatically-generating-stage-descriptions.html#cb30-17" aria-hidden="true" tabindex="-1"></a>                               <span class="at">relative =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-18"><a href="automatically-generating-stage-descriptions.html#cb30-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-19"><a href="automatically-generating-stage-descriptions.html#cb30-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate the stylised route plot</span></span>
<span id="cb30-20"><a href="automatically-generating-stage-descriptions.html#cb30-20" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">=</span> <span class="fu">ggplot</span>(route_segment) <span class="sc">+</span></span>
<span id="cb30-21"><a href="automatically-generating-stage-descriptions.html#cb30-21" aria-hidden="true" tabindex="-1"></a>             <span class="fu">geom_path</span>(<span class="fu">aes_string</span>(<span class="at">x=</span>x, <span class="at">y=</span>y)) <span class="sc">+</span></span>
<span id="cb30-22"><a href="automatically-generating-stage-descriptions.html#cb30-22" aria-hidden="true" tabindex="-1"></a>             <span class="co"># Add a marker to show the start of the segment</span></span>
<span id="cb30-23"><a href="automatically-generating-stage-descriptions.html#cb30-23" aria-hidden="true" tabindex="-1"></a>             <span class="fu">geom_point</span>(<span class="at">data=</span><span class="fu">head</span>(route_segment,<span class="at">n=</span><span class="dv">1</span>),</span>
<span id="cb30-24"><a href="automatically-generating-stage-descriptions.html#cb30-24" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">aes_string</span>(<span class="at">x=</span>x, <span class="at">y=</span>y)) <span class="sc">+</span></span>
<span id="cb30-25"><a href="automatically-generating-stage-descriptions.html#cb30-25" aria-hidden="true" tabindex="-1"></a>             <span class="fu">theme_void</span>()</span>
<span id="cb30-26"><a href="automatically-generating-stage-descriptions.html#cb30-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-27"><a href="automatically-generating-stage-descriptions.html#cb30-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add a title</span></span>
<span id="cb30-28"><a href="automatically-generating-stage-descriptions.html#cb30-28" aria-hidden="true" tabindex="-1"></a>  title<span class="ot">=</span><span class="fu">as.character</span>(title)</span>
<span id="cb30-29"><a href="automatically-generating-stage-descriptions.html#cb30-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">startsWith</span>(title,<span class="st">&#39;auto::&#39;</span>)) {</span>
<span id="cb30-30"><a href="automatically-generating-stage-descriptions.html#cb30-30" aria-hidden="true" tabindex="-1"></a>    title <span class="ot">=</span> stringr<span class="sc">::</span><span class="fu">str_split</span>(title,<span class="st">&#39;::&#39;</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>]</span>
<span id="cb30-31"><a href="automatically-generating-stage-descriptions.html#cb30-31" aria-hidden="true" tabindex="-1"></a>    title_ <span class="ot">=</span> <span class="fu">paste0</span>(start<span class="sc">/</span><span class="dv">1000</span>, <span class="st">&#39;-&#39;</span>, end<span class="sc">/</span><span class="dv">1000</span>, <span class="st">&#39;km&#39;</span>)</span>
<span id="cb30-32"><a href="automatically-generating-stage-descriptions.html#cb30-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (title<span class="sc">!=</span><span class="st">&#39;&#39;</span>)</span>
<span id="cb30-33"><a href="automatically-generating-stage-descriptions.html#cb30-33" aria-hidden="true" tabindex="-1"></a>      title <span class="ot">=</span> <span class="fu">paste</span>(title, title_)</span>
<span id="cb30-34"><a href="automatically-generating-stage-descriptions.html#cb30-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb30-35"><a href="automatically-generating-stage-descriptions.html#cb30-35" aria-hidden="true" tabindex="-1"></a>      title <span class="ot">=</span> title_</span>
<span id="cb30-36"><a href="automatically-generating-stage-descriptions.html#cb30-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-37"><a href="automatically-generating-stage-descriptions.html#cb30-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-38"><a href="automatically-generating-stage-descriptions.html#cb30-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (title<span class="sc">!=</span><span class="st">&#39;&#39;</span>)</span>
<span id="cb30-39"><a href="automatically-generating-stage-descriptions.html#cb30-39" aria-hidden="true" tabindex="-1"></a>    g <span class="ot">=</span> g <span class="sc">+</span> <span class="fu">ggtitle</span>(title)</span>
<span id="cb30-40"><a href="automatically-generating-stage-descriptions.html#cb30-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-41"><a href="automatically-generating-stage-descriptions.html#cb30-41" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (fix_coords)</span>
<span id="cb30-42"><a href="automatically-generating-stage-descriptions.html#cb30-42" aria-hidden="true" tabindex="-1"></a>    g <span class="ot">=</span> g <span class="sc">+</span> <span class="fu">coord_fixed</span>()</span>
<span id="cb30-43"><a href="automatically-generating-stage-descriptions.html#cb30-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-44"><a href="automatically-generating-stage-descriptions.html#cb30-44" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (gradients)</span>
<span id="cb30-45"><a href="automatically-generating-stage-descriptions.html#cb30-45" aria-hidden="true" tabindex="-1"></a>    g <span class="ot">=</span> g<span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes_string</span>(<span class="at">x=</span>x, <span class="at">y=</span>y),</span>
<span id="cb30-46"><a href="automatically-generating-stage-descriptions.html#cb30-46" aria-hidden="true" tabindex="-1"></a>                      <span class="at">size=</span>gradient_size, <span class="at">color=</span><span class="st">&#39;blue&#39;</span>,</span>
<span id="cb30-47"><a href="automatically-generating-stage-descriptions.html#cb30-47" aria-hidden="true" tabindex="-1"></a>             <span class="at">data=</span>route_segment[route_segment<span class="sc">$</span>step_gradient<span class="sc">&gt;</span>gradients,]) <span class="sc">+</span></span>
<span id="cb30-48"><a href="automatically-generating-stage-descriptions.html#cb30-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes_string</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">size=</span>gradient_size,</span>
<span id="cb30-49"><a href="automatically-generating-stage-descriptions.html#cb30-49" aria-hidden="true" tabindex="-1"></a>               <span class="at">data=</span>route_segment[route_segment<span class="sc">$</span>step_gradient<span class="sc">&lt;=-</span>gradients,],</span>
<span id="cb30-50"><a href="automatically-generating-stage-descriptions.html#cb30-50" aria-hidden="true" tabindex="-1"></a>               <span class="at">color=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb30-51"><a href="automatically-generating-stage-descriptions.html#cb30-51" aria-hidden="true" tabindex="-1"></a>  g</span>
<span id="cb30-52"><a href="automatically-generating-stage-descriptions.html#cb30-52" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We can then plot a trajectory as follows, optionally rotatint the segment to a horizontal left-right orientation:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="automatically-generating-stage-descriptions.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show a specified segment</span></span>
<span id="cb31-2"><a href="automatically-generating-stage-descriptions.html#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">trj_segment_plot</span>(trj, <span class="dv">9000</span>, <span class="dv">12500</span>, <span class="at">title=</span><span class="st">&#39;auto::SS1&#39;</span>, <span class="at">rotate=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="images/stage-description-trj_segment_plot-1.png" width="672" /></p>
<div id="segmenting-the-route" class="section level3" number="20.6.1">
<h3><span class="header-section-number">20.6.1</span> Segmenting the Route</h3>
<p>We can automate the production of a single chart that will display the route a section at a time. This requires segmenting the route, then for each segment, generating the plot, which we add to a list of plots.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="automatically-generating-stage-descriptions.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The final section goes to the end of the route</span></span>
<span id="cb32-2"><a href="automatically-generating-stage-descriptions.html#cb32-2" aria-hidden="true" tabindex="-1"></a>trj_segment_multiplot <span class="ot">=</span> <span class="cf">function</span>(trj, i, <span class="at">title=</span><span class="st">&#39;&#39;</span>,</span>
<span id="cb32-3"><a href="automatically-generating-stage-descriptions.html#cb32-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">x=</span><span class="st">&#39;x&#39;</span>, <span class="at">y=</span><span class="st">&#39;y&#39;</span>,</span>
<span id="cb32-4"><a href="automatically-generating-stage-descriptions.html#cb32-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">final=</span><span class="cn">FALSE</span>,</span>
<span id="cb32-5"><a href="automatically-generating-stage-descriptions.html#cb32-5" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">segment_length =</span> <span class="dv">1000</span>,</span>
<span id="cb32-6"><a href="automatically-generating-stage-descriptions.html#cb32-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">prefix_dist =</span> <span class="dv">20</span>,</span>
<span id="cb32-7"><a href="automatically-generating-stage-descriptions.html#cb32-7" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">gradients=</span><span class="dv">0</span>, <span class="at">gradient_size=</span><span class="dv">1</span>,</span>
<span id="cb32-8"><a href="automatically-generating-stage-descriptions.html#cb32-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">fix_coords=</span><span class="cn">FALSE</span>, <span class="at">rotate=</span><span class="cn">NULL</span>){</span>
<span id="cb32-9"><a href="automatically-generating-stage-descriptions.html#cb32-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-10"><a href="automatically-generating-stage-descriptions.html#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Preface the start of the stage with a 20m lead</span></span>
<span id="cb32-11"><a href="automatically-generating-stage-descriptions.html#cb32-11" aria-hidden="true" tabindex="-1"></a>  start_prefix <span class="ot">=</span> prefix_dist</span>
<span id="cb32-12"><a href="automatically-generating-stage-descriptions.html#cb32-12" aria-hidden="true" tabindex="-1"></a>  start <span class="ot">=</span> segment_length<span class="sc">*</span>(i<span class="dv">-1</span>)<span class="sc">-</span>start_prefix</span>
<span id="cb32-13"><a href="automatically-generating-stage-descriptions.html#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (final) </span>
<span id="cb32-14"><a href="automatically-generating-stage-descriptions.html#cb32-14" aria-hidden="true" tabindex="-1"></a>    end <span class="ot">=</span> <span class="cn">Inf</span></span>
<span id="cb32-15"><a href="automatically-generating-stage-descriptions.html#cb32-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span></span>
<span id="cb32-16"><a href="automatically-generating-stage-descriptions.html#cb32-16" aria-hidden="true" tabindex="-1"></a>    end <span class="ot">=</span> (segment_length<span class="sc">*</span>i)</span>
<span id="cb32-17"><a href="automatically-generating-stage-descriptions.html#cb32-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-18"><a href="automatically-generating-stage-descriptions.html#cb32-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">trj_segment_plot</span>(trj, start, end,  <span class="at">x=</span>x, <span class="at">y=</span>y,</span>
<span id="cb32-19"><a href="automatically-generating-stage-descriptions.html#cb32-19" aria-hidden="true" tabindex="-1"></a>                   <span class="at">title=</span>title,</span>
<span id="cb32-20"><a href="automatically-generating-stage-descriptions.html#cb32-20" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fix_coords=</span>fix_coords,</span>
<span id="cb32-21"><a href="automatically-generating-stage-descriptions.html#cb32-21" aria-hidden="true" tabindex="-1"></a>                   <span class="at">rotate=</span>rotate,</span>
<span id="cb32-22"><a href="automatically-generating-stage-descriptions.html#cb32-22" aria-hidden="true" tabindex="-1"></a>                   <span class="at">gradients=</span>gradients, <span class="at">gradient_size=</span>gradient_size)</span>
<span id="cb32-23"><a href="automatically-generating-stage-descriptions.html#cb32-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-24"><a href="automatically-generating-stage-descriptions.html#cb32-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-25"><a href="automatically-generating-stage-descriptions.html#cb32-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a list to hold each plot as a separate item</span></span>
<span id="cb32-26"><a href="automatically-generating-stage-descriptions.html#cb32-26" aria-hidden="true" tabindex="-1"></a>trj_segment_plots <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb32-27"><a href="automatically-generating-stage-descriptions.html#cb32-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-28"><a href="automatically-generating-stage-descriptions.html#cb32-28" aria-hidden="true" tabindex="-1"></a><span class="co"># How many kilometers does the route extend over?</span></span>
<span id="cb32-29"><a href="automatically-generating-stage-descriptions.html#cb32-29" aria-hidden="true" tabindex="-1"></a>length_1km <span class="ot">=</span> <span class="dv">1000</span></span>
<span id="cb32-30"><a href="automatically-generating-stage-descriptions.html#cb32-30" aria-hidden="true" tabindex="-1"></a>kms <span class="ot">=</span> <span class="fu">floor</span>(<span class="fu">max</span>(trj<span class="sc">$</span>cum_dist)<span class="sc">/</span>length_1km)</span>
<span id="cb32-31"><a href="automatically-generating-stage-descriptions.html#cb32-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-32"><a href="automatically-generating-stage-descriptions.html#cb32-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate through each kilometer</span></span>
<span id="cb32-33"><a href="automatically-generating-stage-descriptions.html#cb32-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>kms){</span>
<span id="cb32-34"><a href="automatically-generating-stage-descriptions.html#cb32-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add each plot to the plot list</span></span>
<span id="cb32-35"><a href="automatically-generating-stage-descriptions.html#cb32-35" aria-hidden="true" tabindex="-1"></a>  trj_segment_plots[[<span class="fu">length</span>(trj_segment_plots) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span></span>
<span id="cb32-36"><a href="automatically-generating-stage-descriptions.html#cb32-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">trj_segment_multiplot</span>(trj, i,</span>
<span id="cb32-37"><a href="automatically-generating-stage-descriptions.html#cb32-37" aria-hidden="true" tabindex="-1"></a>                            <span class="at">title=</span>i, <span class="at">final=</span>(i<span class="sc">==</span>kms),</span>
<span id="cb32-38"><a href="automatically-generating-stage-descriptions.html#cb32-38" aria-hidden="true" tabindex="-1"></a>                            <span class="at">fix_coords=</span><span class="cn">TRUE</span>, <span class="at">rotate=</span><span class="dv">0</span>,</span>
<span id="cb32-39"><a href="automatically-generating-stage-descriptions.html#cb32-39" aria-hidden="true" tabindex="-1"></a>                            <span class="at">gradients=</span><span class="fl">0.2</span>, <span class="at">gradient_size=</span><span class="dv">1</span>)</span>
<span id="cb32-40"><a href="automatically-generating-stage-descriptions.html#cb32-40" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We can use the <code>ggpubr::ggarrange()</code> function to plot the list of individual plots as a single image:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="automatically-generating-stage-descriptions.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb33-2"><a href="automatically-generating-stage-descriptions.html#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="automatically-generating-stage-descriptions.html#cb33-3" aria-hidden="true" tabindex="-1"></a>gg <span class="ot">=</span> <span class="fu">ggarrange</span>(<span class="at">plotlist=</span>trj_segment_plots,</span>
<span id="cb33-4"><a href="automatically-generating-stage-descriptions.html#cb33-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">ncol=</span><span class="dv">5</span>, <span class="at">nrow=</span><span class="fu">ceiling</span>(kms<span class="sc">/</span><span class="dv">4</span>))</span>
<span id="cb33-5"><a href="automatically-generating-stage-descriptions.html#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="automatically-generating-stage-descriptions.html#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">annotate_figure</span>(gg,</span>
<span id="cb33-7"><a href="automatically-generating-stage-descriptions.html#cb33-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">top =</span> <span class="fu">text_grob</span>(utm_routes[<span class="dv">1</span>,]<span class="sc">$</span>Name, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb33-8"><a href="automatically-generating-stage-descriptions.html#cb33-8" aria-hidden="true" tabindex="-1"></a>                               <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">size =</span> <span class="dv">14</span>))</span></code></pre></div>
<p><img src="images/stage-description-trj_1km_arrangement-1.png" width="672" /></p>
</div>
<div id="numbering-corners" class="section level3" number="20.6.2">
<h3><span class="header-section-number">20.6.2</span> Numbering Corners</h3>
<p>To make it easier to refer to corners, can we use the <em>firstish</em> flag as a way of counting corners?</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="automatically-generating-stage-descriptions.html#cb34-1" aria-hidden="true" tabindex="-1"></a>trj_corners <span class="ot">=</span> trj[trj<span class="sc">$</span>firstish,]</span>
<span id="cb34-2"><a href="automatically-generating-stage-descriptions.html#cb34-2" aria-hidden="true" tabindex="-1"></a>trj_corners<span class="sc">$</span>corner_num <span class="ot">=</span> <span class="fu">cumsum</span>(trj_corners<span class="sc">$</span>firstish)</span>
<span id="cb34-3"><a href="automatically-generating-stage-descriptions.html#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="automatically-generating-stage-descriptions.html#cb34-4" aria-hidden="true" tabindex="-1"></a>zoom1_corners <span class="ot">=</span> trj_corners[trj_corners<span class="sc">$</span>y<span class="sc">&gt;</span><span class="dv">4964000</span> <span class="sc">&amp;</span> trj_corners<span class="sc">$</span>y<span class="sc">&lt;</span><span class="dv">4965000</span>,]</span>
<span id="cb34-5"><a href="automatically-generating-stage-descriptions.html#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="automatically-generating-stage-descriptions.html#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>trj[zoom1, ],</span>
<span id="cb34-7"><a href="automatically-generating-stage-descriptions.html#cb34-7" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y)) <span class="sc">+</span> <span class="fu">geom_path</span>(<span class="at">color=</span><span class="st">&#39;grey&#39;</span>) <span class="sc">+</span> <span class="fu">coord_sf</span>() <span class="sc">+</span></span>
<span id="cb34-8"><a href="automatically-generating-stage-descriptions.html#cb34-8" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_text</span>(<span class="at">data=</span> zoom1_corners,</span>
<span id="cb34-9"><a href="automatically-generating-stage-descriptions.html#cb34-9" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y, <span class="at">label=</span>corner_num),</span>
<span id="cb34-10"><a href="automatically-generating-stage-descriptions.html#cb34-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb34-11"><a href="automatically-generating-stage-descriptions.html#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>))</span></code></pre></div>
<p><img src="images/stage-description-sd-numbered-corners-1.png" width="672" /></p>
</div>
</div>
<div id="categorising-corners-using-rlft-convexity" class="section level2" number="20.7">
<h2><span class="header-section-number">20.7</span> Categorising Corners Using <code>rLFT</code> Convexity</h2>
<p>The previous approach works to a certain extent with the limited dataset we tested it against but it feels rather contrived. Generally, just by <em>looking</em> at a curve we get a feel for how tight it is, rather than having to apply all sorts of decision-making rules and logical reasoning. Is there a simple metric we can use?</p>
<p>One approach might be to consider using <em>convexity</em> measure, such as the one provided by the <code>rLFT</code> package. Let’s see how that might work using the <code>rLFT::bct()</code> (<em>bounded convexity tool</em>) function. This function finds the curvature at regular points along a track, in the following example, every 10 meters:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="automatically-generating-stage-descriptions.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rLFT)</span>
<span id="cb35-2"><a href="automatically-generating-stage-descriptions.html#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="automatically-generating-stage-descriptions.html#cb35-3" aria-hidden="true" tabindex="-1"></a>stepdist <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb35-4"><a href="automatically-generating-stage-descriptions.html#cb35-4" aria-hidden="true" tabindex="-1"></a>window <span class="ot">=</span> <span class="dv">20</span></span>
<span id="cb35-5"><a href="automatically-generating-stage-descriptions.html#cb35-5" aria-hidden="true" tabindex="-1"></a>route_convexity <span class="ot">&lt;-</span> <span class="fu">bct</span>(utm_routes[<span class="dv">1</span>,],</span>
<span id="cb35-6"><a href="automatically-generating-stage-descriptions.html#cb35-6" aria-hidden="true" tabindex="-1"></a>                      <span class="co"># distance between measurements </span></span>
<span id="cb35-7"><a href="automatically-generating-stage-descriptions.html#cb35-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">step =</span> stepdist,</span>
<span id="cb35-8"><a href="automatically-generating-stage-descriptions.html#cb35-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">window =</span> window, <span class="at">ridName =</span> <span class="st">&quot;Name&quot;</span>)</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.172   0.034   0.208 
## [1] &quot;Features skipped due to size: &quot;
## logical(0)</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="automatically-generating-stage-descriptions.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(route_convexity)</span></code></pre></div>
<pre><code>##   FID  RID MidMeas WindowSize RawConvexity ConvexityIndex Sinuosity Midpoint_X
## 1   1 SS 1      10         20        0.000          0.000     0.500   729181.8
## 2   1 SS 1      20         20       -0.040         -0.004     0.500   729186.1
## 3   1 SS 1      30         20       -0.014         -0.001     0.500   729190.4
## 4   1 SS 1      40         20        0.000          0.000     0.500   729194.6
## 5   1 SS 1      50         20       -1.739         -0.174     0.509   729198.8
## 6   1 SS 1      60         20       -0.093         -0.009     0.501   729199.6
##   Midpoint_Y
## 1    4957667
## 2    4957676
## 3    4957685
## 4    4957694
## 5    4957703
## 6    4957713</code></pre>
<p>Recalling the previous chapter:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="automatically-generating-stage-descriptions.html#cb39-1" aria-hidden="true" tabindex="-1"></a>corner_conv <span class="ot">=</span> <span class="fl">0.1</span></span>
<span id="cb39-2"><a href="automatically-generating-stage-descriptions.html#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="automatically-generating-stage-descriptions.html#cb39-3" aria-hidden="true" tabindex="-1"></a>tight_corners <span class="ot">=</span> route_convexity[<span class="fu">abs</span>(route_convexity<span class="sc">$</span>ConvexityIndex)<span class="sc">&gt;</span>corner_conv,]</span>
<span id="cb39-4"><a href="automatically-generating-stage-descriptions.html#cb39-4" aria-hidden="true" tabindex="-1"></a>tight_corners_zoom1 <span class="ot">=</span> tight_corners<span class="sc">$</span>Midpoint_Y<span class="sc">&gt;</span><span class="dv">4964000</span> <span class="sc">&amp;</span> tight_corners<span class="sc">$</span>Midpoint_Y<span class="sc">&lt;</span><span class="dv">4965000</span></span>
<span id="cb39-5"><a href="automatically-generating-stage-descriptions.html#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="automatically-generating-stage-descriptions.html#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>trj[zoom1, ],</span>
<span id="cb39-7"><a href="automatically-generating-stage-descriptions.html#cb39-7" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y)) <span class="sc">+</span> <span class="fu">geom_path</span>(<span class="at">color=</span><span class="st">&#39;grey&#39;</span>) <span class="sc">+</span> <span class="fu">coord_sf</span>() <span class="sc">+</span></span>
<span id="cb39-8"><a href="automatically-generating-stage-descriptions.html#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data=</span>tight_corners[tight_corners_zoom1,],</span>
<span id="cb39-9"><a href="automatically-generating-stage-descriptions.html#cb39-9" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">aes</span>(<span class="at">label =</span> ConvexityIndex,</span>
<span id="cb39-10"><a href="automatically-generating-stage-descriptions.html#cb39-10" aria-hidden="true" tabindex="-1"></a>                               <span class="at">x=</span>Midpoint_X, <span class="at">y=</span>Midpoint_Y),</span>
<span id="cb39-11"><a href="automatically-generating-stage-descriptions.html#cb39-11" aria-hidden="true" tabindex="-1"></a>                           <span class="at">size=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb39-12"><a href="automatically-generating-stage-descriptions.html#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>tight_corners[tight_corners_zoom1,],</span>
<span id="cb39-13"><a href="automatically-generating-stage-descriptions.html#cb39-13" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x=</span>Midpoint_X, <span class="at">y=</span>Midpoint_Y,</span>
<span id="cb39-14"><a href="automatically-generating-stage-descriptions.html#cb39-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color=</span> (ConvexityIndex<span class="sc">&gt;</span><span class="dv">0</span>) ), <span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb39-15"><a href="automatically-generating-stage-descriptions.html#cb39-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb39-16"><a href="automatically-generating-stage-descriptions.html#cb39-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>))</span></code></pre></div>
<p><img src="images/stage-description-sd-convexity-route-1.png" width="672" /></p>
<p>So the absolute convexity index can help us find corners but we still need to do some work to find find the start of a corner.</p>
<p>How does that top right area look?</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="automatically-generating-stage-descriptions.html#cb40-1" aria-hidden="true" tabindex="-1"></a>tight_corners_zoom2 <span class="ot">=</span> tight_corners_zoom1 <span class="sc">&amp;</span> tight_corners<span class="sc">$</span>Midpoint_X<span class="sc">&lt;</span><span class="dv">730100</span></span>
<span id="cb40-2"><a href="automatically-generating-stage-descriptions.html#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="automatically-generating-stage-descriptions.html#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>trj[zoom2,],</span>
<span id="cb40-4"><a href="automatically-generating-stage-descriptions.html#cb40-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y)) <span class="sc">+</span> <span class="fu">geom_path</span>(<span class="at">color=</span><span class="st">&#39;grey&#39;</span>) <span class="sc">+</span> <span class="fu">coord_sf</span>() <span class="sc">+</span></span>
<span id="cb40-5"><a href="automatically-generating-stage-descriptions.html#cb40-5" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">data=</span>tight_corners[tight_corners_zoom2,],</span>
<span id="cb40-6"><a href="automatically-generating-stage-descriptions.html#cb40-6" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">aes</span>(<span class="at">label =</span> ConvexityIndex,</span>
<span id="cb40-7"><a href="automatically-generating-stage-descriptions.html#cb40-7" aria-hidden="true" tabindex="-1"></a>                               <span class="at">x=</span>Midpoint_X, <span class="at">y=</span>Midpoint_Y),</span>
<span id="cb40-8"><a href="automatically-generating-stage-descriptions.html#cb40-8" aria-hidden="true" tabindex="-1"></a>                           <span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb40-9"><a href="automatically-generating-stage-descriptions.html#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>tight_corners[tight_corners_zoom2,],</span>
<span id="cb40-10"><a href="automatically-generating-stage-descriptions.html#cb40-10" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x=</span>Midpoint_X, <span class="at">y=</span>Midpoint_Y,</span>
<span id="cb40-11"><a href="automatically-generating-stage-descriptions.html#cb40-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color=</span> (ConvexityIndex<span class="sc">&gt;</span><span class="dv">0</span>) ), <span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb40-12"><a href="automatically-generating-stage-descriptions.html#cb40-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb40-13"><a href="automatically-generating-stage-descriptions.html#cb40-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>))</span></code></pre></div>
<p><img src="images/stage-description-sd-convexity-zoom-1.png" width="672" />
So we can probably apply a similar logic to previously to group these and identify the corner entry node, although we need to tweak the rules slightly so that we are identifying a corner entry node that is far from a previous tight corner node:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="automatically-generating-stage-descriptions.html#cb41-1" aria-hidden="true" tabindex="-1"></a>cornerer <span class="ot">=</span> <span class="cf">function</span> (df, <span class="at">slight_conv=</span><span class="fl">0.01</span>, <span class="at">closeby=</span><span class="dv">25</span>){</span>
<span id="cb41-2"><a href="automatically-generating-stage-descriptions.html#cb41-2" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb41-3"><a href="automatically-generating-stage-descriptions.html#cb41-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">dirChange =</span> <span class="fu">sign</span>(ConvexityIndex) <span class="sc">!=</span> <span class="fu">sign</span>(<span class="fu">lag</span>(ConvexityIndex))) <span class="sc">%&gt;%</span></span>
<span id="cb41-4"><a href="automatically-generating-stage-descriptions.html#cb41-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">straightish =</span>  (<span class="fu">abs</span>(ConvexityIndex) <span class="sc">&lt;</span> slight_conv)) <span class="sc">%&gt;%</span></span>
<span id="cb41-5"><a href="automatically-generating-stage-descriptions.html#cb41-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">dist =</span>  (<span class="fu">lead</span>(MidMeas)<span class="sc">-</span>MidMeas)) <span class="sc">%&gt;%</span></span>
<span id="cb41-6"><a href="automatically-generating-stage-descriptions.html#cb41-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">nearby =</span>  dist <span class="sc">&lt;</span> closeby) <span class="sc">%&gt;%</span></span>
<span id="cb41-7"><a href="automatically-generating-stage-descriptions.html#cb41-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">firstish =</span> <span class="sc">!</span>straightish <span class="sc">&amp;</span></span>
<span id="cb41-8"><a href="automatically-generating-stage-descriptions.html#cb41-8" aria-hidden="true" tabindex="-1"></a>                        ((nearby <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">lag</span>(straightish) <span class="sc">&amp;</span> <span class="fu">lag</span>(dirChange)) <span class="sc">|</span></span>
<span id="cb41-9"><a href="automatically-generating-stage-descriptions.html#cb41-9" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># We don&#39;t want the previous node nearby</span></span>
<span id="cb41-10"><a href="automatically-generating-stage-descriptions.html#cb41-10" aria-hidden="true" tabindex="-1"></a>                        (<span class="sc">!</span><span class="fu">lag</span>(nearby)) ) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">lag</span>(nearby) )</span>
<span id="cb41-11"><a href="automatically-generating-stage-descriptions.html#cb41-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-12"><a href="automatically-generating-stage-descriptions.html#cb41-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-13"><a href="automatically-generating-stage-descriptions.html#cb41-13" aria-hidden="true" tabindex="-1"></a>tight_corners <span class="ot">=</span> <span class="fu">cornerer</span>(tight_corners)</span></code></pre></div>
<p>Let’s see how it looks. We can also label nodes showing how far away the next node is:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="automatically-generating-stage-descriptions.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>trj[zoom1,],</span>
<span id="cb42-2"><a href="automatically-generating-stage-descriptions.html#cb42-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y)) <span class="sc">+</span> <span class="fu">geom_path</span>(<span class="at">color=</span><span class="st">&#39;grey&#39;</span>) <span class="sc">+</span> <span class="fu">coord_sf</span>() <span class="sc">+</span></span>
<span id="cb42-3"><a href="automatically-generating-stage-descriptions.html#cb42-3" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">data=</span>tight_corners[tight_corners_zoom1,],</span>
<span id="cb42-4"><a href="automatically-generating-stage-descriptions.html#cb42-4" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">aes</span>(<span class="at">label =</span> dist,</span>
<span id="cb42-5"><a href="automatically-generating-stage-descriptions.html#cb42-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">x=</span>Midpoint_X, <span class="at">y=</span>Midpoint_Y),</span>
<span id="cb42-6"><a href="automatically-generating-stage-descriptions.html#cb42-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb42-7"><a href="automatically-generating-stage-descriptions.html#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>tight_corners[tight_corners_zoom1,],</span>
<span id="cb42-8"><a href="automatically-generating-stage-descriptions.html#cb42-8" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x=</span>Midpoint_X, <span class="at">y=</span>Midpoint_Y,</span>
<span id="cb42-9"><a href="automatically-generating-stage-descriptions.html#cb42-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color=</span> (firstish) ), <span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb42-10"><a href="automatically-generating-stage-descriptions.html#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb42-11"><a href="automatically-generating-stage-descriptions.html#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>))</span></code></pre></div>
<p><img src="images/stage-description-rlft-corners-1.png" width="672" /></p>
</div>
<div id="stage-segmenting" class="section level2" number="20.8">
<h2><span class="header-section-number">20.8</span> Stage Segmenting</h2>
<p>One of the handy things about the <code>rLFT::bct()</code> is that it can chunk the route into very short segments. This provides us with an easy way to index into the route to generate a view over a particular section.</p>
<p>For example, we can view the route over specific sections given a start and finish distance into the route. Note that the route will be discretised to step lengths used by the <code>rLFT::bct()</code> function and a stylised route will be approximated along step midmeasure points:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="automatically-generating-stage-descriptions.html#cb43-1" aria-hidden="true" tabindex="-1"></a>segment_plot <span class="ot">=</span> <span class="cf">function</span>(start, end, <span class="at">title=</span><span class="st">&#39;&#39;</span>, <span class="at">fix_coords=</span><span class="cn">TRUE</span>) {</span>
<span id="cb43-2"><a href="automatically-generating-stage-descriptions.html#cb43-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-3"><a href="automatically-generating-stage-descriptions.html#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the route distance filter limits</span></span>
<span id="cb43-4"><a href="automatically-generating-stage-descriptions.html#cb43-4" aria-hidden="true" tabindex="-1"></a>  segment_filter <span class="ot">=</span> route_convexity<span class="sc">$</span>MidMeas <span class="sc">&gt;=</span> start <span class="sc">&amp;</span></span>
<span id="cb43-5"><a href="automatically-generating-stage-descriptions.html#cb43-5" aria-hidden="true" tabindex="-1"></a>                    route_convexity<span class="sc">$</span>MidMeas <span class="sc">&lt;=</span> end</span>
<span id="cb43-6"><a href="automatically-generating-stage-descriptions.html#cb43-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-7"><a href="automatically-generating-stage-descriptions.html#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter the route</span></span>
<span id="cb43-8"><a href="automatically-generating-stage-descriptions.html#cb43-8" aria-hidden="true" tabindex="-1"></a>  route_segment <span class="ot">=</span> route_convexity[segment_filter,]</span>
<span id="cb43-9"><a href="automatically-generating-stage-descriptions.html#cb43-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-10"><a href="automatically-generating-stage-descriptions.html#cb43-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate the stylised route plot</span></span>
<span id="cb43-11"><a href="automatically-generating-stage-descriptions.html#cb43-11" aria-hidden="true" tabindex="-1"></a>  g<span class="ot">=</span> <span class="fu">ggplot</span>(route_segment) <span class="sc">+</span></span>
<span id="cb43-12"><a href="automatically-generating-stage-descriptions.html#cb43-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">geom_path</span>(<span class="fu">aes</span>(<span class="at">x=</span>Midpoint_X, <span class="at">y=</span>Midpoint_Y)) <span class="sc">+</span></span>
<span id="cb43-13"><a href="automatically-generating-stage-descriptions.html#cb43-13" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_point</span>(<span class="at">data=</span><span class="fu">head</span>(route_convexity[segment_filter,],<span class="at">n=</span><span class="dv">1</span>),</span>
<span id="cb43-14"><a href="automatically-generating-stage-descriptions.html#cb43-14" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x=</span>Midpoint_X, <span class="at">y=</span>Midpoint_Y)) <span class="sc">+</span></span>
<span id="cb43-15"><a href="automatically-generating-stage-descriptions.html#cb43-15" aria-hidden="true" tabindex="-1"></a>            <span class="fu">theme_void</span>() </span>
<span id="cb43-16"><a href="automatically-generating-stage-descriptions.html#cb43-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-17"><a href="automatically-generating-stage-descriptions.html#cb43-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (title<span class="sc">!=</span><span class="st">&#39;&#39;</span>)</span>
<span id="cb43-18"><a href="automatically-generating-stage-descriptions.html#cb43-18" aria-hidden="true" tabindex="-1"></a>    g <span class="ot">=</span> g<span class="sc">+</span><span class="fu">ggtitle</span>(title)</span>
<span id="cb43-19"><a href="automatically-generating-stage-descriptions.html#cb43-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-20"><a href="automatically-generating-stage-descriptions.html#cb43-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (fix_coords)</span>
<span id="cb43-21"><a href="automatically-generating-stage-descriptions.html#cb43-21" aria-hidden="true" tabindex="-1"></a>    g<span class="ot">=</span>g<span class="sc">+</span><span class="fu">coord_fixed</span>()</span>
<span id="cb43-22"><a href="automatically-generating-stage-descriptions.html#cb43-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-23"><a href="automatically-generating-stage-descriptions.html#cb43-23" aria-hidden="true" tabindex="-1"></a>  g</span>
<span id="cb43-24"><a href="automatically-generating-stage-descriptions.html#cb43-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb43-25"><a href="automatically-generating-stage-descriptions.html#cb43-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-26"><a href="automatically-generating-stage-descriptions.html#cb43-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the first 1000m</span></span>
<span id="cb43-27"><a href="automatically-generating-stage-descriptions.html#cb43-27" aria-hidden="true" tabindex="-1"></a><span class="fu">segment_plot</span>(<span class="dv">0</span>, <span class="dv">1000</span>)</span></code></pre></div>
<p><img src="images/stage-description-example-route-section-1.png" width="672" /></p>
<p>We can automate the creation of route sections every kilometer and create a list of plots, one per kilometer section:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="automatically-generating-stage-descriptions.html#cb44-1" aria-hidden="true" tabindex="-1"></a>segment_length <span class="ot">=</span> <span class="dv">1000</span></span>
<span id="cb44-2"><a href="automatically-generating-stage-descriptions.html#cb44-2" aria-hidden="true" tabindex="-1"></a>step_length<span class="ot">=</span><span class="dv">10</span></span>
<span id="cb44-3"><a href="automatically-generating-stage-descriptions.html#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="automatically-generating-stage-descriptions.html#cb44-4" aria-hidden="true" tabindex="-1"></a>kms <span class="ot">=</span> <span class="fu">floor</span>(<span class="fu">max</span>(route_convexity<span class="sc">$</span>MidMeas)<span class="sc">/</span>segment_length)</span>
<span id="cb44-5"><a href="automatically-generating-stage-descriptions.html#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="automatically-generating-stage-descriptions.html#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co"># The final section goes to the end of the route</span></span>
<span id="cb44-7"><a href="automatically-generating-stage-descriptions.html#cb44-7" aria-hidden="true" tabindex="-1"></a>segment_multiplot <span class="ot">=</span> <span class="cf">function</span>(i, <span class="at">final=</span><span class="cn">FALSE</span>){</span>
<span id="cb44-8"><a href="automatically-generating-stage-descriptions.html#cb44-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Preface the start of the stage with a 20m lead</span></span>
<span id="cb44-9"><a href="automatically-generating-stage-descriptions.html#cb44-9" aria-hidden="true" tabindex="-1"></a>  start_prefix <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span>step_length</span>
<span id="cb44-10"><a href="automatically-generating-stage-descriptions.html#cb44-10" aria-hidden="true" tabindex="-1"></a>  start <span class="ot">=</span> segment_length<span class="sc">*</span>(i<span class="dv">-1</span>)<span class="sc">-</span>start_prefix</span>
<span id="cb44-11"><a href="automatically-generating-stage-descriptions.html#cb44-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (final) </span>
<span id="cb44-12"><a href="automatically-generating-stage-descriptions.html#cb44-12" aria-hidden="true" tabindex="-1"></a>    end <span class="ot">=</span> <span class="cn">Inf</span></span>
<span id="cb44-13"><a href="automatically-generating-stage-descriptions.html#cb44-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span></span>
<span id="cb44-14"><a href="automatically-generating-stage-descriptions.html#cb44-14" aria-hidden="true" tabindex="-1"></a>    end <span class="ot">=</span> (segment_length<span class="sc">*</span>i)</span>
<span id="cb44-15"><a href="automatically-generating-stage-descriptions.html#cb44-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-16"><a href="automatically-generating-stage-descriptions.html#cb44-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">segment_plot</span>(start, end, i, <span class="at">fix_coords=</span><span class="cn">TRUE</span>)</span>
<span id="cb44-17"><a href="automatically-generating-stage-descriptions.html#cb44-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-18"><a href="automatically-generating-stage-descriptions.html#cb44-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-19"><a href="automatically-generating-stage-descriptions.html#cb44-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a list to hold each plot as a separate item</span></span>
<span id="cb44-20"><a href="automatically-generating-stage-descriptions.html#cb44-20" aria-hidden="true" tabindex="-1"></a>segment_plots <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb44-21"><a href="automatically-generating-stage-descriptions.html#cb44-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-22"><a href="automatically-generating-stage-descriptions.html#cb44-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate through each kilometer</span></span>
<span id="cb44-23"><a href="automatically-generating-stage-descriptions.html#cb44-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>kms){</span>
<span id="cb44-24"><a href="automatically-generating-stage-descriptions.html#cb44-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add each plot to the plot list</span></span>
<span id="cb44-25"><a href="automatically-generating-stage-descriptions.html#cb44-25" aria-hidden="true" tabindex="-1"></a>  segment_plots[[<span class="fu">length</span>(segment_plots) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span></span>
<span id="cb44-26"><a href="automatically-generating-stage-descriptions.html#cb44-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">segment_multiplot</span>(i, <span class="at">final=</span>(i<span class="sc">==</span>kms))</span>
<span id="cb44-27"><a href="automatically-generating-stage-descriptions.html#cb44-27" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We can now use the <code>ggpubr::ggarrange()</code> function to display all the stage route sections in a single plot:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="automatically-generating-stage-descriptions.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(<span class="at">plotlist=</span>segment_plots,</span>
<span id="cb45-2"><a href="automatically-generating-stage-descriptions.html#cb45-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">ncol=</span><span class="dv">5</span>, <span class="at">nrow=</span><span class="fu">ceiling</span>(kms<span class="sc">/</span><span class="dv">4</span>))</span></code></pre></div>
<p><img src="images/stage-description-route-by-1km-section-1.png" width="672" /></p>
<p>We can use a similar approach to create a more general function that will allow us to plot either the route, or generate a plot for each segment showing the convexity against distance into the segment:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="automatically-generating-stage-descriptions.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple function to get a route segment</span></span>
<span id="cb46-2"><a href="automatically-generating-stage-descriptions.html#cb46-2" aria-hidden="true" tabindex="-1"></a>get_route_segment <span class="ot">=</span> <span class="cf">function</span> (route, start, end){</span>
<span id="cb46-3"><a href="automatically-generating-stage-descriptions.html#cb46-3" aria-hidden="true" tabindex="-1"></a>    segment_filter <span class="ot">=</span> route<span class="sc">$</span>MidMeas <span class="sc">&gt;=</span> start <span class="sc">&amp;</span></span>
<span id="cb46-4"><a href="automatically-generating-stage-descriptions.html#cb46-4" aria-hidden="true" tabindex="-1"></a>                      route<span class="sc">$</span>MidMeas <span class="sc">&lt;=</span> end</span>
<span id="cb46-5"><a href="automatically-generating-stage-descriptions.html#cb46-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-6"><a href="automatically-generating-stage-descriptions.html#cb46-6" aria-hidden="true" tabindex="-1"></a>    route[segment_filter,]</span>
<span id="cb46-7"><a href="automatically-generating-stage-descriptions.html#cb46-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb46-8"><a href="automatically-generating-stage-descriptions.html#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="automatically-generating-stage-descriptions.html#cb46-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-10"><a href="automatically-generating-stage-descriptions.html#cb46-10" aria-hidden="true" tabindex="-1"></a>segment_plot2 <span class="ot">=</span> <span class="cf">function</span>(route, start, end, <span class="at">title=</span><span class="st">&#39;&#39;</span>,</span>
<span id="cb46-11"><a href="automatically-generating-stage-descriptions.html#cb46-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">typ=</span><span class="st">&#39;route&#39;</span>, <span class="at">themevoid=</span><span class="cn">TRUE</span>){</span>
<span id="cb46-12"><a href="automatically-generating-stage-descriptions.html#cb46-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-13"><a href="automatically-generating-stage-descriptions.html#cb46-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get route segment</span></span>
<span id="cb46-14"><a href="automatically-generating-stage-descriptions.html#cb46-14" aria-hidden="true" tabindex="-1"></a>  route_segment <span class="ot">=</span> <span class="fu">get_route_segment</span>(route, start, end)</span>
<span id="cb46-15"><a href="automatically-generating-stage-descriptions.html#cb46-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-16"><a href="automatically-generating-stage-descriptions.html#cb46-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create plot base</span></span>
<span id="cb46-17"><a href="automatically-generating-stage-descriptions.html#cb46-17" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">=</span> <span class="fu">ggplot</span>(route_segment)</span>
<span id="cb46-18"><a href="automatically-generating-stage-descriptions.html#cb46-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-19"><a href="automatically-generating-stage-descriptions.html#cb46-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (typ<span class="sc">==</span><span class="st">&#39;convexity&#39;</span>) {</span>
<span id="cb46-20"><a href="automatically-generating-stage-descriptions.html#cb46-20" aria-hidden="true" tabindex="-1"></a>    g <span class="ot">=</span> g <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x=</span>MidMeas,</span>
<span id="cb46-21"><a href="automatically-generating-stage-descriptions.html#cb46-21" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y=</span><span class="sc">-</span>ConvexityIndex,</span>
<span id="cb46-22"><a href="automatically-generating-stage-descriptions.html#cb46-22" aria-hidden="true" tabindex="-1"></a>                         <span class="at">col=</span>(ConvexityIndex<span class="sc">&gt;</span><span class="dv">0</span>)),</span>
<span id="cb46-23"><a href="automatically-generating-stage-descriptions.html#cb46-23" aria-hidden="true" tabindex="-1"></a>                     <span class="at">stat=</span><span class="st">&#39;identity&#39;</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>)</span>
<span id="cb46-24"><a href="automatically-generating-stage-descriptions.html#cb46-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-25"><a href="automatically-generating-stage-descriptions.html#cb46-25" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb46-26"><a href="automatically-generating-stage-descriptions.html#cb46-26" aria-hidden="true" tabindex="-1"></a>   <span class="co"># plot route</span></span>
<span id="cb46-27"><a href="automatically-generating-stage-descriptions.html#cb46-27" aria-hidden="true" tabindex="-1"></a>   g <span class="ot">=</span> g <span class="sc">+</span> <span class="fu">geom_path</span>(<span class="fu">aes</span>(<span class="at">x=</span>Midpoint_X, <span class="at">y=</span>Midpoint_Y)) <span class="sc">+</span></span>
<span id="cb46-28"><a href="automatically-generating-stage-descriptions.html#cb46-28" aria-hidden="true" tabindex="-1"></a>           <span class="fu">geom_point</span>(<span class="at">data=</span><span class="fu">head</span>(route_segment, <span class="at">n=</span><span class="dv">1</span>),</span>
<span id="cb46-29"><a href="automatically-generating-stage-descriptions.html#cb46-29" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">aes</span>(<span class="at">x=</span>Midpoint_X, <span class="at">y=</span>Midpoint_Y)) </span>
<span id="cb46-30"><a href="automatically-generating-stage-descriptions.html#cb46-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb46-31"><a href="automatically-generating-stage-descriptions.html#cb46-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-32"><a href="automatically-generating-stage-descriptions.html#cb46-32" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (title<span class="sc">!=</span><span class="st">&#39;&#39;</span>)</span>
<span id="cb46-33"><a href="automatically-generating-stage-descriptions.html#cb46-33" aria-hidden="true" tabindex="-1"></a>    g <span class="ot">=</span> g <span class="sc">+</span> <span class="fu">ggtitle</span>(title)</span>
<span id="cb46-34"><a href="automatically-generating-stage-descriptions.html#cb46-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-35"><a href="automatically-generating-stage-descriptions.html#cb46-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (themevoid)</span>
<span id="cb46-36"><a href="automatically-generating-stage-descriptions.html#cb46-36" aria-hidden="true" tabindex="-1"></a>    g <span class="ot">=</span> g <span class="sc">+</span> <span class="fu">theme_void</span>()</span>
<span id="cb46-37"><a href="automatically-generating-stage-descriptions.html#cb46-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-38"><a href="automatically-generating-stage-descriptions.html#cb46-38" aria-hidden="true" tabindex="-1"></a>  g</span>
<span id="cb46-39"><a href="automatically-generating-stage-descriptions.html#cb46-39" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Let’s see what a convexity report for the first kilometer looks like:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="automatically-generating-stage-descriptions.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">segment_plot2</span>(route_convexity, <span class="dv">0</span>, <span class="dv">1000</span>, <span class="at">typ=</span><span class="st">&#39;convexity&#39;</span>)</span></code></pre></div>
<p><img src="images/stage-description-convexity-first-km-1.png" width="672" /></p>
<p>So we start off with a left (<em>port-red-left</em>!), a slight right, a straight, a right that tightens, a left, a straight, a nudge left and then end the kilometer with a tight right.</p>
<p>Let’s remind ourselves to see if that looks about right:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="automatically-generating-stage-descriptions.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">segment_plot2</span>(route_convexity, <span class="dv">0</span>, <span class="dv">1000</span>, <span class="at">typ=</span><span class="st">&#39;route&#39;</span>)</span></code></pre></div>
<p><img src="images/stage-description-convexity-first-km-route-check-1.png" width="672" /></p>
<p>We can use a similar approach before to automate the collection of multiple plots for each stretch of the stage:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="automatically-generating-stage-descriptions.html#cb49-1" aria-hidden="true" tabindex="-1"></a>segment_multiplot2 <span class="ot">=</span> <span class="cf">function</span>(route, i, <span class="at">final=</span><span class="cn">FALSE</span>, <span class="at">typ=</span><span class="st">&#39;route&#39;</span>){</span>
<span id="cb49-2"><a href="automatically-generating-stage-descriptions.html#cb49-2" aria-hidden="true" tabindex="-1"></a>  start <span class="ot">=</span> segment_length<span class="sc">*</span>(i<span class="dv">-1</span>)<span class="sc">-</span>step_length</span>
<span id="cb49-3"><a href="automatically-generating-stage-descriptions.html#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (final) </span>
<span id="cb49-4"><a href="automatically-generating-stage-descriptions.html#cb49-4" aria-hidden="true" tabindex="-1"></a>    end <span class="ot">=</span> <span class="cn">Inf</span></span>
<span id="cb49-5"><a href="automatically-generating-stage-descriptions.html#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span></span>
<span id="cb49-6"><a href="automatically-generating-stage-descriptions.html#cb49-6" aria-hidden="true" tabindex="-1"></a>    end <span class="ot">=</span> (segment_length<span class="sc">*</span>i)</span>
<span id="cb49-7"><a href="automatically-generating-stage-descriptions.html#cb49-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-8"><a href="automatically-generating-stage-descriptions.html#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">segment_plot2</span>(route, start, end, i, typ )</span>
<span id="cb49-9"><a href="automatically-generating-stage-descriptions.html#cb49-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We can now generate a plot of either the route sections, or the convexity based on distance into the route section:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="automatically-generating-stage-descriptions.html#cb50-1" aria-hidden="true" tabindex="-1"></a>segment_plots2 <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb50-2"><a href="automatically-generating-stage-descriptions.html#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="automatically-generating-stage-descriptions.html#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate through each kilometer</span></span>
<span id="cb50-4"><a href="automatically-generating-stage-descriptions.html#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(kms<span class="dv">-1</span>)){</span>
<span id="cb50-5"><a href="automatically-generating-stage-descriptions.html#cb50-5" aria-hidden="true" tabindex="-1"></a>  segment_plots2[[<span class="fu">length</span>(segment_plots2) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span></span>
<span id="cb50-6"><a href="automatically-generating-stage-descriptions.html#cb50-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">segment_multiplot2</span>(route_convexity, i,  <span class="at">final=</span> (i<span class="sc">==</span>kms),</span>
<span id="cb50-7"><a href="automatically-generating-stage-descriptions.html#cb50-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">typ =</span> <span class="st">&#39;convexity&#39;</span>)</span>
<span id="cb50-8"><a href="automatically-generating-stage-descriptions.html#cb50-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb50-9"><a href="automatically-generating-stage-descriptions.html#cb50-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-10"><a href="automatically-generating-stage-descriptions.html#cb50-10" aria-hidden="true" tabindex="-1"></a>ggpubr<span class="sc">::</span><span class="fu">ggarrange</span>(<span class="at">plotlist=</span>segment_plots2,</span>
<span id="cb50-11"><a href="automatically-generating-stage-descriptions.html#cb50-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ncol=</span><span class="dv">5</span>, <span class="at">nrow=</span><span class="fu">ceiling</span>(kms<span class="sc">/</span><span class="dv">4</span>))</span></code></pre></div>
<p><img src="images/stage-description-segment-convexity-bar-1.png" width="672" /></p>
<p>At a glance, we can now start to identify segments of the route that contain particular sorts of feature.</p>
<p>For example, we can readily see that kilometers 12, 15 and 16 include significant straight stretches.</p>
</div>
<div id="corner-severity-numbering" class="section level2" number="20.9">
<h2><span class="header-section-number">20.9</span> Corner Severity Numbering</h2>
<p>Although they may differ in the specifics, all rally pace note systems find some way to categorise the corner severity (also referred to as the turn intensity). Many systems use a convention that numbers corner severity with a value from 1 to 6, where 1 is the most severe and 6 is the least severe; alternatively, <a href="http://therallydriver.com/index.php/en/to-see-the-invisible"><em>therallydriver.com</em> pacenotes system</a>, (which has the added benefit of being well documented in the <em>To See the Invisible</em> tutorial series published by the system’s creator, David Nafría), uses a range from 1 to 10.</p>
<p>Variations on the following diagram are often used to illustrate how the numbers scheme applies to different severity corners.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="automatically-generating-stage-descriptions.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggforce)</span>
<span id="cb51-2"><a href="automatically-generating-stage-descriptions.html#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ggforce::geom_arc</span></span>
<span id="cb51-3"><a href="automatically-generating-stage-descriptions.html#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="automatically-generating-stage-descriptions.html#cb51-4" aria-hidden="true" tabindex="-1"></a>rallynotes <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">n=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb51-5"><a href="automatically-generating-stage-descriptions.html#cb51-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">r=</span><span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="fl">27.5</span>, <span class="dv">35</span>,</span>
<span id="cb51-6"><a href="automatically-generating-stage-descriptions.html#cb51-6" aria-hidden="true" tabindex="-1"></a>                            <span class="dv">45</span>, <span class="dv">60</span>, <span class="fl">77.5</span>, <span class="dv">100</span>, <span class="dv">175</span>))</span>
<span id="cb51-7"><a href="automatically-generating-stage-descriptions.html#cb51-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-8"><a href="automatically-generating-stage-descriptions.html#cb51-8" aria-hidden="true" tabindex="-1"></a>rallynotes_arcs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb51-9"><a href="automatically-generating-stage-descriptions.html#cb51-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span>  <span class="sc">-</span>pi<span class="sc">/</span><span class="dv">2</span>,</span>
<span id="cb51-10"><a href="automatically-generating-stage-descriptions.html#cb51-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">end =</span> <span class="fu">mapply</span>(min, <span class="dv">50</span><span class="sc">/</span>rallynotes<span class="sc">$</span>r, pi<span class="sc">/</span><span class="dv">2</span>), </span>
<span id="cb51-11"><a href="automatically-generating-stage-descriptions.html#cb51-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">r =</span> rallynotes<span class="sc">$</span>r,</span>
<span id="cb51-12"><a href="automatically-generating-stage-descriptions.html#cb51-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> rallynotes<span class="sc">$</span>n</span>
<span id="cb51-13"><a href="automatically-generating-stage-descriptions.html#cb51-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-14"><a href="automatically-generating-stage-descriptions.html#cb51-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-15"><a href="automatically-generating-stage-descriptions.html#cb51-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot a representation of corner severity along the route</span></span>
<span id="cb51-16"><a href="automatically-generating-stage-descriptions.html#cb51-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rallynotes_arcs) <span class="sc">+</span></span>
<span id="cb51-17"><a href="automatically-generating-stage-descriptions.html#cb51-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_arc_bar</span>(<span class="fu">aes</span>(<span class="at">x0 =</span> <span class="sc">-</span><span class="dv">15</span><span class="sc">+</span>r<span class="dv">-6</span><span class="sc">*</span>n, <span class="at">y0 =</span> <span class="dv">0</span>, <span class="at">r0 =</span> r,</span>
<span id="cb51-18"><a href="automatically-generating-stage-descriptions.html#cb51-18" aria-hidden="true" tabindex="-1"></a>                   <span class="at">r =</span> r<span class="sc">+</span><span class="dv">2</span>, <span class="at">start =</span> start,</span>
<span id="cb51-19"><a href="automatically-generating-stage-descriptions.html#cb51-19" aria-hidden="true" tabindex="-1"></a>                   <span class="at">end =</span> end,<span class="at">fill =</span> <span class="fu">factor</span>(n),</span>
<span id="cb51-20"><a href="automatically-generating-stage-descriptions.html#cb51-20" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color =</span> <span class="fu">factor</span>(n)), <span class="at">show.legend=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb51-21"><a href="automatically-generating-stage-descriptions.html#cb51-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>n, <span class="at">x=</span><span class="sc">-</span><span class="dv">15-6</span><span class="sc">*</span>n , <span class="at">y=</span><span class="sc">-</span><span class="dv">10</span>),</span>
<span id="cb51-22"><a href="automatically-generating-stage-descriptions.html#cb51-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">size=</span><span class="dv">3</span>, <span class="at">hjust=</span><span class="st">&#39;right&#39;</span>) <span class="sc">+</span></span>
<span id="cb51-23"><a href="automatically-generating-stage-descriptions.html#cb51-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>()<span class="sc">+</span></span>
<span id="cb51-24"><a href="automatically-generating-stage-descriptions.html#cb51-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() </span></code></pre></div>
<p><img src="images/stage-description-therallydriver-corner-numbers-1.png" width="672" /></p>
<p>Note that with increasing number, the radius of curvature (that is, the radius of the circle describing the corner) also increases. This gives us one way of mapping from a measurement we can apply to a corner (such as its radius of curvature) to the turn severity number.</p>
<p>Two other properties of a corner that we might attempt to describe are the <em>length</em> of the corner either as a linear distance (20m, for example) or as an <em>angular</em> distance (45 degrees, for example). The “distance” might also map on to a descriptive term, such as “long”, as in “long right”. Descriptive terms are more ambiguous because they are normative: they assume a “standard” length corner in comparison with which a “long” corner is longer.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="automatically-generating-stage-descriptions.html#cb52-1" aria-hidden="true" tabindex="-1"></a>curvature <span class="ot">=</span> <span class="cf">function</span>(x,y){</span>
<span id="cb52-2"><a href="automatically-generating-stage-descriptions.html#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#729181.8, 729186.1, 729190.4</span></span>
<span id="cb52-3"><a href="automatically-generating-stage-descriptions.html#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#4957667 , 4957676, 4957685</span></span>
<span id="cb52-4"><a href="automatically-generating-stage-descriptions.html#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>({</span>
<span id="cb52-5"><a href="automatically-generating-stage-descriptions.html#cb52-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># circlefit gives an error if we pass a straight line</span></span>
<span id="cb52-6"><a href="automatically-generating-stage-descriptions.html#cb52-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Also hide the print statement in circlefit</span></span>
<span id="cb52-7"><a href="automatically-generating-stage-descriptions.html#cb52-7" aria-hidden="true" tabindex="-1"></a>    pracma<span class="sc">::</span><span class="fu">circlefit</span>(x,y)[<span class="dv">3</span>]</span>
<span id="cb52-8"><a href="automatically-generating-stage-descriptions.html#cb52-8" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb52-9"><a href="automatically-generating-stage-descriptions.html#cb52-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">error =</span> <span class="cf">function</span>(err) { </span>
<span id="cb52-10"><a href="automatically-generating-stage-descriptions.html#cb52-10" aria-hidden="true" tabindex="-1"></a>      <span class="co"># For a straight, return the first co-ord and Inf diameter</span></span>
<span id="cb52-11"><a href="automatically-generating-stage-descriptions.html#cb52-11" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Alternatively, pass zero diameter?</span></span>
<span id="cb52-12"><a href="automatically-generating-stage-descriptions.html#cb52-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(x[<span class="dv">1</span>], y[<span class="dv">1</span>], <span class="cn">Inf</span>)[<span class="dv">3</span>]})</span>
<span id="cb52-13"><a href="automatically-generating-stage-descriptions.html#cb52-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-14"><a href="automatically-generating-stage-descriptions.html#cb52-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-15"><a href="automatically-generating-stage-descriptions.html#cb52-15" aria-hidden="true" tabindex="-1"></a>curvature2 <span class="ot">=</span> <span class="cf">function</span>(x1, x2, x3, y1, y2, y3){</span>
<span id="cb52-16"><a href="automatically-generating-stage-descriptions.html#cb52-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">curvature</span>(<span class="fu">c</span>(x1, x2, x3), <span class="fu">c</span>(y1, y2, y3))</span>
<span id="cb52-17"><a href="automatically-generating-stage-descriptions.html#cb52-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-18"><a href="automatically-generating-stage-descriptions.html#cb52-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-19"><a href="automatically-generating-stage-descriptions.html#cb52-19" aria-hidden="true" tabindex="-1"></a>curvatures <span class="ot">=</span> <span class="fu">Vectorize</span>(curvature2)</span>
<span id="cb52-20"><a href="automatically-generating-stage-descriptions.html#cb52-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-21"><a href="automatically-generating-stage-descriptions.html#cb52-21" aria-hidden="true" tabindex="-1"></a>curvatures2 <span class="ot">=</span> <span class="cf">function</span>(route,</span>
<span id="cb52-22"><a href="automatically-generating-stage-descriptions.html#cb52-22" aria-hidden="true" tabindex="-1"></a>                       <span class="at">x=</span><span class="st">&#39;Midpoint_X&#39;</span>, <span class="at">y=</span><span class="st">&#39;Midpoint_Y&#39;</span>) {</span>
<span id="cb52-23"><a href="automatically-generating-stage-descriptions.html#cb52-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-24"><a href="automatically-generating-stage-descriptions.html#cb52-24" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">curvatures</span>(<span class="fu">lag</span>(route[[x]]),</span>
<span id="cb52-25"><a href="automatically-generating-stage-descriptions.html#cb52-25" aria-hidden="true" tabindex="-1"></a>                               route[[x]],</span>
<span id="cb52-26"><a href="automatically-generating-stage-descriptions.html#cb52-26" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">lead</span>(route[[x]]),</span>
<span id="cb52-27"><a href="automatically-generating-stage-descriptions.html#cb52-27" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">lag</span>(route[[y]]),</span>
<span id="cb52-28"><a href="automatically-generating-stage-descriptions.html#cb52-28" aria-hidden="true" tabindex="-1"></a>                               route[[y]],</span>
<span id="cb52-29"><a href="automatically-generating-stage-descriptions.html#cb52-29" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">lead</span>(route[[y]]) )</span>
<span id="cb52-30"><a href="automatically-generating-stage-descriptions.html#cb52-30" aria-hidden="true" tabindex="-1"></a>                }</span></code></pre></div>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="automatically-generating-stage-descriptions.html#cb53-1" aria-hidden="true" tabindex="-1"></a>route_convexity<span class="sc">$</span>turn_curvature <span class="ot">=</span> <span class="fu">curvatures2</span>(route_convexity)</span></code></pre></div>
<p>Preview the result:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="automatically-generating-stage-descriptions.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(route_convexity, <span class="fu">c</span>(<span class="st">&#39;ConvexityIndex&#39;</span>, <span class="st">&#39;turn_curvature&#39;</span> ))</span></code></pre></div>
<pre><code>##     FID  RID MidMeas WindowSize RawConvexity ConvexityIndex Sinuosity Midpoint_X
## 1     1 SS 1      10         20        0.000          0.000     0.500   729181.8
## 2     1 SS 1      20         20       -0.040         -0.004     0.500   729186.1
## 3     1 SS 1      30         20       -0.014         -0.001     0.500   729190.4
## 4     1 SS 1      40         20        0.000          0.000     0.500   729194.6
## 5     1 SS 1      50         20       -1.739         -0.174     0.509   729198.8
## 6     1 SS 1      60         20       -0.093         -0.009     0.501   729199.6
## 7     1 SS 1      70         20       -2.684         -0.268     0.527   729200.3
## 8     1 SS 1      80         20       -0.464         -0.046     0.507   729195.8
## 9     1 SS 1      90         20       -2.989         -0.299     0.537   729190.3
## 10    1 SS 1     100         20       -0.672         -0.067     0.512   729181.4
## 11    1 SS 1     110         20       -0.907         -0.091     0.505   729171.7
## 12    1 SS 1     120         20       -0.527         -0.053     0.503   729161.8
## 13    1 SS 1     130         20        0.000          0.000     0.500   729151.8
## 14    1 SS 1     140         20        0.000          0.000     0.500   729141.8
## 15    1 SS 1     150         20        1.303          0.130     0.508   729131.8
## 16    1 SS 1     160         20        0.531          0.053     0.504   729122.2
## 17    1 SS 1     170         20        0.000          0.000     0.500   729112.7
## 18    1 SS 1     180         20        1.053          0.105     0.503   729103.1
## 19    1 SS 1     190         20        0.127          0.013     0.501   729094.5
## 20    1 SS 1     200         20        0.000          0.000     0.500   729086.0
## 21    1 SS 1     210         20        0.000          0.000     0.500   729077.5
## 22    1 SS 1     220         20        0.000          0.000     0.500   729069.0
## 23    1 SS 1     230         20        0.000          0.000     0.500   729060.5
## 24    1 SS 1     240         20        0.000          0.000     0.500   729051.9
## 25    1 SS 1     250         20        0.000          0.000     0.500   729043.4
## 26    1 SS 1     260         20        0.000          0.000     0.500   729034.9
## 27    1 SS 1     270         20        0.000          0.000     0.500   729026.4
## 28    1 SS 1     280         20        0.000          0.000     0.500   729017.9
## 29    1 SS 1     290         20        0.000          0.000     0.500   729009.3
## 30    1 SS 1     300         20        0.000          0.000     0.500   729000.8
## 31    1 SS 1     310         20        0.000          0.000     0.500   728992.3
## 32    1 SS 1     320         20        0.000          0.000     0.500   728983.8
## 33    1 SS 1     330         20        0.000          0.000     0.500   728975.3
## 34    1 SS 1     340         20        0.000          0.000     0.500   728966.8
## 35    1 SS 1     350         20        0.270          0.027     0.502   728958.2
## 36    1 SS 1     360         20        1.009          0.101     0.504   728950.1
## 37    1 SS 1     370         20        0.000          0.000     0.500   728943.2
## 38    1 SS 1     380         20        0.000          0.000     0.500   728936.3
## 39    1 SS 1     390         20        1.574          0.157     0.510   728929.3
## 40    1 SS 1     400         20        0.412          0.041     0.504   728925.1
## 41    1 SS 1     410         20        0.000          0.000     0.500   728921.6
## 42    1 SS 1     420         20        1.050          0.105     0.510   728918.0
## 43    1 SS 1     430         20        1.304          0.130     0.512   728916.6
## 44    1 SS 1     440         20        0.000          0.000     0.500   728917.8
## 45    1 SS 1     450         20        0.280          0.028     0.503   728919.0
## 46    1 SS 1     460         20        1.927          0.193     0.512   728920.7
## 47    1 SS 1     470         20        0.000          0.000     0.500   728926.0
## 48    1 SS 1     480         20        0.000          0.000     0.500   728931.4
## 49    1 SS 1     490         20        0.409          0.041     0.501   728936.7
## 50    1 SS 1     500         20        0.084          0.008     0.500   728942.7
## 51    1 SS 1     510         20        0.000          0.000     0.500   728948.9
## 52    1 SS 1     520         20       -0.930         -0.093     0.506   728955.0
## 53    1 SS 1     530         20       -0.716         -0.072     0.505   728959.5
## 54    1 SS 1     540         20        0.000          0.000     0.500   728962.8
## 55    1 SS 1     550         20       -0.830         -0.083     0.506   728966.0
## 56    1 SS 1     560         20       -0.940         -0.094     0.506   728967.6
## 57    1 SS 1     570         20        0.000          0.000     0.500   728967.4
## 58    1 SS 1     580         20        0.000          0.000     0.500   728967.1
## 59    1 SS 1     590         20        0.000          0.000     0.500   728966.9
## 60    1 SS 1     600         20       -0.280         -0.028     0.501   728966.6
## 61    1 SS 1     610         20       -0.818         -0.082     0.503   728965.8
## 62    1 SS 1     620         20        0.000          0.000     0.500   728963.3
## 63    1 SS 1     630         20        0.000          0.000     0.500   728960.9
## 64    1 SS 1     640         20        0.000          0.000     0.500   728958.4
## 65    1 SS 1     650         20        0.000          0.000     0.500   728956.0
## 66    1 SS 1     660         20        0.000          0.000     0.500   728953.6
## 67    1 SS 1     670         20        0.000          0.000     0.500   728951.1
## 68    1 SS 1     680         20        0.000          0.000     0.500   728948.7
## 69    1 SS 1     690         20        0.000          0.000     0.500   728946.2
## 70    1 SS 1     700         20        0.000          0.000     0.500   728943.8
## 71    1 SS 1     710         20        0.000          0.000     0.500   728941.4
## 72    1 SS 1     720         20        0.000          0.000     0.500   728938.9
## 73    1 SS 1     730         20        0.000          0.000     0.500   728936.5
## 74    1 SS 1     740         20        0.000          0.000     0.500   728934.0
## 75    1 SS 1     750         20        0.000          0.000     0.500   728931.6
## 76    1 SS 1     760         20        0.000          0.000     0.500   728929.1
## 77    1 SS 1     770         20        0.000          0.000     0.500   728926.7
## 78    1 SS 1     780         20        0.000          0.000     0.500   728924.3
## 79    1 SS 1     790         20        0.000          0.000     0.500   728921.8
## 80    1 SS 1     800         20        0.000          0.000     0.500   728919.4
## 81    1 SS 1     810         20        0.000          0.000     0.500   728916.9
## 82    1 SS 1     820         20        0.000          0.000     0.500   728914.5
## 83    1 SS 1     830         20        0.000          0.000     0.500   728912.1
## 84    1 SS 1     840         20        0.000          0.000     0.500   728909.6
## 85    1 SS 1     850         20        0.000          0.000     0.500   728907.2
## 86    1 SS 1     860         20       -0.995         -0.100     0.504   728904.7
## 87    1 SS 1     870         20       -0.225         -0.022     0.501   728900.4
## 88    1 SS 1     880         20        0.000          0.000     0.500   728895.7
## 89    1 SS 1     890         20        0.000          0.000     0.500   728891.0
## 90    1 SS 1     900         20       -0.236         -0.024     0.500   728886.3
## 91    1 SS 1     910         20       -0.132         -0.013     0.500   728881.1
## 92    1 SS 1     920         20        0.000          0.000     0.500   728875.8
## 93    1 SS 1     930         20        0.000          0.000     0.500   728870.4
## 94    1 SS 1     940         20        0.000          0.000     0.500   728865.1
## 95    1 SS 1     950         20        0.000          0.000     0.500   728859.7
## 96    1 SS 1     960         20        0.000          0.000     0.500   728854.4
## 97    1 SS 1     970         20        0.000          0.000     0.500   728849.0
## 98    1 SS 1     980         20        0.000          0.000     0.500   728843.6
## 99    1 SS 1     990         20        3.018          0.302     0.551   728838.3
## 100   1 SS 1    1000         20        1.456          0.146     0.531   728839.0
##     Midpoint_Y turn_curvature
## 1      4957667            Inf
## 2      4957676            Inf
## 3      4957685            Inf
## 4      4957694            Inf
## 5      4957703       28.64928
## 6      4957713      534.95134
## 7      4957723       18.13793
## 8      4957731            Inf
## 9      4957740       16.00415
## 10     4957743            Inf
## 11     4957745            Inf
## 12     4957746            Inf
## 13     4957745            Inf
## 14     4957745            Inf
## 15     4957744       37.82928
## 16     4957746            Inf
## 17     4957749            Inf
## 18     4957752       47.36890
## 19     4957757            Inf
## 20     4957763            Inf
## 21     4957768            Inf
## 22     4957773            Inf
## 23     4957778            Inf
## 24     4957784            Inf
## 25     4957789            Inf
## 26     4957794            Inf
## 27     4957799            Inf
## 28     4957805            Inf
## 29     4957810            Inf
## 30     4957815            Inf
## 31     4957820            Inf
## 32     4957826            Inf
## 33     4957831            Inf
## 34     4957836            Inf
## 35     4957841            Inf
## 36     4957847       49.27605
## 37     4957854            Inf
## 38     4957861            Inf
## 39     4957869       31.34610
## 40     4957878            Inf
## 41     4957887            Inf
## 42     4957896       46.25097
## 43     4957906       37.24827
## 44     4957916            Inf
## 45     4957926      176.80500
## 46     4957936       25.66148
## 47     4957944            Inf
## 48     4957952            Inf
## 49     4957961            Inf
## 50     4957969            Inf
## 51     4957977            Inf
## 52     4957985       53.02203
## 53     4957993       68.89935
## 54     4958003            Inf
## 55     4958012       59.29952
## 56     4958022       52.34419
## 57     4958032            Inf
## 58     4958042            Inf
## 59     4958052            Inf
## 60     4958062      177.62492
## 61     4958072       60.87898
## 62     4958082            Inf
## 63     4958091            Inf
## 64     4958101            Inf
## 65     4958111            Inf
## 66     4958120            Inf
## 67     4958130            Inf
## 68     4958140            Inf
## 69     4958149            Inf
## 70     4958159            Inf
## 71     4958169            Inf
## 72     4958179            Inf
## 73     4958188            Inf
## 74     4958198            Inf
## 75     4958208            Inf
## 76     4958217            Inf
## 77     4958227            Inf
## 78     4958237            Inf
## 79     4958246            Inf
## 80     4958256            Inf
## 81     4958266            Inf
## 82     4958276            Inf
## 83     4958285            Inf
## 84     4958295            Inf
## 85     4958305            Inf
## 86     4958314       50.01758
## 87     4958323            Inf
## 88     4958332            Inf
## 89     4958341            Inf
## 90     4958350            Inf
## 91     4958358            Inf
## 92     4958367            Inf
## 93     4958375            Inf
## 94     4958384            Inf
## 95     4958392            Inf
## 96     4958401            Inf
## 97     4958409            Inf
## 98     4958417            Inf
## 99     4958426       15.11854
## 100    4958435       31.14539
##  [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 2007 rows ]</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="automatically-generating-stage-descriptions.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(route_convexity[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,], <span class="fu">aes</span>(<span class="at">x=</span>Midpoint_X, <span class="at">y=</span>Midpoint_Y)) <span class="sc">+</span></span>
<span id="cb56-2"><a href="automatically-generating-stage-descriptions.html#cb56-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">geom_path</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>turn_curvature))</span></code></pre></div>
<p><img src="images/stage-description-unnamed-chunk-35-1.png" width="672" /></p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="automatically-generating-stage-descriptions.html#cb57-1" aria-hidden="true" tabindex="-1"></a>route_convexity[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,]</span></code></pre></div>
<pre><code>##    FID  RID MidMeas WindowSize RawConvexity ConvexityIndex Sinuosity Midpoint_X
## 1    1 SS 1      10         20        0.000          0.000     0.500   729181.8
## 2    1 SS 1      20         20       -0.040         -0.004     0.500   729186.1
## 3    1 SS 1      30         20       -0.014         -0.001     0.500   729190.4
## 4    1 SS 1      40         20        0.000          0.000     0.500   729194.6
## 5    1 SS 1      50         20       -1.739         -0.174     0.509   729198.8
## 6    1 SS 1      60         20       -0.093         -0.009     0.501   729199.6
## 7    1 SS 1      70         20       -2.684         -0.268     0.527   729200.3
## 8    1 SS 1      80         20       -0.464         -0.046     0.507   729195.8
## 9    1 SS 1      90         20       -2.989         -0.299     0.537   729190.3
## 10   1 SS 1     100         20       -0.672         -0.067     0.512   729181.4
##    Midpoint_Y turn_curvature
## 1     4957667            Inf
## 2     4957676            Inf
## 3     4957685            Inf
## 4     4957694            Inf
## 5     4957703       28.64928
## 6     4957713      534.95134
## 7     4957723       18.13793
## 8     4957731            Inf
## 9     4957740       16.00415
## 10    4957743            Inf</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="adding-openstreetmap-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="creating-a-road-book.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/RallyDataJunkie/visualising-rally-stages/edit/master/creating-stage-descriptions.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/RallyDataJunkie/visualising-rally-stages/blob/master/creating-stage-descriptions.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toc_depth": 3,
"toolbar": {
"position": "fixed"
},
"search": true,
"info": true
});
});
</script>

</body>

</html>
