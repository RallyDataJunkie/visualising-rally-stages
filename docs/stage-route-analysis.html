<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>17 Stage Route Analysis | Visualising WRC Rally Stages With rayshader and R</title>
  <meta name="description" content="Rally stage maps often appear on rally websites displayed via interactive web maps. The data used to generate the routes is often available as a digital data file of some sort. This book takes one such file and embarks on an adventure into the wilds of geocomputing using the R programming language to see just where such a file may take us. From web maps and elevation maps to interactive 3D displays, let the exploration commence…" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="17 Stage Route Analysis | Visualising WRC Rally Stages With rayshader and R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Rally stage maps often appear on rally websites displayed via interactive web maps. The data used to generate the routes is often available as a digital data file of some sort. This book takes one such file and embarks on an adventure into the wilds of geocomputing using the R programming language to see just where such a file may take us. From web maps and elevation maps to interactive 3D displays, let the exploration commence…" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="17 Stage Route Analysis | Visualising WRC Rally Stages With rayshader and R" />
  
  <meta name="twitter:description" content="Rally stage maps often appear on rally websites displayed via interactive web maps. The data used to generate the routes is often available as a digital data file of some sort. This book takes one such file and embarks on an adventure into the wilds of geocomputing using the R programming language to see just where such a file may take us. From web maps and elevation maps to interactive 3D displays, let the exploration commence…" />
  

<meta name="author" content="Tony Hirst" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="composing-rayshader-stills-and-movies.html"/>
<link rel="next" href="elevation-data-revisited.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3.9000/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.3.9000/leaflet-providers-plugin.js"></script>
<link href="libs/leaflet-minimap-3.3.1/Control.MiniMap.min.css" rel="stylesheet" />
<script src="libs/leaflet-minimap-3.3.1/Control.MiniMap.min.js"></script>
<script src="libs/leaflet-minimap-3.3.1/Minimap-binding.js"></script>
<script src="libs/FlatGeoBuf-3.3.3/fgb.js"></script>
<script src="libs/FlatGeoBuf-3.3.3/flatgeobuf-geojson.min.js"></script>
<script src="libs/chromajs-2.1.0/chroma.min.js"></script>
<link id="geojson_sf-1-attachment" rel="attachment" href="libs/geojson_sf-0.0.1/geojson_sf_layer.fgb"/>
<link href="libs/HomeButton-0.0.1/home-button.css" rel="stylesheet" />
<script src="libs/HomeButton-0.0.1/home-button.js"></script>
<script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />
<link href="libs/leaflet-awesomemarkers-2.0.3/leaflet.awesome-markers.css" rel="stylesheet" />
<script src="libs/leaflet-awesomemarkers-2.0.3/leaflet.awesome-markers.min.js"></script>
<link href="libs/fontawesome-4.7.0/font-awesome.min.css" rel="stylesheet" />
<link href="libs/style-1/style.css" rel="stylesheet" />
<script src="libs/plainView-binding-2.9.0/plainView.js"></script>
<link id="image-1-attachment" rel="attachment" href="libs/image-1/img.png"/>
<script src="libs/elev_img-1/data_stars_elev_imgdacf38.txt"></script>
<script src="libs/joda-0.0.1/joda.js"></script>
<script src="libs/joda-0.0.1/addImageQuery-bindings.js"></script>
<script src="libs/rglWebGL-binding-0.105.14/rglWebGL.js"></script>
<link href="libs/rglwidgetClass-0.105.14/rgl.css" rel="stylesheet" />
<script src="libs/rglwidgetClass-0.105.14/rglClass.src.js"></script>
<script src="libs/rglwidgetClass-0.105.14/utils.src.js"></script>
<script src="libs/rglwidgetClass-0.105.14/subscenes.src.js"></script>
<script src="libs/rglwidgetClass-0.105.14/shaders.src.js"></script>
<script src="libs/rglwidgetClass-0.105.14/textures.src.js"></script>
<script src="libs/rglwidgetClass-0.105.14/projection.src.js"></script>
<script src="libs/rglwidgetClass-0.105.14/mouse.src.js"></script>
<script src="libs/rglwidgetClass-0.105.14/init.src.js"></script>
<script src="libs/rglwidgetClass-0.105.14/pieces.src.js"></script>
<script src="libs/rglwidgetClass-0.105.14/draw.src.js"></script>
<script src="libs/rglwidgetClass-0.105.14/controls.src.js"></script>
<script src="libs/rglwidgetClass-0.105.14/selection.src.js"></script>
<script src="libs/rglwidgetClass-0.105.14/rglTimer.src.js"></script>
<script src="libs/CanvasMatrix4-0.105.14/CanvasMatrix.src.js"></script>
<link href="libs/vembedr-0.1.4/css/vembedr.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Index</a></li>
<li class="chapter" data-level="" data-path="in-the-beginning.html"><a href="in-the-beginning.html"><i class="fa fa-check"></i>In the beginning…</a></li>
<li class="chapter" data-level="" data-path="acknowledgements.html"><a href="acknowledgements.html"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#who-this-book-is-for"><i class="fa fa-check"></i><b>1.1</b> Who This Book Is For</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#what-this-book-isnt"><i class="fa fa-check"></i><b>1.2</b> What This Book Isn’t</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#structure-of-the-book"><i class="fa fa-check"></i><b>1.3</b> Structure of the Book</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#further-reading"><i class="fa fa-check"></i><b>1.4</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="getting-started.html"><a href="getting-started.html"><i class="fa fa-check"></i><b>2</b> Getting Started</a>
<ul>
<li class="chapter" data-level="2.1" data-path="getting-started.html"><a href="getting-started.html#setting-up-a-working-code-execution-environment"><i class="fa fa-check"></i><b>2.1</b> Setting Up a Working Code Execution Environment</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="getting-started.html"><a href="getting-started.html#installing-the-docker-environment"><i class="fa fa-check"></i><b>2.1.1</b> Installing the Docker Environment</a></li>
<li class="chapter" data-level="2.1.2" data-path="getting-started.html"><a href="getting-started.html#installing-the-required-r-packages-manually"><i class="fa fa-check"></i><b>2.1.2</b> Installing the Required R Packages Manually</a></li>
<li class="chapter" data-level="2.1.3" data-path="getting-started.html"><a href="getting-started.html#other-installation-dependencies"><i class="fa fa-check"></i><b>2.1.3</b> Other Installation Dependencies</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="getting-started.html"><a href="getting-started.html#using-the-rstudio-environment"><i class="fa fa-check"></i><b>2.2</b> Using the RStudio Environment</a></li>
<li class="chapter" data-level="2.3" data-path="getting-started.html"><a href="getting-started.html#using-a-jupyter-notebook-environment"><i class="fa fa-check"></i><b>2.3</b> Using a Jupyter Notebook Environment</a></li>
<li class="chapter" data-level="2.4" data-path="getting-started.html"><a href="getting-started.html#exploring-the-book-as-an-online-interactive-textbook-not-yet"><i class="fa fa-check"></i><b>2.4</b> Exploring the Book as an Online Interactive Textbook (Not Yet!)</a></li>
<li class="chapter" data-level="2.5" data-path="getting-started.html"><a href="getting-started.html#serving-your-own-map-tiles-and-elevation-raster-images"><i class="fa fa-check"></i><b>2.5</b> Serving Your Own Map Tiles and Elevation Raster Images</a></li>
<li class="chapter" data-level="2.6" data-path="getting-started.html"><a href="getting-started.html#donate"><i class="fa fa-check"></i><b>2.6</b> Donate</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html"><i class="fa fa-check"></i><b>3</b> Importing the Stage Route Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#downloading-the-stage-data-file"><i class="fa fa-check"></i><b>3.1</b> Downloading the Stage Data File</a></li>
<li class="chapter" data-level="3.2" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#opening-kml-geodata-files"><i class="fa fa-check"></i><b>3.2</b> Opening KML Geodata Files</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#using-rgdal-and-sp-to-open-geodata-files"><i class="fa fa-check"></i><b>3.2.1</b> Using <code>rgdal</code> and <code>sp</code> to Open Geodata Files</a></li>
<li class="chapter" data-level="3.2.2" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#using-sf-to-open-geodata-files"><i class="fa fa-check"></i><b>3.2.2</b> Using <code>sf</code> to Open Geodata Files</a></li>
<li class="chapter" data-level="3.2.3" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#accessing-route-data-as-a-geojson-string"><i class="fa fa-check"></i><b>3.2.3</b> Accessing Route Data as a geojson String</a></li>
<li class="chapter" data-level="3.2.4" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#saving-simple-features-data-to-various-geodata-file-formats"><i class="fa fa-check"></i><b>3.2.4</b> Saving Simple Features Data to Various Geodata File Formats</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#important-geodata-file-formats"><i class="fa fa-check"></i><b>3.3</b> Important Geodata File Formats</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#loading-geojson-data"><i class="fa fa-check"></i><b>3.3.1</b> Loading geojson Data</a></li>
<li class="chapter" data-level="3.3.2" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#loading-gpx-data"><i class="fa fa-check"></i><b>3.3.2</b> Loading GPX Data</a></li>
<li class="chapter" data-level="3.3.3" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#loading-flight-data-using-igc-format-gps-files"><i class="fa fa-check"></i><b>3.3.3</b> Loading Flight Data Using IGC format GPS Files</a></li>
<li class="chapter" data-level="3.3.4" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#reading-data-from-gps-devices"><i class="fa fa-check"></i><b>3.3.4</b> Reading Data from GPS Devices</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="working-with-route-data.html"><a href="working-with-route-data.html"><i class="fa fa-check"></i><b>4</b> Working with Route Data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="working-with-route-data.html"><a href="working-with-route-data.html#loading-in-the-route-data"><i class="fa fa-check"></i><b>4.1</b> Loading in the Route Data</a></li>
<li class="chapter" data-level="4.2" data-path="working-with-route-data.html"><a href="working-with-route-data.html#access-a-specific-stage"><i class="fa fa-check"></i><b>4.2</b> Access a specific stage</a></li>
<li class="chapter" data-level="4.3" data-path="working-with-route-data.html"><a href="working-with-route-data.html#visual-preview-of-route-geodata"><i class="fa fa-check"></i><b>4.3</b> Visual Preview of Route Geodata</a></li>
<li class="chapter" data-level="4.4" data-path="working-with-route-data.html"><a href="working-with-route-data.html#previews-using-ggplot2"><i class="fa fa-check"></i><b>4.4</b> Previews using <code>ggplot2</code></a></li>
<li class="chapter" data-level="4.5" data-path="working-with-route-data.html"><a href="working-with-route-data.html#identifying-the-start-and-end-of-the-stage"><i class="fa fa-check"></i><b>4.5</b> Identifying the Start and End of the Stage</a></li>
<li class="chapter" data-level="4.6" data-path="working-with-route-data.html"><a href="working-with-route-data.html#extracting-route-fragments"><i class="fa fa-check"></i><b>4.6</b> Extracting Route Fragments</a></li>
<li class="chapter" data-level="4.7" data-path="working-with-route-data.html"><a href="working-with-route-data.html#previews-using-leaflet-interactive-maps"><i class="fa fa-check"></i><b>4.7</b> Previews Using <code>leaflet</code> Interactive Maps</a></li>
<li class="chapter" data-level="4.8" data-path="working-with-route-data.html"><a href="working-with-route-data.html#creating-buffer-regions-around-features"><i class="fa fa-check"></i><b>4.8</b> Creating Buffer regions around features</a></li>
<li class="chapter" data-level="4.9" data-path="working-with-route-data.html"><a href="working-with-route-data.html#adding-additional-features-to-leaflet-maps"><i class="fa fa-check"></i><b>4.9</b> Adding Additional Features to <code>leaflet</code> maps</a>
<ul>
<li class="chapter" data-level="4.9.1" data-path="working-with-route-data.html"><a href="working-with-route-data.html#add-minimap-navigation"><i class="fa fa-check"></i><b>4.9.1</b> Add “minimap” navigation</a></li>
<li class="chapter" data-level="4.9.2" data-path="working-with-route-data.html"><a href="working-with-route-data.html#add-custom-symbol-legends"><i class="fa fa-check"></i><b>4.9.2</b> Add Custom Symbol Legends</a></li>
<li class="chapter" data-level="4.9.3" data-path="working-with-route-data.html"><a href="working-with-route-data.html#adding-mini-charts-to-maps"><i class="fa fa-check"></i><b>4.9.3</b> Adding Mini-Charts to Maps</a></li>
<li class="chapter" data-level="4.9.4" data-path="working-with-route-data.html"><a href="working-with-route-data.html#adding-html-content-to-popups"><i class="fa fa-check"></i><b>4.9.4</b> Adding HTML content to popups</a></li>
</ul></li>
<li class="chapter" data-level="4.10" data-path="working-with-route-data.html"><a href="working-with-route-data.html#using-mapview-to-create-leaflet-maps"><i class="fa fa-check"></i><b>4.10</b> Using <code>mapview</code> To Create <em>leaflet</em> Maps</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html"><i class="fa fa-check"></i><b>5</b> Introducing Map Projections</a>
<ul>
<li class="chapter" data-level="5.1" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#load-in-the-route-data"><i class="fa fa-check"></i><b>5.1</b> Load in the Route Data</a></li>
<li class="chapter" data-level="5.2" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#previewing-a-map-route"><i class="fa fa-check"></i><b>5.2</b> Previewing a Map Route</a></li>
<li class="chapter" data-level="5.3" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#plotting-latlong-naively"><i class="fa fa-check"></i><b>5.3</b> Plotting LatLong Naively</a></li>
<li class="chapter" data-level="5.4" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#using-the-utm-co-ordinate-reference-system"><i class="fa fa-check"></i><b>5.4</b> Using the UTM Co-ordinate Reference System</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#using-st_transform-for-projection-transformations"><i class="fa fa-check"></i><b>5.4.1</b> Using <code>st_transform</code> for Projection Transformations</a></li>
<li class="chapter" data-level="5.4.2" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#using-ggplot2coord_sf-to-render-projections"><i class="fa fa-check"></i><b>5.4.2</b> Using <code>ggplot2::coord_sf</code> to Render Projections</a></li>
<li class="chapter" data-level="5.4.3" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#exporting-the-route-data-as-a-dataframe"><i class="fa fa-check"></i><b>5.4.3</b> Exporting the Route Data As a Dataframe</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#alternative-crs-projections"><i class="fa fa-check"></i><b>5.5</b> Alternative CRS Projections</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="stage-route-annotations.html"><a href="stage-route-annotations.html"><i class="fa fa-check"></i><b>6</b> Stage Route Annotations</a>
<ul>
<li class="chapter" data-level="6.1" data-path="stage-route-annotations.html"><a href="stage-route-annotations.html#load-in-the-route-data-1"><i class="fa fa-check"></i><b>6.1</b> Load in the Route Data</a></li>
<li class="chapter" data-level="6.2" data-path="stage-route-annotations.html"><a href="stage-route-annotations.html#adding-split-point-locations"><i class="fa fa-check"></i><b>6.2</b> Adding Split Point Locations</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="stage-route-annotations.html"><a href="stage-route-annotations.html#using-geojson-to-find-the-distance-along-a-route"><i class="fa fa-check"></i><b>6.2.1</b> Using geojson to Find the Distance Along a Route</a></li>
<li class="chapter" data-level="6.2.2" data-path="stage-route-annotations.html"><a href="stage-route-annotations.html#using-rgeosginterpolate-to-find-the-distance-along-a-route"><i class="fa fa-check"></i><b>6.2.2</b> Using <code>rgeos::gInterpolate</code> to Find the Distance Along a Route</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="stage-route-annotations.html"><a href="stage-route-annotations.html#parallel-routes"><i class="fa fa-check"></i><b>6.3</b> Parallel Routes</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html"><i class="fa fa-check"></i><b>7</b> Accessing and Working With Elevation Data Raster Files</a>
<ul>
<li class="chapter" data-level="7.1" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#introducing-digital-elevation-model-dem-raster-images"><i class="fa fa-check"></i><b>7.1</b> Introducing Digital Elevation Model (DEM) Raster Images</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#what-is-raster-data"><i class="fa fa-check"></i><b>7.1.1</b> What Is Raster Data?</a></li>
<li class="chapter" data-level="7.1.2" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#what-are-digital-elevation-models-dems"><i class="fa fa-check"></i><b>7.1.2</b> What Are Digital Elevation Models (DEMs)?</a></li>
<li class="chapter" data-level="7.1.3" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#the-r-raster-package"><i class="fa fa-check"></i><b>7.1.3</b> The R <code>raster</code> Package</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#downloading-elevation-data"><i class="fa fa-check"></i><b>7.2</b> Downloading Elevation Data</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#loading-in-some-stage-data"><i class="fa fa-check"></i><b>7.2.1</b> Loading in some stage data</a></li>
<li class="chapter" data-level="7.2.2" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#obtaining-relief-elevation-raster-data-using-elevatr"><i class="fa fa-check"></i><b>7.2.2</b> Obtaining relief / elevation raster data using <code>elevatr</code></a></li>
<li class="chapter" data-level="7.2.3" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#plotting-rasters-as-ggplot-objects"><i class="fa fa-check"></i><b>7.2.3</b> Plotting Rasters As <code>ggplot</code> Objects</a></li>
<li class="chapter" data-level="7.2.4" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#interactive-raster-previews-with-plainview"><i class="fa fa-check"></i><b>7.2.4</b> Interactive Raster Previews with <code>plainview</code></a></li>
<li class="chapter" data-level="7.2.5" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#saving-the-image-raster-data-to-a-local-file"><i class="fa fa-check"></i><b>7.2.5</b> Saving the Image Raster Data to a Local File</a></li>
<li class="chapter" data-level="7.2.6" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#from-raster-to-terra"><i class="fa fa-check"></i><b>7.2.6</b> From <code>raster</code> to <code>terra</code></a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#overlaying-raster-images-on-leaflet-maps"><i class="fa fa-check"></i><b>7.3</b> Overlaying Raster Images on Leaflet Maps</a></li>
<li class="chapter" data-level="7.4" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#retrieving-descriptive-information-about-the-raster"><i class="fa fa-check"></i><b>7.4</b> Retrieving Descriptive Information About the Raster</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#using-mapzen-to-retrieve-dem-raster-data"><i class="fa fa-check"></i><b>7.4.1</b> Using Mapzen to Retrieve DEM raster data</a></li>
<li class="chapter" data-level="7.4.2" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#additional-elevation-data-downloading-tools"><i class="fa fa-check"></i><b>7.4.2</b> Additional Elevation Data Downloading Tools</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#manipulating-raster-images"><i class="fa fa-check"></i><b>7.5</b> Manipulating Raster Images</a></li>
<li class="chapter" data-level="7.6" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#ridge-maps"><i class="fa fa-check"></i><b>7.6</b> Ridge maps</a></li>
<li class="chapter" data-level="7.7" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#further-information"><i class="fa fa-check"></i><b>7.7</b> Further Information</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="determining-terrain-features-from-raster-data.html"><a href="determining-terrain-features-from-raster-data.html"><i class="fa fa-check"></i><b>8</b> Determining Terrain Features from Raster Data</a>
<ul>
<li class="chapter" data-level="8.1" data-path="determining-terrain-features-from-raster-data.html"><a href="determining-terrain-features-from-raster-data.html#load-in-base-data"><i class="fa fa-check"></i><b>8.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="8.2" data-path="determining-terrain-features-from-raster-data.html"><a href="determining-terrain-features-from-raster-data.html#rendering-terrain-over-raster-images"><i class="fa fa-check"></i><b>8.2</b> Rendering Terrain Over Raster Images</a></li>
<li class="chapter" data-level="8.3" data-path="determining-terrain-features-from-raster-data.html"><a href="determining-terrain-features-from-raster-data.html#adding-contours-to-raster-images"><i class="fa fa-check"></i><b>8.3</b> Adding Contours to <code>raster</code> Images</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="using-rayshader-to-render-2d-elevation-and-shade-views.html"><a href="using-rayshader-to-render-2d-elevation-and-shade-views.html"><i class="fa fa-check"></i><b>9</b> Using <code>rayshader</code> to Render 2D Elevation and Shade Views</a>
<ul>
<li class="chapter" data-level="9.1" data-path="using-rayshader-to-render-2d-elevation-and-shade-views.html"><a href="using-rayshader-to-render-2d-elevation-and-shade-views.html#load-in-base-data-1"><i class="fa fa-check"></i><b>9.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="9.2" data-path="using-rayshader-to-render-2d-elevation-and-shade-views.html"><a href="using-rayshader-to-render-2d-elevation-and-shade-views.html#rendering-imagery-from-the-dem-raster"><i class="fa fa-check"></i><b>9.2</b> Rendering imagery from the DEM raster</a></li>
<li class="chapter" data-level="9.3" data-path="using-rayshader-to-render-2d-elevation-and-shade-views.html"><a href="using-rayshader-to-render-2d-elevation-and-shade-views.html#roundtripping-rayshader-rasters-and-matrices"><i class="fa fa-check"></i><b>9.3</b> Roundtripping <code>rayshader</code> Rasters and Matrices</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html"><i class="fa fa-check"></i><b>10</b> Overlaying 2D <code>rayshader</code> Maps</a>
<ul>
<li class="chapter" data-level="10.1" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#load-in-base-data-2"><i class="fa fa-check"></i><b>10.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="10.2" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#adding-overlays"><i class="fa fa-check"></i><b>10.2</b> Adding overlays</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#adding-shadows-to-rayshader-maps"><i class="fa fa-check"></i><b>10.2.1</b> Adding Shadows to <code>rayshader</code> Maps</a></li>
<li class="chapter" data-level="10.2.2" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#adding-water-features"><i class="fa fa-check"></i><b>10.2.2</b> Adding Water Features</a></li>
<li class="chapter" data-level="10.2.3" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#overlaying-map-tiles"><i class="fa fa-check"></i><b>10.2.3</b> Overlaying Map Tiles</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#adding-a-stage-route-layer"><i class="fa fa-check"></i><b>10.3</b> Adding a Stage Route Layer</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#buffering-the-stage-route-view"><i class="fa fa-check"></i><b>10.3.1</b> Buffering the Stage Route View</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#modeling-increased-water-levels"><i class="fa fa-check"></i><b>10.4</b> Modeling Increased Water Levels</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="annotating-rayshader-maps.html"><a href="annotating-rayshader-maps.html"><i class="fa fa-check"></i><b>11</b> Annotating <code>rayshader</code> maps</a>
<ul>
<li class="chapter" data-level="11.1" data-path="annotating-rayshader-maps.html"><a href="annotating-rayshader-maps.html#load-in-base-data-3"><i class="fa fa-check"></i><b>11.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="11.2" data-path="annotating-rayshader-maps.html"><a href="annotating-rayshader-maps.html#adding-a-title-to-a-map"><i class="fa fa-check"></i><b>11.2</b> Adding a Title to a Map</a></li>
<li class="chapter" data-level="11.3" data-path="annotating-rayshader-maps.html"><a href="annotating-rayshader-maps.html#adding-contours-to-rayshader-stage-maps"><i class="fa fa-check"></i><b>11.3</b> Adding Contours to <code>rayshader</code> Stage Maps</a></li>
<li class="chapter" data-level="11.4" data-path="annotating-rayshader-maps.html"><a href="annotating-rayshader-maps.html#overlaying-image-tiles"><i class="fa fa-check"></i><b>11.4</b> Overlaying Image Tiles</a></li>
<li class="chapter" data-level="11.5" data-path="annotating-rayshader-maps.html"><a href="annotating-rayshader-maps.html#plotting-route-layers-on-rayshader-maps"><i class="fa fa-check"></i><b>11.5</b> Plotting Route Layers on <code>rayshader</code> Maps</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="an-aside-the-penny-red.html"><a href="an-aside-the-penny-red.html"><i class="fa fa-check"></i>An Aside - The Penny Red</a>
<ul>
<li><a href="an-aside-the-penny-red.html#d-rendering-of-colour-images-using-rayshader">3D Rendering of Colour Images Using <code>rayshader</code></a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="an-aside-the-penny-red.html"><a href="an-aside-the-penny-red.html#rendering-the-image-directly-from-ggplot2"><i class="fa fa-check"></i><b>11.5.1</b> Rendering the image directly from <code>ggplot2</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="an-aside-the-penny-red.html"><a href="an-aside-the-penny-red.html#rendering-a-movie"><i class="fa fa-check"></i>Rendering a Movie</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html"><i class="fa fa-check"></i><b>12</b> Introducing 3D <code>rayshader</code> Models</a>
<ul>
<li class="chapter" data-level="12.1" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#rendering-the-3d-maps-in-rstudio-and-knitrable-rmd-documents"><i class="fa fa-check"></i><b>12.1</b> Rendering the 3D Maps in <em>RStudio&amp; and <code>knitr</code>able </em>Rmd* Documents</a></li>
<li class="chapter" data-level="12.2" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#rendering-a-3d-view"><i class="fa fa-check"></i><b>12.2</b> Rendering a 3D View</a></li>
<li class="chapter" data-level="12.3" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#the-rayshader-3d-model-plinth"><i class="fa fa-check"></i><b>12.3</b> The <code>rayshader</code> 3D Model Plinth</a></li>
<li class="chapter" data-level="12.4" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#saving-the-widget-as-an-html-file"><i class="fa fa-check"></i><b>12.4</b> Saving the Widget as an HTML File</a></li>
<li class="chapter" data-level="12.5" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#rendering-the-model-to-an-image-file"><i class="fa fa-check"></i><b>12.5</b> Rendering the Model to an Image File</a></li>
<li class="chapter" data-level="12.6" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#rendering-high-quality-models"><i class="fa fa-check"></i><b>12.6</b> Rendering High Quality Models</a></li>
<li class="chapter" data-level="12.7" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#making-a-3d-print-file"><i class="fa fa-check"></i><b>12.7</b> Making a 3D Print File</a></li>
<li class="chapter" data-level="12.8" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#saving-a-movie-of-a-3d-model"><i class="fa fa-check"></i><b>12.8</b> Saving a Movie of a 3D Model</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="rendering-3d-rayshader-stage-route-maps.html"><a href="rendering-3d-rayshader-stage-route-maps.html"><i class="fa fa-check"></i><b>13</b> Rendering 3D <code>rayshader</code> Stage Route Maps</a>
<ul>
<li class="chapter" data-level="13.1" data-path="rendering-3d-rayshader-stage-route-maps.html"><a href="rendering-3d-rayshader-stage-route-maps.html#load-in-base-data-4"><i class="fa fa-check"></i><b>13.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="13.2" data-path="rendering-3d-rayshader-stage-route-maps.html"><a href="rendering-3d-rayshader-stage-route-maps.html#setting-up-3d-embedded-plots"><i class="fa fa-check"></i><b>13.2</b> Setting Up 3D Embedded Plots</a></li>
<li class="chapter" data-level="13.3" data-path="rendering-3d-rayshader-stage-route-maps.html"><a href="rendering-3d-rayshader-stage-route-maps.html#rendering-a-simple-stage-route-model"><i class="fa fa-check"></i><b>13.3</b> Rendering a Simple Stage Route Model</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="rendering-3d-rayshader-stage-route-maps.html"><a href="rendering-3d-rayshader-stage-route-maps.html#decorating-3d-views-with-map-tile-overlays"><i class="fa fa-check"></i><b>13.3.1</b> Decorating 3D Views With Map Tile Overlays</a></li>
<li class="chapter" data-level="13.3.2" data-path="rendering-3d-rayshader-stage-route-maps.html"><a href="rendering-3d-rayshader-stage-route-maps.html#adding-labels-to-3d-rayshader-maps"><i class="fa fa-check"></i><b>13.3.2</b> Adding Labels to 3D <code>rayshader</code> Maps</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="creating-cropped-3d-rayshader-models.html"><a href="creating-cropped-3d-rayshader-models.html"><i class="fa fa-check"></i><b>14</b> Creating Cropped 3d <code>rayshader</code> Models</a>
<ul>
<li class="chapter" data-level="14.1" data-path="creating-cropped-3d-rayshader-models.html"><a href="creating-cropped-3d-rayshader-models.html#load-in-base-data-5"><i class="fa fa-check"></i><b>14.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="14.2" data-path="creating-cropped-3d-rayshader-models.html"><a href="creating-cropped-3d-rayshader-models.html#cropping-the-rendered-3d-view"><i class="fa fa-check"></i><b>14.2</b> Cropping the Rendered 3D View</a></li>
<li class="chapter" data-level="14.3" data-path="creating-cropped-3d-rayshader-models.html"><a href="creating-cropped-3d-rayshader-models.html#cropping-3d-models-to-a-buffered-region"><i class="fa fa-check"></i><b>14.3</b> Cropping 3D Models to a Buffered Region</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="obtaining-shadows-for-a-particular-date-and-time.html"><a href="obtaining-shadows-for-a-particular-date-and-time.html"><i class="fa fa-check"></i><b>15</b> Obtaining Shadows for a Particular Date and Time</a>
<ul>
<li class="chapter" data-level="15.1" data-path="obtaining-shadows-for-a-particular-date-and-time.html"><a href="obtaining-shadows-for-a-particular-date-and-time.html#load-in-base-data-6"><i class="fa fa-check"></i><b>15.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="15.2" data-path="obtaining-shadows-for-a-particular-date-and-time.html"><a href="obtaining-shadows-for-a-particular-date-and-time.html#sunlight-times-vocabulary"><i class="fa fa-check"></i><b>15.2</b> Sunlight Times Vocabulary</a></li>
<li class="chapter" data-level="15.3" data-path="obtaining-shadows-for-a-particular-date-and-time.html"><a href="obtaining-shadows-for-a-particular-date-and-time.html#finding-sunrise-and-sunset-times"><i class="fa fa-check"></i><b>15.3</b> Finding Sunrise and Sunset Times</a></li>
<li class="chapter" data-level="15.4" data-path="obtaining-shadows-for-a-particular-date-and-time.html"><a href="obtaining-shadows-for-a-particular-date-and-time.html#animating-shade"><i class="fa fa-check"></i><b>15.4</b> Animating Shade</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html"><i class="fa fa-check"></i><b>16</b> Composing <code>rayshader</code> Stills and Movies</a>
<ul>
<li class="chapter" data-level="16.1" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html#load-in-base-data-7"><i class="fa fa-check"></i><b>16.1</b> Load in Base Data</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html#adding-complications"><i class="fa fa-check"></i><b>16.1.1</b> Adding Complications…</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html#setting-up-the-camera-shots-in-rayshader"><i class="fa fa-check"></i><b>16.2</b> Setting Up the Camera Shots in <code>rayshader</code></a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html#depth-of-field"><i class="fa fa-check"></i><b>16.2.1</b> Depth of Field</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html#camera-positioning"><i class="fa fa-check"></i><b>16.3</b> Camera Positioning</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html#lighting-effects"><i class="fa fa-check"></i><b>16.3.1</b> Lighting Effects</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html#making-3d-video-tracking-shots"><i class="fa fa-check"></i><b>16.4</b> Making 3D Video Tracking Shots</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html"><i class="fa fa-check"></i><b>17</b> Stage Route Analysis</a>
<ul>
<li class="chapter" data-level="17.1" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#load-in-base-data-8"><i class="fa fa-check"></i><b>17.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="17.2" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#generating-stage-route-profiles"><i class="fa fa-check"></i><b>17.2</b> Generating Stage Route Profiles</a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#an-aside---twists-and-turns-of-rally-stages"><i class="fa fa-check"></i><b>17.2.1</b> An Aside - Twists and Turns of Rally Stages</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#finding-stage-route-lengths"><i class="fa fa-check"></i><b>17.3</b> Finding Stage Route Lengths</a></li>
<li class="chapter" data-level="17.4" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#using-ecological-movement-analysis-tools-to-analyse-stage-routes"><i class="fa fa-check"></i><b>17.4</b> Using Ecological Movement Analysis Tools to Analyse Stage Routes</a></li>
<li class="chapter" data-level="17.5" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#using-trajr-for-stage-route-profiling"><i class="fa fa-check"></i><b>17.5</b> Using <code>trajr</code> for Stage Route Profiling</a>
<ul>
<li class="chapter" data-level="17.5.1" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#smoothing-a-trajectory"><i class="fa fa-check"></i><b>17.5.1</b> Smoothing a Trajectory</a></li>
<li class="chapter" data-level="17.5.2" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#resampling-locations"><i class="fa fa-check"></i><b>17.5.2</b> Resampling Locations</a></li>
<li class="chapter" data-level="17.5.3" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#resampling-against-distance"><i class="fa fa-check"></i><b>17.5.3</b> Resampling Against Distance</a></li>
<li class="chapter" data-level="17.5.4" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#splitting-a-trajectory"><i class="fa fa-check"></i><b>17.5.4</b> Splitting a Trajectory</a></li>
<li class="chapter" data-level="17.5.5" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#rotating-the-stage-trajectory"><i class="fa fa-check"></i><b>17.5.5</b> Rotating the Stage Trajectory</a></li>
<li class="chapter" data-level="17.5.6" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#straightness-and-sinuosity"><i class="fa fa-check"></i><b>17.5.6</b> Straightness and Sinuosity</a></li>
<li class="chapter" data-level="17.5.7" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#directional-change"><i class="fa fa-check"></i><b>17.5.7</b> Directional Change</a></li>
<li class="chapter" data-level="17.5.8" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#tracking-turning-angles"><i class="fa fa-check"></i><b>17.5.8</b> Tracking Turning Angles</a></li>
<li class="chapter" data-level="17.5.9" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#visualising-trajectory-direction-changes"><i class="fa fa-check"></i><b>17.5.9</b> Visualising Trajectory Direction Changes</a></li>
<li class="chapter" data-level="17.5.10" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#using-amt-for-stage-route-profiling"><i class="fa fa-check"></i><b>17.5.10</b> Using <code>amt</code> for Stage Route Profiling</a></li>
<li class="chapter" data-level="17.5.11" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#creating-tracks"><i class="fa fa-check"></i><b>17.5.11</b> Creating Tracks</a></li>
<li class="chapter" data-level="17.5.12" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#converting-to-other-track-formats"><i class="fa fa-check"></i><b>17.5.12</b> Converting to Other Track Formats</a></li>
<li class="chapter" data-level="17.5.13" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#using-amt-for-stage-route-analysis"><i class="fa fa-check"></i><b>17.5.13</b> Using <code>amt</code> for Stage Route Analysis</a></li>
<li class="chapter" data-level="17.5.14" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#using-rlft-for-profiling-along-a-stage-route"><i class="fa fa-check"></i><b>17.5.14</b> Using `rLFT`` for Profiling Along a Stage Route</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html"><i class="fa fa-check"></i><b>18</b> Elevation Data Revisited</a>
<ul>
<li class="chapter" data-level="18.1" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#load-in-base-data-9"><i class="fa fa-check"></i><b>18.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="18.2" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#generating-elevation-maps"><i class="fa fa-check"></i><b>18.2</b> Generating Elevation Maps</a>
<ul>
<li class="chapter" data-level="18.2.1" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#accessing-elevation-values-along-a-route-from-an-elevation-raster"><i class="fa fa-check"></i><b>18.2.1</b> Accessing Elevation Values Along a Route from an Elevation Raster</a></li>
<li class="chapter" data-level="18.2.2" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#using-geospheredistgeo-to-find-distance-along-a-route"><i class="fa fa-check"></i><b>18.2.2</b> Using <code>geosphere::distGeo</code> to Find Distance Along a Route</a></li>
<li class="chapter" data-level="18.2.3" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#using-spspdists-to-find-distance-along-a-route"><i class="fa fa-check"></i><b>18.2.3</b> Using <code>sp::spDists</code> to Find Distance Along a Route</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#generating-a-3d-ribbon-plot-of-the-stage-route"><i class="fa fa-check"></i><b>18.3</b> Generating a 3D Ribbon Plot of the Stage Route</a></li>
<li class="chapter" data-level="18.4" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#identifying-road-type"><i class="fa fa-check"></i><b>18.4</b> Identifying Road Type</a></li>
<li class="chapter" data-level="18.5" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#displaying-route-twistiness-and-elevation"><i class="fa fa-check"></i><b>18.5</b> Displaying Route Twistiness and Elevation</a>
<ul>
<li class="chapter" data-level="18.5.1" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#making-a-3d-print-file-of-the-model"><i class="fa fa-check"></i><b>18.5.1</b> Making a 3D Print File of the Model</a></li>
<li class="chapter" data-level="18.5.2" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#rendering-a-3d-movie-of-the-model"><i class="fa fa-check"></i><b>18.5.2</b> Rendering a 3D movie of the Model</a></li>
</ul></li>
<li class="chapter" data-level="18.6" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#using-the-slopes-package-to-analyse-stage-elevation-data"><i class="fa fa-check"></i><b>18.6</b> Using the <code>slopes</code> Package to Analyse Stage Elevation Data</a></li>
<li class="chapter" data-level="18.7" data-path="elevation-data-revisited.html"><a href="elevation-data-revisited.html#analysing-route-elevation-from-first-principles"><i class="fa fa-check"></i><b>18.7</b> Analysing Route Elevation from First Principles</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html"><i class="fa fa-check"></i><b>19</b> Adding <em>OpenStreetMap</em> Data</a>
<ul>
<li class="chapter" data-level="19.1" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#load-in-base-data-10"><i class="fa fa-check"></i><b>19.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="19.2" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#adding-detail-and-features-from-openstreetmap"><i class="fa fa-check"></i><b>19.2</b> Adding Detail and Features from OpenStreetMap</a>
<ul>
<li class="chapter" data-level="19.2.1" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#plotting-osm-highways"><i class="fa fa-check"></i><b>19.2.1</b> Plotting OSM Highways</a></li>
</ul></li>
<li class="chapter" data-level="19.3" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#viewing-roads-in-the-vicinity-of-a-route"><i class="fa fa-check"></i><b>19.3</b> Viewing Roads in the Vicinity of a Route</a>
<ul>
<li class="chapter" data-level="19.3.1" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#using-sfst_buffer-to-create-buffered-areas"><i class="fa fa-check"></i><b>19.3.1</b> Using <code>sf::st_buffer</code> to Create Buffered Areas</a></li>
<li class="chapter" data-level="19.3.2" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#using-rgeosgbuffer-to-create-buffered-areas"><i class="fa fa-check"></i><b>19.3.2</b> Using <code>rgeos::gBuffer</code> to Create Buffered Areas</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#adding-additional-data-from-osm"><i class="fa fa-check"></i><b>19.4</b> Adding Additional Data From OSM</a>
<ul>
<li class="chapter" data-level="19.4.1" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#adding-building-layers-from-openstreetmap"><i class="fa fa-check"></i><b>19.4.1</b> Adding Building Layers from <em>OpenStreetMap</em></a></li>
<li class="chapter" data-level="19.4.2" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#the-wide-variety-of-osm-features"><i class="fa fa-check"></i><b>19.4.2</b> The Wide Variety of OSM Features</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="20" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html"><i class="fa fa-check"></i><b>20</b> Creating A Road Book</a>
<ul>
<li class="chapter" data-level="20.1" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#load-in-base-data-11"><i class="fa fa-check"></i><b>20.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="20.2" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#using-sfnetworks-to-represent-routes-and-road-networks"><i class="fa fa-check"></i><b>20.2</b> Using <code>sfnetworks</code> to Represent Routes and Road Networks</a></li>
<li class="chapter" data-level="20.3" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#analysing-road-networks-with-sfnetworks"><i class="fa fa-check"></i><b>20.3</b> Analysing Road Networks with <code>sfnetworks</code></a>
<ul>
<li class="chapter" data-level="20.3.1" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#creating-an-sfnetworks-graph"><i class="fa fa-check"></i><b>20.3.1</b> Creating an <code>sfnetworks</code> Graph</a></li>
<li class="chapter" data-level="20.3.2" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#filtering-an-sfnetworks-graph"><i class="fa fa-check"></i><b>20.3.2</b> Filtering an <code>sfnetworks</code> Graph</a></li>
<li class="chapter" data-level="20.3.3" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#viewing-a-buffered-area-around-a-junction-node"><i class="fa fa-check"></i><b>20.3.3</b> Viewing a Buffered Area Around a Junction Node</a></li>
<li class="chapter" data-level="20.3.4" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#snapping-a-route-to-a-road-network"><i class="fa fa-check"></i><b>20.3.4</b> Snapping a Route to a Road Network</a></li>
<li class="chapter" data-level="20.3.5" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#snapping-a-full-stage-route-to-the-road-network"><i class="fa fa-check"></i><b>20.3.5</b> Snapping a Full Stage Route to the Road Network</a></li>
</ul></li>
<li class="chapter" data-level="20.4" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#using-dodgr-to-represent-routes-and-road-networks"><i class="fa fa-check"></i><b>20.4</b> Using <code>dodgr</code> to Represent Routes and Road Networks</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="where-next.html"><a href="where-next.html"><i class="fa fa-check"></i><b>21</b> Where Next?</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Visualising WRC Rally Stages With <code>rayshader</code> and R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="stage-route-analysis" class="section level1" number="17">
<h1><span class="header-section-number">17</span> Stage Route Analysis</h1>
<p>This chapter introduces several ideas relating to <em>stage route analysis</em> and the generation of “stage route profiles” that describe various features of the the route, such as its twistiness.</p>
<p>To a certain extent, stage route analysis could be considered as a static analysis complement to the pace notes created for a stage:</p>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="stage-route-analysis.html#cb389-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;vembedr&quot;</span>)</span>
<span id="cb389-2"><a href="stage-route-analysis.html#cb389-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb389-3"><a href="stage-route-analysis.html#cb389-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Hayden Paddon describes pace notes</span></span>
<span id="cb389-4"><a href="stage-route-analysis.html#cb389-4" aria-hidden="true" tabindex="-1"></a><span class="fu">embed_url</span>(<span class="st">&quot;https://www.youtube.com/watch?v=9q7EYVJL9XU&quot;</span>)</span></code></pre></div>
<div class="vembedr">
<div>
<iframe src="https://www.youtube.com/embed/9q7EYVJL9XU" width="533" height="300" frameborder="0" allowfullscreen=""></iframe>
</div>
</div>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="stage-route-analysis.html#cb390-1" aria-hidden="true" tabindex="-1"></a><span class="co"># See also this Team O&#39;Neil tutorial:</span></span>
<span id="cb390-2"><a href="stage-route-analysis.html#cb390-2" aria-hidden="true" tabindex="-1"></a><span class="co"># &quot;Rally Stage Notes and Pace Notes Explained&quot; https://www.youtube.com/watch?v=earjqfXGYzw</span></span></code></pre></div>
<p>Stage route analysis also includes a consideration of elevation along the route. Analysis and review of route elevation is explored in more detail in a separate chapter.</p>
<div id="load-in-base-data-8" class="section level2" number="17.1">
<h2><span class="header-section-number">17.1</span> Load in Base Data</h2>
<p>As ever, let’s load in our stage data and the elevation raster and create a demo map:</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="stage-route-analysis.html#cb391-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb391-2"><a href="stage-route-analysis.html#cb391-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb391-3"><a href="stage-route-analysis.html#cb391-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rayshader)</span>
<span id="cb391-4"><a href="stage-route-analysis.html#cb391-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb391-5"><a href="stage-route-analysis.html#cb391-5" aria-hidden="true" tabindex="-1"></a>geojson_filename <span class="ot">=</span> <span class="st">&#39;montecarlo_2021.geojson&#39;</span></span>
<span id="cb391-6"><a href="stage-route-analysis.html#cb391-6" aria-hidden="true" tabindex="-1"></a>geojson_sf <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_read</span>(geojson_filename)</span></code></pre></div>
<pre><code>## Reading layer `montecarlo_2021&#39; from data source `/Users/tonyhirst/Documents/GitHub/visualising-rally-stages/montecarlo_2021.geojson&#39; using driver `GeoJSON&#39;
## Simple feature collection with 9 features and 2 fields
## geometry type:  LINESTRING
## dimension:      XY
## bbox:           xmin: 5.243488 ymin: 43.87633 xmax: 6.951953 ymax: 44.81973
## geographic CRS: WGS 84</code></pre>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="stage-route-analysis.html#cb393-1" aria-hidden="true" tabindex="-1"></a>stage_route_gj <span class="ot">=</span> geojsonio<span class="sc">::</span><span class="fu">geojson_json</span>(geojson_sf[<span class="dv">1</span>,]<span class="sc">$</span>geometry)</span>
<span id="cb393-2"><a href="stage-route-analysis.html#cb393-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb393-3"><a href="stage-route-analysis.html#cb393-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Previously downloaded TIF digital elevation model (DEM) file</span></span>
<span id="cb393-4"><a href="stage-route-analysis.html#cb393-4" aria-hidden="true" tabindex="-1"></a>stage_tif <span class="ot">=</span> <span class="st">&quot;stage_elevation.tif&quot;</span></span>
<span id="cb393-5"><a href="stage-route-analysis.html#cb393-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb393-6"><a href="stage-route-analysis.html#cb393-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Load in the previously saved image raster</span></span>
<span id="cb393-7"><a href="stage-route-analysis.html#cb393-7" aria-hidden="true" tabindex="-1"></a>elev_img <span class="ot">=</span> <span class="fu">raster</span>(stage_tif)</span>
<span id="cb393-8"><a href="stage-route-analysis.html#cb393-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb393-9"><a href="stage-route-analysis.html#cb393-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Note we can pass in a file name or a raster object</span></span>
<span id="cb393-10"><a href="stage-route-analysis.html#cb393-10" aria-hidden="true" tabindex="-1"></a>elmat <span class="ot">=</span> <span class="fu">raster_to_matrix</span>(stage_tif)</span>
<span id="cb393-11"><a href="stage-route-analysis.html#cb393-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb393-12"><a href="stage-route-analysis.html#cb393-12" aria-hidden="true" tabindex="-1"></a>demo_map <span class="ot">=</span> elmat <span class="sc">%&gt;%</span></span>
<span id="cb393-13"><a href="stage-route-analysis.html#cb393-13" aria-hidden="true" tabindex="-1"></a>              <span class="fu">sphere_shade</span>(<span class="at">texture =</span> <span class="st">&quot;desert&quot;</span>,</span>
<span id="cb393-14"><a href="stage-route-analysis.html#cb393-14" aria-hidden="true" tabindex="-1"></a>                           <span class="at">progbar =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>Let’s also get a UTM projection of the stage routes:</p>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="stage-route-analysis.html#cb394-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Detect the UTM zone as an EPSG code</span></span>
<span id="cb394-2"><a href="stage-route-analysis.html#cb394-2" aria-hidden="true" tabindex="-1"></a>lonlat2UTMzone <span class="ot">=</span> <span class="cf">function</span>(lonlat) {</span>
<span id="cb394-3"><a href="stage-route-analysis.html#cb394-3" aria-hidden="true" tabindex="-1"></a>  utm <span class="ot">=</span> (<span class="fu">floor</span>((lonlat[<span class="dv">1</span>] <span class="sc">+</span> <span class="dv">180</span>) <span class="sc">/</span> <span class="dv">6</span>) <span class="sc">%%</span> <span class="dv">60</span>) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb394-4"><a href="stage-route-analysis.html#cb394-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(lonlat[<span class="dv">2</span>] <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb394-5"><a href="stage-route-analysis.html#cb394-5" aria-hidden="true" tabindex="-1"></a>    utm <span class="sc">+</span> <span class="dv">32600</span></span>
<span id="cb394-6"><a href="stage-route-analysis.html#cb394-6" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb394-7"><a href="stage-route-analysis.html#cb394-7" aria-hidden="true" tabindex="-1"></a>    utm <span class="sc">+</span> <span class="dv">32700</span></span>
<span id="cb394-8"><a href="stage-route-analysis.html#cb394-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb394-9"><a href="stage-route-analysis.html#cb394-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb394-10"><a href="stage-route-analysis.html#cb394-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb394-11"><a href="stage-route-analysis.html#cb394-11" aria-hidden="true" tabindex="-1"></a>get_utm_projection <span class="ot">=</span> <span class="cf">function</span>(routes){</span>
<span id="cb394-12"><a href="stage-route-analysis.html#cb394-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Keep track of the original proj4 string</span></span>
<span id="cb394-13"><a href="stage-route-analysis.html#cb394-13" aria-hidden="true" tabindex="-1"></a>  old_crs <span class="ot">=</span> <span class="fu">st_crs</span>(geojson_sf[<span class="dv">1</span>,])<span class="sc">$</span>proj4string</span>
<span id="cb394-14"><a href="stage-route-analysis.html#cb394-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb394-15"><a href="stage-route-analysis.html#cb394-15" aria-hidden="true" tabindex="-1"></a>  sample_location_x <span class="ot">=</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(routes[<span class="dv">1</span>,]))[<span class="dv">1</span>]</span>
<span id="cb394-16"><a href="stage-route-analysis.html#cb394-16" aria-hidden="true" tabindex="-1"></a>  sample_location_y <span class="ot">=</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(routes[<span class="dv">1</span>,]))[<span class="dv">2</span>]</span>
<span id="cb394-17"><a href="stage-route-analysis.html#cb394-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb394-18"><a href="stage-route-analysis.html#cb394-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate a new projection in the appropriate UTM zone</span></span>
<span id="cb394-19"><a href="stage-route-analysis.html#cb394-19" aria-hidden="true" tabindex="-1"></a>  crs_zone <span class="ot">=</span> <span class="fu">lonlat2UTMzone</span>(<span class="fu">c</span>(sample_location_x,</span>
<span id="cb394-20"><a href="stage-route-analysis.html#cb394-20" aria-hidden="true" tabindex="-1"></a>                              sample_location_y))</span>
<span id="cb394-21"><a href="stage-route-analysis.html#cb394-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb394-22"><a href="stage-route-analysis.html#cb394-22" aria-hidden="true" tabindex="-1"></a>  new_proj4_string <span class="ot">=</span> <span class="fu">st_crs</span>(crs_zone)<span class="sc">$</span>proj4string</span>
<span id="cb394-23"><a href="stage-route-analysis.html#cb394-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb394-24"><a href="stage-route-analysis.html#cb394-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Transform the route to the UTM projection</span></span>
<span id="cb394-25"><a href="stage-route-analysis.html#cb394-25" aria-hidden="true" tabindex="-1"></a>  utm_routes <span class="ot">=</span> <span class="fu">st_transform</span>(geojson_sf, <span class="at">crs=</span>new_proj4_string)</span>
<span id="cb394-26"><a href="stage-route-analysis.html#cb394-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb394-27"><a href="stage-route-analysis.html#cb394-27" aria-hidden="true" tabindex="-1"></a>  utm_routes</span>
<span id="cb394-28"><a href="stage-route-analysis.html#cb394-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Or should we returned a named list</span></span>
<span id="cb394-29"><a href="stage-route-analysis.html#cb394-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># e.g. including the original projection?</span></span>
<span id="cb394-30"><a href="stage-route-analysis.html#cb394-30" aria-hidden="true" tabindex="-1"></a>  <span class="co">#list(utm_routes = utm_routes, orig_crs=old_crs)</span></span>
<span id="cb394-31"><a href="stage-route-analysis.html#cb394-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb394-32"><a href="stage-route-analysis.html#cb394-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb394-33"><a href="stage-route-analysis.html#cb394-33" aria-hidden="true" tabindex="-1"></a>utm_routes <span class="ot">=</span> <span class="fu">get_utm_projection</span>(geojson_sf)</span></code></pre></div>
</div>
<div id="generating-stage-route-profiles" class="section level2" number="17.2">
<h2><span class="header-section-number">17.2</span> Generating Stage Route Profiles</h2>
<p>Although there are no <code>R</code> packages (yet!) that are specifically focused on representing and analysing rally stage data, there are several packages designed to support the representation and analysis of animal tracks and route trajectories. These packages are capable of loading and analysing route co-ordinate data specified in a variety of ways and have no difficulty in working with our stage route data.</p>
<p>As to the question of “why bother?”, several possibilities come to mind.</p>
<p>In the first case, for the rally fan or rally journalist, learning a bit more about the make up of a stage may add colour when watching or reporting on a stage, or help make sense of why time appears capable of being made up, or lost, on particular stages or particular parts of a stage.</p>
<p>In the second case, an understanding of the detail of a particular stage may help understand strategy, or tyre selection.</p>
<p>In the third case, understanding stage routes may help in setting strategy, or even in planning a stage or hill climb route. With the potential for electric vehicles being used in stage rallies and for hill climbs, energy management and budgeting becomes a key issue. Ensuring that an electric vehicle has enough stored energy to allow it to complete even a single stage, let alone multiple stages with road sections in between, requires an understanding of the likely energy consumption requirements. Knowing the distances involved is one component, but elevation changes may also feed into to energy question, particularly on a a hill climb where the only way is up, and opportunities for regenerative breaking are reduced. Knowing how tortuous a stage is, and the relative mix of fast straights flat corners and slower corners may also help produce simple kinetic energy requirement models for a stage.</p>
<div id="an-aside---twists-and-turns-of-rally-stages" class="section level3" number="17.2.1">
<h3><span class="header-section-number">17.2.1</span> An Aside - Twists and Turns of Rally Stages</h3>
<p>Whilst an understanding of the state of the road surface and the current weather conditions may be the key factors in determining tyre choice, how “twisty and turny” a stage route may also influence tyre selection and driving style.</p>
<p>The tread pattern of rally tyres are designed to support acceleration even when turning, so if tyres are wearing thin and the last stage of day has far more aggressive right corners than turns to a left, knowing the stage profile may help save a second or two.</p>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="stage-route-analysis.html#cb395-1" aria-hidden="true" tabindex="-1"></a><span class="fu">embed_url</span>(<span class="st">&quot;https://www.youtube.com/watch?v=-I74uopkcro&quot;</span>)</span></code></pre></div>
<div class="vembedr">
<div>
<iframe src="https://www.youtube.com/embed/-I74uopkcro" width="533" height="300" frameborder="0" allowfullscreen=""></iframe>
</div>
</div>
</div>
</div>
<div id="finding-stage-route-lengths" class="section level2" number="17.3">
<h2><span class="header-section-number">17.3</span> Finding Stage Route Lengths</h2>
<p>To begin with, let’s start with a very simple metric, <em>stage route length</em>.</p>
<p>We can find the length of each stage route in meters using the <code>sf::st_length()</code> function:</p>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="stage-route-analysis.html#cb396-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_length</span>(geojson_sf)</span></code></pre></div>
<pre><code>## Units: [m]
## [1] 21069.62 21343.85 20378.19 21983.22 22858.86 18649.37 21220.66 13185.96
## [9] 14850.85</code></pre>
<p>Or for a single stage:</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="stage-route-analysis.html#cb398-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_length</span>(geojson_sf[<span class="dv">1</span>,])</span></code></pre></div>
<pre><code>## 21069.62 [m]</code></pre>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="stage-route-analysis.html#cb400-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 21069.62</span></span></code></pre></div>
<p>The <code>rgeos::gLength()</code> function will generate the length of a <em>Spatial</em> object using its natural units. Which is to say, we’d need to project into something like UTM co-ordinates first if we wanted to use it to calculate the distance in meters.</p>
<p>We can also find the route length directly from a geojson string that encodes latitude and longitude locations using the <em>turf.js</em> like <code>geoops::geo_line_distance()</code> function:</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb401-1"><a href="stage-route-analysis.html#cb401-1" aria-hidden="true" tabindex="-1"></a>route_as_geojson <span class="ot">=</span> geojsonio<span class="sc">::</span><span class="fu">geojson_json</span>(geojson_sf[<span class="dv">1</span>,]<span class="sc">$</span>geometry)</span>
<span id="cb401-2"><a href="stage-route-analysis.html#cb401-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb401-3"><a href="stage-route-analysis.html#cb401-3" aria-hidden="true" tabindex="-1"></a>geoops<span class="sc">::</span><span class="fu">geo_line_distance</span>(route_as_geojson)</span></code></pre></div>
<pre><code>## [1] 21.05409</code></pre>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb403-1"><a href="stage-route-analysis.html#cb403-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 21.05409</span></span></code></pre></div>
<p>The <code>geosphere::distGeo()</code> function provides a way of calculating distances for each step of the route represented using the lonlat projection:</p>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="stage-route-analysis.html#cb404-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the coordinates for each step</span></span>
<span id="cb404-2"><a href="stage-route-analysis.html#cb404-2" aria-hidden="true" tabindex="-1"></a>lonlat_coords <span class="ot">=</span> <span class="fu">st_coordinates</span>(geojson_sf[<span class="dv">1</span>,])[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb404-3"><a href="stage-route-analysis.html#cb404-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-4"><a href="stage-route-analysis.html#cb404-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Omit the final NA value</span></span>
<span id="cb404-5"><a href="stage-route-analysis.html#cb404-5" aria-hidden="true" tabindex="-1"></a>route_step_lengths <span class="ot">=</span> <span class="fu">head</span>(geosphere<span class="sc">::</span><span class="fu">distGeo</span>(lonlat_coords), <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb404-6"><a href="stage-route-analysis.html#cb404-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-7"><a href="stage-route-analysis.html#cb404-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the accumulated distance at each step</span></span>
<span id="cb404-8"><a href="stage-route-analysis.html#cb404-8" aria-hidden="true" tabindex="-1"></a><span class="co"># and return the final (maximum) value:</span></span>
<span id="cb404-9"><a href="stage-route-analysis.html#cb404-9" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(<span class="fu">cumsum</span>(route_step_lengths))</span></code></pre></div>
<pre><code>## [1] 21069.62</code></pre>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb406-1"><a href="stage-route-analysis.html#cb406-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 21069.62</span></span></code></pre></div>
<p>One thing we notice is that some of these distances are: a) different to each other; b) different to the officially stated stage distance of 20.58 km.</p>
<p>The projection and parameters used in a projection to calculate the distance all contribute to the actual calculated value. In addition, our distance calculations are base on summing the lengths of the multiple straight line segments described by the route data rather than the tighter (shorter) racing line. It’s also not clear from the route data where the extent of the route is the extent of the competitive portion of the stage, or whether the start and end points refer to the time control locations rather than competitive timing lines.</p>
<p>On the other hand, the actual route is likely to be longer than what we might term the “ground distance” as you can tell from an elevation chart that shows elevation of the route against distance into the route. If we elevation and distance axes on the same scale, the elevation line is unlikely to be a straight line: the elevation may go up or down. If we straighten out the elevation line to a flat line and place on the x-axis, it will be longer than the original “on the flat” route distance.</p>
</div>
<div id="using-ecological-movement-analysis-tools-to-analyse-stage-routes" class="section level2" number="17.4">
<h2><span class="header-section-number">17.4</span> Using Ecological Movement Analysis Tools to Analyse Stage Routes</h2>
<p>Ecologists researching animal movements have produced a wide range of tools for categorising and classifying the trajectories of routes followed by one or more animals. Trajectories are typically recorded as sequences of locations recorded at particular times.</p>
<p>The <a href="https://cran.r-project.org/web/packages/adehabitatLT/index.html"><code>adehabitatLT</code> <em>R</em> package</a> usefully categorises animal trajectories in the following ways:</p>
<ul>
<li><em>type I</em>: location data is available but a sample timestamp is not precisely known or not available for each step;</li>
<li><em>type II</em>: as well as location data, a timestamp for each step is also available; this type is then further subdivided into:
<ul>
<li><em>regular trajectories</em>, where there is a constant delay or period between each step sample;
– <em>irregular trajectories</em>, where there is a variable delay between each step sample.</li>
</ul></li>
</ul>
<p>As far as rally data goes, stage route data may be trivially classed as either <em>type 1</em>. However, if we use distance into route as a time proxy, we can also create <em>type II irregular</em> traces; telemetry data should ideally be <em>type II regular</em>.</p>
<p>One intuition behind using animal movement analysis tools to categorise rally stage routes is that we can analyse the route as if it were a <em>type 1</em> style animal track. Another intuition is that we can use distance into route as a dummy time variable (e.g. use a dummy equivalence mapping of 1m into route as 1s, although we could also attempt to use proxy times, such as setting <em>time = distance_into_stage x nominal_speed</em>, or even use a speed model that may depend on route properties at each step of the stage).</p>
</div>
<div id="using-trajr-for-stage-route-profiling" class="section level2" number="17.5">
<h2><span class="header-section-number">17.5</span> Using <code>trajr</code> for Stage Route Profiling</h2>
<p>The <a href="https://cran.r-project.org/web/packages/trajr/vignettes/trajr-vignette.html"><code>trajr</code> <em>R</em> package</a> was developed to help characterise and analyse the trajectories or paths followed by a moving animal given various location coordinates along its route.</p>
<p>Trajectories are created using Cartesian co-ordinates, so it makes sense to use data that has been cast into UTM coordinate system as the basis for the trajectory.</p>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="stage-route-analysis.html#cb407-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(trajr)</span>
<span id="cb407-2"><a href="stage-route-analysis.html#cb407-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb407-3"><a href="stage-route-analysis.html#cb407-3" aria-hidden="true" tabindex="-1"></a>trj <span class="ot">&lt;-</span> <span class="fu">TrajFromCoords</span>(<span class="fu">as.data.frame</span>(<span class="fu">st_coordinates</span>(utm_routes[<span class="dv">1</span>,])))</span></code></pre></div>
<p>To cast all the routes to trajectories, we could do something like the following:</p>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb408-1"><a href="stage-route-analysis.html#cb408-1" aria-hidden="true" tabindex="-1"></a>get_trj <span class="ot">=</span> <span class="cf">function</span>(route){</span>
<span id="cb408-2"><a href="stage-route-analysis.html#cb408-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">TrajFromCoords</span>(<span class="fu">as.data.frame</span>(<span class="fu">st_coordinates</span>(route<span class="sc">$</span>geometry)))</span>
<span id="cb408-3"><a href="stage-route-analysis.html#cb408-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb408-4"><a href="stage-route-analysis.html#cb408-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb408-5"><a href="stage-route-analysis.html#cb408-5" aria-hidden="true" tabindex="-1"></a>trjs <span class="ot">=</span> <span class="fu">apply</span>(utm_routes, <span class="dv">1</span>, get_trj)</span></code></pre></div>
<p>We can retrieve the stage length using the <code>trajr::TrajLength</code> function:</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="stage-route-analysis.html#cb409-1" aria-hidden="true" tabindex="-1"></a><span class="fu">TrajLength</span>(trjs[[<span class="dv">1</span>]])</span></code></pre></div>
<pre><code>## [1] 21074.92</code></pre>
<p>We can create also create a simple plot of the trajectory, and overplot it with the location points used to construct the route:</p>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb411-1"><a href="stage-route-analysis.html#cb411-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a simple plot the route</span></span>
<span id="cb411-2"><a href="stage-route-analysis.html#cb411-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(trj)</span>
<span id="cb411-3"><a href="stage-route-analysis.html#cb411-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb411-4"><a href="stage-route-analysis.html#cb411-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overlay points onto the plot</span></span>
<span id="cb411-5"><a href="stage-route-analysis.html#cb411-5" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(trj, <span class="at">draw.start.pt =</span> <span class="cn">FALSE</span>,</span>
<span id="cb411-6"><a href="stage-route-analysis.html#cb411-6" aria-hidden="true" tabindex="-1"></a>       <span class="co">#pch = 16,  # symbol</span></span>
<span id="cb411-7"><a href="stage-route-analysis.html#cb411-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, </span>
<span id="cb411-8"><a href="stage-route-analysis.html#cb411-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">cex =</span> <span class="fl">0.4</span> <span class="co"># scale</span></span>
<span id="cb411-9"><a href="stage-route-analysis.html#cb411-9" aria-hidden="true" tabindex="-1"></a>       )</span></code></pre></div>
<p><img src="images/route-metrics-trajr-plot-1.png" width="672" /></p>
<p>For each fragment of the line we can calculate the distance from its displacement, or directly using <code>trajr::TrajStepLengths</code> function, and then cumulatively sum them to get the overall route distance so far:</p>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb412-1"><a href="stage-route-analysis.html#cb412-1" aria-hidden="true" tabindex="-1"></a><span class="co"># displacement is a complex number, so we can get the actual distance:</span></span>
<span id="cb412-2"><a href="stage-route-analysis.html#cb412-2" aria-hidden="true" tabindex="-1"></a>trj<span class="sc">$</span>distance <span class="ot">=</span> <span class="fu">Mod</span>(trj<span class="sc">$</span>displacement)</span>
<span id="cb412-3"><a href="stage-route-analysis.html#cb412-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb412-4"><a href="stage-route-analysis.html#cb412-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the distance of the just completed step</span></span>
<span id="cb412-5"><a href="stage-route-analysis.html#cb412-5" aria-hidden="true" tabindex="-1"></a>trj<span class="sc">$</span>distance2 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">TrajStepLengths</span>(trj))</span>
<span id="cb412-6"><a href="stage-route-analysis.html#cb412-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb412-7"><a href="stage-route-analysis.html#cb412-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the distance of the upcoming step</span></span>
<span id="cb412-8"><a href="stage-route-analysis.html#cb412-8" aria-hidden="true" tabindex="-1"></a>trj<span class="sc">$</span>predist <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">TrajStepLengths</span>(trj), <span class="dv">0</span>)</span>
<span id="cb412-9"><a href="stage-route-analysis.html#cb412-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb412-10"><a href="stage-route-analysis.html#cb412-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the accumulated distance at each step</span></span>
<span id="cb412-11"><a href="stage-route-analysis.html#cb412-11" aria-hidden="true" tabindex="-1"></a>trj<span class="sc">$</span>cum_dist <span class="ot">=</span> <span class="fu">cumsum</span>(trj<span class="sc">$</span>distance)</span>
<span id="cb412-12"><a href="stage-route-analysis.html#cb412-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb412-13"><a href="stage-route-analysis.html#cb412-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(trj[,<span class="fu">c</span>(<span class="st">&#39;distance&#39;</span>, <span class="st">&#39;distance2&#39;</span>, <span class="st">&#39;predist&#39;</span>, <span class="st">&#39;cum_dist&#39;</span>)])</span></code></pre></div>
<pre><code>##   distance distance2  predist  cum_dist
## 1  0.00000   0.00000 22.57610   0.00000
## 2 22.57610  22.57610 27.93969  22.57610
## 3 27.93969  27.93969 21.00615  50.51579
## 4 21.00615  21.00615 20.38569  71.52194
## 5 20.38569  20.38569 21.77625  91.90762
## 6 21.77625  21.77625 39.22507 113.68388</code></pre>
<div id="smoothing-a-trajectory" class="section level3" number="17.5.1">
<h3><span class="header-section-number">17.5.1</span> Smoothing a Trajectory</h3>
<p>Sometimes a stage route may appear rather “ragged” as an artefact of using multiple straight line segments to construct the route.</p>
<p>We can smooth a route with a Savitzky-Golay smoothing filter called from <code>signal::sgolayfilt</code> using the <code>trajr::TrajSmoothSGorder(order, filter_length_odd)</code> function.</p>
<p>Using a third order filter applied to a window size of 5 steps retains quite a smooth fitting line whilst removing some of the sharp edges caused by concatenating straight line segments</p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="stage-route-analysis.html#cb414-1" aria-hidden="true" tabindex="-1"></a>smoothed <span class="ot">&lt;-</span> <span class="fu">TrajSmoothSG</span>(trj, <span class="at">p=</span><span class="dv">3</span>, <span class="at">n=</span><span class="dv">5</span>)</span>
<span id="cb414-2"><a href="stage-route-analysis.html#cb414-2" aria-hidden="true" tabindex="-1"></a><span class="co">#p polynomial order</span></span>
<span id="cb414-3"><a href="stage-route-analysis.html#cb414-3" aria-hidden="true" tabindex="-1"></a><span class="co">#n filter length (window size); must be an odd integer</span></span>
<span id="cb414-4"><a href="stage-route-analysis.html#cb414-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(trj)</span>
<span id="cb414-5"><a href="stage-route-analysis.html#cb414-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(smoothed, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="images/route-metrics-trajr-plot-smoothed-1.png" width="672" /></p>
<p>The <a href="https://cran.r-project.org/web/packages/smoothr/vignettes/smoothr.html"><code>smoothr</code> <em>R</em> package</a> also provides several useful smoothing utilities.</p>
<p>So that we can more clearly see what’s going on, let’s grab just a fragment of our stage route:</p>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb415-1"><a href="stage-route-analysis.html#cb415-1" aria-hidden="true" tabindex="-1"></a>get_route_segment <span class="ot">=</span> <span class="cf">function</span>(i, steps){</span>
<span id="cb415-2"><a href="stage-route-analysis.html#cb415-2" aria-hidden="true" tabindex="-1"></a>  cc <span class="ot">=</span> <span class="fu">as.data.frame</span>(<span class="fu">st_coordinates</span>(geojson_sf[i,]))[steps,]</span>
<span id="cb415-3"><a href="stage-route-analysis.html#cb415-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb415-4"><a href="stage-route-analysis.html#cb415-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_linestring</span>(<span class="fu">cbind</span>(<span class="at">x=</span>cc[,<span class="dv">1</span>], <span class="at">y=</span>cc[,<span class="dv">2</span>]))</span>
<span id="cb415-5"><a href="stage-route-analysis.html#cb415-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb415-6"><a href="stage-route-analysis.html#cb415-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb415-7"><a href="stage-route-analysis.html#cb415-7" aria-hidden="true" tabindex="-1"></a>route_segment <span class="ot">=</span> <span class="fu">get_route_segment</span>(<span class="dv">1</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code></pre></div>
<p>For example, the <code>smoothr::smooth</code> function allows us to apply various smoothing approaches. Let’s see how well its <em>ksmooth</em> kernel smoothing approach works, that applies a Gaussian kernel regression to the x and y coordinates independently:</p>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb416-1"><a href="stage-route-analysis.html#cb416-1" aria-hidden="true" tabindex="-1"></a>smoothr_route_segment <span class="ot">=</span> smoothr<span class="sc">::</span><span class="fu">smooth</span>(route_segment,</span>
<span id="cb416-2"><a href="stage-route-analysis.html#cb416-2" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">method =</span> <span class="st">&quot;ksmooth&quot;</span>)</span>
<span id="cb416-3"><a href="stage-route-analysis.html#cb416-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb416-4"><a href="stage-route-analysis.html#cb416-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(route_segment), <span class="at">col =</span> <span class="st">&#39;grey&#39;</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb416-5"><a href="stage-route-analysis.html#cb416-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(smoothr_route_segment),</span>
<span id="cb416-6"><a href="stage-route-analysis.html#cb416-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="images/route-metrics-smoothr_ksmooth-1.png" width="672" /></p>
<p>Alternatively, we could use the <code>smoothr</code> <em>spline</em> method, which calculates a spline interpolation over the x and y coordinates independently:</p>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb417-1"><a href="stage-route-analysis.html#cb417-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(geojson_sf[<span class="dv">1</span>,]), <span class="at">col =</span> <span class="st">&#39;grey&#39;</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb417-2"><a href="stage-route-analysis.html#cb417-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(smoothr<span class="sc">::</span><span class="fu">smooth</span>(geojson_sf[<span class="dv">1</span>,], <span class="at">method =</span> <span class="st">&quot;spline&quot;</span>)),</span>
<span id="cb417-3"><a href="stage-route-analysis.html#cb417-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="images/route-metrics-smoothr_spline-1.png" width="672" /></p>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb418-1"><a href="stage-route-analysis.html#cb418-1" aria-hidden="true" tabindex="-1"></a>smoothr_route_segment2 <span class="ot">=</span> smoothr<span class="sc">::</span><span class="fu">smooth</span>(route_segment, <span class="at">method =</span> <span class="st">&quot;spline&quot;</span>)</span>
<span id="cb418-2"><a href="stage-route-analysis.html#cb418-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb418-3"><a href="stage-route-analysis.html#cb418-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(route_segment), <span class="at">col =</span> <span class="st">&#39;grey&#39;</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb418-4"><a href="stage-route-analysis.html#cb418-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(smoothr_route_segment),</span>
<span id="cb418-5"><a href="stage-route-analysis.html#cb418-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="images/route-metrics-smoothr_spline-2.png" width="672" /></p>
<p>For a more detailed look at smoothing trajectories and finding racing lines, albeit in circuit racing, see <em>Heilmeier, A., Wischnewski, A., Hermansdorfer, L., Betz, J., Lienkamp, M. and Lohmann, B., 2019. Minimum curvature trajectory planning and control for an autonomous race car. Vehicle System Dynamics. DOI: 10.1080/00423114.2019.1631455</em> and the related Python laptime simulation package, <a href="https://github.com/TUMFTM/laptime-simulation"><code>TUMFTM/laptime-simulation</code></a>.</p>
</div>
<div id="resampling-locations" class="section level3" number="17.5.2">
<h3><span class="header-section-number">17.5.2</span> Resampling Locations</h3>
<p>We can use the <code>trajr::TrajRediscretize</code> function to resample locations from the line that are a fixed distance apart as the crow flies. s well as finding sample points, a new trajectory is also calculated that connects those points.</p>
<p>For example, if we discretise the route to points 500m apart as the crow flies, we note that the newly discretised route now has straight line segments between each of the sample points. This is perhaps not so good for stage route analysis, but it does provide one way of obtaining sample point locations from telemetry data. Ideally, though, sample points would be a fixed distance apart <em>along the route</em>:</p>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb419-1"><a href="stage-route-analysis.html#cb419-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Resample to step length 1</span></span>
<span id="cb419-2"><a href="stage-route-analysis.html#cb419-2" aria-hidden="true" tabindex="-1"></a>resampled <span class="ot">&lt;-</span> <span class="fu">TrajRediscretize</span>(trj, <span class="dv">500</span>)</span>
<span id="cb419-3"><a href="stage-route-analysis.html#cb419-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(trj)</span>
<span id="cb419-4"><a href="stage-route-analysis.html#cb419-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb419-5"><a href="stage-route-analysis.html#cb419-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot rediscretized trajectory in red</span></span>
<span id="cb419-6"><a href="stage-route-analysis.html#cb419-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(resampled, <span class="at">col =</span> <span class="st">&quot;#FF0000A0&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb419-7"><a href="stage-route-analysis.html#cb419-7" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(resampled, <span class="at">type =</span> <span class="st">&#39;p&#39;</span>, <span class="at">col =</span> <span class="st">&quot;#FF0000A0&quot;</span>, <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb419-8"><a href="stage-route-analysis.html#cb419-8" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;Original&quot;</span>, <span class="st">&quot;Rediscretized&quot;</span>),</span>
<span id="cb419-9"><a href="stage-route-analysis.html#cb419-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>), </span>
<span id="cb419-10"><a href="stage-route-analysis.html#cb419-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">inset =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.02</span>))</span></code></pre></div>
<p><img src="images/route-metrics-trajr-rediscretized-1.png" width="672" /></p>
<p>Can we see how many splits there are?</p>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb420-1"><a href="stage-route-analysis.html#cb420-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(resampled)</span></code></pre></div>
<pre><code>## [1] 30</code></pre>
</div>
<div id="resampling-against-distance" class="section level3" number="17.5.3">
<h3><span class="header-section-number">17.5.3</span> Resampling Against Distance</h3>
<p>The <code>trajr</code> package doesn’t seem to support resampling by distance along the line but it does allow resampling by time. So if we set the time to the accumulated basis, we can use time as a proxy for distance…</p>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb422-1"><a href="stage-route-analysis.html#cb422-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Backup the original (dummy) timestamps</span></span>
<span id="cb422-2"><a href="stage-route-analysis.html#cb422-2" aria-hidden="true" tabindex="-1"></a>trj<span class="sc">$</span>displacementTime_ <span class="ot">=</span> trj<span class="sc">$</span>time</span>
<span id="cb422-3"><a href="stage-route-analysis.html#cb422-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb422-4"><a href="stage-route-analysis.html#cb422-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the accumulated distance as a time proxy</span></span>
<span id="cb422-5"><a href="stage-route-analysis.html#cb422-5" aria-hidden="true" tabindex="-1"></a>trj<span class="sc">$</span>time <span class="ot">=</span> trj<span class="sc">$</span>cum_dist</span></code></pre></div>
<p>Let’s see what happens if we resample based on this use of time as a proxy for distance sampling the route every 2km:</p>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="stage-route-analysis.html#cb423-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The time units for the route are in seconds: TrajGetTimeUnits(trj)</span></span>
<span id="cb423-2"><a href="stage-route-analysis.html#cb423-2" aria-hidden="true" tabindex="-1"></a>resampled_t <span class="ot">=</span> <span class="fu">TrajResampleTime</span>(trj, <span class="dv">2000</span> )</span>
<span id="cb423-3"><a href="stage-route-analysis.html#cb423-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(trj)</span>
<span id="cb423-4"><a href="stage-route-analysis.html#cb423-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb423-5"><a href="stage-route-analysis.html#cb423-5" aria-hidden="true" tabindex="-1"></a><span class="co">#lines(resampled_t, col = &quot;#FF0000A0&quot;, lwd = 2)</span></span>
<span id="cb423-6"><a href="stage-route-analysis.html#cb423-6" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(resampled_t, <span class="at">type =</span> <span class="st">&#39;p&#39;</span>, <span class="at">col =</span> <span class="st">&quot;#FF0000A0&quot;</span>, <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb423-7"><a href="stage-route-analysis.html#cb423-7" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;Original&quot;</span>, <span class="st">&quot;Resampled&quot;</span>),</span>
<span id="cb423-8"><a href="stage-route-analysis.html#cb423-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>), </span>
<span id="cb423-9"><a href="stage-route-analysis.html#cb423-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">inset =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.02</span>))</span></code></pre></div>
<p><img src="images/route-metrics-trackr-resampled-1.png" width="672" /></p>
</div>
<div id="splitting-a-trajectory" class="section level3" number="17.5.4">
<h3><span class="header-section-number">17.5.4</span> Splitting a Trajectory</h3>
<p>We can split a trajectory using the <code>trajr::TrajSplit()</code> function. This takes a trajectory and an index of split points along the path and returns a list of trajectories containing the segment starting from each of the index values to the next supplied value.</p>
<p>If we try to use this function to split the route by split points applied generated by discretising or sampling the route, the resolution of the original line is lost: we are not cutting the <em>original() line at the sample points, we are cutting the </em>new* line created from the sample points:</p>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb424-1"><a href="stage-route-analysis.html#cb424-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">TrajSplit</span>(resampled_t, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>))[[<span class="dv">3</span>]])</span></code></pre></div>
<p><img src="images/route-metrics-split-resampled-1.png" width="672" /></p>
<p>However, we <em>can</em> cut the original lines using the <code>stplanr::route_split()</code> function:</p>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb425-1"><a href="stage-route-analysis.html#cb425-1" aria-hidden="true" tabindex="-1"></a><span class="co">#https://www.rdocumentation.org/packages/stplanr/versions/0.6.2/topics/route_split</span></span>
<span id="cb425-2"><a href="stage-route-analysis.html#cb425-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stplanr)</span>
<span id="cb425-3"><a href="stage-route-analysis.html#cb425-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb425-4"><a href="stage-route-analysis.html#cb425-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the second resampled point</span></span>
<span id="cb425-5"><a href="stage-route-analysis.html#cb425-5" aria-hidden="true" tabindex="-1"></a>pt <span class="ot">=</span> <span class="fu">st_sfc</span>(<span class="fu">st_point</span>(<span class="fu">c</span>(resampled_t[<span class="dv">2</span>,<span class="st">&#39;x&#39;</span>],resampled_t[<span class="dv">2</span>,<span class="st">&#39;y&#39;</span>])),</span>
<span id="cb425-6"><a href="stage-route-analysis.html#cb425-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">crs=</span><span class="fu">st_crs</span>(utm_routes[<span class="dv">1</span>,])<span class="sc">$</span>proj4string)</span>
<span id="cb425-7"><a href="stage-route-analysis.html#cb425-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb425-8"><a href="stage-route-analysis.html#cb425-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the third resampled point</span></span>
<span id="cb425-9"><a href="stage-route-analysis.html#cb425-9" aria-hidden="true" tabindex="-1"></a>pt2 <span class="ot">=</span> <span class="fu">st_sfc</span>(<span class="fu">st_point</span>(<span class="fu">c</span>(resampled_t[<span class="dv">3</span>,<span class="st">&#39;x&#39;</span>],resampled_t[<span class="dv">3</span>,<span class="st">&#39;y&#39;</span>])),</span>
<span id="cb425-10"><a href="stage-route-analysis.html#cb425-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">crs=</span><span class="fu">st_crs</span>(utm_routes[<span class="dv">1</span>,])<span class="sc">$</span>proj4string)</span>
<span id="cb425-11"><a href="stage-route-analysis.html#cb425-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb425-12"><a href="stage-route-analysis.html#cb425-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the original route in grep</span></span>
<span id="cb425-13"><a href="stage-route-analysis.html#cb425-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(utm_routes[<span class="dv">1</span>,]<span class="sc">$</span>geometry, <span class="at">lwd =</span> <span class="dv">9</span>, <span class="at">col =</span> <span class="st">&quot;grey&quot;</span>)</span>
<span id="cb425-14"><a href="stage-route-analysis.html#cb425-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb425-15"><a href="stage-route-analysis.html#cb425-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the route about the second point</span></span>
<span id="cb425-16"><a href="stage-route-analysis.html#cb425-16" aria-hidden="true" tabindex="-1"></a>split_route <span class="ot">=</span> <span class="fu">route_split</span>(utm_routes[<span class="dv">1</span>,], pt)</span>
<span id="cb425-17"><a href="stage-route-analysis.html#cb425-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb425-18"><a href="stage-route-analysis.html#cb425-18" aria-hidden="true" tabindex="-1"></a><span class="co"># And plot the two parts</span></span>
<span id="cb425-19"><a href="stage-route-analysis.html#cb425-19" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(split_route<span class="sc">$</span>geometry, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>), <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="images/route-metrics-split-route-colours-1.png" width="672" /></p>
<p>We can view each line segment separately:</p>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb426-1"><a href="stage-route-analysis.html#cb426-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use two columns to display plots side by side</span></span>
<span id="cb426-2"><a href="stage-route-analysis.html#cb426-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb426-3"><a href="stage-route-analysis.html#cb426-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb426-4"><a href="stage-route-analysis.html#cb426-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(split_route[<span class="dv">1</span>,]<span class="sc">$</span>geometry)</span>
<span id="cb426-5"><a href="stage-route-analysis.html#cb426-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(split_route[<span class="dv">2</span>,]<span class="sc">$</span>geometry)</span></code></pre></div>
<p><img src="images/route-metrics-segmented-stage-parts-1.png" width="672" /></p>
<p>We can automate the extraction of segmented lines using the following approach, which takes a route, splits it by the first point, splits the second half of the segment by the second point, and so on. Note that this requires us to order the points we want to split the line along in the order they appear along the route:</p>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb427-1"><a href="stage-route-analysis.html#cb427-1" aria-hidden="true" tabindex="-1"></a>split_line <span class="ot">=</span> <span class="cf">function</span>(route_, pts_) {</span>
<span id="cb427-2"><a href="stage-route-analysis.html#cb427-2" aria-hidden="true" tabindex="-1"></a>  segments <span class="ot">=</span> <span class="fu">c</span>()</span>
<span id="cb427-3"><a href="stage-route-analysis.html#cb427-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(pts_)) { </span>
<span id="cb427-4"><a href="stage-route-analysis.html#cb427-4" aria-hidden="true" tabindex="-1"></a>    split_ <span class="ot">=</span> <span class="fu">route_split</span>(route_, pts_[i])</span>
<span id="cb427-5"><a href="stage-route-analysis.html#cb427-5" aria-hidden="true" tabindex="-1"></a>    segments <span class="ot">=</span> <span class="fu">c</span>(segments, split_[<span class="dv">1</span>])</span>
<span id="cb427-6"><a href="stage-route-analysis.html#cb427-6" aria-hidden="true" tabindex="-1"></a>    route_ <span class="ot">=</span> split_[<span class="dv">2</span>]</span>
<span id="cb427-7"><a href="stage-route-analysis.html#cb427-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb427-8"><a href="stage-route-analysis.html#cb427-8" aria-hidden="true" tabindex="-1"></a>  route_</span>
<span id="cb427-9"><a href="stage-route-analysis.html#cb427-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb427-10"><a href="stage-route-analysis.html#cb427-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb427-11"><a href="stage-route-analysis.html#cb427-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Points we wish to segment on</span></span>
<span id="cb427-12"><a href="stage-route-analysis.html#cb427-12" aria-hidden="true" tabindex="-1"></a>pts <span class="ot">=</span> <span class="fu">c</span>(pt, pt2)</span>
<span id="cb427-13"><a href="stage-route-analysis.html#cb427-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb427-14"><a href="stage-route-analysis.html#cb427-14" aria-hidden="true" tabindex="-1"></a>split_route2 <span class="ot">=</span> <span class="fu">split_line</span>(utm_routes[<span class="dv">1</span>,], pts)</span>
<span id="cb427-15"><a href="stage-route-analysis.html#cb427-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb427-16"><a href="stage-route-analysis.html#cb427-16" aria-hidden="true" tabindex="-1"></a>split_route2</span></code></pre></div>
<pre><code>## Simple feature collection with 3 features and 0 fields
## geometry type:  LINESTRING
## dimension:      XY
## bbox:           xmin: 728265.7 ymin: 4957658 xmax: 732502.2 ymax: 4967115
## CRS:            +proj=utm +zone=31 +datum=WGS84 +units=m +no_defs
##                         geometry
## 1 LINESTRING (729177.5 495765...
## 2 LINESTRING (728356.7 495918...
## 3 LINESTRING (729158.2 496066...</code></pre>
<p>Now we can plot out three segment line (two split points):</p>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb429-1"><a href="stage-route-analysis.html#cb429-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(utm_routes[<span class="dv">1</span>,]<span class="sc">$</span>geometry, <span class="at">lwd =</span> <span class="dv">9</span>, <span class="at">col =</span> <span class="st">&quot;grey&quot;</span>)</span>
<span id="cb429-2"><a href="stage-route-analysis.html#cb429-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(split_route2<span class="sc">$</span>geometry, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;green&quot;</span>), <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="images/route-metrics-three-segment-line-1.png" width="672" /></p>
</div>
<div id="rotating-the-stage-trajectory" class="section level3" number="17.5.5">
<h3><span class="header-section-number">17.5.5</span> Rotating the Stage Trajectory</h3>
<p>To visualise routes in a similar profile, we can use the <code>trajr::trajr-rotate()</code> function to align the start and finish points. An <em>angle</em> parameter gives the angle in radians between the first and last points.</p>
<p>For example, for a horizontal, left to right right stage view:</p>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb430-1"><a href="stage-route-analysis.html#cb430-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">TrajRotate</span>(trj, <span class="at">angle =</span> <span class="dv">0</span>, <span class="at">relative =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<p><img src="images/route-metrics-trajr-rotate-horiz-1.png" width="672" /></p>
<p>Or for a view where we read the stage up from the bottom:</p>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb431-1"><a href="stage-route-analysis.html#cb431-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">TrajRotate</span>(trj, <span class="at">angle =</span> pi<span class="sc">/</span><span class="dv">2</span>, <span class="at">relative =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<p><img src="images/route-metrics-trajr-rotate-vert-1.png" width="672" /></p>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb432-1"><a href="stage-route-analysis.html#cb432-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Arguments</span></span>
<span id="cb432-2"><a href="stage-route-analysis.html#cb432-2" aria-hidden="true" tabindex="-1"></a><span class="co">#trj The trajectory to be rotated.</span></span>
<span id="cb432-3"><a href="stage-route-analysis.html#cb432-3" aria-hidden="true" tabindex="-1"></a><span class="co">#angle The angle in radians between the first and last points in th</span></span></code></pre></div>
<p>It might be handy to rebase the coordinates of the start to (0,0).</p>
</div>
<div id="straightness-and-sinuosity" class="section level3" number="17.5.6">
<h3><span class="header-section-number">17.5.6</span> Straightness and Sinuosity</h3>
<p>Several simple measures exist that try to provide a single number measure describing something about the straightness or sinuosity of a trajectory.</p>
<p>For example, the <code>trajr::TrajStraightness()</code> function determines <em>straightness</em> from the start to the end of a route as the ratio <em>D/L</em>, where <em>D</em> is the distance from the start to the end of the trajectory, and <em>L</em> is the length of the trajectory:</p>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb433-1"><a href="stage-route-analysis.html#cb433-1" aria-hidden="true" tabindex="-1"></a><span class="fu">TrajStraightness</span>(trj)</span></code></pre></div>
<pre><code>## [1] 0.4734154</code></pre>
<p>We can get the straightness for each stage as follows:</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb435-1"><a href="stage-route-analysis.html#cb435-1" aria-hidden="true" tabindex="-1"></a>utm_routes[<span class="st">&#39;straightness&#39;</span>] <span class="ot">=</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(trjs, TrajStraightness))</span>
<span id="cb435-2"><a href="stage-route-analysis.html#cb435-2" aria-hidden="true" tabindex="-1"></a>utm_routes[,<span class="fu">c</span>(<span class="st">&#39;Name&#39;</span>, <span class="st">&#39;straightness&#39;</span>)]</span></code></pre></div>
<pre><code>## Simple feature collection with 9 features and 2 fields
## geometry type:  LINESTRING
## dimension:      XY
## bbox:           xmin: 678318.2 ymin: 4865061 xmax: 817310.3 ymax: 4967115
## CRS:            +proj=utm +zone=31 +datum=WGS84 +units=m +no_defs
##       Name straightness                       geometry
## 1     SS 1    0.4734154 LINESTRING (729177.5 495765...
## 2     SS 2    0.4963787 LINESTRING (744846.5 496584...
## 3   SS 3/6    0.4385873 LINESTRING (716515.9 492960...
## 4   SS 4/7    0.3944959 LINESTRING (687221.3 493014...
## 5     SS 5    0.3839475 LINESTRING (700929.5 490648...
## 6  SS 9/11    0.4275332 LINESTRING (762930.5 492637...
## 7    SS 10    0.4886654 LINESTRING (783708.2 495029...
## 8 SS 12/14    0.5080453 LINESTRING (812970.4 487379...
## 9 SS 13/15    0.5746124 LINESTRING (803161.5 486506...</code></pre>
<p>This suggests that SS 5 is perhaps the most least straight, and SS13/15 is most straight.</p>
<p>If reading data from tables is not your thing, here’s a chart…</p>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb437-1"><a href="stage-route-analysis.html#cb437-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb437-2"><a href="stage-route-analysis.html#cb437-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb437-3"><a href="stage-route-analysis.html#cb437-3" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">=</span> <span class="fu">ggplot</span>(utm_routes) <span class="sc">+</span></span>
<span id="cb437-4"><a href="stage-route-analysis.html#cb437-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">as.numeric</span>(<span class="fu">row.names</span>(utm_routes)),</span>
<span id="cb437-5"><a href="stage-route-analysis.html#cb437-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y=</span>straightness)) <span class="sc">+</span></span>
<span id="cb437-6"><a href="stage-route-analysis.html#cb437-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">limits=</span>utm_routes<span class="sc">$</span>Name) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&#39;Stage&#39;</span>)</span>
<span id="cb437-7"><a href="stage-route-analysis.html#cb437-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb437-8"><a href="stage-route-analysis.html#cb437-8" aria-hidden="true" tabindex="-1"></a>g1</span></code></pre></div>
<p><img src="images/route-metrics-straight_bar-1.png" width="672" /></p>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb438-1"><a href="stage-route-analysis.html#cb438-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ggpubr::ggarrange(c(g1, g2))</span></span></code></pre></div>
<p>Let’s render them both, with a simple indicator to show where the <em>start</em> of each stage is.</p>
<div class="sourceCode" id="cb439"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb439-1"><a href="stage-route-analysis.html#cb439-1" aria-hidden="true" tabindex="-1"></a>start_location <span class="ot">=</span> <span class="cf">function</span>(i) {</span>
<span id="cb439-2"><a href="stage-route-analysis.html#cb439-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(<span class="fu">st_coordinates</span>(utm_routes[i, ]<span class="sc">$</span>geometry))[<span class="dv">1</span>,]</span>
<span id="cb439-3"><a href="stage-route-analysis.html#cb439-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb439-4"><a href="stage-route-analysis.html#cb439-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb439-5"><a href="stage-route-analysis.html#cb439-5" aria-hidden="true" tabindex="-1"></a>plot_stage <span class="ot">=</span> <span class="cf">function</span>(i, label){</span>
<span id="cb439-6"><a href="stage-route-analysis.html#cb439-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ggplot</span>(<span class="at">data=</span>utm_routes[i,]) <span class="sc">+</span> </span>
<span id="cb439-7"><a href="stage-route-analysis.html#cb439-7" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_sf</span>() <span class="sc">+</span> </span>
<span id="cb439-8"><a href="stage-route-analysis.html#cb439-8" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>X, <span class="at">y=</span>Y), <span class="at">size=</span><span class="dv">2</span>,</span>
<span id="cb439-9"><a href="stage-route-analysis.html#cb439-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">col=</span><span class="st">&#39;red&#39;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb439-10"><a href="stage-route-analysis.html#cb439-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">data=</span><span class="fu">start_location</span>(i)) <span class="sc">+</span></span>
<span id="cb439-11"><a href="stage-route-analysis.html#cb439-11" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ggtitle</span>(label) <span class="sc">+</span> <span class="fu">coord_sf</span>()</span>
<span id="cb439-12"><a href="stage-route-analysis.html#cb439-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb439-13"><a href="stage-route-analysis.html#cb439-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb439-14"><a href="stage-route-analysis.html#cb439-14" aria-hidden="true" tabindex="-1"></a>g_SS5 <span class="ot">=</span> <span class="fu">plot_stage</span>(<span class="dv">5</span>, <span class="st">&#39;SS5 - least straight&#39;</span> )</span>
<span id="cb439-15"><a href="stage-route-analysis.html#cb439-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb439-16"><a href="stage-route-analysis.html#cb439-16" aria-hidden="true" tabindex="-1"></a>g_SS13 <span class="ot">=</span> <span class="fu">plot_stage</span>(<span class="dv">9</span>, <span class="st">&#39;SS13/15 - most straight&#39;</span>)</span>
<span id="cb439-17"><a href="stage-route-analysis.html#cb439-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb439-18"><a href="stage-route-analysis.html#cb439-18" aria-hidden="true" tabindex="-1"></a>ggpubr<span class="sc">::</span><span class="fu">ggarrange</span>(g_SS5, g_SS13)</span></code></pre></div>
<p><img src="images/route-metrics-straightness-stages-1.png" width="672" /></p>
<p>Note that where we have multiple split point tines and locations for a stage available, we could slice the stage into split segments and analyse the straightness of each one separately.</p>
<p>Another single value measure is the <em>sinuosity</em>, “a function of the mean cosine of the turning angle”, calculated in a corrected form that does not require constant step size by the <a href="https://rdrr.io/github/JimMcL/trajr/man/TrajSinuosity2.html"><code>traj::TrajSinuosity2()</code> function</a> (based on equation 8 of <em>Benhamou, S. (2004). <a href="http://www.seaturtle.org/library/BenhamouS_2004_JTheorBiol.pdf">How to reliably estimate the tortuosity of an animal’s pat</a>, Journal of Theoretical Biology, 229(2), 209-220. <a href="doi:10.1016/j.jtbi.2004.03.016" class="uri">doi:10.1016/j.jtbi.2004.03.016</a></em>):</p>
<p>Let’s see how the sinuosity compares with straightness on each stage:</p>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb440-1"><a href="stage-route-analysis.html#cb440-1" aria-hidden="true" tabindex="-1"></a>utm_routes[<span class="st">&#39;sinuosity&#39;</span>] <span class="ot">=</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(trjs, TrajSinuosity2))</span>
<span id="cb440-2"><a href="stage-route-analysis.html#cb440-2" aria-hidden="true" tabindex="-1"></a>utm_routes[, <span class="fu">c</span>(<span class="st">&#39;Name&#39;</span>, <span class="st">&#39;straightness&#39;</span>, <span class="st">&#39;sinuosity&#39;</span>)]</span></code></pre></div>
<pre><code>## Simple feature collection with 9 features and 3 fields
## geometry type:  LINESTRING
## dimension:      XY
## bbox:           xmin: 678318.2 ymin: 4865061 xmax: 817310.3 ymax: 4967115
## CRS:            +proj=utm +zone=31 +datum=WGS84 +units=m +no_defs
##       Name straightness  sinuosity                       geometry
## 1     SS 1    0.4734154 0.06892671 LINESTRING (729177.5 495765...
## 2     SS 2    0.4963787 0.05811054 LINESTRING (744846.5 496584...
## 3   SS 3/6    0.4385873 0.06491216 LINESTRING (716515.9 492960...
## 4   SS 4/7    0.3944959 0.06735206 LINESTRING (687221.3 493014...
## 5     SS 5    0.3839475 0.08090800 LINESTRING (700929.5 490648...
## 6  SS 9/11    0.4275332 0.06355774 LINESTRING (762930.5 492637...
## 7    SS 10    0.4886654 0.06932409 LINESTRING (783708.2 495029...
## 8 SS 12/14    0.5080453 0.07686025 LINESTRING (812970.4 487379...
## 9 SS 13/15    0.5746124 0.08885200 LINESTRING (803161.5 486506...</code></pre>
<p>Again, if reading data from tables is not your thing, we can visualise how straightness and sinuosity relate on each stage using a scatterplot:</p>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb442-1"><a href="stage-route-analysis.html#cb442-1" aria-hidden="true" tabindex="-1"></a>g2 <span class="ot">=</span> <span class="fu">ggplot</span>(utm_routes, <span class="fu">aes</span>(<span class="at">x=</span>straightness,</span>
<span id="cb442-2"><a href="stage-route-analysis.html#cb442-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">y=</span>sinuosity,</span>
<span id="cb442-3"><a href="stage-route-analysis.html#cb442-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">label =</span> Name)) <span class="sc">+</span> </span>
<span id="cb442-4"><a href="stage-route-analysis.html#cb442-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">1</span>)  <span class="sc">+</span></span>
<span id="cb442-5"><a href="stage-route-analysis.html#cb442-5" aria-hidden="true" tabindex="-1"></a>        <span class="co"># hjust: left justiifcation (0), right justification (1)</span></span>
<span id="cb442-6"><a href="stage-route-analysis.html#cb442-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_text</span>(<span class="at">size=</span><span class="dv">3</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">nudge_y =</span> <span class="sc">-</span><span class="fl">0.001</span>)</span>
<span id="cb442-7"><a href="stage-route-analysis.html#cb442-7" aria-hidden="true" tabindex="-1"></a>g2</span></code></pre></div>
<p><img src="images/route-metrics-str_sin_scatter-1.png" width="672" /></p>
<p>Under this measure we see that the most sinuous state is actually SS 13/15 and SS5 also has high sinuosity, whereas SS 2 is the least sinuous stage:</p>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb443-1"><a href="stage-route-analysis.html#cb443-1" aria-hidden="true" tabindex="-1"></a>g_SS2 <span class="ot">=</span> <span class="fu">plot_stage</span>(<span class="dv">2</span>, <span class="st">&#39;SS2 - least sinuous&#39;</span>)</span>
<span id="cb443-2"><a href="stage-route-analysis.html#cb443-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb443-3"><a href="stage-route-analysis.html#cb443-3" aria-hidden="true" tabindex="-1"></a>g_SS13b <span class="ot">=</span> g_SS13 <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&#39;SS13 - most sinuous&#39;</span>)</span>
<span id="cb443-4"><a href="stage-route-analysis.html#cb443-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb443-5"><a href="stage-route-analysis.html#cb443-5" aria-hidden="true" tabindex="-1"></a>ggpubr<span class="sc">::</span><span class="fu">ggarrange</span>(g_SS2, g_SS13b) </span></code></pre></div>
<p><img src="images/route-metrics-trajr_sinuosity-1.png" width="672" /></p>
</div>
<div id="directional-change" class="section level3" number="17.5.7">
<h3><span class="header-section-number">17.5.7</span> Directional Change</h3>
<p>Another possible measure of how twisty a route is the <em>directional change</em>. As this measure is defined for each pair of steps, the directional change measure applied to a route is given as the mean (DC) and standard deviation (SDDC) calculated over all directional changes. Directional change itself is defined as the angular change (in degrees) between any two points in the trajectory, divided by the time difference between the two points. According to the <a href="https://cran.r-project.org/web/packages/trajr/vignettes/trajr-vignette.html"><code>trajr</code> vignette</a>, <em>DC may be used as an index of nonlinearity, and SDDC as a measure of irregularity</em>.</p>
<p>The time basis of this measure means we have to use some sort of poetic license when using this measure for route analysis: do steps go up one time unit per step, or do we use the accumulated distance for time stamps?</p>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb444-1"><a href="stage-route-analysis.html#cb444-1" aria-hidden="true" tabindex="-1"></a>calc_dc <span class="ot">=</span> <span class="cf">function</span>(route){</span>
<span id="cb444-2"><a href="stage-route-analysis.html#cb444-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(<span class="fu">TrajDirectionalChange</span>(route))</span>
<span id="cb444-3"><a href="stage-route-analysis.html#cb444-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb444-4"><a href="stage-route-analysis.html#cb444-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb444-5"><a href="stage-route-analysis.html#cb444-5" aria-hidden="true" tabindex="-1"></a>calc_sd <span class="ot">=</span> <span class="cf">function</span>(route){</span>
<span id="cb444-6"><a href="stage-route-analysis.html#cb444-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sd</span>(<span class="fu">TrajDirectionalChange</span>(route))</span>
<span id="cb444-7"><a href="stage-route-analysis.html#cb444-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb444-8"><a href="stage-route-analysis.html#cb444-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb444-9"><a href="stage-route-analysis.html#cb444-9" aria-hidden="true" tabindex="-1"></a>utm_routes[<span class="st">&#39;DC&#39;</span>] <span class="ot">=</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(trjs, calc_dc))</span>
<span id="cb444-10"><a href="stage-route-analysis.html#cb444-10" aria-hidden="true" tabindex="-1"></a>utm_routes[<span class="st">&#39;SDDC&#39;</span>] <span class="ot">=</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(trjs, calc_sd))</span>
<span id="cb444-11"><a href="stage-route-analysis.html#cb444-11" aria-hidden="true" tabindex="-1"></a>utm_routes[, <span class="fu">c</span>(<span class="st">&#39;Name&#39;</span>, <span class="st">&#39;DC&#39;</span>, <span class="st">&#39;SDDC&#39;</span>)]</span></code></pre></div>
<pre><code>## Simple feature collection with 9 features and 3 fields
## geometry type:  LINESTRING
## dimension:      XY
## bbox:           xmin: 678318.2 ymin: 4865061 xmax: 817310.3 ymax: 4967115
## CRS:            +proj=utm +zone=31 +datum=WGS84 +units=m +no_defs
##       Name       DC     SDDC                       geometry
## 1     SS 1 610.7077 447.9824 LINESTRING (729177.5 495765...
## 2     SS 2 462.6914 419.8097 LINESTRING (744846.5 496584...
## 3   SS 3/6 532.5554 375.9676 LINESTRING (716515.9 492960...
## 4   SS 4/7 507.2251 396.5569 LINESTRING (687221.3 493014...
## 5     SS 5 624.6447 651.9530 LINESTRING (700929.5 490648...
## 6  SS 9/11 491.8433 465.1185 LINESTRING (762930.5 492637...
## 7    SS 10 577.5148 479.2375 LINESTRING (783708.2 495029...
## 8 SS 12/14 587.3964 572.4125 LINESTRING (812970.4 487379...
## 9 SS 13/15 654.2415 689.2286 LINESTRING (803161.5 486506...</code></pre>
<p>Exploring these measures with different time bases is left for another day…</p>
</div>
<div id="tracking-turning-angles" class="section level3" number="17.5.8">
<h3><span class="header-section-number">17.5.8</span> Tracking Turning Angles</h3>
<p>One final single value, albeit, a complex value, metric we can get is the mean vector of the turning angle, given via the <code>trajr::TrajMeanVectorOfTurningAngle()</code> function.</p>
<p>This function takes a <em>compass.direction</em> (default <code>NULL</code>) which indicates whether the angle should be calculated relative to the angle (in radians) or, if <code>NULL</code>, relative to the previous step.</p>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb446-1"><a href="stage-route-analysis.html#cb446-1" aria-hidden="true" tabindex="-1"></a>utm_routes[<span class="st">&#39;meanTurn&#39;</span>] <span class="ot">=</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(trjs,</span>
<span id="cb446-2"><a href="stage-route-analysis.html#cb446-2" aria-hidden="true" tabindex="-1"></a>                                       TrajMeanVectorOfTurningAngles))</span>
<span id="cb446-3"><a href="stage-route-analysis.html#cb446-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb446-4"><a href="stage-route-analysis.html#cb446-4" aria-hidden="true" tabindex="-1"></a>utm_routes[, <span class="fu">c</span>(<span class="st">&#39;Name&#39;</span>, <span class="st">&#39;meanTurn&#39;</span>)]</span></code></pre></div>
<pre><code>## Simple feature collection with 9 features and 2 fields
## geometry type:  LINESTRING
## dimension:      XY
## bbox:           xmin: 678318.2 ymin: 4865061 xmax: 817310.3 ymax: 4967115
## CRS:            +proj=utm +zone=31 +datum=WGS84 +units=m +no_defs
##       Name             meanTurn                       geometry
## 1     SS 1 0.8731026+0.0075108i LINESTRING (729177.5 495765...
## 2     SS 2 0.9155575-0.0099249i LINESTRING (744846.5 496584...
## 3   SS 3/6 0.9020143+0.0010998i LINESTRING (716515.9 492960...
## 4   SS 4/7 0.9059527+0.0056232i LINESTRING (687221.3 493014...
## 5     SS 5 0.8541612-0.0058486i LINESTRING (700929.5 490648...
## 6  SS 9/11 0.9074551+0.0013095i LINESTRING (762930.5 492637...
## 7    SS 10 0.8766840-0.0029896i LINESTRING (783708.2 495029...
## 8 SS 12/14 0.8719758+0.0011581i LINESTRING (812970.4 487379...
## 9 SS 13/15 0.8343665+0.0067231i LINESTRING (803161.5 486506...</code></pre>
<p>For example, SS2 and SS13 appear to rotate in different directions?</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="stage-route-analysis.html#cb448-1" aria-hidden="true" tabindex="-1"></a>ggpubr<span class="sc">::</span><span class="fu">ggarrange</span>(g_SS2, g_SS13) </span></code></pre></div>
<p><img src="images/route-metrics-trajr-mean-turn-1.png" width="672" /></p>
<p>Hmm… maybe!</p>
<p>This is perhaps useful if we try to parse it in terms of the general direction of travel over the course of the route. This may be relevant when trying to identify whether a driver might be driving into the sun, for example (recall that we can look up sun angle and elevation by date and time easily enough using the <code>suncalc</code> <em>R</em> package.</p>
<p>For example, how about if we calculate the angle relative to due North, which I think(?!) has the compass angle of 0 radians:</p>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb449-1"><a href="stage-route-analysis.html#cb449-1" aria-hidden="true" tabindex="-1"></a>compass_relative_turn <span class="ot">=</span> <span class="cf">function</span>(route, <span class="at">angle=</span><span class="dv">0</span>) {</span>
<span id="cb449-2"><a href="stage-route-analysis.html#cb449-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">TrajMeanVectorOfTurningAngles</span>(route, angle)</span>
<span id="cb449-3"><a href="stage-route-analysis.html#cb449-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb449-4"><a href="stage-route-analysis.html#cb449-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb449-5"><a href="stage-route-analysis.html#cb449-5" aria-hidden="true" tabindex="-1"></a>utm_routes[<span class="st">&#39;meanCompass&#39;</span>] <span class="ot">=</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(trjs,</span>
<span id="cb449-6"><a href="stage-route-analysis.html#cb449-6" aria-hidden="true" tabindex="-1"></a>                                          compass_relative_turn))</span>
<span id="cb449-7"><a href="stage-route-analysis.html#cb449-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb449-8"><a href="stage-route-analysis.html#cb449-8" aria-hidden="true" tabindex="-1"></a>utm_routes[, <span class="fu">c</span>(<span class="st">&#39;Name&#39;</span>, <span class="st">&#39;meanCompass&#39;</span>)]</span></code></pre></div>
<pre><code>## Simple feature collection with 9 features and 2 fields
## geometry type:  LINESTRING
## dimension:      XY
## bbox:           xmin: 678318.2 ymin: 4865061 xmax: 817310.3 ymax: 4967115
## CRS:            +proj=utm +zone=31 +datum=WGS84 +units=m +no_defs
##       Name           meanCompass                       geometry
## 1     SS 1  0.1242776+0.3915590i LINESTRING (729177.5 495765...
## 2     SS 2 -0.0206872-0.4660270i LINESTRING (744846.5 496584...
## 3   SS 3/6 -0.3787080+0.0886329i LINESTRING (716515.9 492960...
## 4   SS 4/7 -0.4013541+0.0010163i LINESTRING (687221.3 493014...
## 5     SS 5  0.3798902+0.1763371i LINESTRING (700929.5 490648...
## 6  SS 9/11 -0.0243449-0.3751122i LINESTRING (762930.5 492637...
## 7    SS 10 -0.0341099+0.4008367i LINESTRING (783708.2 495029...
## 8 SS 12/14  0.2787954-0.4566956i LINESTRING (812970.4 487379...
## 9 SS 13/15  0.0876097+0.5542382i LINESTRING (803161.5 486506...</code></pre>
<p>So… do SS2 and SS6 appear to go in different directions?</p>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="stage-route-analysis.html#cb451-1" aria-hidden="true" tabindex="-1"></a>g_SS2 <span class="ot">=</span> <span class="fu">plot_stage</span>(<span class="dv">2</span>, <span class="st">&#39;SS2 - one way..&#39;</span>)</span>
<span id="cb451-2"><a href="stage-route-analysis.html#cb451-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb451-3"><a href="stage-route-analysis.html#cb451-3" aria-hidden="true" tabindex="-1"></a>g_SS5 <span class="ot">=</span> <span class="fu">plot_stage</span>(<span class="dv">5</span>, <span class="st">&#39;SS5 - and another?&#39;</span>)</span>
<span id="cb451-4"><a href="stage-route-analysis.html#cb451-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb451-5"><a href="stage-route-analysis.html#cb451-5" aria-hidden="true" tabindex="-1"></a>ggpubr<span class="sc">::</span><span class="fu">ggarrange</span>(g_SS2, g_SS5) </span></code></pre></div>
<p><img src="images/route-metrics-trajr-mean-compass-different-1.png" width="672" /></p>
<p>And do SS9 and SS11 appear to go in roughly the same direction?</p>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="stage-route-analysis.html#cb452-1" aria-hidden="true" tabindex="-1"></a>g_SS9 <span class="ot">=</span> <span class="fu">plot_stage</span>(<span class="dv">6</span>, <span class="st">&#39;SS9 - and the same?&#39;</span>)</span>
<span id="cb452-2"><a href="stage-route-analysis.html#cb452-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-3"><a href="stage-route-analysis.html#cb452-3" aria-hidden="true" tabindex="-1"></a>ggpubr<span class="sc">::</span><span class="fu">ggarrange</span>(g_SS2, g_SS9) </span></code></pre></div>
<p><img src="images/route-metrics-trajr-mean-compass-same-1.png" width="672" /></p>
</div>
<div id="visualising-trajectory-direction-changes" class="section level3" number="17.5.9">
<h3><span class="header-section-number">17.5.9</span> Visualising Trajectory Direction Changes</h3>
<p>As well as providing single number metrics, we can also get information back at the level of each step of the trajectory. We have already seen how the complex <em>displacement</em> is given for each step, from which we can calculate the distance of each step.</p>
<p>We can also get access to the angle of each step in a route using the <code>trajr::TrajAngles()</code> function. This function also takes a <em>compass.direction</em>, again indicating whether the angle should be calculated relative to the angle (in radians) or, if <code>NULL</code>, relative to the previous step.</p>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="stage-route-analysis.html#cb453-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step angle in radians relative to previous</span></span>
<span id="cb453-2"><a href="stage-route-analysis.html#cb453-2" aria-hidden="true" tabindex="-1"></a>trj<span class="sc">$</span>stepangle <span class="ot">=</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="fu">TrajAngles</span>(trj, <span class="at">compass.direction =</span> <span class="cn">NULL</span>) <span class="sc">*</span> <span class="dv">180</span> <span class="sc">/</span> pi, <span class="cn">NA</span>) </span>
<span id="cb453-3"><a href="stage-route-analysis.html#cb453-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb453-4"><a href="stage-route-analysis.html#cb453-4" aria-hidden="true" tabindex="-1"></a>trj<span class="sc">$</span>cumstepangle <span class="ot">=</span> <span class="fu">cumsum</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">TrajAngles</span>(trj, <span class="at">compass.direction =</span> <span class="cn">NULL</span>) <span class="sc">*</span> <span class="dv">180</span> <span class="sc">/</span> pi, <span class="cn">NA</span>))</span>
<span id="cb453-5"><a href="stage-route-analysis.html#cb453-5" aria-hidden="true" tabindex="-1"></a>trj<span class="sc">$</span>stepheading <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">TrajAngles</span>(trj, <span class="at">compass.direction =</span> <span class="dv">0</span>)<span class="sc">*</span> <span class="dv">180</span> <span class="sc">/</span> pi, <span class="cn">NA</span>) </span>
<span id="cb453-6"><a href="stage-route-analysis.html#cb453-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb453-7"><a href="stage-route-analysis.html#cb453-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb453-8"><a href="stage-route-analysis.html#cb453-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(trj[,<span class="fu">c</span>(<span class="st">&#39;stepangle&#39;</span>, <span class="st">&#39;cumstepangle&#39;</span>, <span class="st">&#39;stepheading&#39;</span>)], <span class="dv">5</span>)</span></code></pre></div>
<pre><code>##    stepangle cumstepangle stepheading
## 1         NA    0.0000000    64.44197
## 2  0.6145542    0.6145542    65.05653
## 3 21.1370427   21.7515969    86.19357
## 4 36.9688081   58.7204050   123.16238
## 5 43.4834868  102.2038918   166.64587</code></pre>
<p>We can plot the route using colour to give the general heading, by quadrant:</p>
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb455-1"><a href="stage-route-analysis.html#cb455-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cut styling via https://stackoverflow.com/a/29966785/454773</span></span>
<span id="cb455-2"><a href="stage-route-analysis.html#cb455-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb455-3"><a href="stage-route-analysis.html#cb455-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>tidyr<span class="sc">::</span><span class="fu">drop_na</span>(trj, stepheading ),</span>
<span id="cb455-4"><a href="stage-route-analysis.html#cb455-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y, <span class="at">color=</span>col)) <span class="sc">+</span> </span>
<span id="cb455-5"><a href="stage-route-analysis.html#cb455-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> <span class="fu">cut</span>(stepheading,</span>
<span id="cb455-6"><a href="stage-route-analysis.html#cb455-6" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">c</span>(<span class="sc">-</span><span class="dv">180</span>, <span class="sc">-</span><span class="dv">90</span>, <span class="dv">0</span>, <span class="dv">90</span>, <span class="dv">180</span>))),</span>
<span id="cb455-7"><a href="stage-route-analysis.html#cb455-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb455-8"><a href="stage-route-analysis.html#cb455-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>() <span class="sc">+</span> </span>
<span id="cb455-9"><a href="stage-route-analysis.html#cb455-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>X, <span class="at">y=</span>Y), <span class="at">size=</span><span class="dv">1</span>, <span class="at">col=</span><span class="st">&#39;black&#39;</span>,</span>
<span id="cb455-10"><a href="stage-route-analysis.html#cb455-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">data=</span><span class="fu">start_location</span>(<span class="dv">1</span>))</span></code></pre></div>
<p><img src="images/route-metrics-trajr-route-headings-1.png" width="672" /></p>
<p>Can we identify tight turns? The following chart plots each step location, using a distinct marker to highlight turns with a large <em>stepangle</em>:</p>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb456-1"><a href="stage-route-analysis.html#cb456-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>trj,</span>
<span id="cb456-2"><a href="stage-route-analysis.html#cb456-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">size=</span><span class="fl">0.5</span>) <span class="sc">+</span> <span class="fu">geom_path</span>(<span class="at">color=</span><span class="st">&#39;grey&#39;</span>)<span class="sc">+</span></span>
<span id="cb456-3"><a href="stage-route-analysis.html#cb456-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="at">pch=</span><span class="dv">0</span>, <span class="at">color=</span><span class="st">&#39;blue&#39;</span>,</span>
<span id="cb456-4"><a href="stage-route-analysis.html#cb456-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">data=</span>trj[<span class="fu">abs</span>(trj<span class="sc">$</span>stepangle)<span class="sc">&gt;</span><span class="dv">45</span>,]) <span class="sc">+</span></span>
<span id="cb456-5"><a href="stage-route-analysis.html#cb456-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data=</span>trj[<span class="fu">abs</span>(trj<span class="sc">$</span>stepangle)<span class="sc">&lt;=</span><span class="dv">45</span>,],</span>
<span id="cb456-6"><a href="stage-route-analysis.html#cb456-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">pch=</span><span class="dv">1</span>, <span class="at">color=</span><span class="st">&#39;red&#39;</span>, <span class="at">size=</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb456-7"><a href="stage-route-analysis.html#cb456-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>() <span class="sc">+</span> </span>
<span id="cb456-8"><a href="stage-route-analysis.html#cb456-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>X, <span class="at">y=</span>Y), <span class="at">size=</span><span class="dv">1</span>, <span class="at">col=</span><span class="st">&#39;black&#39;</span>,</span>
<span id="cb456-9"><a href="stage-route-analysis.html#cb456-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">data=</span><span class="fu">start_location</span>(<span class="dv">1</span>))</span></code></pre></div>
<p><img src="images/route-metrics-trajr-tight-turns-1.png" width="672" /></p>
<p>The instantaneous angle is okay for trying to identify particularly tight turns, but to identify whether a corner increase the angle in the same step direction, which is to say, whether the corner <em>tightens</em>, for example, we need process the data a bit further.</p>
<p>One way of doing this is to determine the gradient of the accumulated angle using the <a href="https://www.rdocumentation.org/packages/pracma/versions/1.9.9/topics/gradient"><code>pracma::gradient</code> function</a>.</p>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb457-1"><a href="stage-route-analysis.html#cb457-1" aria-hidden="true" tabindex="-1"></a>trj<span class="sc">$</span>step_gradient <span class="ot">=</span> pracma<span class="sc">::</span><span class="fu">gradient</span>(trj<span class="sc">$</span>cumstepangle, trj<span class="sc">$</span>cum_dist)</span></code></pre></div>
<p>The sign of the gradient then identifies the turn direction but the magnitude of the gradient is harder to parse because the step sizes are not constant.</p>
<p>A plot using colour to depict gradient sign may help identify whether a route involves turn predominantly to the left or to the right. We could use a related approach to display a table of locations labeled as tight right or left corners, for example:</p>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb458-1"><a href="stage-route-analysis.html#cb458-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>trj,</span>
<span id="cb458-2"><a href="stage-route-analysis.html#cb458-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y)) <span class="sc">+</span> <span class="fu">geom_path</span>(<span class="at">color=</span><span class="st">&#39;grey&#39;</span>)<span class="sc">+</span></span>
<span id="cb458-3"><a href="stage-route-analysis.html#cb458-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="at">size=</span><span class="fl">0.2</span>, <span class="at">color=</span><span class="st">&#39;blue&#39;</span>,</span>
<span id="cb458-4"><a href="stage-route-analysis.html#cb458-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">data=</span>trj[trj<span class="sc">$</span>step_gradient<span class="sc">&gt;</span><span class="fl">0.2</span>,]) <span class="sc">+</span></span>
<span id="cb458-5"><a href="stage-route-analysis.html#cb458-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size=</span><span class="fl">0.2</span>,</span>
<span id="cb458-6"><a href="stage-route-analysis.html#cb458-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">data=</span>trj[trj<span class="sc">$</span>step_gradient<span class="sc">&lt;=-</span><span class="fl">0.2</span>,],</span>
<span id="cb458-7"><a href="stage-route-analysis.html#cb458-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">color=</span><span class="st">&#39;red&#39;</span>) <span class="sc">+</span></span>
<span id="cb458-8"><a href="stage-route-analysis.html#cb458-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>() <span class="sc">+</span> </span>
<span id="cb458-9"><a href="stage-route-analysis.html#cb458-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>X, <span class="at">y=</span>Y), <span class="at">size=</span><span class="dv">1</span>, <span class="at">col=</span><span class="st">&#39;black&#39;</span>,</span>
<span id="cb458-10"><a href="stage-route-analysis.html#cb458-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">data=</span><span class="fu">start_location</span>(<span class="dv">1</span>))</span></code></pre></div>
<p><img src="images/route-metrics-trajr-gradient-lr-1.png" width="672" /></p>
<p>If nothing else, however, this approach also gives us an immediate way of detecting stationary points in the gradient. As a consequence, we can identify directional changes from left to right, or <em>vice versa</em>.</p>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb459-1"><a href="stage-route-analysis.html#cb459-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(trj,<span class="fu">aes</span>(<span class="at">x=</span>cum_dist)) <span class="sc">+</span> </span>
<span id="cb459-2"><a href="stage-route-analysis.html#cb459-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="dv">0</span>, <span class="at">color=</span><span class="st">&#39;grey&#39;</span> ) <span class="sc">+</span></span>
<span id="cb459-3"><a href="stage-route-analysis.html#cb459-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="sc">-</span><span class="dv">500</span>, <span class="at">color=</span><span class="st">&#39;grey&#39;</span> ) <span class="sc">+</span></span>
<span id="cb459-4"><a href="stage-route-analysis.html#cb459-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>( <span class="at">y=</span>cumstepangle)) <span class="sc">+</span></span>
<span id="cb459-5"><a href="stage-route-analysis.html#cb459-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>( <span class="at">y=</span><span class="sc">-</span><span class="dv">500</span><span class="sc">+</span><span class="dv">50</span> <span class="sc">*</span> step_gradient),</span>
<span id="cb459-6"><a href="stage-route-analysis.html#cb459-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">color=</span><span class="st">&#39;red&#39;</span>)</span></code></pre></div>
<p><img src="images/route-metrics-trajr-gradient-1.png" width="672" /></p>
<p>By creating simple rules, we might be able to identify features like <em>tightens</em> (for example, if we have three angles in the same direction with increasing magnitude and the final angle exceeding some threshold limit). We might similarly be able to create rules around elevation data, for example to identify <em>crests</em> (for example, a maximum in elevation, found by finding stationary points of elevation / first derivative).</p>
<p>Finally, it’s worth briefly mentioning a couple more <code>trajr</code> functions that may be useful when it comes to analysing telemetry data: <code>trajr::TrajVelocity</code> and <code>trajr:TrajAcceleration</code>, which estimate velocity and acceleration as vectors at each point along a trajectory. But that’s for another book…</p>
</div>
<div id="using-amt-for-stage-route-profiling" class="section level3" number="17.5.10">
<h3><span class="header-section-number">17.5.10</span> Using <code>amt</code> for Stage Route Profiling</h3>
<p>The <a href="https://cran.r-project.org/web/packages/amt/index.html"><code>amt</code> (animal movement tools) <em>R</em> package</a> was designed to support the management and analysis of animal movement data. Routes are represented as <em>tracks</em> in the form of tibbles with at least an <em>x_</em> and <em>y_</em> column and, if required, a <code>t_</code> (time) column. Consecutive rows, which might be assumed to be collected with fixed period, identify straightline <em>steps</em>. A <code>track_xy</code>track type only has coordinates, and a
<code>track_xyt</code> track type has a timestamp associated to each coordinate pair.</p>
<p>An additional <em>burst</em> column, <code>burst_</code>, provides us with a potential grouping parameter that lets us perform analyses on sections of the track. This could be used to identify segments of the route between split points, for example, if we can apply appropriate burst labels to each part of the track.</p>
<p>For our purposes here, it is clear to see how we might imagine a mapping the X and Y co-ordinates from a route linestring in a UTM/meters based projection directly into a a track tibble. The <code>amt::make_track()</code> function provides a straightforward way of doing this:</p>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb460-1"><a href="stage-route-analysis.html#cb460-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(amt)</span>
<span id="cb460-2"><a href="stage-route-analysis.html#cb460-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-3"><a href="stage-route-analysis.html#cb460-3" aria-hidden="true" tabindex="-1"></a>amt_track <span class="ot">=</span> <span class="fu">make_track</span>(<span class="fu">st_coordinates</span>(utm_routes[<span class="dv">1</span>,]), X, Y)</span></code></pre></div>
<pre><code>## .t missing, creating `track_xy`.</code></pre>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb462-1"><a href="stage-route-analysis.html#cb462-1" aria-hidden="true" tabindex="-1"></a>amt_track</span></code></pre></div>
<pre><code>## # A tibble: 419 x 2
##         x_       y_
##  *   &lt;dbl&gt;    &lt;dbl&gt;
##  1 729177. 4957658.
##  2 729187. 4957678.
##  3 729199. 4957703.
##  4 729200. 4957724.
##  5 729189. 4957741.
##  6 729168. 4957746.
##  7 729129. 4957744.
##  8 729102. 4957753.
##  9 728952. 4957845.
## 10 728928. 4957870.
## # … with 409 more rows</code></pre>
</div>
<div id="creating-tracks" class="section level3" number="17.5.11">
<h3><span class="header-section-number">17.5.11</span> Creating Tracks</h3>
<p>The <code>make_track</code> function has a further optional argument (<code>crs</code>), which allows the user to set a coordinate reference system (CRS) of the track. The CRS needs to be provided as valid proj4string, see the documentation of sp::CRS for further details; see also <a href="https://proj.org/usage/projections.html"><em>proj4</em> projections</a>.</p>
<p>We can segment the track into a series of straightline steps from one point to the next, also returning the step distance (<code>sl</code>) and angle (<code>direction_p</code> radians):</p>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb464-1"><a href="stage-route-analysis.html#cb464-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a &quot;steps&quot; object from each sample</span></span>
<span id="cb464-2"><a href="stage-route-analysis.html#cb464-2" aria-hidden="true" tabindex="-1"></a>amt_steps <span class="ot">=</span> <span class="fu">steps</span>(amt_track)</span>
<span id="cb464-3"><a href="stage-route-analysis.html#cb464-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(amt_steps)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 7
##       x1_     x2_      y1_      y2_   sl_ direction_p     ta_
## *   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt;   &lt;dbl&gt;
## 1 729177. 729187. 4957658. 4957678.  22.6       NA    NA     
## 2 729187. 729199. 4957678. 4957703.  27.9        1.12  0.0107
## 3 729199. 729200. 4957703. 4957724.  21.0        1.14  0.369 
## 4 729200. 729189. 4957724. 4957741.  20.4        1.50  0.645 
## 5 729189. 729168. 4957741. 4957746.  21.8        2.15  0.759 
## 6 729168. 729129. 4957746. 4957744.  39.2        2.91  0.288</code></pre>
</div>
<div id="converting-to-other-track-formats" class="section level3" number="17.5.12">
<h3><span class="header-section-number">17.5.12</span> Converting to Other Track Formats</h3>
<p>The <code>amt</code> package provides a range of tools that allow us to <em>coerce</em> <code>amt</code> tracks to other movement analysis packages.</p>
<p>For example, we can cast a <code>track_xy</code> object to a <em>Spatial</em> object:</p>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="stage-route-analysis.html#cb466-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_sp</span>(amt_track)</span></code></pre></div>
<pre><code>## class       : SpatialPoints 
## features    : 419 
## extent      : 728265.7, 732502.2, 4957658, 4967115  (xmin, xmax, ymin, ymax)
## crs         : NA</code></pre>
<p>Conversions to other movement data structures is possible from <code>track_xyt</code> objects.</p>
</div>
<div id="using-amt-for-stage-route-analysis" class="section level3" number="17.5.13">
<h3><span class="header-section-number">17.5.13</span> Using <code>amt</code> for Stage Route Analysis</h3>
<p>We can also obtain step lengths directly from the track via the <code>amt::step_lengths()</code> function:</p>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="stage-route-analysis.html#cb468-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtain the step lengths and omit / drop the final NA value</span></span>
<span id="cb468-2"><a href="stage-route-analysis.html#cb468-2" aria-hidden="true" tabindex="-1"></a>amt_step_lengths <span class="ot">=</span> <span class="fu">head</span>(<span class="fu">step_lengths</span>(amt_track), <span class="sc">-</span><span class="dv">1</span>)</span></code></pre></div>
<p>Directions can be determined absolutely, e.g. with reference to a North, South, East or West basis, using <code>amt::direction_abs()</code> or relatively to the previous step using `<code>amt::direction_rel()</code>:</p>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb469-1"><a href="stage-route-analysis.html#cb469-1" aria-hidden="true" tabindex="-1"></a>absolute_step_directions <span class="ot">=</span> <span class="fu">direction_abs</span>(amt_track)</span>
<span id="cb469-2"><a href="stage-route-analysis.html#cb469-2" aria-hidden="true" tabindex="-1"></a>relative_step_directions <span class="ot">=</span> <span class="fu">direction_rel</span>(amt_track)</span></code></pre></div>
<p>In terms of route complexity measures, the <code>amt</code> package provides functions for calculating single number metrics of <em>sinuosity</em> (<code>amt::sinuosity()</code>),
<em>straightness</em> (<code>amt::straightness()</code>), <em>accumulated track distance</em> (<code>amt::cum_dist()</code>) and <em>total straightline distance</em> (<code>amt::tot_dist()</code>). The <em>intensity use</em> metric is calculated by dividing the total movement distance (<code>tot_dist</code>) by the square of the area of movement:</p>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="stage-route-analysis.html#cb470-1" aria-hidden="true" tabindex="-1"></a>amt<span class="sc">::</span><span class="fu">sinuosity</span>(amt_track)</span></code></pre></div>
<pre><code>## [1] 0.001697952</code></pre>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="stage-route-analysis.html#cb472-1" aria-hidden="true" tabindex="-1"></a>amt<span class="sc">::</span><span class="fu">straightness</span>(amt_track)</span></code></pre></div>
<pre><code>## [1] 0.4734154</code></pre>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="stage-route-analysis.html#cb474-1" aria-hidden="true" tabindex="-1"></a>amt<span class="sc">::</span><span class="fu">cum_dist</span>(amt_track)</span></code></pre></div>
<pre><code>## [1] 21074.92</code></pre>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="stage-route-analysis.html#cb476-1" aria-hidden="true" tabindex="-1"></a>amt<span class="sc">::</span><span class="fu">tot_dist</span>(amt_track)</span></code></pre></div>
<pre><code>## [1] 9977.189</code></pre>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="stage-route-analysis.html#cb478-1" aria-hidden="true" tabindex="-1"></a>amt<span class="sc">::</span><span class="fu">intensity_use</span>(amt_track)</span></code></pre></div>
<pre><code>## [1] 4.710567</code></pre>
<p>Let’s generate a list of tracks, one for each stage:</p>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb480-1"><a href="stage-route-analysis.html#cb480-1" aria-hidden="true" tabindex="-1"></a>to_amt_track <span class="ot">=</span> <span class="cf">function</span>(route){</span>
<span id="cb480-2"><a href="stage-route-analysis.html#cb480-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">make_track</span>(<span class="fu">st_coordinates</span>(route<span class="sc">$</span>geometry), X, Y)</span>
<span id="cb480-3"><a href="stage-route-analysis.html#cb480-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb480-4"><a href="stage-route-analysis.html#cb480-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-5"><a href="stage-route-analysis.html#cb480-5" aria-hidden="true" tabindex="-1"></a>amt_tracks <span class="ot">=</span> <span class="fu">apply</span>(utm_routes, <span class="dv">1</span>, to_amt_track)</span></code></pre></div>
<pre><code>## .t missing, creating `track_xy`.
## .t missing, creating `track_xy`.
## .t missing, creating `track_xy`.
## .t missing, creating `track_xy`.
## .t missing, creating `track_xy`.
## .t missing, creating `track_xy`.
## .t missing, creating `track_xy`.
## .t missing, creating `track_xy`.
## .t missing, creating `track_xy`.</code></pre>
<p>Now we can generate reports for all the stages:</p>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="stage-route-analysis.html#cb482-1" aria-hidden="true" tabindex="-1"></a>utm_routes[<span class="st">&#39;amt_sin&#39;</span>] <span class="ot">=</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(amt_tracks, amt<span class="sc">::</span>sinuosity))</span>
<span id="cb482-2"><a href="stage-route-analysis.html#cb482-2" aria-hidden="true" tabindex="-1"></a>utm_routes[<span class="st">&#39;amt_str&#39;</span>] <span class="ot">=</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(amt_tracks, amt<span class="sc">::</span>straightness))</span>
<span id="cb482-3"><a href="stage-route-analysis.html#cb482-3" aria-hidden="true" tabindex="-1"></a>utm_routes[<span class="st">&#39;amt_cumd&#39;</span>] <span class="ot">=</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(amt_tracks, amt<span class="sc">::</span>cum_dist))</span>
<span id="cb482-4"><a href="stage-route-analysis.html#cb482-4" aria-hidden="true" tabindex="-1"></a>utm_routes[<span class="st">&#39;amt_totd&#39;</span>] <span class="ot">=</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(amt_tracks, amt<span class="sc">::</span>tot_dist))</span>
<span id="cb482-5"><a href="stage-route-analysis.html#cb482-5" aria-hidden="true" tabindex="-1"></a>utm_routes[<span class="st">&#39;amt_int&#39;</span>] <span class="ot">=</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(amt_tracks, amt<span class="sc">::</span>intensity_use))</span>
<span id="cb482-6"><a href="stage-route-analysis.html#cb482-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb482-7"><a href="stage-route-analysis.html#cb482-7" aria-hidden="true" tabindex="-1"></a>utm_routes[, <span class="fu">c</span>(<span class="st">&#39;amt_sin&#39;</span>,<span class="st">&#39;amt_str&#39;</span>,<span class="st">&#39;amt_cumd&#39;</span>,<span class="st">&#39;amt_totd&#39;</span>,<span class="st">&#39;amt_int&#39;</span>)]</span></code></pre></div>
<pre><code>## Simple feature collection with 9 features and 5 fields
## geometry type:  LINESTRING
## dimension:      XY
## bbox:           xmin: 678318.2 ymin: 4865061 xmax: 817310.3 ymax: 4967115
## CRS:            +proj=utm +zone=31 +datum=WGS84 +units=m +no_defs
##       amt_sin   amt_str amt_cumd  amt_totd  amt_int
## 1 0.001697952 0.4734154 21074.92  9977.189 4.710567
## 2 0.003279775 0.4963787 21350.64 10598.001 3.449856
## 3 0.001161548 0.4385873 20381.31  8938.984 4.135712
## 4 0.005593607 0.3944959 21983.48  8672.392 4.697379
## 5 0.001731603 0.3839475 22861.47  8777.607 7.097515
## 6 0.002622528 0.4275332 18657.68  7976.777 4.770509
## 7 0.003586272 0.4886654 21233.21 10375.937 4.468135
## 8 0.002778324 0.5080453 13196.82  6704.582 4.362178
## 9 0.003312796 0.5746124 14861.89  8539.827 5.504767
##                         geometry
## 1 LINESTRING (729177.5 495765...
## 2 LINESTRING (744846.5 496584...
## 3 LINESTRING (716515.9 492960...
## 4 LINESTRING (687221.3 493014...
## 5 LINESTRING (700929.5 490648...
## 6 LINESTRING (762930.5 492637...
## 7 LINESTRING (783708.2 495029...
## 8 LINESTRING (812970.4 487379...
## 9 LINESTRING (803161.5 486506...</code></pre>
<p>We can resample locations from the track using <code>amt::track_resample()</code>. Once again, if we use distance as a proxy for time, this allows us to sample by distance along the line.</p>
</div>
<div id="using-rlft-for-profiling-along-a-stage-route" class="section level3" number="17.5.14">
<h3><span class="header-section-number">17.5.14</span> Using `rLFT`` for Profiling Along a Stage Route</h3>
<p>The <a href="https://cran.r-project.org/web//packages/rLFT/vignettes/rLFT_Introduction.html"><code>rLFT</code> (Linear Feature Tools) <em>R</em> package</a> was developed in order to support the processing of simple linear features.</p>
<p>The boundary convexity tool function, <code>rLFT::bct()</code> generates a convexity measure for a sliding window of points along a route; the route must be provided in a projected (<em>not</em> geographic) coordinate system. The sign of the convexity measure identifies whether the curve is concave (negative) or convex (positive), the increasing values identifying tightness of the curve. A normalised convexity index and a sinuosity measure are also created.</p>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb484-1"><a href="stage-route-analysis.html#cb484-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rLFT)</span>
<span id="cb484-2"><a href="stage-route-analysis.html#cb484-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb484-3"><a href="stage-route-analysis.html#cb484-3" aria-hidden="true" tabindex="-1"></a>outputTable <span class="ot">&lt;-</span> <span class="fu">bct</span>(utm_routes[<span class="dv">1</span>,],</span>
<span id="cb484-4"><a href="stage-route-analysis.html#cb484-4" aria-hidden="true" tabindex="-1"></a>                   <span class="co"># distance between measurements </span></span>
<span id="cb484-5"><a href="stage-route-analysis.html#cb484-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">step =</span> <span class="dv">10</span>,</span>
<span id="cb484-6"><a href="stage-route-analysis.html#cb484-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">window =</span> <span class="dv">20</span>, <span class="at">ridName =</span> <span class="st">&quot;Name&quot;</span>)</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.175   0.029   0.205 
## [1] &quot;Features skipped due to size: &quot;
## logical(0)</code></pre>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb486-1"><a href="stage-route-analysis.html#cb486-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(outputTable)</span></code></pre></div>
<pre><code>##   FID  RID MidMeas WindowSize RawConvexity ConvexityIndex Sinuosity Midpoint_X
## 1   1 SS 1      10         20        0.000          0.000     0.500   729181.8
## 2   1 SS 1      20         20       -0.040         -0.004     0.500   729186.1
## 3   1 SS 1      30         20       -0.014         -0.001     0.500   729190.4
## 4   1 SS 1      40         20        0.000          0.000     0.500   729194.6
## 5   1 SS 1      50         20       -1.739         -0.174     0.509   729198.8
## 6   1 SS 1      60         20       -0.093         -0.009     0.501   729199.6
##   Midpoint_Y
## 1    4957667
## 2    4957676
## 3    4957685
## 4    4957694
## 5    4957703
## 6    4957713</code></pre>
<p>By filtering the table to rows with with a large absolute <em>ConvexityIndex</em> we can identify and label tight corners. The <code>ggrepel::geom_text_repel()</code> function attempts to minimise the extent to which labels overlap, using arrows to identify points referenced by the label where the label location is dodged away from the point:</p>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb488-1"><a href="stage-route-analysis.html#cb488-1" aria-hidden="true" tabindex="-1"></a>tight_corners <span class="ot">=</span> outputTable[<span class="fu">abs</span>(outputTable<span class="sc">$</span>ConvexityIndex)<span class="sc">&gt;</span><span class="fl">0.45</span>,]</span>
<span id="cb488-2"><a href="stage-route-analysis.html#cb488-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-3"><a href="stage-route-analysis.html#cb488-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb488-4"><a href="stage-route-analysis.html#cb488-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span>utm_routes[<span class="dv">1</span>,]) <span class="sc">+</span></span>
<span id="cb488-5"><a href="stage-route-analysis.html#cb488-5" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">data=</span>tight_corners,</span>
<span id="cb488-6"><a href="stage-route-analysis.html#cb488-6" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">aes</span>(<span class="at">label =</span> ConvexityIndex,</span>
<span id="cb488-7"><a href="stage-route-analysis.html#cb488-7" aria-hidden="true" tabindex="-1"></a>                               <span class="at">x=</span>Midpoint_X, <span class="at">y=</span>Midpoint_Y,</span>
<span id="cb488-8"><a href="stage-route-analysis.html#cb488-8" aria-hidden="true" tabindex="-1"></a>                               <span class="at">color=</span> (ConvexityIndex<span class="sc">&gt;</span><span class="dv">0</span>) ),</span>
<span id="cb488-9"><a href="stage-route-analysis.html#cb488-9" aria-hidden="true" tabindex="-1"></a>                           <span class="at">size=</span><span class="dv">2</span>,</span>
<span id="cb488-10"><a href="stage-route-analysis.html#cb488-10" aria-hidden="true" tabindex="-1"></a>                           <span class="at">nudge_x =</span> <span class="dv">2000</span>, <span class="at">nudge_y =</span> <span class="dv">500</span>) <span class="sc">+</span></span>
<span id="cb488-11"><a href="stage-route-analysis.html#cb488-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>tight_corners,</span>
<span id="cb488-12"><a href="stage-route-analysis.html#cb488-12" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x=</span>Midpoint_X, <span class="at">y=</span>Midpoint_Y,</span>
<span id="cb488-13"><a href="stage-route-analysis.html#cb488-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color=</span> (ConvexityIndex<span class="sc">&gt;</span><span class="dv">0</span>) ), <span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb488-14"><a href="stage-route-analysis.html#cb488-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="images/route-metrics-rLFT-route-1.png" width="672" /></p>
<p>We can also get the output table as a <em>simple features</em> object where the midpoint co-ordinates are cast to a point geometry type:</p>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb489-1"><a href="stage-route-analysis.html#cb489-1" aria-hidden="true" tabindex="-1"></a>outSF <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(outputTable,</span>
<span id="cb489-2"><a href="stage-route-analysis.html#cb489-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;Midpoint_X&quot;</span>, <span class="st">&quot;Midpoint_Y&quot;</span>), </span>
<span id="cb489-3"><a href="stage-route-analysis.html#cb489-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>The convexity measures are defined in *Albeke, S.E. et al. <a href="https://www.d.umn.edu/biology/documents/Nibbelink2_000.pdf">Measuring boundary convexity at multiple spatial scales using a linear ‘moving window’ analysis: an application to coastal river otter habitat selection</a> Landscape Ecology 25 (2010): 1575-1587.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="composing-rayshader-stills-and-movies.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="elevation-data-revisited.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toc_depth": 3,
"toolbar": {
"position": "fixed"
},
"search": true,
"info": true
});
});
</script>

</body>

</html>
