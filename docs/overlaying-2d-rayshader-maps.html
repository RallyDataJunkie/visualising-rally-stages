<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>10 Overlaying 2D rayshader Maps | Visualising WRC Rally Stages With rayshader and R</title>
  <meta name="description" content="Rally stage maps often appear on rally websites displayed via interactive web maps. The data used to generate the routes is often available as a digital data file of some sort. This book takes one such file and embarks on an adventure into the wilds of geocomputing using the R programming language to see just where such a file may take us. From web maps and elevation maps to interactive 3D displays, let the exploration commence…" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="10 Overlaying 2D rayshader Maps | Visualising WRC Rally Stages With rayshader and R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Rally stage maps often appear on rally websites displayed via interactive web maps. The data used to generate the routes is often available as a digital data file of some sort. This book takes one such file and embarks on an adventure into the wilds of geocomputing using the R programming language to see just where such a file may take us. From web maps and elevation maps to interactive 3D displays, let the exploration commence…" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="10 Overlaying 2D rayshader Maps | Visualising WRC Rally Stages With rayshader and R" />
  
  <meta name="twitter:description" content="Rally stage maps often appear on rally websites displayed via interactive web maps. The data used to generate the routes is often available as a digital data file of some sort. This book takes one such file and embarks on an adventure into the wilds of geocomputing using the R programming language to see just where such a file may take us. From web maps and elevation maps to interactive 3D displays, let the exploration commence…" />
  

<meta name="author" content="Tony Hirst" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="using-rayshader-to-render-2d-elevation-and-shade-views.html"/>
<link rel="next" href="annotating-rayshader-maps.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3.9000/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.3.9000/leaflet-providers-plugin.js"></script>
<link href="libs/leaflet-awesomemarkers-2.0.3/leaflet.awesome-markers.css" rel="stylesheet" />
<script src="libs/leaflet-awesomemarkers-2.0.3/leaflet.awesome-markers.min.js"></script>
<link href="libs/fontawesome-4.7.0/font-awesome.min.css" rel="stylesheet" />
<link href="libs/leaflet-minimap-3.3.1/Control.MiniMap.min.css" rel="stylesheet" />
<script src="libs/leaflet-minimap-3.3.1/Control.MiniMap.min.js"></script>
<script src="libs/leaflet-minimap-3.3.1/Minimap-binding.js"></script>
<script src="libs/FlatGeoBuf-3.3.3/fgb.js"></script>
<script src="libs/FlatGeoBuf-3.3.3/flatgeobuf-geojson.min.js"></script>
<script src="libs/chromajs-2.1.0/chroma.min.js"></script>
<link id="geojson_sf-1-attachment" rel="attachment" href="libs/geojson_sf-0.0.1/geojson_sf_layer.fgb"/>
<link href="libs/HomeButton-0.0.1/home-button.css" rel="stylesheet" />
<script src="libs/HomeButton-0.0.1/home-button.js"></script>
<script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />
<link href="libs/style-1/style.css" rel="stylesheet" />
<script src="libs/plainView-binding-2.9.0/plainView.js"></script>
<link id="image-1-attachment" rel="attachment" href="libs/image-1/img.png"/>
<script src="libs/elev_img-1/data_stars_elev_imgdacf38.txt"></script>
<script src="libs/joda-0.0.1/joda.js"></script>
<script src="libs/joda-0.0.1/addImageQuery-bindings.js"></script>
<script src="libs/rglWebGL-binding-0.105.14/rglWebGL.js"></script>
<link href="libs/rglwidgetClass-0.105.14/rgl.css" rel="stylesheet" />
<script src="libs/rglwidgetClass-0.105.14/rglClass.src.js"></script>
<script src="libs/rglwidgetClass-0.105.14/utils.src.js"></script>
<script src="libs/rglwidgetClass-0.105.14/subscenes.src.js"></script>
<script src="libs/rglwidgetClass-0.105.14/shaders.src.js"></script>
<script src="libs/rglwidgetClass-0.105.14/textures.src.js"></script>
<script src="libs/rglwidgetClass-0.105.14/projection.src.js"></script>
<script src="libs/rglwidgetClass-0.105.14/mouse.src.js"></script>
<script src="libs/rglwidgetClass-0.105.14/init.src.js"></script>
<script src="libs/rglwidgetClass-0.105.14/pieces.src.js"></script>
<script src="libs/rglwidgetClass-0.105.14/draw.src.js"></script>
<script src="libs/rglwidgetClass-0.105.14/controls.src.js"></script>
<script src="libs/rglwidgetClass-0.105.14/selection.src.js"></script>
<script src="libs/rglwidgetClass-0.105.14/rglTimer.src.js"></script>
<script src="libs/CanvasMatrix4-0.105.14/CanvasMatrix.src.js"></script>
<link href="libs/vembedr-0.1.4/css/vembedr.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="in-the-beginning.html"><a href="in-the-beginning.html"><i class="fa fa-check"></i>In the beginning…</a></li>
<li class="chapter" data-level="" data-path="acknowledgements.html"><a href="acknowledgements.html"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#who-this-book-is-for"><i class="fa fa-check"></i><b>1.1</b> Who This Book Is For</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#what-this-book-isnt"><i class="fa fa-check"></i><b>1.2</b> What This Book Isn’t</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#structure-of-the-book"><i class="fa fa-check"></i><b>1.3</b> Structure of the Book</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#further-reading"><i class="fa fa-check"></i><b>1.4</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="getting-started.html"><a href="getting-started.html"><i class="fa fa-check"></i><b>2</b> Getting Started</a>
<ul>
<li class="chapter" data-level="2.1" data-path="getting-started.html"><a href="getting-started.html#setting-up-a-working-code-execution-environment"><i class="fa fa-check"></i><b>2.1</b> Setting Up a Working Code Execution Environment</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="getting-started.html"><a href="getting-started.html#installing-the-docker-environment"><i class="fa fa-check"></i><b>2.1.1</b> Installing the Docker Environment</a></li>
<li class="chapter" data-level="2.1.2" data-path="getting-started.html"><a href="getting-started.html#installing-the-required-r-packages-manually"><i class="fa fa-check"></i><b>2.1.2</b> Installing the Required R Packages Manually</a></li>
<li class="chapter" data-level="2.1.3" data-path="getting-started.html"><a href="getting-started.html#other-installation-dependencies"><i class="fa fa-check"></i><b>2.1.3</b> Other Installation Dependencies</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="getting-started.html"><a href="getting-started.html#using-the-rstudio-environment"><i class="fa fa-check"></i><b>2.2</b> Using the RStudio Environment</a></li>
<li class="chapter" data-level="2.3" data-path="getting-started.html"><a href="getting-started.html#using-a-jupyter-notebook-environment"><i class="fa fa-check"></i><b>2.3</b> Using a Jupyter Notebook Environment</a></li>
<li class="chapter" data-level="2.4" data-path="getting-started.html"><a href="getting-started.html#exploring-the-book-as-an-online-interactive-textbook-not-yet"><i class="fa fa-check"></i><b>2.4</b> Exploring the Book as an Online Interactive Textbook (Not Yet!)</a></li>
<li class="chapter" data-level="2.5" data-path="getting-started.html"><a href="getting-started.html#serving-your-own-map-tiles-and-elevation-raster-images"><i class="fa fa-check"></i><b>2.5</b> Serving Your Own Map Tiles and Elevation Raster Images</a></li>
<li class="chapter" data-level="2.6" data-path="getting-started.html"><a href="getting-started.html#donate"><i class="fa fa-check"></i><b>2.6</b> Donate</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html"><i class="fa fa-check"></i><b>3</b> Importing the Stage Route Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#downloading-the-stage-data-file"><i class="fa fa-check"></i><b>3.1</b> Downloading the Stage Data File</a></li>
<li class="chapter" data-level="3.2" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#opening-kml-geodata-files"><i class="fa fa-check"></i><b>3.2</b> Opening KML Geodata Files</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#using-rgdal-and-sp-to-open-geodata-files"><i class="fa fa-check"></i><b>3.2.1</b> Using <code>rgdal</code> and <code>sp</code> to Open Geodata Files</a></li>
<li class="chapter" data-level="3.2.2" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#using-sf-to-open-geodata-files"><i class="fa fa-check"></i><b>3.2.2</b> Using <code>sf</code> to Open Geodata Files</a></li>
<li class="chapter" data-level="3.2.3" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#accessing-route-data-as-a-geojson-string"><i class="fa fa-check"></i><b>3.2.3</b> Accessing Route Data as a geojson String</a></li>
<li class="chapter" data-level="3.2.4" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#saving-simple-features-data-to-various-geodata-file-formats"><i class="fa fa-check"></i><b>3.2.4</b> Saving Simple Features Data to Various Geodata File Formats</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#important-geodata-file-formats"><i class="fa fa-check"></i><b>3.3</b> Important Geodata File Formats</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#loading-geojson-data"><i class="fa fa-check"></i><b>3.3.1</b> Loading geojson Data</a></li>
<li class="chapter" data-level="3.3.2" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#loading-gpx-data"><i class="fa fa-check"></i><b>3.3.2</b> Loading GPX Data</a></li>
<li class="chapter" data-level="3.3.3" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#loading-flight-data-using-igc-format-gps-files"><i class="fa fa-check"></i><b>3.3.3</b> Loading Flight Data Using IGC format GPS Files</a></li>
<li class="chapter" data-level="3.3.4" data-path="importing-the-stage-route-data.html"><a href="importing-the-stage-route-data.html#reading-data-from-gps-devices"><i class="fa fa-check"></i><b>3.3.4</b> Reading Data from GPS Devices</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="working-with-route-data.html"><a href="working-with-route-data.html"><i class="fa fa-check"></i><b>4</b> Working with Route Data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="working-with-route-data.html"><a href="working-with-route-data.html#loading-in-the-route-data"><i class="fa fa-check"></i><b>4.1</b> Loading in the Route Data</a></li>
<li class="chapter" data-level="4.2" data-path="working-with-route-data.html"><a href="working-with-route-data.html#access-a-specific-stage"><i class="fa fa-check"></i><b>4.2</b> Access a specific stage</a></li>
<li class="chapter" data-level="4.3" data-path="working-with-route-data.html"><a href="working-with-route-data.html#visual-preview-of-route-geodata"><i class="fa fa-check"></i><b>4.3</b> Visual Preview of Route Geodata</a></li>
<li class="chapter" data-level="4.4" data-path="working-with-route-data.html"><a href="working-with-route-data.html#previews-using-ggplot2"><i class="fa fa-check"></i><b>4.4</b> Previews using <code>ggplot2</code></a></li>
<li class="chapter" data-level="4.5" data-path="working-with-route-data.html"><a href="working-with-route-data.html#identifying-the-start-and-end-of-the-stage"><i class="fa fa-check"></i><b>4.5</b> Identifying the Start and End of the Stage</a></li>
<li class="chapter" data-level="4.6" data-path="working-with-route-data.html"><a href="working-with-route-data.html#extracting-route-fragments"><i class="fa fa-check"></i><b>4.6</b> Extracting Route Fragments</a></li>
<li class="chapter" data-level="4.7" data-path="working-with-route-data.html"><a href="working-with-route-data.html#previews-using-leaflet-interactive-maps"><i class="fa fa-check"></i><b>4.7</b> Previews Using <code>leaflet</code> Interactive Maps</a></li>
<li class="chapter" data-level="4.8" data-path="working-with-route-data.html"><a href="working-with-route-data.html#creating-buffer-regions-around-features"><i class="fa fa-check"></i><b>4.8</b> Creating Buffer regions around features</a></li>
<li class="chapter" data-level="4.9" data-path="working-with-route-data.html"><a href="working-with-route-data.html#adding-additional-features-to-leaflet-maps"><i class="fa fa-check"></i><b>4.9</b> Adding Additional Features to <code>leaflet</code> maps</a>
<ul>
<li class="chapter" data-level="4.9.1" data-path="working-with-route-data.html"><a href="working-with-route-data.html#add-minimap-navigation"><i class="fa fa-check"></i><b>4.9.1</b> Add “minimap” navigation</a></li>
<li class="chapter" data-level="4.9.2" data-path="working-with-route-data.html"><a href="working-with-route-data.html#add-custom-symbol-legends"><i class="fa fa-check"></i><b>4.9.2</b> Add Custom Symbol Legends</a></li>
<li class="chapter" data-level="4.9.3" data-path="working-with-route-data.html"><a href="working-with-route-data.html#adding-mini-charts-to-maps"><i class="fa fa-check"></i><b>4.9.3</b> Adding Mini-Charts to Maps</a></li>
<li class="chapter" data-level="4.9.4" data-path="working-with-route-data.html"><a href="working-with-route-data.html#adding-html-content-to-popups"><i class="fa fa-check"></i><b>4.9.4</b> Adding HTML content to popups</a></li>
</ul></li>
<li class="chapter" data-level="4.10" data-path="working-with-route-data.html"><a href="working-with-route-data.html#using-mapview-to-create-leaflet-maps"><i class="fa fa-check"></i><b>4.10</b> Using <code>mapview</code> To Create <em>leaflet</em> Maps</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html"><i class="fa fa-check"></i><b>5</b> Introducing Map Projections</a>
<ul>
<li class="chapter" data-level="5.1" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#load-in-the-route-data"><i class="fa fa-check"></i><b>5.1</b> Load in the Route Data</a></li>
<li class="chapter" data-level="5.2" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#previewing-a-map-route"><i class="fa fa-check"></i><b>5.2</b> Previewing a Map Route</a></li>
<li class="chapter" data-level="5.3" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#plotting-latlong-naively"><i class="fa fa-check"></i><b>5.3</b> Plotting LatLong Naively</a></li>
<li class="chapter" data-level="5.4" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#using-the-utm-co-ordinate-reference-system"><i class="fa fa-check"></i><b>5.4</b> Using the UTM Co-ordinate Reference System</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#using-st_transform-for-projection-transformations"><i class="fa fa-check"></i><b>5.4.1</b> Using <code>st_transform</code> for Projection Transformations</a></li>
<li class="chapter" data-level="5.4.2" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#using-ggplot2coord_sf-to-render-projections"><i class="fa fa-check"></i><b>5.4.2</b> Using <code>ggplot2::coord_sf</code> to Render Projections</a></li>
<li class="chapter" data-level="5.4.3" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#exporting-the-route-data-as-a-dataframe"><i class="fa fa-check"></i><b>5.4.3</b> Exporting the Route Data As a Dataframe</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="introducing-map-projections.html"><a href="introducing-map-projections.html#alternative-crs-projections"><i class="fa fa-check"></i><b>5.5</b> Alternative CRS Projections</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="stage-route-annotations.html"><a href="stage-route-annotations.html"><i class="fa fa-check"></i><b>6</b> Stage Route Annotations</a>
<ul>
<li class="chapter" data-level="6.1" data-path="stage-route-annotations.html"><a href="stage-route-annotations.html#load-in-the-route-data-1"><i class="fa fa-check"></i><b>6.1</b> Load in the Route Data</a></li>
<li class="chapter" data-level="6.2" data-path="stage-route-annotations.html"><a href="stage-route-annotations.html#adding-split-point-locations"><i class="fa fa-check"></i><b>6.2</b> Adding Split Point Locations</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="stage-route-annotations.html"><a href="stage-route-annotations.html#using-geojson-to-find-the-distance-along-a-route"><i class="fa fa-check"></i><b>6.2.1</b> Using geojson to Find the Distance Along a Route</a></li>
<li class="chapter" data-level="6.2.2" data-path="stage-route-annotations.html"><a href="stage-route-annotations.html#using-rgeosginterpolate-to-find-the-distance-along-a-route"><i class="fa fa-check"></i><b>6.2.2</b> Using <code>rgeos::gInterpolate</code> to Find the Distance Along a Route</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="stage-route-annotations.html"><a href="stage-route-annotations.html#parallel-routes"><i class="fa fa-check"></i><b>6.3</b> Parallel Routes</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html"><i class="fa fa-check"></i><b>7</b> Accessing and Working With Elevation Data Raster Files</a>
<ul>
<li class="chapter" data-level="7.1" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#introducing-digital-elevation-model-dem-raster-images"><i class="fa fa-check"></i><b>7.1</b> Introducing Digital Elevation Model (DEM) Raster Images</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#what-is-raster-data"><i class="fa fa-check"></i><b>7.1.1</b> What Is Raster Data?</a></li>
<li class="chapter" data-level="7.1.2" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#what-are-digital-elevation-models-dems"><i class="fa fa-check"></i><b>7.1.2</b> What Are Digital Elevation Models (DEMs)?</a></li>
<li class="chapter" data-level="7.1.3" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#the-r-raster-package"><i class="fa fa-check"></i><b>7.1.3</b> The R <code>raster</code> Package</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#downloading-elevation-data"><i class="fa fa-check"></i><b>7.2</b> Downloading Elevation Data</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#loading-in-some-stage-data"><i class="fa fa-check"></i><b>7.2.1</b> Loading in some stage data</a></li>
<li class="chapter" data-level="7.2.2" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#obtaining-relief-elevation-raster-data-using-elevatr"><i class="fa fa-check"></i><b>7.2.2</b> Obtaining relief / elevation raster data using <code>elevatr</code></a></li>
<li class="chapter" data-level="7.2.3" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#plotting-rasters-as-ggplot-objects"><i class="fa fa-check"></i><b>7.2.3</b> Plotting Rasters As <code>ggplot</code> Objects</a></li>
<li class="chapter" data-level="7.2.4" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#interactive-raster-previews-with-plainview"><i class="fa fa-check"></i><b>7.2.4</b> Interactive Raster Previews with <code>plainview</code></a></li>
<li class="chapter" data-level="7.2.5" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#saving-the-image-raster-data-to-a-local-file"><i class="fa fa-check"></i><b>7.2.5</b> Saving the Image Raster Data to a Local File</a></li>
<li class="chapter" data-level="7.2.6" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#from-raster-to-terra"><i class="fa fa-check"></i><b>7.2.6</b> From <code>raster</code> to <code>terra</code></a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#overlaying-raster-images-on-leaflet-maps"><i class="fa fa-check"></i><b>7.3</b> Overlaying Raster Images on Leaflet Maps</a></li>
<li class="chapter" data-level="7.4" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#retrieving-descriptive-information-about-the-raster"><i class="fa fa-check"></i><b>7.4</b> Retrieving Descriptive Information About the Raster</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#using-mapzen-to-retrieve-dem-raster-data"><i class="fa fa-check"></i><b>7.4.1</b> Using Mapzen to Retrieve DEM raster data</a></li>
<li class="chapter" data-level="7.4.2" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#additional-elevation-data-downloading-tools"><i class="fa fa-check"></i><b>7.4.2</b> Additional Elevation Data Downloading Tools</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#manipulating-raster-images"><i class="fa fa-check"></i><b>7.5</b> Manipulating Raster Images</a></li>
<li class="chapter" data-level="7.6" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#ridge-maps"><i class="fa fa-check"></i><b>7.6</b> Ridge maps</a></li>
<li class="chapter" data-level="7.7" data-path="accessing-and-working-with-elevation-data-raster-files.html"><a href="accessing-and-working-with-elevation-data-raster-files.html#further-information"><i class="fa fa-check"></i><b>7.7</b> Further Information</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="determining-terrain-features-from-raster-data.html"><a href="determining-terrain-features-from-raster-data.html"><i class="fa fa-check"></i><b>8</b> Determining Terrain Features from Raster Data</a>
<ul>
<li class="chapter" data-level="8.1" data-path="determining-terrain-features-from-raster-data.html"><a href="determining-terrain-features-from-raster-data.html#load-in-base-data"><i class="fa fa-check"></i><b>8.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="8.2" data-path="determining-terrain-features-from-raster-data.html"><a href="determining-terrain-features-from-raster-data.html#rendering-terrain-over-raster-images"><i class="fa fa-check"></i><b>8.2</b> Rendering Terrain Over Raster Images</a></li>
<li class="chapter" data-level="8.3" data-path="determining-terrain-features-from-raster-data.html"><a href="determining-terrain-features-from-raster-data.html#adding-contours-to-raster-images"><i class="fa fa-check"></i><b>8.3</b> Adding Contours to <code>raster</code> Images</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="using-rayshader-to-render-2d-elevation-and-shade-views.html"><a href="using-rayshader-to-render-2d-elevation-and-shade-views.html"><i class="fa fa-check"></i><b>9</b> Using <code>rayshader</code> to Render 2D Elevation and Shade Views</a>
<ul>
<li class="chapter" data-level="9.1" data-path="using-rayshader-to-render-2d-elevation-and-shade-views.html"><a href="using-rayshader-to-render-2d-elevation-and-shade-views.html#load-in-base-data-1"><i class="fa fa-check"></i><b>9.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="9.2" data-path="using-rayshader-to-render-2d-elevation-and-shade-views.html"><a href="using-rayshader-to-render-2d-elevation-and-shade-views.html#rendering-imagery-from-the-dem-raster"><i class="fa fa-check"></i><b>9.2</b> Rendering imagery from the DEM raster</a></li>
<li class="chapter" data-level="9.3" data-path="using-rayshader-to-render-2d-elevation-and-shade-views.html"><a href="using-rayshader-to-render-2d-elevation-and-shade-views.html#roundtripping-rayshader-rasters-and-matrices"><i class="fa fa-check"></i><b>9.3</b> Roundtripping <code>rayshader</code> Rasters and Matrices</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html"><i class="fa fa-check"></i><b>10</b> Overlaying 2D <code>rayshader</code> Maps</a>
<ul>
<li class="chapter" data-level="10.1" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#load-in-base-data-2"><i class="fa fa-check"></i><b>10.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="10.2" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#adding-overlays"><i class="fa fa-check"></i><b>10.2</b> Adding overlays</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#adding-shadows-to-rayshader-maps"><i class="fa fa-check"></i><b>10.2.1</b> Adding Shadows to <code>rayshader</code> Maps</a></li>
<li class="chapter" data-level="10.2.2" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#adding-water-features"><i class="fa fa-check"></i><b>10.2.2</b> Adding Water Features</a></li>
<li class="chapter" data-level="10.2.3" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#overlaying-map-tiles"><i class="fa fa-check"></i><b>10.2.3</b> Overlaying Map Tiles</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#adding-a-stage-route-layer"><i class="fa fa-check"></i><b>10.3</b> Adding a Stage Route Layer</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#buffering-the-stage-route-view"><i class="fa fa-check"></i><b>10.3.1</b> Buffering the Stage Route View</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="overlaying-2d-rayshader-maps.html"><a href="overlaying-2d-rayshader-maps.html#modeling-increased-water-levels"><i class="fa fa-check"></i><b>10.4</b> Modeling Increased Water Levels</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="annotating-rayshader-maps.html"><a href="annotating-rayshader-maps.html"><i class="fa fa-check"></i><b>11</b> Annotating <code>rayshader</code> maps</a>
<ul>
<li class="chapter" data-level="11.1" data-path="annotating-rayshader-maps.html"><a href="annotating-rayshader-maps.html#load-in-base-data-3"><i class="fa fa-check"></i><b>11.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="11.2" data-path="annotating-rayshader-maps.html"><a href="annotating-rayshader-maps.html#adding-a-title-to-a-map"><i class="fa fa-check"></i><b>11.2</b> Adding a Title to a Map</a></li>
<li class="chapter" data-level="11.3" data-path="annotating-rayshader-maps.html"><a href="annotating-rayshader-maps.html#adding-contours-to-rayshader-stage-maps"><i class="fa fa-check"></i><b>11.3</b> Adding Contours to <code>rayshader</code> Stage Maps</a></li>
<li class="chapter" data-level="11.4" data-path="annotating-rayshader-maps.html"><a href="annotating-rayshader-maps.html#overlaying-image-tiles"><i class="fa fa-check"></i><b>11.4</b> Overlaying Image Tiles</a></li>
<li class="chapter" data-level="11.5" data-path="annotating-rayshader-maps.html"><a href="annotating-rayshader-maps.html#plotting-route-layers-on-rayshader-maps"><i class="fa fa-check"></i><b>11.5</b> Plotting Route Layers on <code>rayshader</code> Maps</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="an-aside-the-penny-red.html"><a href="an-aside-the-penny-red.html"><i class="fa fa-check"></i>An Aside - The Penny Red</a>
<ul>
<li><a href="an-aside-the-penny-red.html#d-rendering-of-colour-images-using-rayshader">3D Rendering of Colour Images Using <code>rayshader</code></a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="an-aside-the-penny-red.html"><a href="an-aside-the-penny-red.html#rendering-the-image-directly-from-ggplot2"><i class="fa fa-check"></i><b>11.5.1</b> Rendering the image directly from <code>ggplot2</code></a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="an-aside-the-penny-red.html"><a href="an-aside-the-penny-red.html#rendering-a-movie"><i class="fa fa-check"></i><b>11.6</b> Rendering a Movie</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html"><i class="fa fa-check"></i><b>12</b> Introducing 3D <code>rayshader</code> Models</a>
<ul>
<li class="chapter" data-level="12.1" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#rendering-the-3d-maps-in-rstudio-and-knitrable-rmd-documents"><i class="fa fa-check"></i><b>12.1</b> Rendering the 3D Maps in <em>RStudio&amp; and <code>knitr</code>able </em>Rmd* Documents</a></li>
<li class="chapter" data-level="12.2" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#rendering-a-3d-view"><i class="fa fa-check"></i><b>12.2</b> Rendering a 3D View</a></li>
<li class="chapter" data-level="12.3" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#the-rayshader-3d-model-plinth"><i class="fa fa-check"></i><b>12.3</b> The <code>rayshader</code> 3D Model Plinth</a></li>
<li class="chapter" data-level="12.4" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#saving-the-widget-as-an-html-file"><i class="fa fa-check"></i><b>12.4</b> Saving the Widget as an HTML File</a></li>
<li class="chapter" data-level="12.5" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#rendering-the-model-to-an-image-file"><i class="fa fa-check"></i><b>12.5</b> Rendering the Model to an Image File</a></li>
<li class="chapter" data-level="12.6" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#rendering-high-quality-models"><i class="fa fa-check"></i><b>12.6</b> Rendering High Quality Models</a></li>
<li class="chapter" data-level="12.7" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#making-a-3d-print-file"><i class="fa fa-check"></i><b>12.7</b> Making a 3D Print File</a></li>
<li class="chapter" data-level="12.8" data-path="introducing-3d-rayshader-models.html"><a href="introducing-3d-rayshader-models.html#saving-a-movie-of-a-3d-model"><i class="fa fa-check"></i><b>12.8</b> Saving a Movie of a 3D Model</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="rendering-3d-rayshader-stage-route-maps.html"><a href="rendering-3d-rayshader-stage-route-maps.html"><i class="fa fa-check"></i><b>13</b> Rendering 3D <code>rayshader</code> Stage Route Maps</a>
<ul>
<li class="chapter" data-level="13.1" data-path="rendering-3d-rayshader-stage-route-maps.html"><a href="rendering-3d-rayshader-stage-route-maps.html#load-in-base-data-4"><i class="fa fa-check"></i><b>13.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="13.2" data-path="rendering-3d-rayshader-stage-route-maps.html"><a href="rendering-3d-rayshader-stage-route-maps.html#setting-up-3d-embedded-plots"><i class="fa fa-check"></i><b>13.2</b> Setting Up 3D Embedded Plots</a></li>
<li class="chapter" data-level="13.3" data-path="rendering-3d-rayshader-stage-route-maps.html"><a href="rendering-3d-rayshader-stage-route-maps.html#rendering-a-simple-stage-route-model"><i class="fa fa-check"></i><b>13.3</b> Rendering a Simple Stage Route Model</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="rendering-3d-rayshader-stage-route-maps.html"><a href="rendering-3d-rayshader-stage-route-maps.html#decorating-3d-views-with-map-tile-overlays"><i class="fa fa-check"></i><b>13.3.1</b> Decorating 3D Views With Map Tile Overlays</a></li>
<li class="chapter" data-level="13.3.2" data-path="rendering-3d-rayshader-stage-route-maps.html"><a href="rendering-3d-rayshader-stage-route-maps.html#adding-labels-to-3d-rayshader-maps"><i class="fa fa-check"></i><b>13.3.2</b> Adding Labels to 3D <code>rayshader</code> Maps</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="creating-cropped-3d-rayshader-models.html"><a href="creating-cropped-3d-rayshader-models.html"><i class="fa fa-check"></i><b>14</b> Creating Cropped 3d <code>rayshader</code> Models</a>
<ul>
<li class="chapter" data-level="14.1" data-path="creating-cropped-3d-rayshader-models.html"><a href="creating-cropped-3d-rayshader-models.html#load-in-base-data-5"><i class="fa fa-check"></i><b>14.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="14.2" data-path="creating-cropped-3d-rayshader-models.html"><a href="creating-cropped-3d-rayshader-models.html#cropping-the-rendered-3d-view"><i class="fa fa-check"></i><b>14.2</b> Cropping the Rendered 3D View</a></li>
<li class="chapter" data-level="14.3" data-path="creating-cropped-3d-rayshader-models.html"><a href="creating-cropped-3d-rayshader-models.html#cropping-3d-models-to-a-buffered-region"><i class="fa fa-check"></i><b>14.3</b> Cropping 3D Models to a Buffered Region</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="obtaining-shadows-for-a-particular-date-and-time.html"><a href="obtaining-shadows-for-a-particular-date-and-time.html"><i class="fa fa-check"></i><b>15</b> Obtaining Shadows for a Particular Date and Time</a>
<ul>
<li class="chapter" data-level="15.1" data-path="obtaining-shadows-for-a-particular-date-and-time.html"><a href="obtaining-shadows-for-a-particular-date-and-time.html#load-in-base-data-6"><i class="fa fa-check"></i><b>15.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="15.2" data-path="obtaining-shadows-for-a-particular-date-and-time.html"><a href="obtaining-shadows-for-a-particular-date-and-time.html#sunlight-times-vocabulary"><i class="fa fa-check"></i><b>15.2</b> Sunlight Times Vocabulary</a></li>
<li class="chapter" data-level="15.3" data-path="obtaining-shadows-for-a-particular-date-and-time.html"><a href="obtaining-shadows-for-a-particular-date-and-time.html#finding-sunrise-and-sunset-times"><i class="fa fa-check"></i><b>15.3</b> Finding Sunrise and Sunset Times</a></li>
<li class="chapter" data-level="15.4" data-path="obtaining-shadows-for-a-particular-date-and-time.html"><a href="obtaining-shadows-for-a-particular-date-and-time.html#animating-shade"><i class="fa fa-check"></i><b>15.4</b> Animating Shade</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html"><i class="fa fa-check"></i><b>16</b> Composing <code>rayshader</code> Stills and Movies</a>
<ul>
<li class="chapter" data-level="16.1" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html#load-in-base-data-7"><i class="fa fa-check"></i><b>16.1</b> Load in Base Data</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html#adding-complications"><i class="fa fa-check"></i><b>16.1.1</b> Adding Complications…</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html#setting-up-the-camera-shots-in-rayshader"><i class="fa fa-check"></i><b>16.2</b> Setting Up the Camera Shots in <code>rayshader</code></a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html#depth-of-field"><i class="fa fa-check"></i><b>16.2.1</b> Depth of Field</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html#camera-positioning"><i class="fa fa-check"></i><b>16.3</b> Camera Positioning</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html#lighting-effects"><i class="fa fa-check"></i><b>16.3.1</b> Lighting Effects</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="composing-rayshader-stills-and-movies.html"><a href="composing-rayshader-stills-and-movies.html#making-3d-video-tracking-shots"><i class="fa fa-check"></i><b>16.4</b> Making 3D Video Tracking Shots</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html"><i class="fa fa-check"></i><b>17</b> Stage Route Analysis</a>
<ul>
<li class="chapter" data-level="17.1" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#load-in-base-data-8"><i class="fa fa-check"></i><b>17.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="17.2" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#generating-stage-route-profiles"><i class="fa fa-check"></i><b>17.2</b> Generating Stage Route Profiles</a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#an-aside---twists-and-turns-of-rally-stages"><i class="fa fa-check"></i><b>17.2.1</b> An Aside - Twists and Turns of Rally Stages</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#finding-stage-route-lengths"><i class="fa fa-check"></i><b>17.3</b> Finding Stage Route Lengths</a></li>
<li class="chapter" data-level="17.4" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#using-ecological-movement-analysis-tools-to-analyse-stage-routes"><i class="fa fa-check"></i><b>17.4</b> Using Ecological Movement Analysis Tools to Analyse Stage Routes</a></li>
<li class="chapter" data-level="17.5" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#using-trajr-for-stage-route-profiling"><i class="fa fa-check"></i><b>17.5</b> Using <code>trajr</code> for Stage Route Profiling</a>
<ul>
<li class="chapter" data-level="17.5.1" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#smoothing-a-trajectory"><i class="fa fa-check"></i><b>17.5.1</b> Smoothing a Trajectory</a></li>
<li class="chapter" data-level="17.5.2" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#resampling-locations"><i class="fa fa-check"></i><b>17.5.2</b> Resampling Locations</a></li>
<li class="chapter" data-level="17.5.3" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#resampling-against-distance"><i class="fa fa-check"></i><b>17.5.3</b> Resampling Against Distance</a></li>
<li class="chapter" data-level="17.5.4" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#splitting-a-trajectory"><i class="fa fa-check"></i><b>17.5.4</b> Splitting a Trajectory</a></li>
<li class="chapter" data-level="17.5.5" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#rotating-the-stage-trajectory"><i class="fa fa-check"></i><b>17.5.5</b> Rotating the Stage Trajectory</a></li>
<li class="chapter" data-level="17.5.6" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#straightness-and-sinuosity"><i class="fa fa-check"></i><b>17.5.6</b> Straightness and Sinuosity</a></li>
<li class="chapter" data-level="17.5.7" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#directional-change"><i class="fa fa-check"></i><b>17.5.7</b> Directional Change</a></li>
<li class="chapter" data-level="17.5.8" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#tracking-turning-angles"><i class="fa fa-check"></i><b>17.5.8</b> Tracking Turning Angles</a></li>
<li class="chapter" data-level="17.5.9" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#visualising-trajectory-direction-changes"><i class="fa fa-check"></i><b>17.5.9</b> Visualising Trajectory Direction Changes</a></li>
<li class="chapter" data-level="17.5.10" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#using-amt-for-stage-route-profiling"><i class="fa fa-check"></i><b>17.5.10</b> Using <code>amt</code> for Stage Route Profiling</a></li>
<li class="chapter" data-level="17.5.11" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#creating-tracks"><i class="fa fa-check"></i><b>17.5.11</b> Creating Tracks</a></li>
<li class="chapter" data-level="17.5.12" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#converting-to-other-track-formats"><i class="fa fa-check"></i><b>17.5.12</b> Converting to Other Track Formats</a></li>
<li class="chapter" data-level="17.5.13" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#using-amt-for-stage-route-analysis"><i class="fa fa-check"></i><b>17.5.13</b> Using <code>amt</code> for Stage Route Analysis</a></li>
<li class="chapter" data-level="17.5.14" data-path="stage-route-analysis.html"><a href="stage-route-analysis.html#using-rlft-for-profiling-along-a-stage-route"><i class="fa fa-check"></i><b>17.5.14</b> Using `rLFT`` for Profiling Along a Stage Route</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="revisiting-elevation-data.html"><a href="revisiting-elevation-data.html"><i class="fa fa-check"></i><b>18</b> Revisiting Elevation Data</a>
<ul>
<li class="chapter" data-level="18.1" data-path="revisiting-elevation-data.html"><a href="revisiting-elevation-data.html#load-in-base-data-9"><i class="fa fa-check"></i><b>18.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="18.2" data-path="revisiting-elevation-data.html"><a href="revisiting-elevation-data.html#generating-elevation-maps"><i class="fa fa-check"></i><b>18.2</b> Generating Elevation Maps</a>
<ul>
<li class="chapter" data-level="18.2.1" data-path="revisiting-elevation-data.html"><a href="revisiting-elevation-data.html#accessing-elevation-values-along-a-route-from-an-elevation-raster"><i class="fa fa-check"></i><b>18.2.1</b> Accessing Elevation Values Along a Route from an Elevation Raster</a></li>
<li class="chapter" data-level="18.2.2" data-path="revisiting-elevation-data.html"><a href="revisiting-elevation-data.html#using-geospheredistgeo-to-find-distance-along-a-route"><i class="fa fa-check"></i><b>18.2.2</b> Using <code>geosphere::distGeo</code> to Find Distance Along a Route</a></li>
<li class="chapter" data-level="18.2.3" data-path="revisiting-elevation-data.html"><a href="revisiting-elevation-data.html#using-spspdists-to-find-distance-along-a-route"><i class="fa fa-check"></i><b>18.2.3</b> Using <code>sp::spDists</code> to Find Distance Along a Route</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="revisiting-elevation-data.html"><a href="revisiting-elevation-data.html#generating-a-3d-ribbon-plot-of-the-stage-route"><i class="fa fa-check"></i><b>18.3</b> Generating a 3D Ribbon Plot of the Stage Route</a></li>
<li class="chapter" data-level="18.4" data-path="revisiting-elevation-data.html"><a href="revisiting-elevation-data.html#identifying-road-type"><i class="fa fa-check"></i><b>18.4</b> Identifying Road Type</a></li>
<li class="chapter" data-level="18.5" data-path="revisiting-elevation-data.html"><a href="revisiting-elevation-data.html#displaying-route-twistiness-and-elevation"><i class="fa fa-check"></i><b>18.5</b> Displaying Route Twistiness and Elevation</a>
<ul>
<li class="chapter" data-level="18.5.1" data-path="revisiting-elevation-data.html"><a href="revisiting-elevation-data.html#rendering-a-3d-movie-of-the-model"><i class="fa fa-check"></i><b>18.5.1</b> Rendering a 3D movie of the Model</a></li>
</ul></li>
<li class="chapter" data-level="18.6" data-path="revisiting-elevation-data.html"><a href="revisiting-elevation-data.html#using-the-slopes-package-to-analyse-stage-elevation-data"><i class="fa fa-check"></i><b>18.6</b> Using the <code>slopes</code> Package to Analyse Stage Elevation Data</a></li>
<li class="chapter" data-level="18.7" data-path="revisiting-elevation-data.html"><a href="revisiting-elevation-data.html#analysing-route-elevation-from-first-principles"><i class="fa fa-check"></i><b>18.7</b> Analysing Route Elevation from First Principles</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html"><i class="fa fa-check"></i><b>19</b> Adding <em>OpenStreetMap</em> Data</a>
<ul>
<li class="chapter" data-level="19.1" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#load-in-base-data-10"><i class="fa fa-check"></i><b>19.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="19.2" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#adding-detail-and-features-from-openstreetmap"><i class="fa fa-check"></i><b>19.2</b> Adding Detail and Features from OpenStreetMap</a>
<ul>
<li class="chapter" data-level="19.2.1" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#plotting-osm-highways"><i class="fa fa-check"></i><b>19.2.1</b> Plotting OSM Highways</a></li>
</ul></li>
<li class="chapter" data-level="19.3" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#viewing-roads-in-the-vicinity-of-a-route"><i class="fa fa-check"></i><b>19.3</b> Viewing Roads in the Vicinity of a Route</a>
<ul>
<li class="chapter" data-level="19.3.1" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#using-sfst_buffer-to-create-buffered-areas"><i class="fa fa-check"></i><b>19.3.1</b> Using <code>sf::st_buffer</code> to Create Buffered Areas</a></li>
<li class="chapter" data-level="19.3.2" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#using-rgeosgbuffer-to-create-buffered-areas"><i class="fa fa-check"></i><b>19.3.2</b> Using <code>rgeos::gBuffer</code> to Create Buffered Areas</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#adding-additional-data-from-osm"><i class="fa fa-check"></i><b>19.4</b> Adding Additional Data From OSM</a>
<ul>
<li class="chapter" data-level="19.4.1" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#adding-building-layers-from-openstreetmap"><i class="fa fa-check"></i><b>19.4.1</b> Adding Building Layers from <em>OpenStreetMap</em></a></li>
<li class="chapter" data-level="19.4.2" data-path="adding-openstreetmap-data.html"><a href="adding-openstreetmap-data.html#the-wide-variety-of-osm-features"><i class="fa fa-check"></i><b>19.4.2</b> The Wide Variety of OSM Features</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="20" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html"><i class="fa fa-check"></i><b>20</b> Creating A Road Book</a>
<ul>
<li class="chapter" data-level="20.1" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#load-in-base-data-11"><i class="fa fa-check"></i><b>20.1</b> Load in Base Data</a></li>
<li class="chapter" data-level="20.2" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#using-sfnetworks-to-represent-routes-and-road-networks"><i class="fa fa-check"></i><b>20.2</b> Using <code>sfnetworks</code> to Represent Routes and Road Networks</a></li>
<li class="chapter" data-level="20.3" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#analysing-road-networks-with-sfnetworks"><i class="fa fa-check"></i><b>20.3</b> Analysing Road Networks with <code>sfnetworks</code></a>
<ul>
<li class="chapter" data-level="20.3.1" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#creating-an-sfnetworks-graph"><i class="fa fa-check"></i><b>20.3.1</b> Creating an <code>sfnetworks</code> Graph</a></li>
<li class="chapter" data-level="20.3.2" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#filtering-an-sfnetworks-graph"><i class="fa fa-check"></i><b>20.3.2</b> Filtering an <code>sfnetworks</code> Graph</a></li>
<li class="chapter" data-level="20.3.3" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#viewing-a-buffered-area-around-a-junction-node"><i class="fa fa-check"></i><b>20.3.3</b> Viewing a Buffered Area Around a Junction Node</a></li>
<li class="chapter" data-level="20.3.4" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#snapping-a-route-to-a-road-network"><i class="fa fa-check"></i><b>20.3.4</b> Snapping a Route to a Road Network</a></li>
<li class="chapter" data-level="20.3.5" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#snapping-a-full-stage-route-to-the-road-network"><i class="fa fa-check"></i><b>20.3.5</b> Snapping a Full Stage Route to the Road Network</a></li>
</ul></li>
<li class="chapter" data-level="20.4" data-path="creating-a-road-book.html"><a href="creating-a-road-book.html#using-dodgr-to-represent-routes-and-road-networks"><i class="fa fa-check"></i><b>20.4</b> Using <code>dodgr</code> to Represent Routes and Road Networks</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="where-next.html"><a href="where-next.html"><i class="fa fa-check"></i><b>21</b> Where Next?</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Visualising WRC Rally Stages With <code>rayshader</code> and R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="overlaying-2d-rayshader-maps" class="section level1" number="10">
<h1><span class="header-section-number">10</span> Overlaying 2D <code>rayshader</code> Maps</h1>
<p>In this chapter, we will explore in more detail how we can add overlays to <code>rayshader</code> two-dimensional maps such as water feature overlays, map tiles or stage routes.</p>
<div id="load-in-base-data-2" class="section level2" number="10.1">
<h2><span class="header-section-number">10.1</span> Load in Base Data</h2>
<p>As ever, let’s load in our stage data:</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="overlaying-2d-rayshader-maps.html#cb247-1" aria-hidden="true" tabindex="-1"></a>geojson_filename <span class="ot">=</span> <span class="st">&#39;montecarlo_2021.geojson&#39;</span></span>
<span id="cb247-2"><a href="overlaying-2d-rayshader-maps.html#cb247-2" aria-hidden="true" tabindex="-1"></a>geojson_sf <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_read</span>(geojson_filename)</span></code></pre></div>
<pre><code>## Reading layer `montecarlo_2021&#39; from data source `/Users/tonyhirst/Documents/GitHub/visualising-rally-stages/montecarlo_2021.geojson&#39; using driver `GeoJSON&#39;
## Simple feature collection with 9 features and 2 fields
## geometry type:  LINESTRING
## dimension:      XY
## bbox:           xmin: 5.243488 ymin: 43.87633 xmax: 6.951953 ymax: 44.81973
## geographic CRS: WGS 84</code></pre>
<p>And also load in the elevation data raster:</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="overlaying-2d-rayshader-maps.html#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb249-2"><a href="overlaying-2d-rayshader-maps.html#cb249-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rayshader)</span>
<span id="cb249-3"><a href="overlaying-2d-rayshader-maps.html#cb249-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-4"><a href="overlaying-2d-rayshader-maps.html#cb249-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Previously downloaded TIF digital elevation model (DEM) file</span></span>
<span id="cb249-5"><a href="overlaying-2d-rayshader-maps.html#cb249-5" aria-hidden="true" tabindex="-1"></a>stage_tif <span class="ot">=</span> <span class="st">&quot;stage_elevation.tif&quot;</span></span>
<span id="cb249-6"><a href="overlaying-2d-rayshader-maps.html#cb249-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-7"><a href="overlaying-2d-rayshader-maps.html#cb249-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Load in the previously saved image raster</span></span>
<span id="cb249-8"><a href="overlaying-2d-rayshader-maps.html#cb249-8" aria-hidden="true" tabindex="-1"></a>elev_img <span class="ot">=</span> <span class="fu">raster</span>(stage_tif)</span>
<span id="cb249-9"><a href="overlaying-2d-rayshader-maps.html#cb249-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-10"><a href="overlaying-2d-rayshader-maps.html#cb249-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Note we can pass in a file name or a raster object</span></span>
<span id="cb249-11"><a href="overlaying-2d-rayshader-maps.html#cb249-11" aria-hidden="true" tabindex="-1"></a>elmat <span class="ot">=</span> <span class="fu">raster_to_matrix</span>(stage_tif)</span></code></pre></div>
</div>
<div id="adding-overlays" class="section level2" number="10.2">
<h2><span class="header-section-number">10.2</span> Adding overlays</h2>
<p>The <code>rayshader</code> package includes various tools for styling the rendering of the 2d image.</p>
<div id="adding-shadows-to-rayshader-maps" class="section level3" number="10.2.1">
<h3><span class="header-section-number">10.2.1</span> Adding Shadows to <code>rayshader</code> Maps</h3>
<p>It can often be convenient to construct shadow layers for a particular <code>rayshader</code> map that we can add to the rendering as required:</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="overlaying-2d-rayshader-maps.html#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add shade</span></span>
<span id="cb250-2"><a href="overlaying-2d-rayshader-maps.html#cb250-2" aria-hidden="true" tabindex="-1"></a>raymat <span class="ot">&lt;-</span> <span class="fu">ray_shade</span>(elmat, <span class="at">zscale =</span> auto_zscale, <span class="at">lambert =</span> <span class="cn">TRUE</span>)</span>
<span id="cb250-3"><a href="overlaying-2d-rayshader-maps.html#cb250-3" aria-hidden="true" tabindex="-1"></a><span class="co"># And &quot;ambient occlusion shadow&quot;</span></span>
<span id="cb250-4"><a href="overlaying-2d-rayshader-maps.html#cb250-4" aria-hidden="true" tabindex="-1"></a>ambmat <span class="ot">&lt;-</span> <span class="fu">ambient_shade</span>(elmat, <span class="at">zscale =</span> auto_zscale)</span></code></pre></div>
<p>The shading functions accept <code>sunaltitude</code> and <code>sunangle</code> paramters to specify the sun / light source position. The <code>suncalc</code> <em>R</em> package can be used to determine sun altitude and and angle settings for a particular date and time at a specified location.</p>
<p>We can also create a composite shadow layer constructed from several shadow operators piped together:</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="overlaying-2d-rayshader-maps.html#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="co"># More shadow style from:</span></span>
<span id="cb251-2"><a href="overlaying-2d-rayshader-maps.html#cb251-2" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.tylermw.com/adding-open-street-map-data-to-rayshader-maps-in-r/</span></span>
<span id="cb251-3"><a href="overlaying-2d-rayshader-maps.html#cb251-3" aria-hidden="true" tabindex="-1"></a>                      </span>
<span id="cb251-4"><a href="overlaying-2d-rayshader-maps.html#cb251-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We can build up layers that can be generated once then added</span></span>
<span id="cb251-5"><a href="overlaying-2d-rayshader-maps.html#cb251-5" aria-hidden="true" tabindex="-1"></a><span class="co"># as overlays to construct views from basic parts</span></span>
<span id="cb251-6"><a href="overlaying-2d-rayshader-maps.html#cb251-6" aria-hidden="true" tabindex="-1"></a>shadow_layer <span class="ot">=</span> <span class="fu">height_shade</span>(elmat) <span class="sc">%&gt;%</span> </span>
<span id="cb251-7"><a href="overlaying-2d-rayshader-maps.html#cb251-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_overlay</span>(<span class="fu">sphere_shade</span>(elmat, <span class="at">texture =</span> <span class="st">&quot;desert&quot;</span>, </span>
<span id="cb251-8"><a href="overlaying-2d-rayshader-maps.html#cb251-8" aria-hidden="true" tabindex="-1"></a>                           <span class="at">zscale=</span>auto_zscale, <span class="at">colorintensity =</span> <span class="dv">5</span>), <span class="at">alphalayer=</span><span class="fl">0.5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb251-9"><a href="overlaying-2d-rayshader-maps.html#cb251-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_shadow</span>(<span class="fu">lamb_shade</span>(elmat, <span class="at">zscale =</span> auto_zscale),<span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb251-10"><a href="overlaying-2d-rayshader-maps.html#cb251-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_shadow</span>(<span class="fu">texture_shade</span>(elmat,<span class="at">detail=</span><span class="dv">8</span><span class="sc">/</span><span class="dv">10</span>,<span class="at">contrast=</span><span class="dv">9</span>,<span class="at">brightness =</span> <span class="dv">11</span>), <span class="fl">0.1</span>)</span></code></pre></div>
<p>The layers can be added to the <code>rayshader</code> map in the normal way:</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="overlaying-2d-rayshader-maps.html#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add water</span></span>
<span id="cb252-2"><a href="overlaying-2d-rayshader-maps.html#cb252-2" aria-hidden="true" tabindex="-1"></a>watermap <span class="ot">&lt;-</span> <span class="fu">detect_water</span>(elmat, <span class="at">zscale =</span> <span class="dv">8</span>)</span>
<span id="cb252-3"><a href="overlaying-2d-rayshader-maps.html#cb252-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-4"><a href="overlaying-2d-rayshader-maps.html#cb252-4" aria-hidden="true" tabindex="-1"></a>demo_map <span class="ot">=</span> elmat <span class="sc">%&gt;%</span></span>
<span id="cb252-5"><a href="overlaying-2d-rayshader-maps.html#cb252-5" aria-hidden="true" tabindex="-1"></a>              <span class="fu">add_overlay</span>(shadow_layer)  <span class="sc">%&gt;%</span> </span>
<span id="cb252-6"><a href="overlaying-2d-rayshader-maps.html#cb252-6" aria-hidden="true" tabindex="-1"></a>              <span class="fu">add_water</span>(watermap, <span class="at">color =</span> <span class="st">&quot;desert&quot;</span>)</span>
<span id="cb252-7"><a href="overlaying-2d-rayshader-maps.html#cb252-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-8"><a href="overlaying-2d-rayshader-maps.html#cb252-8" aria-hidden="true" tabindex="-1"></a>demo_map <span class="sc">%&gt;%</span></span>
<span id="cb252-9"><a href="overlaying-2d-rayshader-maps.html#cb252-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_map</span>()</span></code></pre></div>
<p><img src="images/rayshader-2d-overlays-shadows-preview-1.png" width="672" /></p>
<div id="retrieving-shadow-data-along-a-route" class="section level4" number="10.2.1.1">
<h4><span class="header-section-number">10.2.1.1</span> Retrieving Shadow Data Along a Route</h4>
<p>If we can access just the shadow layer data, one interesting possibility is that we could produced a “shadow depth” profile of a route identifying which bit are in shadow at a particular time and date.</p>
</div>
</div>
<div id="adding-water-features" class="section level3" number="10.2.2">
<h3><span class="header-section-number">10.2.2</span> Adding Water Features</h3>
<p>We can detect water (and even modify the height of the water to model raising water levels) to create a layer that we can later add to the rendered map.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="overlaying-2d-rayshader-maps.html#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add water</span></span>
<span id="cb253-2"><a href="overlaying-2d-rayshader-maps.html#cb253-2" aria-hidden="true" tabindex="-1"></a>watermap <span class="ot">&lt;-</span> <span class="fu">detect_water</span>(elmat, <span class="at">zscale =</span> <span class="dv">8</span>)</span></code></pre></div>
<p>Let’s add that layer to the 2d map:</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="overlaying-2d-rayshader-maps.html#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Texture palettes:</span></span>
<span id="cb254-2"><a href="overlaying-2d-rayshader-maps.html#cb254-2" aria-hidden="true" tabindex="-1"></a><span class="co"># `imhof1`,`imhof2`,`imhof3`,`imhof4`,`bw`,`desert`, and `unicorn`</span></span>
<span id="cb254-3"><a href="overlaying-2d-rayshader-maps.html#cb254-3" aria-hidden="true" tabindex="-1"></a>elmat <span class="sc">%&gt;%</span></span>
<span id="cb254-4"><a href="overlaying-2d-rayshader-maps.html#cb254-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#sphere_shade(texture = &quot;imhof1&quot;) %&gt;%</span></span>
<span id="cb254-5"><a href="overlaying-2d-rayshader-maps.html#cb254-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Optionally set sun angle</span></span>
<span id="cb254-6"><a href="overlaying-2d-rayshader-maps.html#cb254-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sphere_shade</span>(<span class="at">sunangle =</span> <span class="sc">-</span><span class="dv">45</span>, <span class="at">texture =</span> <span class="st">&quot;imhof1&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb254-7"><a href="overlaying-2d-rayshader-maps.html#cb254-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_water</span>(watermap, <span class="at">color =</span> <span class="st">&quot;bw&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb254-8"><a href="overlaying-2d-rayshader-maps.html#cb254-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_map</span>()</span></code></pre></div>
<p><img src="images/rayshader-2d-overlays-water-map-1.png" width="672" /></p>
</div>
<div id="overlaying-map-tiles" class="section level3" number="10.2.3">
<h3><span class="header-section-number">10.2.3</span> Overlaying Map Tiles</h3>
<p>We can also add tiles as an overlay.</p>
<p>For example, the <code>geoviz</code> package provides a way for us to retrieve popular map tilesets and then overlay them onto the <code>rayshader</code> map.</p>
<p>Let’s grab some tiles covering the extent of our original raster image and create overlays from them:</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="overlaying-2d-rayshader-maps.html#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="co"># via https://github.com/neilcharles/geoviz</span></span>
<span id="cb255-2"><a href="overlaying-2d-rayshader-maps.html#cb255-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geoviz)</span>
<span id="cb255-3"><a href="overlaying-2d-rayshader-maps.html#cb255-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-4"><a href="overlaying-2d-rayshader-maps.html#cb255-4" aria-hidden="true" tabindex="-1"></a><span class="co"># stamen: toner, watercolor, terrain</span></span>
<span id="cb255-5"><a href="overlaying-2d-rayshader-maps.html#cb255-5" aria-hidden="true" tabindex="-1"></a>overlay_image_watercolor <span class="ot">&lt;-</span></span>
<span id="cb255-6"><a href="overlaying-2d-rayshader-maps.html#cb255-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slippy_overlay</span>(elev_img, </span>
<span id="cb255-7"><a href="overlaying-2d-rayshader-maps.html#cb255-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">image_source =</span> <span class="st">&quot;stamen&quot;</span>,</span>
<span id="cb255-8"><a href="overlaying-2d-rayshader-maps.html#cb255-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">image_type =</span> <span class="st">&quot;watercolor&quot;</span>,</span>
<span id="cb255-9"><a href="overlaying-2d-rayshader-maps.html#cb255-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">png_opacity =</span> <span class="fl">0.5</span>)</span>
<span id="cb255-10"><a href="overlaying-2d-rayshader-maps.html#cb255-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-11"><a href="overlaying-2d-rayshader-maps.html#cb255-11" aria-hidden="true" tabindex="-1"></a>overlay_image_tonerlite <span class="ot">&lt;-</span></span>
<span id="cb255-12"><a href="overlaying-2d-rayshader-maps.html#cb255-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slippy_overlay</span>(elev_img, </span>
<span id="cb255-13"><a href="overlaying-2d-rayshader-maps.html#cb255-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">image_source =</span> <span class="st">&quot;stamen&quot;</span>,</span>
<span id="cb255-14"><a href="overlaying-2d-rayshader-maps.html#cb255-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">image_type =</span> <span class="st">&quot;toner&quot;</span>,</span>
<span id="cb255-15"><a href="overlaying-2d-rayshader-maps.html#cb255-15" aria-hidden="true" tabindex="-1"></a>                 <span class="at">png_opacity =</span> <span class="fl">0.5</span>)</span>
<span id="cb255-16"><a href="overlaying-2d-rayshader-maps.html#cb255-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-17"><a href="overlaying-2d-rayshader-maps.html#cb255-17" aria-hidden="true" tabindex="-1"></a>overlay_image_terrain <span class="ot">&lt;-</span></span>
<span id="cb255-18"><a href="overlaying-2d-rayshader-maps.html#cb255-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slippy_overlay</span>(elev_img, </span>
<span id="cb255-19"><a href="overlaying-2d-rayshader-maps.html#cb255-19" aria-hidden="true" tabindex="-1"></a>                 <span class="at">image_source =</span> <span class="st">&quot;stamen&quot;</span>,</span>
<span id="cb255-20"><a href="overlaying-2d-rayshader-maps.html#cb255-20" aria-hidden="true" tabindex="-1"></a>                 <span class="at">image_type =</span> <span class="st">&quot;terrain&quot;</span>,</span>
<span id="cb255-21"><a href="overlaying-2d-rayshader-maps.html#cb255-21" aria-hidden="true" tabindex="-1"></a>                 <span class="at">png_opacity =</span> <span class="fl">0.9</span>)</span></code></pre></div>
<p>We can now overlay a tileset onto the rendered map.</p>
<p>In the following example, notice how I have further separated out the map creation phase from the map plotting phase:</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="overlaying-2d-rayshader-maps.html#cb256-1" aria-hidden="true" tabindex="-1"></a>scene <span class="ot">&lt;-</span> elmat <span class="sc">%&gt;%</span></span>
<span id="cb256-2"><a href="overlaying-2d-rayshader-maps.html#cb256-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sphere_shade</span>(<span class="at">sunangle =</span> <span class="dv">270</span>, <span class="at">texture =</span> <span class="st">&quot;desert&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb256-3"><a href="overlaying-2d-rayshader-maps.html#cb256-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_overlay</span>(overlay_image_watercolor)</span>
<span id="cb256-4"><a href="overlaying-2d-rayshader-maps.html#cb256-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-5"><a href="overlaying-2d-rayshader-maps.html#cb256-5" aria-hidden="true" tabindex="-1"></a>scene  <span class="sc">%&gt;%</span></span>
<span id="cb256-6"><a href="overlaying-2d-rayshader-maps.html#cb256-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_map</span>()</span></code></pre></div>
<p><img src="images/rayshader-2d-overlays-overlay-map-1.png" width="672" /></p>
<div id="setting-elevation-sensitive-tile-transparancy" class="section level4" number="10.2.3.1">
<h4><span class="header-section-number">10.2.3.1</span> Setting Elevation Sensitive Tile Transparancy</h4>
<p>We can also specify different elevations at which we want to apply an overlay as a transparency.</p>
<p>For example, we can turn mountainous parts of the overlay transparent, showing the tiles overlaid on the lower altitude areas but not on the higher regions, which in this case are rendered with a black and white texture:</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="overlaying-2d-rayshader-maps.html#cb257-1" aria-hidden="true" tabindex="-1"></a>overlay_image_tonerlite_low_alt <span class="ot">&lt;-</span></span>
<span id="cb257-2"><a href="overlaying-2d-rayshader-maps.html#cb257-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">elevation_transparency</span>(overlay_image_terrain,</span>
<span id="cb257-3"><a href="overlaying-2d-rayshader-maps.html#cb257-3" aria-hidden="true" tabindex="-1"></a>                        elev_img,</span>
<span id="cb257-4"><a href="overlaying-2d-rayshader-maps.html#cb257-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">pct_alt_high =</span> <span class="fl">0.5</span>,</span>
<span id="cb257-5"><a href="overlaying-2d-rayshader-maps.html#cb257-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">alpha_max =</span> <span class="fl">0.9</span>)</span>
<span id="cb257-6"><a href="overlaying-2d-rayshader-maps.html#cb257-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-7"><a href="overlaying-2d-rayshader-maps.html#cb257-7" aria-hidden="true" tabindex="-1"></a>scene <span class="ot">&lt;-</span> elmat <span class="sc">%&gt;%</span></span>
<span id="cb257-8"><a href="overlaying-2d-rayshader-maps.html#cb257-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sphere_shade</span>(<span class="at">sunangle =</span> <span class="dv">270</span>, <span class="at">texture =</span> <span class="st">&quot;bw&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb257-9"><a href="overlaying-2d-rayshader-maps.html#cb257-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_overlay</span>(overlay_image_tonerlite_low_alt) <span class="sc">%&gt;%</span></span>
<span id="cb257-10"><a href="overlaying-2d-rayshader-maps.html#cb257-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_map</span>()</span></code></pre></div>
<p><img src="images/rayshader-2d-overlays-overlay-toner-1.png" width="672" /></p>
</div>
</div>
</div>
<div id="adding-a-stage-route-layer" class="section level2" number="10.3">
<h2><span class="header-section-number">10.3</span> Adding a Stage Route Layer</h2>
<p>When adding overlays, we ofter need to specify the extent of the area covered by the overlay.</p>
<p>For our stage route, we can take the extent directly from the geojson loaded data:</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="overlaying-2d-rayshader-maps.html#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb258-2"><a href="overlaying-2d-rayshader-maps.html#cb258-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-3"><a href="overlaying-2d-rayshader-maps.html#cb258-3" aria-hidden="true" tabindex="-1"></a><span class="fu">extent</span>(<span class="fu">st_bbox</span>(geojson_sf[<span class="dv">1</span>,]))</span></code></pre></div>
<pre><code>## class      : Extent 
## xmin       : 5.883753 
## xmax       : 5.940715 
## ymin       : 44.73562 
## ymax       : 44.81973</code></pre>
<p>We can then create a route layer as a line overlay:</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="overlaying-2d-rayshader-maps.html#cb260-1" aria-hidden="true" tabindex="-1"></a>yellow_route <span class="ot">=</span> <span class="fu">generate_line_overlay</span>(geojson_sf[<span class="dv">1</span>,],</span>
<span id="cb260-2"><a href="overlaying-2d-rayshader-maps.html#cb260-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">extent =</span> <span class="fu">extent</span>(geojson_sf[<span class="dv">1</span>,]),</span>
<span id="cb260-3"><a href="overlaying-2d-rayshader-maps.html#cb260-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">heightmap =</span> elmat,</span>
<span id="cb260-4"><a href="overlaying-2d-rayshader-maps.html#cb260-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">linewidth =</span> <span class="dv">5</span>, <span class="at">color=</span><span class="st">&quot;yellow&quot;</span>)</span></code></pre></div>
<p>We can add the line overlay to our map to show the path followed by the stage route:</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="overlaying-2d-rayshader-maps.html#cb261-1" aria-hidden="true" tabindex="-1"></a>mapped_route_yellow <span class="ot">=</span> elmat <span class="sc">%&gt;%</span></span>
<span id="cb261-2"><a href="overlaying-2d-rayshader-maps.html#cb261-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sphere_shade</span>(<span class="at">sunangle =</span> <span class="sc">-</span><span class="dv">45</span>, <span class="at">texture =</span> <span class="st">&quot;bw&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb261-3"><a href="overlaying-2d-rayshader-maps.html#cb261-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#add_water(watermap, color = &quot;bw&quot;) %&gt;%</span></span>
<span id="cb261-4"><a href="overlaying-2d-rayshader-maps.html#cb261-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_overlay</span>(yellow_route) </span>
<span id="cb261-5"><a href="overlaying-2d-rayshader-maps.html#cb261-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-6"><a href="overlaying-2d-rayshader-maps.html#cb261-6" aria-hidden="true" tabindex="-1"></a>mapped_route_yellow <span class="sc">%&gt;%</span></span>
<span id="cb261-7"><a href="overlaying-2d-rayshader-maps.html#cb261-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_map</span>()</span></code></pre></div>
<p><img src="images/rayshader-2d-overlays-overlay-yellow-1.png" width="672" /></p>
<p><em>The <code>geoviz::add_gps_to_rayshader()</code> can also add a route to a <code>rayshader</code> model from longitude, latitude and elevation vectors.</em></p>
<div id="buffering-the-stage-route-view" class="section level3" number="10.3.1">
<h3><span class="header-section-number">10.3.1</span> Buffering the Stage Route View</h3>
<p>One problem with that view is that the route extent borders on the edge of the rendered image. It would be easier to see the route if the extent of the image was increased to provide a bordered area around the route.</p>
<p>We can create a “buffered boundary box” around the stage extent as follows:</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="overlaying-2d-rayshader-maps.html#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spatialEco)</span>
<span id="cb262-2"><a href="overlaying-2d-rayshader-maps.html#cb262-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-3"><a href="overlaying-2d-rayshader-maps.html#cb262-3" aria-hidden="true" tabindex="-1"></a>bb_sp <span class="ot">=</span> <span class="fu">SpatialPoints</span>(<span class="fu">extent</span>(geojson_sf[<span class="dv">1</span>,]))</span>
<span id="cb262-4"><a href="overlaying-2d-rayshader-maps.html#cb262-4" aria-hidden="true" tabindex="-1"></a><span class="fu">proj4string</span>(bb_sp) <span class="ot">&lt;-</span> <span class="fu">st_crs</span>(geojson_sf[<span class="dv">1</span>,])<span class="sc">$</span>proj4string</span>
<span id="cb262-5"><a href="overlaying-2d-rayshader-maps.html#cb262-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-6"><a href="overlaying-2d-rayshader-maps.html#cb262-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new, buffered region</span></span>
<span id="cb262-7"><a href="overlaying-2d-rayshader-maps.html#cb262-7" aria-hidden="true" tabindex="-1"></a>stage_bbox_buffered <span class="ot">=</span> <span class="fu">st_bbox</span>(<span class="fu">geo.buffer</span>(<span class="at">x=</span>bb_sp, <span class="at">r=</span><span class="dv">500</span>))</span>
<span id="cb262-8"><a href="overlaying-2d-rayshader-maps.html#cb262-8" aria-hidden="true" tabindex="-1"></a>stage_bbox_buffered</span></code></pre></div>
<pre><code>##      xmin      ymin      xmax      ymax 
##  5.877431 44.731117  5.947037 44.824231</code></pre>
<p>We can then use those extended bounds to retrieve a buffered elevation raster image:</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="overlaying-2d-rayshader-maps.html#cb264-1" aria-hidden="true" tabindex="-1"></a>ex.df2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x=</span> <span class="fu">c</span>(stage_bbox_buffered[[<span class="st">&#39;xmin&#39;</span>]],</span>
<span id="cb264-2"><a href="overlaying-2d-rayshader-maps.html#cb264-2" aria-hidden="true" tabindex="-1"></a>                          stage_bbox_buffered[[<span class="st">&#39;xmax&#39;</span>]]), </span>
<span id="cb264-3"><a href="overlaying-2d-rayshader-maps.html#cb264-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">y=</span> <span class="fu">c</span>(stage_bbox_buffered[[<span class="st">&#39;ymin&#39;</span>]],</span>
<span id="cb264-4"><a href="overlaying-2d-rayshader-maps.html#cb264-4" aria-hidden="true" tabindex="-1"></a>                         stage_bbox_buffered[[<span class="st">&#39;ymax&#39;</span>]]))</span>
<span id="cb264-5"><a href="overlaying-2d-rayshader-maps.html#cb264-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-6"><a href="overlaying-2d-rayshader-maps.html#cb264-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(elevatr)</span>
<span id="cb264-7"><a href="overlaying-2d-rayshader-maps.html#cb264-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-8"><a href="overlaying-2d-rayshader-maps.html#cb264-8" aria-hidden="true" tabindex="-1"></a><span class="co"># The zoom level, z, impacts on how long it takes to download the imagery</span></span>
<span id="cb264-9"><a href="overlaying-2d-rayshader-maps.html#cb264-9" aria-hidden="true" tabindex="-1"></a><span class="co"># z ranges from 1 to 14</span></span>
<span id="cb264-10"><a href="overlaying-2d-rayshader-maps.html#cb264-10" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.rdocumentation.org/packages/elevatr/versions/0.3.4/topics/get_elev_raster</span></span>
<span id="cb264-11"><a href="overlaying-2d-rayshader-maps.html#cb264-11" aria-hidden="true" tabindex="-1"></a>prj_dd <span class="ot">&lt;-</span> <span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs&quot;</span></span>
<span id="cb264-12"><a href="overlaying-2d-rayshader-maps.html#cb264-12" aria-hidden="true" tabindex="-1"></a>elev_img2 <span class="ot">&lt;-</span> <span class="fu">get_elev_raster</span>(ex.df2, <span class="at">prj =</span> prj_dd, <span class="at">z =</span> <span class="dv">12</span>, <span class="at">clip =</span> <span class="st">&quot;bbox&quot;</span>)</span></code></pre></div>
<pre><code>## Mosaicing &amp; Projecting</code></pre>
<pre><code>## Clipping DEM to bbox</code></pre>
<pre><code>## Note: Elevation units are in meters.
## Note: The coordinate reference system is:
##  GEOGCRS[&quot;unknown&quot;,
##     DATUM[&quot;World Geodetic System 1984&quot;,
##         ELLIPSOID[&quot;WGS 84&quot;,6378137,298.257223563,
##             LENGTHUNIT[&quot;metre&quot;,1]],
##         ID[&quot;EPSG&quot;,6326]],
##     PRIMEM[&quot;Greenwich&quot;,0,
##         ANGLEUNIT[&quot;degree&quot;,0.0174532925199433],
##         ID[&quot;EPSG&quot;,8901]],
##     CS[ellipsoidal,2],
##         AXIS[&quot;longitude&quot;,east,
##             ORDER[1],
##             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433,
##                 ID[&quot;EPSG&quot;,9122]]],
##         AXIS[&quot;latitude&quot;,north,
##             ORDER[2],
##             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433,
##                 ID[&quot;EPSG&quot;,9122]]]]</code></pre>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="overlaying-2d-rayshader-maps.html#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save out the buffered image</span></span>
<span id="cb268-2"><a href="overlaying-2d-rayshader-maps.html#cb268-2" aria-hidden="true" tabindex="-1"></a>stage_tif <span class="ot">=</span> <span class="st">&quot;buffered_stage_elevation.tif&quot;</span></span>
<span id="cb268-3"><a href="overlaying-2d-rayshader-maps.html#cb268-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Write the data to an elevation data raster tif</span></span>
<span id="cb268-4"><a href="overlaying-2d-rayshader-maps.html#cb268-4" aria-hidden="true" tabindex="-1"></a>raster<span class="sc">::</span><span class="fu">writeRaster</span>(elev_img2, stage_tif, <span class="at">overwrite=</span> <span class="cn">TRUE</span>)</span>
<span id="cb268-5"><a href="overlaying-2d-rayshader-maps.html#cb268-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-6"><a href="overlaying-2d-rayshader-maps.html#cb268-6" aria-hidden="true" tabindex="-1"></a>elmat_buffered <span class="ot">=</span>  <span class="fu">raster_to_matrix</span>(elev_img2)</span></code></pre></div>
<p>To create a buffered yellow route, we generate the line overlay with an extend matching that of the buffered image and the heightmap associated with that image:</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="overlaying-2d-rayshader-maps.html#cb269-1" aria-hidden="true" tabindex="-1"></a>yellow_route_b <span class="ot">=</span> <span class="fu">generate_line_overlay</span>(geojson_sf[<span class="dv">1</span>,],</span>
<span id="cb269-2"><a href="overlaying-2d-rayshader-maps.html#cb269-2" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">extent =</span> <span class="fu">extent</span>(elev_img2),</span>
<span id="cb269-3"><a href="overlaying-2d-rayshader-maps.html#cb269-3" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">heightmap =</span> elmat_buffered,</span>
<span id="cb269-4"><a href="overlaying-2d-rayshader-maps.html#cb269-4" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">linewidth =</span> <span class="dv">5</span>, <span class="at">color=</span><span class="st">&quot;yellow&quot;</span>)</span></code></pre></div>
<p>Plotting the buffered route in the buffered image now provides us with a marginal border around the edge of the route:</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="overlaying-2d-rayshader-maps.html#cb270-1" aria-hidden="true" tabindex="-1"></a>mapped_route_yellow <span class="ot">=</span> elmat_buffered <span class="sc">%&gt;%</span></span>
<span id="cb270-2"><a href="overlaying-2d-rayshader-maps.html#cb270-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sphere_shade</span>(<span class="at">sunangle =</span> <span class="sc">-</span><span class="dv">45</span>, <span class="at">texture =</span> <span class="st">&quot;bw&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb270-3"><a href="overlaying-2d-rayshader-maps.html#cb270-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_overlay</span>(yellow_route_b)  <span class="sc">%&gt;%</span></span>
<span id="cb270-4"><a href="overlaying-2d-rayshader-maps.html#cb270-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_map</span>()</span></code></pre></div>
<p><img src="images/rayshader-2d-overlays-mapped-yellow-1.png" width="672" /></p>
</div>
</div>
<div id="modeling-increased-water-levels" class="section level2" number="10.4">
<h2><span class="header-section-number">10.4</span> Modeling Increased Water Levels</h2>
<p>The <code>rayshader::plot_3d()</code> function takes a <em>water_depth</em> parameter that allows us to model changing water levels. This is not really relevant to rally route analysis and visualisation, although it may be of interest in other contexts (eg raising sea levels, historical views over land that as since been reclaimed from the sea, dam bursts, etc.)</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="using-rayshader-to-render-2d-elevation-and-shade-views.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="annotating-rayshader-maps.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toc_depth": 3,
"toolbar": {
"position": "fixed"
},
"search": true,
"info": true
});
});
</script>

</body>

</html>
