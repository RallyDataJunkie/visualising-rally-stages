```{r cache = T, echo = F, message=F}
# 9Allow knitr to continue to execute even in the presence of errors
knitr::opts_chunk$set(error = TRUE)
knitr::opts_chunk$set(fig.path = "images/stage-description-")
```
# Automatically Generating Stage Descriptions

Having annotated each line segment that makes up a rally stage route, can we use that information to help us create visual or even written, descriptions of a stage?

In terms of categorising turns in a way that's meaningful in a rally context, let's have a recap on what sorts of thing a rally navigator or co-driver is likely to be saying:

```{r rally-notes-codriver}
embed_url("https://www.youtube.com/watch?v=KFjRj25uclQ")
```

And let's review what we actually mean by a corner...

```{r chain-bear-corner-video}
embed_url("https://www.youtube.com/watch?v=YXOYckDATWE")
```

In terms of actual corners, the convexity interesting may be one of the more interesting properties. Finding a good way of representing variable radius turns (you did watch the "corners" video, didn't you?!) will also be important if we want to be able to identify "tightens" or "lessens" corner features. ANnd elevation changes in the vicinity of a corner are likely to be important if we are trying to characterise braking zone requirements...

## Jemba Inertia Notes System

In a section entitled *Using data to assess the suitability of a special stage*, the [*FIA Rally Safety Guidelines 2020*](https://www.fia.com/sites/default/files/2printable_rally_safety_guidelines_1.pdf) suggest that as well as using historic information, the "Jemba System" for recording terrain data, including "the inclines, the dips, the bends and crests". By also taking the road terrain (for example, gravel or asphalt) into account, and likely car classes, average speeds over the stage as well as highest speed  and heaviest braking areas can also be determined. THe system [can also report](https://jemba.se/inertia.htm) the *margin for critical braking dist before stop* ("how far you may carry on at competitive speed until you have to start braking to be able to stop at the stop control") and the Jemba Safety Index (J/kg), the average kinetic energy of a car going through the corners.

The FIA Safety Guidelines illustrate how speeds might be visualised over a Google Earth map using a three colour scale (purple:over 150kph; red: over 90kph; yellow â€“ 7590kph). The report also suggests that the Jemba system can predict the maximum cornering speed for any particular bend.

A Wikipedia page describing the [*Jemba Inertia Notes System*](https://en.wikipedia.org/wiki/Jemba_Inertia_Notes_System) gives examples of the descriptive and numerical labels that the Jemba system can generate as it converts odemtery and interal accelerometer data into something rather more human understandable. A [visual grading](http://www.jemba.se/GradeUSA.jpg) shows how descriptive labels correspond to turn angle.


## Generating Stage Descriptions

Being able to display route profiles on a map as a colour highlighted routeis very useful and could be made more so adding the data to a *leaflet.js* extension such as [`Leaflet.Heightgraph`](https://github.com/GIScience/Leaflet.Heightgraph), which displays arbitrary traces (to integrate this in the current workflow properly would require the development of an extension to the *R* `leaflet` package).

Another possibility would be to try to automate the creation of text based route descriptions ("robot journalism"), which I've crudely explored in other contexts elsewhere. The [*It Gets Faster Now*](https://itgetsfasternow.com/2021/01/19/route-preview-rallye-monte-carlo-2021/) blog publishes stage descriptions for WRC stage routes, so this could be a good place to learn tropes from.
